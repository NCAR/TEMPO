var tipuesearch = {"pages":[{"title":" TEMPO Microphysics ","text":"TEMPO Microphysics Developer Info Anders A. Jensen","tags":"home","url":"index.html"},{"title":"ty_tempo_driver_diags – TEMPO Microphysics ","text":"type, public :: ty_tempo_driver_diags Components Type Visibility Attributes Name Initial real(kind=wp), public, dimension(:,:), allocatable :: rain_precip real(kind=wp), public, dimension(:,:), allocatable :: ice_liquid_equiv_precip real(kind=wp), public, dimension(:,:), allocatable :: snow_liquid_equiv_precip real(kind=wp), public, dimension(:,:), allocatable :: graupel_liquid_equiv_precip real(kind=wp), public, dimension(:,:), allocatable :: frozen_fraction real(kind=wp), public, dimension(:,:), allocatable :: frz_rain_precip real(kind=wp), public, dimension(:,:), allocatable :: max_hail_diameter_sfc real(kind=wp), public, dimension(:,:), allocatable :: max_hail_diameter_column real(kind=wp), public, dimension(:,:,:), allocatable :: refl10cm real(kind=wp), public, dimension(:,:,:), allocatable :: re_cloud real(kind=wp), public, dimension(:,:,:), allocatable :: re_ice real(kind=wp), public, dimension(:,:,:), allocatable :: re_snow real(kind=wp), public, dimension(:,:,:), allocatable :: rain_med_vol_diam real(kind=wp), public, dimension(:,:,:), allocatable :: graupel_med_vol_diam real(kind=wp), public, dimension(:,:,:), allocatable :: cloud_number_mixing_ratio","tags":"","url":"type/ty_tempo_driver_diags.html"},{"title":"ty_tempo_cfgs – TEMPO Microphysics ","text":"type, public :: ty_tempo_cfgs \\section arg_table_ty_tempo_cfgs Argument Table\n\\htmlinclude ty_tempo_cfgs.html Components Type Visibility Attributes Name Initial logical, public :: aerosolaware_flag = .true. flag to run aerosol-aware microphysics logical, public :: hailaware_flag = .true. flag to run hail-aware microphysics logical, public :: ml_for_bl_nc_flag = .false. flag to run machine-learning prediction for subgrid cloud number concentration logical, public :: ml_for_nc_flag = .false. flag to run machine-learning prediction for tempo cloud number concentration logical, public :: semi_sedi_flag = .false. flag for semi-lagrangian sedimentation logical, public :: refl10cm_from_melting_flag = .false. flag to calculate reflectivity for melting snow and graupel logical, public :: turn_off_micro_flag = .false. flag to turn off all microphysical processes logical, public :: verbose = .false. flag to turn on verbose print statements logical, public :: refl10cm_flag = .true. flag to output 10cm reflectivity logical, public :: re_cloud_flag = .true. flag to output cloud effective radius logical, public :: re_ice_flag = .true. flag to output ice effective radius logical, public :: re_snow_flag = .true. flag to output snow effective radius logical, public :: max_hail_diameter_flag = .true. flag to output maximum hail diameter logical, public :: rain_med_vol_diam_flag = .false. flag to output median volume diameter for rain logical, public :: graupel_med_vol_diam_flag = .false. flag to output median volume diameter for graupel logical, public :: cloud_number_mixing_ratio_flag = .false. flag to output cloud number mixing ratio","tags":"","url":"type/ty_tempo_cfgs.html"},{"title":"ty_tempo_table_cfgs – TEMPO Microphysics ","text":"type, public :: ty_tempo_table_cfgs Components Type Visibility Attributes Name Initial character(len=100), public :: ccn_table_name = 'ccn_activate.bin' ccn table name character(len=100), public :: qrqg_table_name = 'qr_acr_qg_data_tempo_v3' rain-graupel collection table name character(len=100), public :: qrqs_table_name = 'qr_acr_qs_data_tempo_v3' rain-snow collection table name character(len=100), public :: freezewater_table_name = 'freeze_water_data_tempo_v3' freeze water collection table name","tags":"","url":"type/ty_tempo_table_cfgs.html"},{"title":"ty_tempo_ml_data – TEMPO Microphysics ","text":"type, public :: ty_tempo_ml_data Components Type Visibility Attributes Name Initial integer, public :: input_size integer, public :: output_size integer, public :: node_size real(kind=wp), public, dimension(:), allocatable :: transform_mean real(kind=wp), public, dimension(:), allocatable :: transform_var real(kind=wp), public, dimension(:,:), allocatable :: weights00 real(kind=wp), public, dimension(:), allocatable :: bias00 real(kind=wp), public, dimension(:,:), allocatable :: weights01 real(kind=wp), public, dimension(:), allocatable :: bias01","tags":"","url":"type/ty_tempo_ml_data.html"},{"title":"ty_tempo_main_diags – TEMPO Microphysics ","text":"type, public :: ty_tempo_main_diags Components Type Visibility Attributes Name Initial real(kind=wp), public :: rain_precip real(kind=wp), public :: cloud_precip real(kind=wp), public :: ice_liquid_equiv_precip real(kind=wp), public :: snow_liquid_equiv_precip real(kind=wp), public :: graupel_liquid_equiv_precip real(kind=wp), public :: frozen_fraction real(kind=wp), public :: frz_rain_precip real(kind=wp), public, dimension(:), allocatable :: rain_med_vol_diam real(kind=wp), public, dimension(:), allocatable :: graupel_med_vol_diam real(kind=wp), public, dimension(:), allocatable :: refl10cm real(kind=wp), public, dimension(:), allocatable :: re_cloud real(kind=wp), public, dimension(:), allocatable :: re_ice real(kind=wp), public, dimension(:), allocatable :: re_snow real(kind=wp), public, dimension(:), allocatable :: max_hail_diameter real(kind=wp), public, dimension(:), allocatable :: cloud_number_mixing_ratio","tags":"","url":"type/ty_tempo_main_diags.html"},{"title":"ty_tend – TEMPO Microphysics ","text":"type, private :: ty_tend Components Type Visibility Attributes Name Initial real(kind=dp), public, allocatable, dimension(:) :: prr_wau real(kind=dp), public, allocatable, dimension(:) :: pnr_wau real(kind=dp), public, allocatable, dimension(:) :: pnc_wau real(kind=dp), public, allocatable, dimension(:) :: prr_rcw real(kind=dp), public, allocatable, dimension(:) :: pnc_rcw real(kind=dp), public, allocatable, dimension(:) :: pnr_rcr real(kind=dp), public, allocatable, dimension(:) :: prs_scw real(kind=dp), public, allocatable, dimension(:) :: pnc_scw real(kind=dp), public, allocatable, dimension(:) :: png_scw real(kind=dp), public, allocatable, dimension(:) :: pbg_scw real(kind=dp), public, allocatable, dimension(:) :: prg_gcw real(kind=dp), public, allocatable, dimension(:) :: pnc_gcw real(kind=dp), public, allocatable, dimension(:) :: pbg_gcw real(kind=dp), public, allocatable, dimension(:) :: pri_ihm real(kind=dp), public, allocatable, dimension(:) :: pni_ihm real(kind=dp), public, allocatable, dimension(:) :: prs_ihm real(kind=dp), public, allocatable, dimension(:) :: prg_ihm real(kind=dp), public, allocatable, dimension(:) :: prg_scw real(kind=dp), public, allocatable, dimension(:) :: prr_rcs real(kind=dp), public, allocatable, dimension(:) :: pnr_rcs real(kind=dp), public, allocatable, dimension(:) :: prg_rcs real(kind=dp), public, allocatable, dimension(:) :: png_rcs real(kind=dp), public, allocatable, dimension(:) :: prs_rcs real(kind=dp), public, allocatable, dimension(:) :: pbg_rcs real(kind=dp), public, allocatable, dimension(:) :: prr_rcg real(kind=dp), public, allocatable, dimension(:) :: pnr_rcg real(kind=dp), public, allocatable, dimension(:) :: prg_rcg real(kind=dp), public, allocatable, dimension(:) :: png_rcg real(kind=dp), public, allocatable, dimension(:) :: pbg_rcg real(kind=dp), public, allocatable, dimension(:) :: pri_inu real(kind=dp), public, allocatable, dimension(:) :: pni_inu real(kind=dp), public, allocatable, dimension(:) :: pri_iha real(kind=dp), public, allocatable, dimension(:) :: pni_iha real(kind=dp), public, allocatable, dimension(:) :: pri_wfz real(kind=dp), public, allocatable, dimension(:) :: pni_wfz real(kind=dp), public, allocatable, dimension(:) :: prg_rfz real(kind=dp), public, allocatable, dimension(:) :: png_rfz real(kind=dp), public, allocatable, dimension(:) :: pnr_rfz real(kind=dp), public, allocatable, dimension(:) :: pri_rfz real(kind=dp), public, allocatable, dimension(:) :: pni_rfz real(kind=dp), public, allocatable, dimension(:) :: pbg_rfz real(kind=dp), public, allocatable, dimension(:) :: prs_sde real(kind=dp), public, allocatable, dimension(:) :: pri_ide real(kind=dp), public, allocatable, dimension(:) :: pni_ide real(kind=dp), public, allocatable, dimension(:) :: prs_ide real(kind=dp), public, allocatable, dimension(:) :: prg_gde real(kind=dp), public, allocatable, dimension(:) :: png_gde real(kind=dp), public, allocatable, dimension(:) :: pni_iau real(kind=dp), public, allocatable, dimension(:) :: prs_iau real(kind=dp), public, allocatable, dimension(:) :: prr_sml real(kind=dp), public, allocatable, dimension(:) :: prr_gml real(kind=dp), public, allocatable, dimension(:) :: pbg_sml real(kind=dp), public, allocatable, dimension(:) :: pbg_gml real(kind=dp), public, allocatable, dimension(:) :: pnr_sml real(kind=dp), public, allocatable, dimension(:) :: pnr_gml real(kind=dp), public, allocatable, dimension(:) :: prr_rci real(kind=dp), public, allocatable, dimension(:) :: pnr_rci real(kind=dp), public, allocatable, dimension(:) :: pri_rci real(kind=dp), public, allocatable, dimension(:) :: pni_rci real(kind=dp), public, allocatable, dimension(:) :: prg_rci real(kind=dp), public, allocatable, dimension(:) :: png_rci real(kind=dp), public, allocatable, dimension(:) :: pbg_rci real(kind=dp), public, allocatable, dimension(:) :: pni_sci real(kind=dp), public, allocatable, dimension(:) :: prs_sci real(kind=dp), public, allocatable, dimension(:) :: prw_vcd real(kind=dp), public, allocatable, dimension(:) :: pnc_wcd real(kind=dp), public, allocatable, dimension(:) :: prv_rev real(kind=dp), public, allocatable, dimension(:) :: pnr_rev real(kind=dp), public, allocatable, dimension(:) :: pna_rca real(kind=dp), public, allocatable, dimension(:) :: pna_sca real(kind=dp), public, allocatable, dimension(:) :: pna_gca real(kind=dp), public, allocatable, dimension(:) :: pnd_rcd real(kind=dp), public, allocatable, dimension(:) :: pnd_scd real(kind=dp), public, allocatable, dimension(:) :: pnd_gcd","tags":"","url":"type/ty_tend.html"},{"title":"aerosol_collection_efficiency – TEMPO Microphysics","text":"public  function aerosol_collection_efficiency(d, da, visc, rhoa, temp, species) result(eff_a) Uses module_mp_tempo_params proc~~aerosol_collection_efficiency~~UsesGraph proc~aerosol_collection_efficiency aerosol_collection_efficiency module~module_mp_tempo_params module_mp_tempo_params proc~aerosol_collection_efficiency->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes aerosol collection efficiency for precipitation scavenging\nfrom Wang et al. (2010) Arguments Type Intent Optional Attributes Name real(kind=dp), intent(in) :: d real(kind=wp), intent(in) :: da real(kind=wp), intent(in) :: visc real(kind=wp), intent(in) :: rhoa real(kind=wp), intent(in) :: temp character(len=1), intent(in) :: species Return Value real(kind=wp) Called by proc~~aerosol_collection_efficiency~~CalledByGraph proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging aerosol_scavenging proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~tempo_main tempo_main proc~tempo_main->proc~aerosol_scavenging proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/aerosol_collection_efficiency.html"},{"title":"init_water_friendly_aerosols – TEMPO Microphysics","text":"public  subroutine init_water_friendly_aerosols(dz1d, nwfa) sets water-friendly aerosols to an exponential profile\nif aerosol-aware = true and no initial condition\nis provided by the host model Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: nwfa Called by proc~~init_water_friendly_aerosols~~CalledByGraph proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main tempo_main proc~tempo_main->proc~init_water_friendly_aerosols proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/init_water_friendly_aerosols.html"},{"title":"init_ice_friendly_aerosols – TEMPO Microphysics","text":"public  subroutine init_ice_friendly_aerosols(dz1d, nifa) sets ice-friendly aerosols to an exponential profile\nif aerosol-aware = true and no initial condition\nis provided by the host model Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: nifa Called by proc~~init_ice_friendly_aerosols~~CalledByGraph proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main tempo_main proc~tempo_main->proc~init_ice_friendly_aerosols proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/init_ice_friendly_aerosols.html"},{"title":"test_tempo_init – TEMPO Microphysics","text":"public  subroutine test_tempo_init() test tempo initialization procedure\nuse ml_for_bl_nc_flag = .true. to initialize ml data\nwhich is used for a few tests\ntest specific flags are then set in each test Arguments None Calls proc~~test_tempo_init~~CallsGraph proc~test_tempo_init test_tempo_init proc~tempo_init tempo_init proc~test_tempo_init->proc~tempo_init proc~compute_drop_evap compute_drop_evap proc~tempo_init->proc~compute_drop_evap proc~compute_efrw compute_efrw proc~tempo_init->proc~compute_efrw proc~compute_efsw compute_efsw proc~tempo_init->proc~compute_efsw proc~get_version get_version proc~tempo_init->proc~get_version proc~init_ml_data init_ml_data proc~tempo_init->proc~init_ml_data proc~initialize_array_efrw initialize_array_efrw proc~tempo_init->proc~initialize_array_efrw proc~initialize_array_efsw initialize_array_efsw proc~tempo_init->proc~initialize_array_efsw proc~initialize_arrays_ccn initialize_arrays_ccn proc~tempo_init->proc~initialize_arrays_ccn proc~initialize_arrays_drop_evap initialize_arrays_drop_evap proc~tempo_init->proc~initialize_arrays_drop_evap proc~initialize_arrays_freezewater initialize_arrays_freezewater proc~tempo_init->proc~initialize_arrays_freezewater proc~initialize_arrays_qi_aut_qs initialize_arrays_qi_aut_qs proc~tempo_init->proc~initialize_arrays_qi_aut_qs proc~initialize_arrays_qr_acr_qg initialize_arrays_qr_acr_qg proc~tempo_init->proc~initialize_arrays_qr_acr_qg proc~initialize_arrays_qr_acr_qs initialize_arrays_qr_acr_qs proc~tempo_init->proc~initialize_arrays_qr_acr_qs proc~initialize_bins_for_hail_size initialize_bins_for_hail_size proc~tempo_init->proc~initialize_bins_for_hail_size proc~initialize_bins_for_radar initialize_bins_for_radar proc~tempo_init->proc~initialize_bins_for_radar proc~initialize_bins_for_tables initialize_bins_for_tables proc~tempo_init->proc~initialize_bins_for_tables proc~initialize_graupel_vars initialize_graupel_vars proc~tempo_init->proc~initialize_graupel_vars proc~initialize_parameters initialize_parameters proc~tempo_init->proc~initialize_parameters proc~qi_aut_qs qi_aut_qs proc~tempo_init->proc~qi_aut_qs proc~read_table_ccn read_table_ccn proc~tempo_init->proc~read_table_ccn proc~read_table_freezewater read_table_freezewater proc~tempo_init->proc~read_table_freezewater proc~read_table_qr_acr_qg read_table_qr_acr_qg proc~tempo_init->proc~read_table_qr_acr_qg proc~read_table_qr_acr_qs read_table_qr_acr_qs proc~tempo_init->proc~read_table_qr_acr_qs proc~get_nuc get_nuc proc~compute_drop_evap->proc~get_nuc proc~save_or_read_ml_data save_or_read_ml_data proc~init_ml_data->proc~save_or_read_ml_data proc~create_bins create_bins proc~initialize_bins_for_hail_size->proc~create_bins proc~initialize_bins_for_radar->proc~create_bins proc~initialize_bins_for_tables->proc~create_bins proc~calc_gamma_p calc_gamma_p proc~qi_aut_qs->proc~calc_gamma_p proc~check_before_table_read check_before_table_read proc~read_table_ccn->proc~check_before_table_read proc~read_table_freezewater->proc~check_before_table_read proc~read_table_qr_acr_qg->proc~check_before_table_read proc~read_table_qr_acr_qs->proc~check_before_table_read proc~calc_gamma_cf calc_gamma_cf proc~calc_gamma_p->proc~calc_gamma_cf proc~calc_gamma_series calc_gamma_series proc~calc_gamma_p->proc~calc_gamma_series Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~test_tempo_init~~CalledByGraph proc~test_tempo_init test_tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/test_tempo_init.html"},{"title":"test_graupel_sedimentation – TEMPO Microphysics","text":"public  subroutine test_graupel_sedimentation(dt, semi_sedi) Uses module_mp_tempo_params proc~~test_graupel_sedimentation~~UsesGraph proc~test_graupel_sedimentation test_graupel_sedimentation module~module_mp_tempo_params module_mp_tempo_params proc~test_graupel_sedimentation->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. test graupel sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt logical, intent(in) :: semi_sedi Calls proc~~test_graupel_sedimentation~~CallsGraph proc~test_graupel_sedimentation test_graupel_sedimentation proc~tempo_run tempo_run proc~test_graupel_sedimentation->proc~tempo_run proc~tempo_main tempo_main proc~tempo_run->proc~tempo_main interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~snow_moments proc~effective_radius->proc~get_nuc proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~test_graupel_sedimentation~~CalledByGraph proc~test_graupel_sedimentation test_graupel_sedimentation program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_graupel_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/test_graupel_sedimentation.html"},{"title":"test_snow_sedimentation – TEMPO Microphysics","text":"public  subroutine test_snow_sedimentation(dt) Uses module_mp_tempo_params proc~~test_snow_sedimentation~~UsesGraph proc~test_snow_sedimentation test_snow_sedimentation module~module_mp_tempo_params module_mp_tempo_params proc~test_snow_sedimentation->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt Calls proc~~test_snow_sedimentation~~CallsGraph proc~test_snow_sedimentation test_snow_sedimentation proc~tempo_run tempo_run proc~test_snow_sedimentation->proc~tempo_run proc~tempo_main tempo_main proc~tempo_run->proc~tempo_main interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~snow_moments proc~effective_radius->proc~get_nuc proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~test_snow_sedimentation~~CalledByGraph proc~test_snow_sedimentation test_snow_sedimentation program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/test_snow_sedimentation.html"},{"title":"test_cloud_number_aerosolaware – TEMPO Microphysics","text":"public  subroutine test_cloud_number_aerosolaware(dt) Uses module_mp_tempo_params proc~~test_cloud_number_aerosolaware~~UsesGraph proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware module~module_mp_tempo_params module_mp_tempo_params proc~test_cloud_number_aerosolaware->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt Calls proc~~test_cloud_number_aerosolaware~~CallsGraph proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~tempo_run tempo_run proc~test_cloud_number_aerosolaware->proc~tempo_run proc~tempo_main tempo_main proc~tempo_run->proc~tempo_main interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~snow_moments proc~effective_radius->proc~get_nuc proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~test_cloud_number_aerosolaware~~CalledByGraph proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/test_cloud_number_aerosolaware.html"},{"title":"test_cloud_number_non_aerosolaware – TEMPO Microphysics","text":"public  subroutine test_cloud_number_non_aerosolaware(dt) Uses module_mp_tempo_params proc~~test_cloud_number_non_aerosolaware~~UsesGraph proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware module~module_mp_tempo_params module_mp_tempo_params proc~test_cloud_number_non_aerosolaware->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt Calls proc~~test_cloud_number_non_aerosolaware~~CallsGraph proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~tempo_run tempo_run proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~tempo_main tempo_main proc~tempo_run->proc~tempo_main interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~snow_moments proc~effective_radius->proc~get_nuc proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~test_cloud_number_non_aerosolaware~~CalledByGraph proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/test_cloud_number_non_aerosolaware.html"},{"title":"test_cloud_number_ml – TEMPO Microphysics","text":"public  subroutine test_cloud_number_ml(dt) Uses module_mp_tempo_params proc~~test_cloud_number_ml~~UsesGraph proc~test_cloud_number_ml test_cloud_number_ml module~module_mp_tempo_params module_mp_tempo_params proc~test_cloud_number_ml->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt Calls proc~~test_cloud_number_ml~~CallsGraph proc~test_cloud_number_ml test_cloud_number_ml proc~tempo_run tempo_run proc~test_cloud_number_ml->proc~tempo_run proc~tempo_main tempo_main proc~tempo_run->proc~tempo_main interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~snow_moments proc~effective_radius->proc~get_nuc proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~test_cloud_number_ml~~CalledByGraph proc~test_cloud_number_ml test_cloud_number_ml program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_ml Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/test_cloud_number_ml.html"},{"title":"test_ml_cloud_effective_radius – TEMPO Microphysics","text":"public  subroutine test_ml_cloud_effective_radius(dt) Uses module_mp_tempo_params proc~~test_ml_cloud_effective_radius~~UsesGraph proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius module~module_mp_tempo_params module_mp_tempo_params proc~test_ml_cloud_effective_radius->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt Calls proc~~test_ml_cloud_effective_radius~~CallsGraph proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~tempo_run tempo_run proc~test_ml_cloud_effective_radius->proc~tempo_run proc~tempo_main tempo_main proc~tempo_run->proc~tempo_main interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~snow_moments proc~effective_radius->proc~get_nuc proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~test_ml_cloud_effective_radius~~CalledByGraph proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_ml_cloud_effective_radius Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/test_ml_cloud_effective_radius.html"},{"title":"tempo_init – TEMPO Microphysics","text":"public  subroutine tempo_init(aerosolaware_flag, hailaware_flag, ml_for_bl_nc_flag, ml_for_nc_flag, force_init_flag, tempo_cfgs) Uses module_mp_tempo_params proc~~tempo_init~~UsesGraph proc~tempo_init tempo_init module~module_mp_tempo_params module_mp_tempo_params proc~tempo_init->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. initialize tempo microphysics\n\\section arg_table_tempo_init Argument Table\n\\htmlinclude tempo_init.html initialize tempo microphysics Arguments Type Intent Optional Attributes Name logical, intent(in), optional :: aerosolaware_flag logical, intent(in), optional :: hailaware_flag logical, intent(in), optional :: ml_for_bl_nc_flag logical, intent(in), optional :: ml_for_nc_flag logical, intent(in), optional :: force_init_flag type( ty_tempo_cfgs ), intent(out) :: tempo_cfgs Calls proc~~tempo_init~~CallsGraph proc~tempo_init tempo_init proc~compute_drop_evap compute_drop_evap proc~tempo_init->proc~compute_drop_evap proc~compute_efrw compute_efrw proc~tempo_init->proc~compute_efrw proc~compute_efsw compute_efsw proc~tempo_init->proc~compute_efsw proc~get_version get_version proc~tempo_init->proc~get_version proc~init_ml_data init_ml_data proc~tempo_init->proc~init_ml_data proc~initialize_array_efrw initialize_array_efrw proc~tempo_init->proc~initialize_array_efrw proc~initialize_array_efsw initialize_array_efsw proc~tempo_init->proc~initialize_array_efsw proc~initialize_arrays_ccn initialize_arrays_ccn proc~tempo_init->proc~initialize_arrays_ccn proc~initialize_arrays_drop_evap initialize_arrays_drop_evap proc~tempo_init->proc~initialize_arrays_drop_evap proc~initialize_arrays_freezewater initialize_arrays_freezewater proc~tempo_init->proc~initialize_arrays_freezewater proc~initialize_arrays_qi_aut_qs initialize_arrays_qi_aut_qs proc~tempo_init->proc~initialize_arrays_qi_aut_qs proc~initialize_arrays_qr_acr_qg initialize_arrays_qr_acr_qg proc~tempo_init->proc~initialize_arrays_qr_acr_qg proc~initialize_arrays_qr_acr_qs initialize_arrays_qr_acr_qs proc~tempo_init->proc~initialize_arrays_qr_acr_qs proc~initialize_bins_for_hail_size initialize_bins_for_hail_size proc~tempo_init->proc~initialize_bins_for_hail_size proc~initialize_bins_for_radar initialize_bins_for_radar proc~tempo_init->proc~initialize_bins_for_radar proc~initialize_bins_for_tables initialize_bins_for_tables proc~tempo_init->proc~initialize_bins_for_tables proc~initialize_graupel_vars initialize_graupel_vars proc~tempo_init->proc~initialize_graupel_vars proc~initialize_parameters initialize_parameters proc~tempo_init->proc~initialize_parameters proc~qi_aut_qs qi_aut_qs proc~tempo_init->proc~qi_aut_qs proc~read_table_ccn read_table_ccn proc~tempo_init->proc~read_table_ccn proc~read_table_freezewater read_table_freezewater proc~tempo_init->proc~read_table_freezewater proc~read_table_qr_acr_qg read_table_qr_acr_qg proc~tempo_init->proc~read_table_qr_acr_qg proc~read_table_qr_acr_qs read_table_qr_acr_qs proc~tempo_init->proc~read_table_qr_acr_qs proc~get_nuc get_nuc proc~compute_drop_evap->proc~get_nuc proc~save_or_read_ml_data save_or_read_ml_data proc~init_ml_data->proc~save_or_read_ml_data proc~create_bins create_bins proc~initialize_bins_for_hail_size->proc~create_bins proc~initialize_bins_for_radar->proc~create_bins proc~initialize_bins_for_tables->proc~create_bins proc~calc_gamma_p calc_gamma_p proc~qi_aut_qs->proc~calc_gamma_p proc~check_before_table_read check_before_table_read proc~read_table_ccn->proc~check_before_table_read proc~read_table_freezewater->proc~check_before_table_read proc~read_table_qr_acr_qg->proc~check_before_table_read proc~read_table_qr_acr_qs->proc~check_before_table_read proc~calc_gamma_cf calc_gamma_cf proc~calc_gamma_p->proc~calc_gamma_cf proc~calc_gamma_series calc_gamma_series proc~calc_gamma_p->proc~calc_gamma_series Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~tempo_init~~CalledByGraph proc~tempo_init tempo_init proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/tempo_init.html"},{"title":"tempo_run – TEMPO Microphysics","text":"public  subroutine tempo_run(tempo_cfgs, dt, itimestep, t, th, pii, p, w, dz, qv, qc, qr, qi, qs, qg, ni, nr, nc, nwfa, nifa, ng, qb, qc_bl, qcfrac_bl, qcfrac, qifrac, thten_bl, qvten_bl, qcten_bl, qiten_bl, thten_lwrad, thten_swrad, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte, tempo_diags) \\section arg_table_tempo_run Argument Table\n\\htmlinclude tempo_run.html Arguments Type Intent Optional Attributes Name type( ty_tempo_cfgs ), intent(in) :: tempo_cfgs real(kind=wp), intent(in) :: dt timestep integer, intent(in) :: itimestep integer timestep = integration time / dt real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: t temperature real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: th theta real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: pii exner function real(kind=wp), intent(in), dimension(ims:ime, kms:kme, jms:jme) :: p pressure real(kind=wp), intent(in), dimension(ims:ime, kms:kme, jms:jme) :: w vertical velocity real(kind=wp), intent(in), dimension(ims:ime, kms:kme, jms:jme) :: dz vertical grid spacing real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qv 3D water vapor mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qc 3D cloud water mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qr 3D rain water mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qi 3D cloud ice mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qs 3D snow mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qg 3D graupel mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: ni 3D cloud ice number mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: nr 3D rain water number mixing ratio real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: nc 3D cloud water number mixing ratio (aerosol-aware) real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: nwfa 3D water-friendly aerosol number mixing ratio (aerosol-aware) real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: nifa 3D ice-friendly aerosol number mixing ratio (aerosol-aware) real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: ng 3D graupel number mixing ratio (hail-aware) real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: qb 3D graupel volume mixing ratio (hail-aware) real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qc_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qcfrac_bl real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: qcfrac real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: qifrac real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: thten_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qvten_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qcten_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qiten_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: thten_lwrad real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: thten_swrad integer, intent(in) :: ids domain locations integer, intent(in) :: ide domain locations integer, intent(in) :: jds domain locations integer, intent(in) :: jde domain locations integer, intent(in) :: kds domain locations integer, intent(in) :: kde domain locations integer, intent(in) :: ims memory locations integer, intent(in) :: ime memory locations integer, intent(in) :: jms memory locations integer, intent(in) :: jme memory locations integer, intent(in) :: kms memory locations integer, intent(in) :: kme memory locations integer, intent(in) :: its tile locations integer, intent(in) :: ite tile locations integer, intent(in) :: jts tile locations integer, intent(in) :: jte tile locations integer, intent(in) :: kts tile locations integer, intent(in) :: kte tile locations type( ty_tempo_driver_diags ), intent(out) :: tempo_diags Calls proc~~tempo_run~~CallsGraph proc~tempo_run tempo_run proc~tempo_main tempo_main proc~tempo_run->proc~tempo_main interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~snow_moments proc~effective_radius->proc~get_nuc proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~tempo_run~~CalledByGraph proc~tempo_run tempo_run proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/tempo_run.html"},{"title":"tempo_aerosol_surface_emissions – TEMPO Microphysics","text":"public  subroutine tempo_aerosol_surface_emissions(dt, nwfa, nwfa2d, ims, ime, jms, jme, kms, kme, kts) adds aerosol surface emissions to the 3D field Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: nwfa real(kind=wp), intent(in), dimension(ims:ime, jms:jme) :: nwfa2d integer, intent(in) :: ims integer, intent(in) :: ime integer, intent(in) :: jms integer, intent(in) :: jme integer, intent(in) :: kms integer, intent(in) :: kme integer, intent(in) :: kts","tags":"","url":"proc/tempo_aerosol_surface_emissions.html"},{"title":"read_table_freezewater – TEMPO Microphysics","text":"private  subroutine read_table_freezewater(filename, table_size) Uses module_mp_tempo_params proc~~read_table_freezewater~~UsesGraph proc~read_table_freezewater read_table_freezewater module~module_mp_tempo_params module_mp_tempo_params proc~read_table_freezewater->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. read lookup table for frozen cloud and rain water Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size Calls proc~~read_table_freezewater~~CallsGraph proc~read_table_freezewater read_table_freezewater proc~check_before_table_read check_before_table_read proc~read_table_freezewater->proc~check_before_table_read Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~read_table_freezewater~~CalledByGraph proc~read_table_freezewater read_table_freezewater proc~tempo_init tempo_init proc~tempo_init->proc~read_table_freezewater proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/read_table_freezewater.html"},{"title":"read_table_qr_acr_qs – TEMPO Microphysics","text":"private  subroutine read_table_qr_acr_qs(filename, table_size) Uses module_mp_tempo_params proc~~read_table_qr_acr_qs~~UsesGraph proc~read_table_qr_acr_qs read_table_qr_acr_qs module~module_mp_tempo_params module_mp_tempo_params proc~read_table_qr_acr_qs->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. read lookup table for rain-snow collection Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size Calls proc~~read_table_qr_acr_qs~~CallsGraph proc~read_table_qr_acr_qs read_table_qr_acr_qs proc~check_before_table_read check_before_table_read proc~read_table_qr_acr_qs->proc~check_before_table_read Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~read_table_qr_acr_qs~~CalledByGraph proc~read_table_qr_acr_qs read_table_qr_acr_qs proc~tempo_init tempo_init proc~tempo_init->proc~read_table_qr_acr_qs proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/read_table_qr_acr_qs.html"},{"title":"read_table_qr_acr_qg – TEMPO Microphysics","text":"private  subroutine read_table_qr_acr_qg(filename, table_size) Uses module_mp_tempo_params proc~~read_table_qr_acr_qg~~UsesGraph proc~read_table_qr_acr_qg read_table_qr_acr_qg module~module_mp_tempo_params module_mp_tempo_params proc~read_table_qr_acr_qg->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. read lookup table for rain-graupel collection Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size Calls proc~~read_table_qr_acr_qg~~CallsGraph proc~read_table_qr_acr_qg read_table_qr_acr_qg proc~check_before_table_read check_before_table_read proc~read_table_qr_acr_qg->proc~check_before_table_read Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~read_table_qr_acr_qg~~CalledByGraph proc~read_table_qr_acr_qg read_table_qr_acr_qg proc~tempo_init tempo_init proc~tempo_init->proc~read_table_qr_acr_qg proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/read_table_qr_acr_qg.html"},{"title":"read_table_ccn – TEMPO Microphysics","text":"private  subroutine read_table_ccn(filename, table_size) Uses module_mp_tempo_params proc~~read_table_ccn~~UsesGraph proc~read_table_ccn read_table_ccn module~module_mp_tempo_params module_mp_tempo_params proc~read_table_ccn->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. read static file containing CCN activation of aerosols;\nthe data were created from a parcel model by Feingold and Heymsfield (1992)\nhttps://doi.org/10.1175/1520-0469(1992)049<2325:POCGOD>2.0.CO;2\nwith further changes by Eidhammer and Kreidenweis Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size Calls proc~~read_table_ccn~~CallsGraph proc~read_table_ccn read_table_ccn proc~check_before_table_read check_before_table_read proc~read_table_ccn->proc~check_before_table_read Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~read_table_ccn~~CalledByGraph proc~read_table_ccn read_table_ccn proc~tempo_init tempo_init proc~tempo_init->proc~read_table_ccn proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/read_table_ccn.html"},{"title":"check_before_table_read – TEMPO Microphysics","text":"private  subroutine check_before_table_read(filename, table_size) checks that lookup tables exist and are the correct size\nbefore attempting to read them Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size Called by proc~~check_before_table_read~~CalledByGraph proc~check_before_table_read check_before_table_read proc~read_table_ccn read_table_ccn proc~read_table_ccn->proc~check_before_table_read proc~read_table_freezewater read_table_freezewater proc~read_table_freezewater->proc~check_before_table_read proc~read_table_qr_acr_qg read_table_qr_acr_qg proc~read_table_qr_acr_qg->proc~check_before_table_read proc~read_table_qr_acr_qs read_table_qr_acr_qs proc~read_table_qr_acr_qs->proc~check_before_table_read proc~tempo_init tempo_init proc~tempo_init->proc~read_table_ccn proc~tempo_init->proc~read_table_freezewater proc~tempo_init->proc~read_table_qr_acr_qg proc~tempo_init->proc~read_table_qr_acr_qs proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/check_before_table_read.html"},{"title":"init_ml_data – TEMPO Microphysics","text":"private  subroutine init_ml_data() initialize machine learning data for tempo microphysics Arguments None Calls proc~~init_ml_data~~CallsGraph proc~init_ml_data init_ml_data proc~save_or_read_ml_data save_or_read_ml_data proc~init_ml_data->proc~save_or_read_ml_data Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~init_ml_data~~CalledByGraph proc~init_ml_data init_ml_data proc~tempo_init tempo_init proc~tempo_init->proc~init_ml_data proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/init_ml_data.html"},{"title":"tempo_build_tables – TEMPO Microphysics","text":"public  subroutine tempo_build_tables(build_tables_rank, build_tables_num_proc) Uses module_mp_tempo_params proc~~tempo_build_tables~~UsesGraph proc~tempo_build_tables tempo_build_tables module~module_mp_tempo_params module_mp_tempo_params proc~tempo_build_tables->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. builds three lookup tables for tempo microphysics Arguments Type Intent Optional Attributes Name integer, intent(in) :: build_tables_rank integer, intent(in) :: build_tables_num_proc Calls proc~~tempo_build_tables~~CallsGraph proc~tempo_build_tables tempo_build_tables proc~build_table_freezewater build_table_freezewater proc~tempo_build_tables->proc~build_table_freezewater proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~tempo_build_tables->proc~build_table_qr_acr_qg proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~tempo_build_tables->proc~build_table_qr_acr_qs proc~get_version get_version proc~tempo_build_tables->proc~get_version proc~initialize_bins_for_tables initialize_bins_for_tables proc~tempo_build_tables->proc~initialize_bins_for_tables proc~initialize_graupel_vars initialize_graupel_vars proc~tempo_build_tables->proc~initialize_graupel_vars proc~initialize_parameters initialize_parameters proc~tempo_build_tables->proc~initialize_parameters proc~write_table_freezewater write_table_freezewater proc~tempo_build_tables->proc~write_table_freezewater proc~write_table_qr_acr_qg write_table_qr_acr_qg proc~tempo_build_tables->proc~write_table_qr_acr_qg proc~write_table_qr_acr_qs write_table_qr_acr_qs proc~tempo_build_tables->proc~write_table_qr_acr_qs proc~freezewater freezewater proc~build_table_freezewater->proc~freezewater proc~initialize_arrays_freezewater initialize_arrays_freezewater proc~build_table_freezewater->proc~initialize_arrays_freezewater mpi_allgather mpi_allgather proc~build_table_qr_acr_qg->mpi_allgather mpi_barrier mpi_barrier proc~build_table_qr_acr_qg->mpi_barrier mpi_wtime mpi_wtime proc~build_table_qr_acr_qg->mpi_wtime proc~gather gather proc~build_table_qr_acr_qg->proc~gather proc~get_index_for_rank get_index_for_rank proc~build_table_qr_acr_qg->proc~get_index_for_rank proc~initialize_arrays_qr_acr_qg initialize_arrays_qr_acr_qg proc~build_table_qr_acr_qg->proc~initialize_arrays_qr_acr_qg proc~qr_acr_qg qr_acr_qg proc~build_table_qr_acr_qg->proc~qr_acr_qg proc~build_table_qr_acr_qs->mpi_allgather proc~build_table_qr_acr_qs->mpi_barrier proc~build_table_qr_acr_qs->mpi_wtime proc~build_table_qr_acr_qs->proc~gather proc~build_table_qr_acr_qs->proc~get_index_for_rank proc~initialize_arrays_qr_acr_qs initialize_arrays_qr_acr_qs proc~build_table_qr_acr_qs->proc~initialize_arrays_qr_acr_qs proc~qr_acr_qs qr_acr_qs proc~build_table_qr_acr_qs->proc~qr_acr_qs proc~create_bins create_bins proc~initialize_bins_for_tables->proc~create_bins mpi_gatherv mpi_gatherv proc~gather->mpi_gatherv proc~snow_moments snow_moments proc~qr_acr_qs->proc~snow_moments Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~tempo_build_tables~~CalledByGraph proc~tempo_build_tables tempo_build_tables program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/tempo_build_tables.html"},{"title":"build_table_freezewater – TEMPO Microphysics","text":"private  subroutine build_table_freezewater() Uses module_mp_tempo_params proc~~build_table_freezewater~~UsesGraph proc~build_table_freezewater build_table_freezewater module~module_mp_tempo_params module_mp_tempo_params proc~build_table_freezewater->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. build lookup table data for frozen cloud and rain water Arguments None Calls proc~~build_table_freezewater~~CallsGraph proc~build_table_freezewater build_table_freezewater proc~freezewater freezewater proc~build_table_freezewater->proc~freezewater proc~initialize_arrays_freezewater initialize_arrays_freezewater proc~build_table_freezewater->proc~initialize_arrays_freezewater Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~build_table_freezewater~~CalledByGraph proc~build_table_freezewater build_table_freezewater proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_freezewater program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/build_table_freezewater.html"},{"title":"write_table_freezewater – TEMPO Microphysics","text":"private  subroutine write_table_freezewater(filename) Uses module_mp_tempo_params proc~~write_table_freezewater~~UsesGraph proc~write_table_freezewater write_table_freezewater module~module_mp_tempo_params module_mp_tempo_params proc~write_table_freezewater->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. write data for frozen cloud water and rain to a file Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename Called by proc~~write_table_freezewater~~CalledByGraph proc~write_table_freezewater write_table_freezewater proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~write_table_freezewater program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/write_table_freezewater.html"},{"title":"build_table_qr_acr_qs – TEMPO Microphysics","text":"private  subroutine build_table_qr_acr_qs(rank, num_proc) Uses module_mp_tempo_params proc~~build_table_qr_acr_qs~~UsesGraph proc~build_table_qr_acr_qs build_table_qr_acr_qs module~module_mp_tempo_params module_mp_tempo_params proc~build_table_qr_acr_qs->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. build lookup table data for rain-snow collection Arguments Type Intent Optional Attributes Name integer, intent(in) :: rank integer, intent(in) :: num_proc Calls proc~~build_table_qr_acr_qs~~CallsGraph proc~build_table_qr_acr_qs build_table_qr_acr_qs mpi_allgather mpi_allgather proc~build_table_qr_acr_qs->mpi_allgather mpi_barrier mpi_barrier proc~build_table_qr_acr_qs->mpi_barrier mpi_wtime mpi_wtime proc~build_table_qr_acr_qs->mpi_wtime proc~gather gather proc~build_table_qr_acr_qs->proc~gather proc~get_index_for_rank get_index_for_rank proc~build_table_qr_acr_qs->proc~get_index_for_rank proc~initialize_arrays_qr_acr_qs initialize_arrays_qr_acr_qs proc~build_table_qr_acr_qs->proc~initialize_arrays_qr_acr_qs proc~qr_acr_qs qr_acr_qs proc~build_table_qr_acr_qs->proc~qr_acr_qs mpi_gatherv mpi_gatherv proc~gather->mpi_gatherv proc~snow_moments snow_moments proc~qr_acr_qs->proc~snow_moments Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~build_table_qr_acr_qs~~CalledByGraph proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qs program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/build_table_qr_acr_qs.html"},{"title":"write_table_qr_acr_qs – TEMPO Microphysics","text":"private  subroutine write_table_qr_acr_qs(filename) Uses module_mp_tempo_params proc~~write_table_qr_acr_qs~~UsesGraph proc~write_table_qr_acr_qs write_table_qr_acr_qs module~module_mp_tempo_params module_mp_tempo_params proc~write_table_qr_acr_qs->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. write data for rain-snow collection to a file Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename Called by proc~~write_table_qr_acr_qs~~CalledByGraph proc~write_table_qr_acr_qs write_table_qr_acr_qs proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~write_table_qr_acr_qs program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/write_table_qr_acr_qs.html"},{"title":"build_table_qr_acr_qg – TEMPO Microphysics","text":"private  subroutine build_table_qr_acr_qg(rank, num_proc) Uses module_mp_tempo_params proc~~build_table_qr_acr_qg~~UsesGraph proc~build_table_qr_acr_qg build_table_qr_acr_qg module~module_mp_tempo_params module_mp_tempo_params proc~build_table_qr_acr_qg->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. build lookup table data for rain-graupel collection Arguments Type Intent Optional Attributes Name integer, intent(in) :: rank integer, intent(in) :: num_proc Calls proc~~build_table_qr_acr_qg~~CallsGraph proc~build_table_qr_acr_qg build_table_qr_acr_qg mpi_allgather mpi_allgather proc~build_table_qr_acr_qg->mpi_allgather mpi_barrier mpi_barrier proc~build_table_qr_acr_qg->mpi_barrier mpi_wtime mpi_wtime proc~build_table_qr_acr_qg->mpi_wtime proc~gather gather proc~build_table_qr_acr_qg->proc~gather proc~get_index_for_rank get_index_for_rank proc~build_table_qr_acr_qg->proc~get_index_for_rank proc~initialize_arrays_qr_acr_qg initialize_arrays_qr_acr_qg proc~build_table_qr_acr_qg->proc~initialize_arrays_qr_acr_qg proc~qr_acr_qg qr_acr_qg proc~build_table_qr_acr_qg->proc~qr_acr_qg mpi_gatherv mpi_gatherv proc~gather->mpi_gatherv Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~build_table_qr_acr_qg~~CalledByGraph proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qg program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/build_table_qr_acr_qg.html"},{"title":"write_table_qr_acr_qg – TEMPO Microphysics","text":"private  subroutine write_table_qr_acr_qg(filename) Uses module_mp_tempo_params proc~~write_table_qr_acr_qg~~UsesGraph proc~write_table_qr_acr_qg write_table_qr_acr_qg module~module_mp_tempo_params module_mp_tempo_params proc~write_table_qr_acr_qg->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. write data for rain-graupel collection to a file Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename Called by proc~~write_table_qr_acr_qg~~CalledByGraph proc~write_table_qr_acr_qg write_table_qr_acr_qg proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~write_table_qr_acr_qg program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/write_table_qr_acr_qg.html"},{"title":"gather – TEMPO Microphysics","text":"private  subroutine gather(local_flat, global_flat, sendcounts, displacements, ierror) Uses module_mp_tempo_params proc~~gather~~UsesGraph proc~gather gather module~module_mp_tempo_params module_mp_tempo_params proc~gather->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. wrapper to simplify MPI_Gatherv Arguments Type Intent Optional Attributes Name real(kind=table_dp), intent(in), dimension(:) :: local_flat real(kind=table_dp), intent(out), dimension(:) :: global_flat integer, intent(in), dimension(:) :: sendcounts integer, intent(in), dimension(:) :: displacements integer, intent(inout) :: ierror Calls proc~~gather~~CallsGraph proc~gather gather mpi_gatherv mpi_gatherv proc~gather->mpi_gatherv Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~gather~~CalledByGraph proc~gather gather proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~build_table_qr_acr_qg->proc~gather proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~build_table_qr_acr_qs->proc~gather proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qg proc~tempo_build_tables->proc~build_table_qr_acr_qs program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/gather.html"},{"title":"get_index_for_rank – TEMPO Microphysics","text":"private  subroutine get_index_for_rank(idx, rank, num_proc, start_idx, end_idx) returns start and end index values for an array dimension\nof size idx distributed over num_procs Arguments Type Intent Optional Attributes Name integer, intent(in) :: idx integer, intent(in) :: rank integer, intent(in) :: num_proc integer, intent(out) :: start_idx integer, intent(out) :: end_idx Called by proc~~get_index_for_rank~~CalledByGraph proc~get_index_for_rank get_index_for_rank proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~build_table_qr_acr_qg->proc~get_index_for_rank proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~build_table_qr_acr_qs->proc~get_index_for_rank proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qg proc~tempo_build_tables->proc~build_table_qr_acr_qs program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_index_for_rank.html"},{"title":"qr_acr_qs – TEMPO Microphysics","text":"private  subroutine qr_acr_qs(local_start, local_end, ltcs_racs1, ltmr_racs1, ltcs_racs2, ltmr_racs2, ltcr_sacr1, ltms_sacr1, ltcr_sacr2, ltms_sacr2, ltnr_racs1, ltnr_racs2, ltnr_sacr1, ltnr_sacr2) Uses module_mp_tempo_params proc~~qr_acr_qs~~UsesGraph proc~qr_acr_qs qr_acr_qs module~module_mp_tempo_params module_mp_tempo_params proc~qr_acr_qs->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates rain collecting snow (and inverse) Arguments Type Intent Optional Attributes Name integer, intent(in) :: local_start integer, intent(in) :: local_end real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltcs_racs1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltmr_racs1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltcs_racs2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltmr_racs2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltcr_sacr1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltms_sacr1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltcr_sacr2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltms_sacr2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltnr_racs1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltnr_racs2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltnr_sacr1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltnr_sacr2 Calls proc~~qr_acr_qs~~CallsGraph proc~qr_acr_qs qr_acr_qs proc~snow_moments snow_moments proc~qr_acr_qs->proc~snow_moments Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~qr_acr_qs~~CalledByGraph proc~qr_acr_qs qr_acr_qs proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~build_table_qr_acr_qs->proc~qr_acr_qs proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qs program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/qr_acr_qs.html"},{"title":"qr_acr_qg – TEMPO Microphysics","text":"private  subroutine qr_acr_qg(local_start, local_end, ltcg_racg, ltmr_racg, ltcr_gacr, ltnr_racg, ltnr_gacr) Uses module_mp_tempo_params proc~~qr_acr_qg~~UsesGraph proc~qr_acr_qg qr_acr_qg module~module_mp_tempo_params module_mp_tempo_params proc~qr_acr_qg->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. rain collecting graupel (and inverse) using explicit integration Arguments Type Intent Optional Attributes Name integer, intent(in) :: local_start integer, intent(in) :: local_end real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltcg_racg real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltmr_racg real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltcr_gacr real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltnr_racg real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltnr_gacr Called by proc~~qr_acr_qg~~CalledByGraph proc~qr_acr_qg qr_acr_qg proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~build_table_qr_acr_qg->proc~qr_acr_qg proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qg program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/qr_acr_qg.html"},{"title":"freezewater – TEMPO Microphysics","text":"private  subroutine freezewater() Uses module_mp_tempo_params proc~~freezewater~~UsesGraph proc~freezewater freezewater module~module_mp_tempo_params module_mp_tempo_params proc~freezewater->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates the probability of drops of a particular volume freezing\n from Bigg (1953)\n https://doi.org/10.1002/qj.49707934207 Note Graupel tuning parameter: In this table, if the frozen raindrop mass is >= xm0g,\n initialization to graupel occurs. Arguments None Called by proc~~freezewater~~CalledByGraph proc~freezewater freezewater proc~build_table_freezewater build_table_freezewater proc~build_table_freezewater->proc~freezewater proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_freezewater program~build_tables build_tables program~build_tables->proc~tempo_build_tables Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/freezewater.html"},{"title":"save_or_read_ml_data – TEMPO Microphysics","text":"public  subroutine save_or_read_ml_data(ml_data_in, ml_data_out) initializes and saves or returns neural network information Arguments Type Intent Optional Attributes Name type( ty_tempo_ml_data ), intent(in), optional, dimension(1) :: ml_data_in type( ty_tempo_ml_data ), intent(out), optional, dimension(1) :: ml_data_out Called by proc~~save_or_read_ml_data~~CalledByGraph proc~save_or_read_ml_data save_or_read_ml_data proc~init_ml_data init_ml_data proc~init_ml_data->proc~save_or_read_ml_data proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data interface~get_cloud_number get_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~tempo_init tempo_init proc~tempo_init->proc~init_ml_data proc~tempo_main tempo_main proc~tempo_main->interface~get_cloud_number proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_aerosolaware proc~test_cloud_number_ml test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_ml proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware proc~test_graupel_sedimentation test_graupel_sedimentation program~run_tempo_tests->proc~test_graupel_sedimentation proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_ml_cloud_effective_radius proc~test_snow_sedimentation test_snow_sedimentation program~run_tempo_tests->proc~test_snow_sedimentation proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation->proc~tempo_run Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/save_or_read_ml_data.html"},{"title":"tempo_ml_predict_cloud_number – TEMPO Microphysics","text":"public  subroutine tempo_ml_predict_cloud_number(qc, qr, qi, qs, pres, temp, w, predicted_number) predicts number concentration Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: qc real(kind=wp), intent(in), dimension(:) :: qr real(kind=wp), intent(in), dimension(:) :: qi real(kind=wp), intent(in), dimension(:) :: qs real(kind=wp), intent(in), dimension(:) :: pres real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: w real(kind=wp), intent(inout), dimension(:) :: predicted_number Calls proc~~tempo_ml_predict_cloud_number~~CallsGraph proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~tempo_ml_predict_cloud_number~~CalledByGraph proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number get_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~tempo_main tempo_main proc~tempo_main->interface~get_cloud_number proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/tempo_ml_predict_cloud_number.html"},{"title":"standard_scaler_transform – TEMPO Microphysics","text":"private  subroutine standard_scaler_transform(mean, var, raw_data, transformed_data) standard scaler tranformer Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: mean real(kind=wp), intent(in), dimension(:) :: var real(kind=wp), intent(in), dimension(:,:) :: raw_data real(kind=wp), intent(out), dimension(:,:), allocatable :: transformed_data Called by proc~~standard_scaler_transform~~CalledByGraph proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform interface~get_cloud_number get_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~tempo_main tempo_main proc~tempo_main->interface~get_cloud_number proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/standard_scaler_transform.html"},{"title":"relu_activation – TEMPO Microphysics","text":"private  subroutine relu_activation(input, output) relu activation function Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:,:) :: input real(kind=wp), intent(out), dimension(:,:), allocatable :: output Called by proc~~relu_activation~~CalledByGraph proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number proc~tempo_ml_predict_cloud_number->proc~relu_activation interface~get_cloud_number get_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~tempo_main tempo_main proc~tempo_main->interface~get_cloud_number proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/relu_activation.html"},{"title":"koop_nucleation – TEMPO Microphysics","text":"private  function koop_nucleation(temp, satw, naero) result(nuc) Uses module_mp_tempo_params proc~~koop_nucleation~~UsesGraph proc~koop_nucleation koop_nucleation module~module_mp_tempo_params module_mp_tempo_params proc~koop_nucleation->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. aqueous solution freezing of water from Koop et al. (2000) newer research suggests that the freezing rate should be lower \nthan original paper, so J_rate is reduced by two orders of magnitude Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: temp real(kind=wp), intent(in) :: satw real(kind=wp), intent(in) :: naero Return Value real(kind=wp) Called by proc~~koop_nucleation~~CalledByGraph proc~koop_nucleation koop_nucleation proc~ice_nucleation ice_nucleation proc~ice_nucleation->proc~koop_nucleation proc~tempo_main tempo_main proc~tempo_main->proc~ice_nucleation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/koop_nucleation.html"},{"title":"activate_cloud_number – TEMPO Microphysics","text":"private  function activate_cloud_number(temp, w1d, nwfa, land) result(activ) Uses module_mp_tempo_params proc~~activate_cloud_number~~UsesGraph proc~activate_cloud_number activate_cloud_number module~module_mp_tempo_params module_mp_tempo_params proc~activate_cloud_number->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculations numer of cloud droplets activated Todo separation tiny size sulfates from larger sea salts Note there is a lower limit set for activation over water to improve cloud coverage Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: temp real(kind=wp), intent(in) :: w1d real(kind=wp), intent(in) :: nwfa integer, intent(in), optional :: land Return Value real(kind=wp) Called by proc~~activate_cloud_number~~CalledByGraph proc~activate_cloud_number activate_cloud_number proc~cloud_condensation cloud_condensation proc~cloud_condensation->proc~activate_cloud_number proc~tempo_main tempo_main proc~tempo_main->proc~cloud_condensation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/activate_cloud_number.html"},{"title":"demott_nucleation – TEMPO Microphysics","text":"private  function demott_nucleation(tempc, rho, nifa) result(nuc) Uses module_mp_tempo_params proc~~demott_nucleation~~UsesGraph proc~demott_nucleation demott_nucleation module~module_mp_tempo_params module_mp_tempo_params proc~demott_nucleation->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. DeMott nucleation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: tempc real(kind=wp), intent(in) :: rho real(kind=wp), intent(in) :: nifa Return Value real(kind=wp) Called by proc~~demott_nucleation~~CalledByGraph proc~demott_nucleation demott_nucleation proc~ice_nucleation ice_nucleation proc~ice_nucleation->proc~demott_nucleation proc~tempo_main tempo_main proc~tempo_main->proc~ice_nucleation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/demott_nucleation.html"},{"title":"tempo_main – TEMPO Microphysics","text":"public  subroutine tempo_main(tempo_cfgs, qv1d, qc1d, qi1d, qr1d, qs1d, qg1d, qb1d, ni1d, nr1d, nc1d, ng1d, nwfa1d, nifa1d, t1d, p1d, w1d, dz1d, qcfrac1d, qifrac1d, qc_bl1d, qcfrac_bl1d, thten_bl1d, qvten_bl1d, qcten_bl1d, qiten_bl1d, thten_lwrad1d, thten_swrad1d, kts, kte, dt, ii, jj, tempo_main_diags) tempo main Arguments Type Intent Optional Attributes Name type( ty_tempo_cfgs ), intent(in) :: tempo_cfgs real(kind=wp), intent(inout), dimension(kts:kte) :: qv1d 1D water vapor mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qc1d 1D cloud water mass mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qi1d 1D cloud ice mass mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qr1d 1D rain water mass mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qs1d 1D snow mass mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qg1d 1D graupel mass mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: qb1d 1D graupel volume mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: ni1d 1D cloud ice number mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: nr1d 1D rain water number mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: nc1d 1D cloud water number mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: ng1d 1D graupel number mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: nwfa1d 1D water-friendly aerosol number mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: nifa1d 1D ice-friendly aerosol number mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: t1d 1D temperature real(kind=wp), intent(in), dimension(kts:kte) :: p1d 1D pressure real(kind=wp), intent(in), dimension(kts:kte) :: w1d 1D vertical velocity real(kind=wp), intent(in), dimension(kts:kte) :: dz1d 1D vertical grid spacing real(kind=wp), intent(inout), optional, dimension(:) :: qcfrac1d cloud fraction real(kind=wp), intent(inout), optional, dimension(:) :: qifrac1d cloud ice fraction real(kind=wp), intent(in), optional, dimension(:) :: qc_bl1d cloud water mixing ratio from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: qcfrac_bl1d cloud fraction from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: thten_bl1d potential temperature tendency from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: qvten_bl1d water vapor mixing ratio tendency from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: qcten_bl1d cloud water mixing ratio tendency from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: qiten_bl1d cloud ice mixing ratio from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: thten_lwrad1d potential temperature tendency from longwave radiation scheme real(kind=wp), intent(in), optional, dimension(:) :: thten_swrad1d potential temperature tendency from shortwave radiation scheme integer, intent(in) :: kts integer, intent(in) :: kte real(kind=wp), intent(in) :: dt integer, intent(in) :: ii integer, intent(in) :: jj type( ty_tempo_main_diags ), intent(out) :: tempo_main_diags Calls proc~~tempo_main~~CallsGraph proc~tempo_main tempo_main interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~snow_moments proc~effective_radius->proc~get_nuc proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~tempo_main~~CalledByGraph proc~tempo_main tempo_main proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/tempo_main.html"},{"title":"aerosol_check_and_update – TEMPO Microphysics","text":"private  subroutine aerosol_check_and_update(rho, nwfa1d, nifa1d, nwfa, nifa, nwfaten, nifaten) Uses module_mp_tempo_params proc~~aerosol_check_and_update~~UsesGraph proc~aerosol_check_and_update aerosol_check_and_update module~module_mp_tempo_params module_mp_tempo_params proc~aerosol_check_and_update->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. sets aerosol number concentrations and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(inout), optional, dimension(:) :: nwfa1d real(kind=wp), intent(inout), optional, dimension(:) :: nifa1d real(kind=wp), intent(inout), dimension(:) :: nwfa real(kind=wp), intent(inout), dimension(:) :: nifa real(kind=wp), intent(inout), dimension(:) :: nwfaten real(kind=wp), intent(inout), dimension(:) :: nifaten Called by proc~~aerosol_check_and_update~~CalledByGraph proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main tempo_main proc~tempo_main->proc~aerosol_check_and_update proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/aerosol_check_and_update.html"},{"title":"cloud_check_and_update – TEMPO Microphysics","text":"public  subroutine cloud_check_and_update(rho, l_qc, qc1d, nc1d, rc, nc, qcten, ncten, ilamc, mvd_c) Uses module_mp_tempo_params proc~~cloud_check_and_update~~UsesGraph proc~cloud_check_and_update cloud_check_and_update module~module_mp_tempo_params module_mp_tempo_params proc~cloud_check_and_update->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes cloud water contents, ilamc, and mvd_c and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qc real(kind=wp), intent(inout), dimension(:) :: qc1d real(kind=wp), intent(inout), optional, dimension(:) :: nc1d real(kind=wp), intent(inout), dimension(:) :: rc real(kind=wp), intent(inout), dimension(:) :: nc real(kind=wp), intent(inout), dimension(:) :: qcten real(kind=wp), intent(inout), dimension(:) :: ncten real(kind=dp), intent(out), dimension(:) :: ilamc real(kind=wp), intent(out), dimension(:) :: mvd_c Calls proc~~cloud_check_and_update~~CallsGraph proc~cloud_check_and_update cloud_check_and_update proc~get_nuc get_nuc proc~cloud_check_and_update->proc~get_nuc Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~cloud_check_and_update~~CalledByGraph proc~cloud_check_and_update cloud_check_and_update proc~tempo_main tempo_main proc~tempo_main->proc~cloud_check_and_update proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/cloud_check_and_update.html"},{"title":"rain_check_and_update – TEMPO Microphysics","text":"private  subroutine rain_check_and_update(rho, l_qr, qr1d, nr1d, rr, nr, qrten, nrten, ilamr, mvd_r) Uses module_mp_tempo_params proc~~rain_check_and_update~~UsesGraph proc~rain_check_and_update rain_check_and_update module~module_mp_tempo_params module_mp_tempo_params proc~rain_check_and_update->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes rain water contents, ilamr, and mvd_r and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qr real(kind=wp), intent(inout), dimension(:) :: qr1d real(kind=wp), intent(inout), dimension(:) :: nr1d real(kind=wp), intent(inout), dimension(:) :: rr real(kind=wp), intent(inout), dimension(:) :: nr real(kind=wp), intent(inout), dimension(:) :: qrten real(kind=wp), intent(inout), dimension(:) :: nrten real(kind=dp), intent(out), dimension(:) :: ilamr real(kind=wp), intent(out), dimension(:) :: mvd_r Called by proc~~rain_check_and_update~~CalledByGraph proc~rain_check_and_update rain_check_and_update proc~tempo_main tempo_main proc~tempo_main->proc~rain_check_and_update proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/rain_check_and_update.html"},{"title":"ice_check_and_update – TEMPO Microphysics","text":"public  subroutine ice_check_and_update(rho, l_qi, qi1d, ni1d, ri, ni, qiten, niten, ilami) Uses module_mp_tempo_params proc~~ice_check_and_update~~UsesGraph proc~ice_check_and_update ice_check_and_update module~module_mp_tempo_params module_mp_tempo_params proc~ice_check_and_update->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes ice contents, ilami and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qi real(kind=wp), intent(inout), dimension(:) :: qi1d real(kind=wp), intent(inout), dimension(:) :: ni1d real(kind=wp), intent(inout), dimension(:) :: ri real(kind=wp), intent(inout), dimension(:) :: ni real(kind=wp), intent(inout), dimension(:) :: qiten real(kind=wp), intent(inout), dimension(:) :: niten real(kind=dp), intent(out), dimension(:) :: ilami Called by proc~~ice_check_and_update~~CalledByGraph proc~ice_check_and_update ice_check_and_update proc~tempo_main tempo_main proc~tempo_main->proc~ice_check_and_update proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/ice_check_and_update.html"},{"title":"snow_check_and_update – TEMPO Microphysics","text":"public  subroutine snow_check_and_update(rho, l_qs, qs1d, rs, qsten) Uses module_mp_tempo_params proc~~snow_check_and_update~~UsesGraph proc~snow_check_and_update snow_check_and_update module~module_mp_tempo_params module_mp_tempo_params proc~snow_check_and_update->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes snow mass Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qs real(kind=wp), intent(inout), dimension(:) :: qs1d real(kind=wp), intent(inout), dimension(:) :: rs real(kind=wp), intent(inout), dimension(:) :: qsten Called by proc~~snow_check_and_update~~CalledByGraph proc~snow_check_and_update snow_check_and_update proc~tempo_main tempo_main proc~tempo_main->proc~snow_check_and_update proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/snow_check_and_update.html"},{"title":"graupel_check_and_update – TEMPO Microphysics","text":"private  subroutine graupel_check_and_update(rho, l_qg, qg1d, ng1d, qb1d, rg, ng, rb, idx, qgten, ngten, qbten, ilamg, mvd_g) Uses module_mp_tempo_params proc~~graupel_check_and_update~~UsesGraph proc~graupel_check_and_update graupel_check_and_update module~module_mp_tempo_params module_mp_tempo_params proc~graupel_check_and_update->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes graupel contents, ilamg, and mvd_g and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qg real(kind=wp), intent(inout), dimension(:) :: qg1d real(kind=wp), intent(inout), optional, dimension(:) :: ng1d real(kind=wp), intent(inout), optional, dimension(:) :: qb1d real(kind=wp), intent(inout), dimension(:) :: rg real(kind=wp), intent(inout), dimension(:) :: ng real(kind=wp), intent(inout), dimension(:) :: rb integer, intent(inout), dimension(:) :: idx real(kind=wp), intent(inout), dimension(:) :: qgten real(kind=wp), intent(inout), dimension(:) :: ngten real(kind=wp), intent(inout), dimension(:) :: qbten real(kind=dp), intent(out), dimension(:) :: ilamg real(kind=wp), intent(out), dimension(:) :: mvd_g Called by proc~~graupel_check_and_update~~CalledByGraph proc~graupel_check_and_update graupel_check_and_update proc~tempo_main tempo_main proc~tempo_main->proc~graupel_check_and_update proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/graupel_check_and_update.html"},{"title":"graupel_init – TEMPO Microphysics","text":"private  subroutine graupel_init(rho, qg1d, ng1d, qb1d) Uses module_mp_tempo_params proc~~graupel_init~~UsesGraph proc~graupel_init graupel_init module~module_mp_tempo_params module_mp_tempo_params proc~graupel_init->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. initializes graupel number and volume if both are zero\nand hail-aware = true Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: qg1d real(kind=wp), intent(inout), dimension(:) :: ng1d real(kind=wp), intent(inout), dimension(:) :: qb1d Called by proc~~graupel_init~~CalledByGraph proc~graupel_init graupel_init proc~tempo_main tempo_main proc~tempo_main->proc~graupel_init proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/graupel_init.html"},{"title":"thermo_vars – TEMPO Microphysics","text":"private  subroutine thermo_vars(qv, temp, pres, rho, rhof, rhof2, qvs, delqvs, qvsi, satw, sati, ssatw, ssati, diffu, visco, vsc2, ocp, lvap, tcond, lvt2, supersaturated) Uses module_mp_tempo_params proc~~thermo_vars~~UsesGraph proc~thermo_vars thermo_vars module~module_mp_tempo_params module_mp_tempo_params proc~thermo_vars->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes thermodynamic variables Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: pres real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(out), dimension(:) :: rhof real(kind=wp), intent(out), dimension(:) :: rhof2 real(kind=wp), intent(out), dimension(:) :: qvs real(kind=wp), intent(out), dimension(:) :: delqvs real(kind=wp), intent(out), dimension(:) :: qvsi real(kind=wp), intent(out), dimension(:) :: satw real(kind=wp), intent(out), dimension(:) :: sati real(kind=wp), intent(out), dimension(:) :: ssatw real(kind=wp), intent(out), dimension(:) :: ssati real(kind=wp), intent(out), dimension(:) :: diffu real(kind=wp), intent(out), dimension(:) :: visco real(kind=wp), intent(out), dimension(:) :: vsc2 real(kind=wp), intent(out), dimension(:) :: ocp real(kind=wp), intent(out), dimension(:) :: lvap real(kind=wp), intent(out), dimension(:) :: tcond real(kind=wp), intent(out), dimension(:) :: lvt2 logical, intent(inout) :: supersaturated Calls proc~~thermo_vars~~CallsGraph proc~thermo_vars thermo_vars proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~thermo_vars~~CalledByGraph proc~thermo_vars thermo_vars proc~tempo_main tempo_main proc~tempo_main->proc~thermo_vars proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/thermo_vars.html"},{"title":"check_over_depletion – TEMPO Microphysics","text":"private  subroutine check_over_depletion(rho, temp, qvsi, qv, l_qc, rc, l_qi, ri, l_qr, rr, l_qs, rs, l_qg, rg, tend) Uses module_mp_tempo_params proc~~check_over_depletion~~UsesGraph proc~check_over_depletion check_over_depletion module~module_mp_tempo_params module_mp_tempo_params proc~check_over_depletion->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. check to ensure that loss terms don't over-deplete a category and\nadjusts tendencies if needed Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: qv logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc logical, intent(in), dimension(:) :: l_qi real(kind=wp), intent(in), dimension(:) :: ri logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg type( ty_tend ), intent(inout) :: tend Called by proc~~check_over_depletion~~CalledByGraph proc~check_over_depletion check_over_depletion proc~tempo_main tempo_main proc~tempo_main->proc~check_over_depletion proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/check_over_depletion.html"},{"title":"sum_tendencies – TEMPO Microphysics","text":"private  subroutine sum_tendencies(rho, temp, idx, lvap, ocp, tend, tten, qvten, qcten, ncten, qiten, niten, qsten, qrten, nrten, qgten, ngten, qbten) Uses module_mp_tempo_params proc~~sum_tendencies~~UsesGraph proc~sum_tendencies sum_tendencies module~module_mp_tempo_params module_mp_tempo_params proc~sum_tendencies->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. sums tendencies for each hydrometeor category and temperature and moisture Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp integer, intent(in), dimension(:) :: idx real(kind=wp), intent(in), dimension(:) :: lvap real(kind=wp), intent(in), dimension(:) :: ocp type( ty_tend ), intent(in) :: tend real(kind=wp), intent(inout), dimension(:) :: tten real(kind=wp), intent(inout), dimension(:) :: qvten real(kind=wp), intent(inout), dimension(:) :: qcten real(kind=wp), intent(inout), dimension(:) :: ncten real(kind=wp), intent(inout), dimension(:) :: qiten real(kind=wp), intent(inout), dimension(:) :: niten real(kind=wp), intent(inout), dimension(:) :: qsten real(kind=wp), intent(inout), dimension(:) :: qrten real(kind=wp), intent(inout), dimension(:) :: nrten real(kind=wp), intent(inout), dimension(:) :: qgten real(kind=wp), intent(inout), dimension(:) :: ngten real(kind=wp), intent(inout), dimension(:) :: qbten Called by proc~~sum_tendencies~~CalledByGraph proc~sum_tendencies sum_tendencies proc~tempo_main tempo_main proc~tempo_main->proc~sum_tendencies proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/sum_tendencies.html"},{"title":"sedimentation – TEMPO Microphysics","text":"private  subroutine sedimentation(xr, vt, dz1d, rho, xten, limit, steps, ktop_sedi, precip) Uses module_mp_tempo_params proc~~sedimentation~~UsesGraph proc~sedimentation sedimentation module~module_mp_tempo_params module_mp_tempo_params proc~sedimentation->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes sedimentation fluxes, adds fluxes to tendencies, and updates hydrometeor\nmass (and number and volume) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(inout), dimension(:) :: xr real(kind=wp), intent(in), dimension(:) :: vt real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(inout), dimension(:) :: xten real(kind=wp), intent(in) :: limit integer, intent(in) :: steps integer, intent(in), optional :: ktop_sedi real(kind=wp), intent(inout), optional :: precip Called by proc~~sedimentation~~CalledByGraph proc~sedimentation sedimentation proc~tempo_main tempo_main proc~tempo_main->proc~sedimentation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/sedimentation.html"},{"title":"semilagrangian_sedimentation – TEMPO Microphysics","text":"private  subroutine semilagrangian_sedimentation(dz1d, rho, xr, xten, vt, steps, limit, precip) semi-lagrangian sedimentation scheme from Juang and Hong (2010) original author: hann-ming henry juang henry.juang@noaa.gov original implemented by: song-you hong Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(inout), dimension(:) :: xr real(kind=wp), intent(inout), dimension(:) :: xten real(kind=wp), intent(in), dimension(:) :: vt integer, intent(in) :: steps real(kind=wp), intent(in) :: limit real(kind=wp), intent(out), optional :: precip Called by proc~~semilagrangian_sedimentation~~CalledByGraph proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main tempo_main proc~tempo_main->proc~semilagrangian_sedimentation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/semilagrangian_sedimentation.html"},{"title":"rain_fallspeed – TEMPO Microphysics","text":"private  subroutine rain_fallspeed(rhof, l_qr, rr, ilamr, dz1d, vt, vtn, substeps_sedi, ktop_sedi) Uses module_mp_tempo_params proc~~rain_fallspeed~~UsesGraph proc~rain_fallspeed rain_fallspeed module~module_mp_tempo_params module_mp_tempo_params proc~rain_fallspeed->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates mass and number weighted fall speeds for rain\nand optionally the substepping required and the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=dp), intent(in), dimension(:) :: ilamr real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(inout), dimension(:) :: vtn integer, intent(out), optional :: substeps_sedi integer, intent(out), optional :: ktop_sedi Called by proc~~rain_fallspeed~~CalledByGraph proc~rain_fallspeed rain_fallspeed proc~tempo_main tempo_main proc~tempo_main->proc~rain_fallspeed proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/rain_fallspeed.html"},{"title":"graupel_fallspeed – TEMPO Microphysics","text":"private  subroutine graupel_fallspeed(rhof, rho, visco, l_qg, rg, rb, qb1d, idx, ilamg, dz1d, vt, vtn, substeps_sedi, ktop_sedi) Uses module_mp_tempo_params proc~~graupel_fallspeed~~UsesGraph proc~graupel_fallspeed graupel_fallspeed module~module_mp_tempo_params module_mp_tempo_params proc~graupel_fallspeed->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates mass and number weighted fall speeds for graupel\nand optionally the substepping required and the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: visco logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: rb real(kind=wp), intent(in), optional, dimension(:) :: qb1d integer, intent(in), dimension(:) :: idx real(kind=dp), intent(in), dimension(:) :: ilamg real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(inout), dimension(:) :: vtn integer, intent(out), optional :: substeps_sedi integer, intent(out), optional :: ktop_sedi Called by proc~~graupel_fallspeed~~CalledByGraph proc~graupel_fallspeed graupel_fallspeed proc~tempo_main tempo_main proc~tempo_main->proc~graupel_fallspeed proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/graupel_fallspeed.html"},{"title":"snow_fallspeed – TEMPO Microphysics","text":"private  subroutine snow_fallspeed(rhof, l_qs, rs, prr_sml, smob, smoc, rr, vtrr, dz1d, vt, vtboost, substeps_sedi, ktop_sedi) Uses module_mp_tempo_params proc~~snow_fallspeed~~UsesGraph proc~snow_fallspeed snow_fallspeed module~module_mp_tempo_params module_mp_tempo_params proc~snow_fallspeed->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calcules mass weighted fall speeds for snow\nand optionally the substepping required and the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: prr_sml real(kind=dp), intent(in), dimension(:) :: smob real(kind=dp), intent(in), dimension(:) :: smoc real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: vtrr real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(in), dimension(:) :: vtboost integer, intent(out), optional :: substeps_sedi integer, intent(out), optional :: ktop_sedi Called by proc~~snow_fallspeed~~CalledByGraph proc~snow_fallspeed snow_fallspeed proc~tempo_main tempo_main proc~tempo_main->proc~snow_fallspeed proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/snow_fallspeed.html"},{"title":"ice_fallspeed – TEMPO Microphysics","text":"private  subroutine ice_fallspeed(rhof, l_qi, ri, ilami, dz1d, vt, vtn, substeps_sedi, ktop_sedi) Uses module_mp_tempo_params proc~~ice_fallspeed~~UsesGraph proc~ice_fallspeed ice_fallspeed module~module_mp_tempo_params module_mp_tempo_params proc~ice_fallspeed->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates mass and number weighted fall speeds for ice\nand the substepping required and the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof logical, intent(in), dimension(:) :: l_qi real(kind=wp), intent(in), dimension(:) :: ri real(kind=dp), intent(in), dimension(:) :: ilami real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(inout), dimension(:) :: vtn integer, intent(out) :: substeps_sedi integer, intent(out) :: ktop_sedi Called by proc~~ice_fallspeed~~CalledByGraph proc~ice_fallspeed ice_fallspeed proc~tempo_main tempo_main proc~tempo_main->proc~ice_fallspeed proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/ice_fallspeed.html"},{"title":"cloud_fallspeed – TEMPO Microphysics","text":"private  subroutine cloud_fallspeed(rhof, w1d, l_qc, rc, nc, ilamc, dz1d, vt, vtn, ktop_sedi) Uses module_mp_tempo_params proc~~cloud_fallspeed~~UsesGraph proc~cloud_fallspeed cloud_fallspeed module~module_mp_tempo_params module_mp_tempo_params proc~cloud_fallspeed->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates mass and number weighted fall speeds for cloud\nand the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: w1d logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc real(kind=dp), intent(in), dimension(:) :: ilamc real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(inout), dimension(:) :: vtn integer, intent(out) :: ktop_sedi Calls proc~~cloud_fallspeed~~CallsGraph proc~cloud_fallspeed cloud_fallspeed proc~get_nuc get_nuc proc~cloud_fallspeed->proc~get_nuc Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~cloud_fallspeed~~CalledByGraph proc~cloud_fallspeed cloud_fallspeed proc~tempo_main tempo_main proc~tempo_main->proc~cloud_fallspeed proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/cloud_fallspeed.html"},{"title":"cloud_condensation – TEMPO Microphysics","text":"private  subroutine cloud_condensation(rho, temp, w1d, ssatw, lvap, tcond, diffu, lvt2, nwfa, qv, qvs, l_qc, rc, nc, tend) Uses module_mp_tempo_params proc~~cloud_condensation~~UsesGraph proc~cloud_condensation cloud_condensation module~module_mp_tempo_params module_mp_tempo_params proc~cloud_condensation->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. cloud condensation and evaporation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: w1d real(kind=wp), intent(in), dimension(:) :: ssatw real(kind=wp), intent(in), dimension(:) :: lvap real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: lvt2 real(kind=wp), intent(in), dimension(:) :: nwfa real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: qvs logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc type( ty_tend ), intent(inout) :: tend Calls proc~~cloud_condensation~~CallsGraph proc~cloud_condensation cloud_condensation proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~cloud_condensation~~CalledByGraph proc~cloud_condensation cloud_condensation proc~tempo_main tempo_main proc~tempo_main->proc~cloud_condensation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/cloud_condensation.html"},{"title":"rain_evaporation – TEMPO Microphysics","text":"private  subroutine rain_evaporation(rho, temp, ssatw, lvap, tcond, diffu, vsc2, rhof2, qv, qvs, l_qr, rr, nr, ilamr, tend) Uses module_mp_tempo_params proc~~rain_evaporation~~UsesGraph proc~rain_evaporation rain_evaporation module~module_mp_tempo_params module_mp_tempo_params proc~rain_evaporation->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. rain evaporation that includes reduction in the evaporation rate\nin the presence of melting graupel Note rain evaporation rapidly eliminates near zero values when low humidity (<95%) s Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: ssatw real(kind=wp), intent(in), dimension(:) :: lvap real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: vsc2 real(kind=wp), intent(in), dimension(:) :: rhof2 real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: qvs logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr type( ty_tend ), intent(inout) :: tend Called by proc~~rain_evaporation~~CalledByGraph proc~rain_evaporation rain_evaporation proc~tempo_main tempo_main proc~tempo_main->proc~rain_evaporation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/rain_evaporation.html"},{"title":"freeze_cloud_melt_ice – TEMPO Microphysics","text":"private  subroutine freeze_cloud_melt_ice(temp, rho, ocp, lvap, qi1d, ni1d, qiten, niten, qc1d, nc1d, ncsave, qcten, ncten, tten) Uses module_mp_tempo_params proc~~freeze_cloud_melt_ice~~UsesGraph proc~freeze_cloud_melt_ice freeze_cloud_melt_ice module~module_mp_tempo_params module_mp_tempo_params proc~freeze_cloud_melt_ice->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: ocp real(kind=wp), intent(in), dimension(:) :: lvap real(kind=wp), intent(in), dimension(:) :: qi1d real(kind=wp), intent(in), dimension(:) :: ni1d real(kind=wp), intent(inout), dimension(:) :: qiten real(kind=wp), intent(inout), dimension(:) :: niten real(kind=wp), intent(in), dimension(:) :: qc1d real(kind=wp), intent(in), optional, dimension(:) :: nc1d real(kind=wp), intent(in), optional, dimension(:) :: ncsave real(kind=wp), intent(inout), dimension(:) :: qcten real(kind=wp), intent(inout), dimension(:) :: ncten real(kind=wp), intent(inout), dimension(:) :: tten Called by proc~~freeze_cloud_melt_ice~~CalledByGraph proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main tempo_main proc~tempo_main->proc~freeze_cloud_melt_ice proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/freeze_cloud_melt_ice.html"},{"title":"warm_rain – TEMPO Microphysics","text":"private  subroutine warm_rain(rhof, l_qc, rc, nc, ilamc, mvd_c, l_qr, rr, nr, mvd_r, tend) Uses module_mp_tempo_params proc~~warm_rain~~UsesGraph proc~warm_rain warm_rain module~module_mp_tempo_params module_mp_tempo_params proc~warm_rain->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes warm-rain process rates -- condensation/evaporation happen later Note rain self-collection is from Seifert and Beheng (2001) and drop break-up follows Verlinde and Cotton (1993) autoconversion follows Berry and Reinhardt (1974) with characteristic diameters correctly computed from gamma distribution of cloud droplets rain collecting cloud water - assumes dc << dr and vtc Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc real(kind=dp), intent(in), dimension(:) :: ilamc real(kind=wp), intent(in), dimension(:) :: mvd_c logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=wp), intent(in), dimension(:) :: mvd_r type( ty_tend ), intent(inout) :: tend Calls proc~~warm_rain~~CallsGraph proc~warm_rain warm_rain proc~get_nuc get_nuc proc~warm_rain->proc~get_nuc Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~warm_rain~~CalledByGraph proc~warm_rain warm_rain proc~tempo_main tempo_main proc~tempo_main->proc~warm_rain proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/warm_rain.html"},{"title":"riming – TEMPO Microphysics","text":"private  subroutine riming(temp, rhof, visco, l_qc, rc, nc, ilamc, mvd_c, l_qs, rs, smo0, smob, smoc, smoe, vtboost, l_qg, rg, ng, ilamg, idx, tend) Uses module_mp_tempo_params proc~~riming~~UsesGraph proc~riming riming module~module_mp_tempo_params module_mp_tempo_params proc~riming->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. snow and graupel riming Note snow collecting cloud water - assume dc << ds and vtc at temperatures below melting, if the riming rate is greater than the depositional\ngrowth rate for snow by a factor rime_threshold, convert a portion of rimed snow\nto graupel graupel collecting cloud water - assume dc << dg and vtc rime density formula is from Cober and List (1993) hail size increases below the melting level so the collection efficiency\nis reduced (proxy for shedding of collected cloud water) rime splintering is from Hallet and Mossop (1974) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: visco logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc real(kind=dp), intent(in), dimension(:) :: ilamc real(kind=wp), intent(in), dimension(:) :: mvd_c logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smo0 real(kind=dp), intent(in), dimension(:) :: smob real(kind=dp), intent(in), dimension(:) :: smoc real(kind=dp), intent(in), dimension(:) :: smoe real(kind=wp), intent(out), dimension(:) :: vtboost logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend Calls proc~~riming~~CallsGraph proc~riming riming proc~get_nuc get_nuc proc~riming->proc~get_nuc Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~riming~~CalledByGraph proc~riming riming proc~tempo_main tempo_main proc~tempo_main->proc~riming proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/riming.html"},{"title":"get_snow_table_index – TEMPO Microphysics","text":"public  subroutine get_snow_table_index(rs, idx_s) Uses module_mp_tempo_params proc~~get_snow_table_index~~UsesGraph proc~get_snow_table_index get_snow_table_index module~module_mp_tempo_params module_mp_tempo_params proc~get_snow_table_index->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. get snow table index from snow mass Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rs integer, intent(out) :: idx_s Called by proc~~get_snow_table_index~~CalledByGraph proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~tempo_main tempo_main proc~tempo_main->proc~rain_snow_rain_graupel proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_snow_table_index.html"},{"title":"get_temperature_table_index – TEMPO Microphysics","text":"public  subroutine get_temperature_table_index(tempk, idx_t) Uses module_mp_tempo_params proc~~get_temperature_table_index~~UsesGraph proc~get_temperature_table_index get_temperature_table_index module~module_mp_tempo_params module_mp_tempo_params proc~get_temperature_table_index->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. get temperature table index Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: tempk integer, intent(out) :: idx_t Called by proc~~get_temperature_table_index~~CalledByGraph proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~tempo_main tempo_main proc~tempo_main->proc~rain_snow_rain_graupel proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_temperature_table_index.html"},{"title":"get_rain_table_index – TEMPO Microphysics","text":"public  subroutine get_rain_table_index(rr, ilamr, idx_r, idx_r1) Uses module_mp_tempo_params proc~~get_rain_table_index~~UsesGraph proc~get_rain_table_index get_rain_table_index module~module_mp_tempo_params module_mp_tempo_params proc~get_rain_table_index->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. get rain table indices from rain mass and lambda Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rr real(kind=dp), intent(in) :: ilamr integer, intent(out) :: idx_r integer, intent(out) :: idx_r1 Called by proc~~get_rain_table_index~~CalledByGraph proc~get_rain_table_index get_rain_table_index proc~ice_nucleation ice_nucleation proc~ice_nucleation->proc~get_rain_table_index proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~tempo_main tempo_main proc~tempo_main->proc~ice_nucleation proc~tempo_main->proc~rain_snow_rain_graupel proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_rain_table_index.html"},{"title":"get_graupel_table_index – TEMPO Microphysics","text":"public  subroutine get_graupel_table_index(rg, ilamg, idx, idx_g, idx_g1) Uses module_mp_tempo_params proc~~get_graupel_table_index~~UsesGraph proc~get_graupel_table_index get_graupel_table_index module~module_mp_tempo_params module_mp_tempo_params proc~get_graupel_table_index->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. get graupel table indices from graupel mass, lambda, and density index Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rg real(kind=dp), intent(in) :: ilamg integer, intent(in) :: idx integer, intent(out) :: idx_g integer, intent(out) :: idx_g1 Called by proc~~get_graupel_table_index~~CalledByGraph proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~tempo_main tempo_main proc~tempo_main->proc~rain_snow_rain_graupel proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_graupel_table_index.html"},{"title":"get_cloud_table_index – TEMPO Microphysics","text":"public  subroutine get_cloud_table_index(rc, nc, idx_c, idx_n) Uses module_mp_tempo_params proc~~get_cloud_table_index~~UsesGraph proc~get_cloud_table_index get_cloud_table_index module~module_mp_tempo_params module_mp_tempo_params proc~get_cloud_table_index->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. get cloud table index from mass and number Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rc real(kind=wp), intent(in) :: nc integer, intent(out) :: idx_c integer, intent(out) :: idx_n Called by proc~~get_cloud_table_index~~CalledByGraph proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation cloud_condensation proc~cloud_condensation->proc~get_cloud_table_index proc~ice_nucleation ice_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~tempo_main tempo_main proc~tempo_main->proc~cloud_condensation proc~tempo_main->proc~ice_nucleation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_cloud_table_index.html"},{"title":"get_ice_table_index – TEMPO Microphysics","text":"public  subroutine get_ice_table_index(ri, ni, idx_i, idx_i1) Uses module_mp_tempo_params proc~~get_ice_table_index~~UsesGraph proc~get_ice_table_index get_ice_table_index module~module_mp_tempo_params module_mp_tempo_params proc~get_ice_table_index->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. get ice table index from mass and number Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: ri real(kind=wp), intent(in) :: ni integer, intent(out) :: idx_i integer, intent(out) :: idx_i1 Called by proc~~get_ice_table_index~~CalledByGraph proc~get_ice_table_index get_ice_table_index proc~ice_processes ice_processes proc~ice_processes->proc~get_ice_table_index proc~tempo_main tempo_main proc~tempo_main->proc~ice_processes proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_ice_table_index.html"},{"title":"rain_snow_rain_graupel – TEMPO Microphysics","text":"private  subroutine rain_snow_rain_graupel(temp, l_qr, rr, nr, ilamr, l_qs, rs, l_qg, rg, ng, ilamg, idx, tend) Uses module_mp_tempo_params proc~~rain_snow_rain_graupel~~UsesGraph proc~rain_snow_rain_graupel rain_snow_rain_graupel module~module_mp_tempo_params module_mp_tempo_params proc~rain_snow_rain_graupel->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates rain-snow and rain-graupel collection Note adds explicit rain drop break-up due to collisions with graupel\nat temperatures above melting Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend Calls proc~~rain_snow_rain_graupel~~CallsGraph proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~get_rain_table_index get_rain_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~rain_snow_rain_graupel~~CalledByGraph proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main tempo_main proc~tempo_main->proc~rain_snow_rain_graupel proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/rain_snow_rain_graupel.html"},{"title":"ice_nucleation – TEMPO Microphysics","text":"private  subroutine ice_nucleation(temp, rho, w1d, qv, qvsi, ssati, ssatw, nifa, nwfa, ni, smo0, rc, nc, rr, nr, ilamr, tend) Uses module_mp_tempo_params proc~~ice_nucleation~~UsesGraph proc~ice_nucleation ice_nucleation module~module_mp_tempo_params module_mp_tempo_params proc~ice_nucleation->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. ice nulceation Note freezing of water drops into either cloud ice or graupel is from Bigg (1953) deposition nucleation from dust is from DeMott et al. (2010) freezing of aqueous aerosols is based on Koop et al. (2000) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: w1d real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: ssati real(kind=wp), intent(in), dimension(:) :: ssatw real(kind=wp), intent(in), optional, dimension(:) :: nifa real(kind=wp), intent(in), optional, dimension(:) :: nwfa real(kind=wp), intent(in), dimension(:) :: ni real(kind=dp), intent(in), dimension(:) :: smo0 real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr type( ty_tend ), intent(inout) :: tend Calls proc~~ice_nucleation~~CallsGraph proc~ice_nucleation ice_nucleation proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~get_cloud_table_index get_cloud_table_index proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~ice_nucleation~~CalledByGraph proc~ice_nucleation ice_nucleation proc~tempo_main tempo_main proc~tempo_main->proc~ice_nucleation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/ice_nucleation.html"},{"title":"get_in_table_index – TEMPO Microphysics","text":"private  subroutine get_in_table_index(xni, idx_in) Uses module_mp_tempo_params proc~~get_in_table_index~~UsesGraph proc~get_in_table_index get_in_table_index module~module_mp_tempo_params module_mp_tempo_params proc~get_in_table_index->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. get ice nuclei table index Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: xni integer, intent(out) :: idx_in Called by proc~~get_in_table_index~~CalledByGraph proc~get_in_table_index get_in_table_index proc~ice_nucleation ice_nucleation proc~ice_nucleation->proc~get_in_table_index proc~tempo_main tempo_main proc~tempo_main->proc~ice_nucleation proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_in_table_index.html"},{"title":"get_t1_subl – TEMPO Microphysics","text":"private  subroutine get_t1_subl(rho, temp, qvsi, tcond, diffu, ssati, t1_subl) Uses module_mp_tempo_params proc~~get_t1_subl~~UsesGraph proc~get_t1_subl get_t1_subl module~module_mp_tempo_params module_mp_tempo_params proc~get_t1_subl->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculations thermodynamic term used in depositional growth and melting Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: ssati real(kind=wp), intent(out), dimension(:) :: t1_subl Called by proc~~get_t1_subl~~CalledByGraph proc~get_t1_subl get_t1_subl proc~ice_processes ice_processes proc~ice_processes->proc~get_t1_subl proc~melting melting proc~melting->proc~get_t1_subl proc~tempo_main tempo_main proc~tempo_main->proc~ice_processes proc~tempo_main->proc~melting proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_t1_subl.html"},{"title":"ice_processes – TEMPO Microphysics","text":"private  subroutine ice_processes(rhof, rhof2, rho, w1d, temp, qv, qvsi, tcond, diffu, vsc2, ssati, l_qi, ri, ni, ilami, l_qs, rs, smoe, smof, smo1, rr, nr, ilamr, mvd_r, l_qg, rg, ng, ilamg, idx, tend) Uses module_mp_tempo_params proc~~ice_processes~~UsesGraph proc~ice_processes ice_processes module~module_mp_tempo_params module_mp_tempo_params proc~ice_processes->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. ice processes including cloud ice depositional growth, conversion of cloud ice\nto snow, snow collecting cloud ice, rain collecting cloud ice, snow depositional growth, \nand graupel sublimation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: rhof2 real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: w1d real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: vsc2 real(kind=wp), intent(in), dimension(:) :: ssati logical, intent(in), dimension(:) :: l_qi real(kind=wp), intent(in), dimension(:) :: ri real(kind=wp), intent(in), dimension(:) :: ni real(kind=dp), intent(in), dimension(:) :: ilami logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smoe real(kind=dp), intent(in), dimension(:) :: smof real(kind=dp), intent(in), dimension(:) :: smo1 real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr real(kind=wp), intent(in), dimension(:) :: mvd_r logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend Calls proc~~ice_processes~~CallsGraph proc~ice_processes ice_processes proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~ice_processes~~CalledByGraph proc~ice_processes ice_processes proc~tempo_main tempo_main proc~tempo_main->proc~ice_processes proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/ice_processes.html"},{"title":"melting – TEMPO Microphysics","text":"private  subroutine melting(rhof2, rho, temp, qvsi, tcond, diffu, vsc2, ssati, delqvs, l_qs, rs, smof, smo0, smo1, l_qg, rg, ng, ilamg, idx, tend) Uses module_mp_tempo_params proc~~melting~~UsesGraph proc~melting melting module~module_mp_tempo_params module_mp_tempo_params proc~melting->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. melting of snow and graupel Note if snow and graupel collected cloud water at temperatures above melting\nand if the timestep is too long, the melting process should have converted\neverything to rain credit to Bjorn-Egil Nygaard for this find Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof2 real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: vsc2 real(kind=wp), intent(in), dimension(:) :: ssati real(kind=wp), intent(in), dimension(:) :: delqvs logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smof real(kind=dp), intent(in), dimension(:) :: smo0 real(kind=dp), intent(in), dimension(:) :: smo1 logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend Calls proc~~melting~~CallsGraph proc~melting melting proc~get_t1_subl get_t1_subl proc~melting->proc~get_t1_subl Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~melting~~CalledByGraph proc~melting melting proc~tempo_main tempo_main proc~tempo_main->proc~melting proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/melting.html"},{"title":"aerosol_scavenging – TEMPO Microphysics","text":"private  subroutine aerosol_scavenging(temp, rho, rhof, visco, nwfa, nifa, l_qr, nr, ilamr, mvd_r, l_qs, rs, smob, smoc, smoe, l_qg, rg, ng, ilamg, idx, tend) Uses module_mp_tempo_params proc~~aerosol_scavenging~~UsesGraph proc~aerosol_scavenging aerosol_scavenging module~module_mp_tempo_params module_mp_tempo_params proc~aerosol_scavenging->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. scavenging of aerosols by rain, snow, and graupel Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: visco real(kind=wp), intent(in), dimension(:) :: nwfa real(kind=wp), intent(in), dimension(:) :: nifa logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr real(kind=wp), intent(in), dimension(:) :: mvd_r logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smob real(kind=dp), intent(in), dimension(:) :: smoc real(kind=dp), intent(in), dimension(:) :: smoe logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend Calls proc~~aerosol_scavenging~~CallsGraph proc~aerosol_scavenging aerosol_scavenging proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~aerosol_scavenging~~CalledByGraph proc~aerosol_scavenging aerosol_scavenging proc~tempo_main tempo_main proc~tempo_main->proc~aerosol_scavenging proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/aerosol_scavenging.html"},{"title":"get_cloud_number – TEMPO Microphysics","text":"private interface get_cloud_number Calls interface~~get_cloud_number~~CallsGraph interface~get_cloud_number get_cloud_number proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~save_or_read_ml_data save_or_read_ml_data proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by interface~~get_cloud_number~~CalledByGraph interface~get_cloud_number get_cloud_number proc~tempo_main tempo_main proc~tempo_main->interface~get_cloud_number proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Module Procedures public  subroutine tempo_ml_predict_cloud_number (qc, qr, qi, qs, pres, temp, w, predicted_number) predicts number concentration Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: qc real(kind=wp), intent(in), dimension(:) :: qr real(kind=wp), intent(in), dimension(:) :: qi real(kind=wp), intent(in), dimension(:) :: qs real(kind=wp), intent(in), dimension(:) :: pres real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: w real(kind=wp), intent(inout), dimension(:) :: predicted_number public  subroutine get_constant_cloud_number (land, nc) returns land-specific value of cloud droplet number concentration\nwhen aerosol-aware = false if land = 1, else returns ocean-specific value Arguments Type Intent Optional Attributes Name integer, intent(in), optional :: land real(kind=wp), intent(out), dimension(:) :: nc","tags":"","url":"interface/get_cloud_number.html"},{"title":"find_melting_level – TEMPO Microphysics","text":"private  function find_melting_level(temp, l_qr, l_qs, l_qg) result(k_melt) Uses module_mp_tempo_params proc~~find_melting_level~~UsesGraph proc~find_melting_level find_melting_level module~module_mp_tempo_params module_mp_tempo_params proc~find_melting_level->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. finds the melting level Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp logical, intent(in), dimension(:) :: l_qr logical, intent(in), dimension(:) :: l_qs logical, intent(in), dimension(:) :: l_qg Return Value integer Called by proc~~find_melting_level~~CalledByGraph proc~find_melting_level find_melting_level proc~reflectivity_10cm reflectivity_10cm proc~reflectivity_10cm->proc~find_melting_level proc~tempo_main tempo_main proc~tempo_main->proc~reflectivity_10cm proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/find_melting_level.html"},{"title":"complex_water_ray – TEMPO Microphysics","text":"private  function complex_water_ray(lambda, t) result(refractive_index) Uses module_mp_tempo_params proc~~complex_water_ray~~UsesGraph proc~complex_water_ray complex_water_ray module~module_mp_tempo_params module_mp_tempo_params proc~complex_water_ray->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. complex refractive index of water\nfrom Ray (1972) calculated as function of temperature t [Celsius] (valid from -10 to 30)\nand radar wavelength lambda [m] (valid from 0.001 to 1) original credit: Ulrich Blahak and G. Thompson Arguments Type Intent Optional Attributes Name real(kind=dp), intent(in) :: lambda real(kind=dp), intent(in) :: t Return Value complex(kind=dp) Called by proc~~complex_water_ray~~CalledByGraph proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_10cm reflectivity_10cm proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~tempo_main tempo_main proc~tempo_main->proc~reflectivity_10cm proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/complex_water_ray.html"},{"title":"complex_ice_maetzler – TEMPO Microphysics","text":"private  function complex_ice_maetzler(lambda, t) result(refractive_index) complex refractive index of ice from Maetzler (1998) calculated as function of temperature t [Celsius] (valid from -250 to 0)\nand radar wavelength lambda [m] (valid from 0.0001 to 30) original credit: Ulrich Blahak and G. Thompson Arguments Type Intent Optional Attributes Name real(kind=dp), intent(in) :: lambda real(kind=dp), intent(in) :: t Return Value complex(kind=dp) Called by proc~~complex_ice_maetzler~~CalledByGraph proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_10cm reflectivity_10cm proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~tempo_main tempo_main proc~tempo_main->proc~reflectivity_10cm proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/complex_ice_maetzler.html"},{"title":"reflectivity_from_melting_graupel – TEMPO Microphysics","text":"private  function reflectivity_from_melting_graupel(rg, ng, ilamg, idx, rr) result(ze_graupel) Uses module_mp_tempo_params proc~~reflectivity_from_melting_graupel~~UsesGraph proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel module~module_mp_tempo_params module_mp_tempo_params proc~reflectivity_from_melting_graupel->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates radar reflectivity from melting graupel using binned approach original credit: Ulrich Blahak and G. Thompson Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rg real(kind=wp), intent(in) :: ng real(kind=dp), intent(in) :: ilamg integer, intent(in) :: idx real(kind=wp), intent(in) :: rr Return Value real(kind=wp) Calls proc~~reflectivity_from_melting_graupel~~CallsGraph proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~reflectivity_from_melting_graupel~~CalledByGraph proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm reflectivity_10cm proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~tempo_main tempo_main proc~tempo_main->proc~reflectivity_10cm proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/reflectivity_from_melting_graupel.html"},{"title":"reflectivity_from_melting_snow – TEMPO Microphysics","text":"private  function reflectivity_from_melting_snow(rs, smob, smoc, rr) result(ze_snow) Uses module_mp_tempo_params proc~~reflectivity_from_melting_snow~~UsesGraph proc~reflectivity_from_melting_snow reflectivity_from_melting_snow module~module_mp_tempo_params module_mp_tempo_params proc~reflectivity_from_melting_snow->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates radar reflectivity from melting snow using binned approach original credit: Ulrich Blahak and G. Thompson Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rs real(kind=dp), intent(in) :: smob real(kind=dp), intent(in) :: smoc real(kind=wp), intent(in) :: rr Return Value real(kind=wp) Calls proc~~reflectivity_from_melting_snow~~CallsGraph proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~reflectivity_from_melting_snow~~CalledByGraph proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm reflectivity_10cm proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~tempo_main tempo_main proc~tempo_main->proc~reflectivity_10cm proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/reflectivity_from_melting_snow.html"},{"title":"effective_radius – TEMPO Microphysics","text":"public  subroutine effective_radius(temp, l_qc, nc, ilamc, l_qi, ilami, l_qs, rs, re_qc, re_qi, re_qs) Uses module_mp_tempo_params proc~~effective_radius~~UsesGraph proc~effective_radius effective_radius module~module_mp_tempo_params module_mp_tempo_params proc~effective_radius->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. effective radius values for cloud water, cloud ice and snow Note limiting values of for cloud water, for\ncloud ice, and for snow are consistent with RRTMG radiation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: nc real(kind=dp), intent(in), dimension(:) :: ilamc logical, intent(in), dimension(:) :: l_qi real(kind=dp), intent(in), dimension(:) :: ilami logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=wp), intent(out), dimension(:) :: re_qc real(kind=wp), intent(out), dimension(:) :: re_qi real(kind=wp), intent(out), dimension(:) :: re_qs Calls proc~~effective_radius~~CallsGraph proc~effective_radius effective_radius proc~get_nuc get_nuc proc~effective_radius->proc~get_nuc proc~snow_moments snow_moments proc~effective_radius->proc~snow_moments Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~effective_radius~~CalledByGraph proc~effective_radius effective_radius proc~tempo_main tempo_main proc~tempo_main->proc~effective_radius proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/effective_radius.html"},{"title":"reflectivity_10cm – TEMPO Microphysics","text":"public  subroutine reflectivity_10cm(refl10cm_from_melting_flag, temp, l_qr, rr, nr, ilamr, l_qs, rs, smoc, smob, smoz, l_qg, rg, ng, idx, ilamg, dbz) Uses module_mp_tempo_params proc~~reflectivity_10cm~~UsesGraph proc~reflectivity_10cm reflectivity_10cm module~module_mp_tempo_params module_mp_tempo_params proc~reflectivity_10cm->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. 10-cm radar reflectivity contributions from melting snow and graupel are optionally included and Arguments Type Intent Optional Attributes Name logical, intent(in) :: refl10cm_from_melting_flag real(kind=wp), intent(in), dimension(:) :: temp logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smoc real(kind=dp), intent(in), dimension(:) :: smob real(kind=dp), intent(in), dimension(:) :: smoz logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng integer, intent(in), dimension(:) :: idx real(kind=dp), intent(in), dimension(:) :: ilamg real(kind=wp), intent(out), dimension(:) :: dbz Calls proc~~reflectivity_10cm~~CallsGraph proc~reflectivity_10cm reflectivity_10cm proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~reflectivity_10cm~~CalledByGraph proc~reflectivity_10cm reflectivity_10cm proc~tempo_main tempo_main proc~tempo_main->proc~reflectivity_10cm proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/reflectivity_10cm.html"},{"title":"rayleigh_soak_wetgraupel – TEMPO Microphysics","text":"private  subroutine rayleigh_soak_wetgraupel(x_g, a_geo, b_geo, fmelt, lambda_radar, meltratio_outside, m_w, m_i, backscatter) calculates backscatter cross section of wet snow or graupel\nusing Maxwell-Garnett mixing formula and Rayleigh approximation original credit: Ulrich Blahak and G. Thompson Arguments Type Intent Optional Attributes Name real(kind=dp), intent(in) :: x_g real(kind=dp), intent(in) :: a_geo real(kind=dp), intent(in) :: b_geo real(kind=dp), intent(in) :: fmelt real(kind=dp), intent(in) :: lambda_radar real(kind=dp), intent(in) :: meltratio_outside complex(kind=dp), intent(in) :: m_w complex(kind=dp), intent(in) :: m_i real(kind=dp), intent(out) :: backscatter Called by proc~~rayleigh_soak_wetgraupel~~CalledByGraph proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~reflectivity_10cm reflectivity_10cm proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~tempo_main tempo_main proc~tempo_main->proc~reflectivity_10cm proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/rayleigh_soak_wetgraupel.html"},{"title":"max_hail_diam – TEMPO Microphysics","text":"public  subroutine max_hail_diam(rho, rg, ng, ilamg, idx, max_hail_diameter) Uses module_mp_tempo_params proc~~max_hail_diam~~UsesGraph proc~max_hail_diam max_hail_diam module~module_mp_tempo_params module_mp_tempo_params proc~max_hail_diam->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. estimates maximmum hail diameter [mm] using a binned approach see Jensen et al. (2023) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx real(kind=wp), intent(out), dimension(:) :: max_hail_diameter Called by proc~~max_hail_diam~~CalledByGraph proc~max_hail_diam max_hail_diam proc~tempo_main tempo_main proc~tempo_main->proc~max_hail_diam proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/max_hail_diam.html"},{"title":"freezing_rain – TEMPO Microphysics","text":"public  subroutine freezing_rain(temp, rain_precip, cloud_precip, frz_rain) Uses module_mp_tempo_params proc~~freezing_rain~~UsesGraph proc~freezing_rain freezing_rain module~module_mp_tempo_params module_mp_tempo_params proc~freezing_rain->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. estimates freezing rain/drizzle accumulation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: temp real(kind=wp), intent(in) :: rain_precip real(kind=wp), intent(in), optional :: cloud_precip real(kind=wp), intent(out) :: frz_rain Called by proc~~freezing_rain~~CalledByGraph proc~freezing_rain freezing_rain proc~tempo_main tempo_main proc~tempo_main->proc~freezing_rain proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/freezing_rain.html"},{"title":"calc_gamma_p – TEMPO Microphysics","text":"public  function calc_gamma_p(a, x) result(gamma_p) normalized lower gamma function calculated either with a \nseries expansion or continued fraction method input: a = gamma function argument, x = upper limit of integration output: gamma_p = Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: a real(kind=wp), intent(in) :: x Return Value real(kind=wp) Calls proc~~calc_gamma_p~~CallsGraph proc~calc_gamma_p calc_gamma_p proc~calc_gamma_cf calc_gamma_cf proc~calc_gamma_p->proc~calc_gamma_cf proc~calc_gamma_series calc_gamma_series proc~calc_gamma_p->proc~calc_gamma_series Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~calc_gamma_p~~CalledByGraph proc~calc_gamma_p calc_gamma_p proc~qi_aut_qs qi_aut_qs proc~qi_aut_qs->proc~calc_gamma_p proc~tempo_init tempo_init proc~tempo_init->proc~qi_aut_qs proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/calc_gamma_p.html"},{"title":"calc_gamma_series – TEMPO Microphysics","text":"private  function calc_gamma_series(a, x) result(gamma_series) solves the normalized lower gamma function see Equation 8.7.1 input: a = gamma function argument, x = upper limit of integration output: normalized lower gamma function Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: a real(kind=wp), intent(in) :: x Return Value real(kind=wp) Called by proc~~calc_gamma_series~~CalledByGraph proc~calc_gamma_series calc_gamma_series proc~calc_gamma_p calc_gamma_p proc~calc_gamma_p->proc~calc_gamma_series proc~qi_aut_qs qi_aut_qs proc~qi_aut_qs->proc~calc_gamma_p proc~tempo_init tempo_init proc~tempo_init->proc~qi_aut_qs proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/calc_gamma_series.html"},{"title":"calc_gamma_cf – TEMPO Microphysics","text":"private  function calc_gamma_cf(a, x) result(gamma_cf) solves the normalized upper gamma function using a continued fractions method (modified Lentz Algorithm) input: a = gamma function argument, x = lower limit of integration output: normalized upper gamma function: Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: a real(kind=wp), intent(in) :: x Return Value real(kind=wp) Called by proc~~calc_gamma_cf~~CalledByGraph proc~calc_gamma_cf calc_gamma_cf proc~calc_gamma_p calc_gamma_p proc~calc_gamma_p->proc~calc_gamma_cf proc~qi_aut_qs qi_aut_qs proc~qi_aut_qs->proc~calc_gamma_p proc~tempo_init tempo_init proc~tempo_init->proc~qi_aut_qs proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/calc_gamma_cf.html"},{"title":"calc_rslf – TEMPO Microphysics","text":"public  function calc_rslf(p, t) result(rslf) calculates liquid saturation vapor mixing ratio Note even with p = 1050 mb and t = 55 C, the saturation vapor \npressure only contributes to 15% of the total pressure,\nthus the limit on the saturation vapor pressure is set to 15% Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: p real(kind=wp), intent(in) :: t Return Value real(kind=wp) Called by proc~~calc_rslf~~CalledByGraph proc~calc_rslf calc_rslf proc~thermo_vars thermo_vars proc~thermo_vars->proc~calc_rslf proc~tempo_main tempo_main proc~tempo_main->proc~thermo_vars proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/calc_rslf.html"},{"title":"calc_rsif – TEMPO Microphysics","text":"public  function calc_rsif(p, t) result(rsif) calculates liquid saturation vapor mixing ratio Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: p real(kind=wp), intent(in) :: t Return Value real(kind=wp) Called by proc~~calc_rsif~~CalledByGraph proc~calc_rsif calc_rsif proc~thermo_vars thermo_vars proc~thermo_vars->proc~calc_rsif proc~tempo_main tempo_main proc~tempo_main->proc~thermo_vars proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/calc_rsif.html"},{"title":"get_nuc – TEMPO Microphysics","text":"public  function get_nuc(nc) result(nu_c) Uses module_mp_tempo_params proc~~get_nuc~~UsesGraph proc~get_nuc get_nuc module~module_mp_tempo_params module_mp_tempo_params proc~get_nuc->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. returns nu_c for cloud water (values from 2-15) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: nc Return Value integer Called by proc~~get_nuc~~CalledByGraph proc~get_nuc get_nuc proc~cloud_check_and_update cloud_check_and_update proc~cloud_check_and_update->proc~get_nuc proc~cloud_fallspeed cloud_fallspeed proc~cloud_fallspeed->proc~get_nuc proc~compute_drop_evap compute_drop_evap proc~compute_drop_evap->proc~get_nuc proc~effective_radius effective_radius proc~effective_radius->proc~get_nuc proc~riming riming proc~riming->proc~get_nuc proc~warm_rain warm_rain proc~warm_rain->proc~get_nuc proc~tempo_init tempo_init proc~tempo_init->proc~compute_drop_evap proc~tempo_main tempo_main proc~tempo_main->proc~cloud_check_and_update proc~tempo_main->proc~cloud_fallspeed proc~tempo_main->proc~effective_radius proc~tempo_main->proc~riming proc~tempo_main->proc~warm_rain proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_nuc.html"},{"title":"get_constant_cloud_number – TEMPO Microphysics","text":"public  subroutine get_constant_cloud_number(land, nc) Uses module_mp_tempo_params proc~~get_constant_cloud_number~~UsesGraph proc~get_constant_cloud_number get_constant_cloud_number module~module_mp_tempo_params module_mp_tempo_params proc~get_constant_cloud_number->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. returns land-specific value of cloud droplet number concentration\nwhen aerosol-aware = false if land = 1, else returns ocean-specific value Arguments Type Intent Optional Attributes Name integer, intent(in), optional :: land real(kind=wp), intent(out), dimension(:) :: nc Called by proc~~get_constant_cloud_number~~CalledByGraph proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number get_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_main tempo_main proc~tempo_main->interface~get_cloud_number proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_constant_cloud_number.html"},{"title":"snow_moments – TEMPO Microphysics","text":"public  subroutine snow_moments(rs, tc, smob, smoc, ns, smo0, smo1, smo2, smoe, smof, smog, smoz) Uses module_mp_tempo_params proc~~snow_moments~~UsesGraph proc~snow_moments snow_moments module~module_mp_tempo_params module_mp_tempo_params proc~snow_moments->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. computes snow moments from Field et al. (2005) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rs real(kind=wp), intent(in) :: tc real(kind=dp), intent(out) :: smob real(kind=dp), intent(out) :: smoc real(kind=dp), intent(out), optional :: ns real(kind=dp), intent(out), optional :: smo0 real(kind=dp), intent(out), optional :: smo1 real(kind=dp), intent(out), optional :: smo2 real(kind=dp), intent(out), optional :: smoe real(kind=dp), intent(out), optional :: smof real(kind=dp), intent(out), optional :: smog real(kind=dp), intent(out), optional :: smoz Called by proc~~snow_moments~~CalledByGraph proc~snow_moments snow_moments proc~effective_radius effective_radius proc~effective_radius->proc~snow_moments proc~qr_acr_qs qr_acr_qs proc~qr_acr_qs->proc~snow_moments proc~tempo_main tempo_main proc~tempo_main->proc~snow_moments proc~tempo_main->proc~effective_radius proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~build_table_qr_acr_qs->proc~qr_acr_qs proc~tempo_run tempo_run proc~tempo_run->proc~tempo_main proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qs proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->proc~tempo_run program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_graupel_sedimentation program~run_tempo_tests->proc~test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_snow_sedimentation Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/snow_moments.html"},{"title":"compute_efrw – TEMPO Microphysics","text":"public  subroutine compute_efrw() Uses module_mp_tempo_params proc~~compute_efrw~~UsesGraph proc~compute_efrw compute_efrw module~module_mp_tempo_params module_mp_tempo_params proc~compute_efrw->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. collision efficiency for rain collecting cloud water from Beard and Grover (1974)\nif a/A < 0.25\nhttps://doi.org/10.1175/1520-0469(1974)031<0543:NCEFSR>2.0.CO;2\notherwise uses polynomials to get close match of Pruppacher and Klett Fig. 14-9 Arguments None Called by proc~~compute_efrw~~CalledByGraph proc~compute_efrw compute_efrw proc~tempo_init tempo_init proc~tempo_init->proc~compute_efrw proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/compute_efrw.html"},{"title":"compute_efsw – TEMPO Microphysics","text":"public  subroutine compute_efsw() Uses module_mp_tempo_params proc~~compute_efsw~~UsesGraph proc~compute_efsw compute_efsw module~module_mp_tempo_params module_mp_tempo_params proc~compute_efsw->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. collision efficiency for snow collecting cloud water from Wang and Ji (2000)\nhttps://doi.org/10.1175/1520-0469(2000)057<1001:CEOICA>2.0.CO;2\nequating melted snow diameter to effective collision cross-section Arguments None Called by proc~~compute_efsw~~CalledByGraph proc~compute_efsw compute_efsw proc~tempo_init tempo_init proc~tempo_init->proc~compute_efsw proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/compute_efsw.html"},{"title":"qi_aut_qs – TEMPO Microphysics","text":"public  subroutine qi_aut_qs() Uses module_mp_tempo_params proc~~qi_aut_qs~~UsesGraph proc~qi_aut_qs qi_aut_qs module~module_mp_tempo_params module_mp_tempo_params proc~qi_aut_qs->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates cloud ice conversion to snow\nand depositional growth by binning cloud ice distributions and \ndetermining both the size bins > d0s (that are converted to snow) and the \ndepositional growth up to d0s (for cloud ice) and > d0s for snow \nfollowing Harrington et al. (1995)\nhttps://doi.org/10.1175/1520-0469(1995)052<4344:POICCP>2.0.CO;2 Arguments None Calls proc~~qi_aut_qs~~CallsGraph proc~qi_aut_qs qi_aut_qs proc~calc_gamma_p calc_gamma_p proc~qi_aut_qs->proc~calc_gamma_p proc~calc_gamma_cf calc_gamma_cf proc~calc_gamma_p->proc~calc_gamma_cf proc~calc_gamma_series calc_gamma_series proc~calc_gamma_p->proc~calc_gamma_series Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~qi_aut_qs~~CalledByGraph proc~qi_aut_qs qi_aut_qs proc~tempo_init tempo_init proc~tempo_init->proc~qi_aut_qs proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/qi_aut_qs.html"},{"title":"compute_drop_evap – TEMPO Microphysics","text":"public  subroutine compute_drop_evap() Uses module_mp_tempo_params proc~~compute_drop_evap~~UsesGraph proc~compute_drop_evap compute_drop_evap module~module_mp_tempo_params module_mp_tempo_params proc~compute_drop_evap->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. calculates droplet evaporation data Arguments None Calls proc~~compute_drop_evap~~CallsGraph proc~compute_drop_evap compute_drop_evap proc~get_nuc get_nuc proc~compute_drop_evap->proc~get_nuc Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~compute_drop_evap~~CalledByGraph proc~compute_drop_evap compute_drop_evap proc~tempo_init tempo_init proc~tempo_init->proc~compute_drop_evap proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/compute_drop_evap.html"},{"title":"get_version – TEMPO Microphysics","text":"public  subroutine get_version(version) returns the tempo version string from the README.md file\nor returns empty string if not found Arguments Type Intent Optional Attributes Name character(len=*), intent(inout) :: version Called by proc~~get_version~~CalledByGraph proc~get_version get_version proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~get_version proc~tempo_init tempo_init proc~tempo_init->proc~get_version proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/get_version.html"},{"title":"initialize_graupel_vars – TEMPO Microphysics","text":"public  subroutine initialize_graupel_vars(hail_flag) initialize graupel variables based on hail-aware configuration flag Arguments Type Intent Optional Attributes Name logical, intent(in) :: hail_flag Called by proc~~initialize_graupel_vars~~CalledByGraph proc~initialize_graupel_vars initialize_graupel_vars proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~initialize_graupel_vars proc~tempo_init tempo_init proc~tempo_init->proc~initialize_graupel_vars proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_graupel_vars.html"},{"title":"initialize_parameters – TEMPO Microphysics","text":"public  subroutine initialize_parameters() initialize tempo parameters and variables Arguments None Called by proc~~initialize_parameters~~CalledByGraph proc~initialize_parameters initialize_parameters proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~initialize_parameters proc~tempo_init tempo_init proc~tempo_init->proc~initialize_parameters proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_parameters.html"},{"title":"initialize_bins_for_tables – TEMPO Microphysics","text":"public  subroutine initialize_bins_for_tables() initialize log-spaced bins of hydrometer quantities used for lookup tables Arguments None Calls proc~~initialize_bins_for_tables~~CallsGraph proc~initialize_bins_for_tables initialize_bins_for_tables proc~create_bins create_bins proc~initialize_bins_for_tables->proc~create_bins Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~initialize_bins_for_tables~~CalledByGraph proc~initialize_bins_for_tables initialize_bins_for_tables proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~initialize_bins_for_tables proc~tempo_init tempo_init proc~tempo_init->proc~initialize_bins_for_tables proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_bins_for_tables.html"},{"title":"initialize_bins_for_hail_size – TEMPO Microphysics","text":"public  subroutine initialize_bins_for_hail_size() initialize log-spaced bins for hail size calculation Arguments None Calls proc~~initialize_bins_for_hail_size~~CallsGraph proc~initialize_bins_for_hail_size initialize_bins_for_hail_size proc~create_bins create_bins proc~initialize_bins_for_hail_size->proc~create_bins Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~initialize_bins_for_hail_size~~CalledByGraph proc~initialize_bins_for_hail_size initialize_bins_for_hail_size proc~tempo_init tempo_init proc~tempo_init->proc~initialize_bins_for_hail_size proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_bins_for_hail_size.html"},{"title":"initialize_bins_for_radar – TEMPO Microphysics","text":"public  subroutine initialize_bins_for_radar() initialize log-spaced bins for radar calculation Arguments None Calls proc~~initialize_bins_for_radar~~CallsGraph proc~initialize_bins_for_radar initialize_bins_for_radar proc~create_bins create_bins proc~initialize_bins_for_radar->proc~create_bins Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Called by proc~~initialize_bins_for_radar~~CalledByGraph proc~initialize_bins_for_radar initialize_bins_for_radar proc~tempo_init tempo_init proc~tempo_init->proc~initialize_bins_for_radar proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_bins_for_radar.html"},{"title":"create_bins – TEMPO Microphysics","text":"public  subroutine create_bins(numbins, lowbin, highbin, bins, deltabins) calculates log-spaced bins of hydrometer sizes to simplify calculations later Arguments Type Intent Optional Attributes Name integer, intent(in) :: numbins real(kind=dp), intent(in) :: lowbin real(kind=dp), intent(in) :: highbin real(kind=dp), intent(out), dimension(:) :: bins real(kind=dp), intent(out), optional, dimension(:) :: deltabins Called by proc~~create_bins~~CalledByGraph proc~create_bins create_bins proc~initialize_bins_for_hail_size initialize_bins_for_hail_size proc~initialize_bins_for_hail_size->proc~create_bins proc~initialize_bins_for_radar initialize_bins_for_radar proc~initialize_bins_for_radar->proc~create_bins proc~initialize_bins_for_tables initialize_bins_for_tables proc~initialize_bins_for_tables->proc~create_bins proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~initialize_bins_for_tables proc~tempo_init tempo_init proc~tempo_init->proc~initialize_bins_for_hail_size proc~tempo_init->proc~initialize_bins_for_radar proc~tempo_init->proc~initialize_bins_for_tables proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/create_bins.html"},{"title":"initialize_arrays_freezewater – TEMPO Microphysics","text":"public  subroutine initialize_arrays_freezewater(table_size) initialize data arrays for Bigg (1953) freezing of cloud water and rain Warning six lookup table arrays are allocated and set here Arguments Type Intent Optional Attributes Name integer, intent(out), optional :: table_size Called by proc~~initialize_arrays_freezewater~~CalledByGraph proc~initialize_arrays_freezewater initialize_arrays_freezewater proc~build_table_freezewater build_table_freezewater proc~build_table_freezewater->proc~initialize_arrays_freezewater proc~tempo_init tempo_init proc~tempo_init->proc~initialize_arrays_freezewater proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_freezewater proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_arrays_freezewater.html"},{"title":"initialize_arrays_qr_acr_qs – TEMPO Microphysics","text":"public  subroutine initialize_arrays_qr_acr_qs(table_size) initialize data arrays for rain-snow collection Warning twelve lookup table arrays are allocated and set here Arguments Type Intent Optional Attributes Name integer, intent(out), optional :: table_size Called by proc~~initialize_arrays_qr_acr_qs~~CalledByGraph proc~initialize_arrays_qr_acr_qs initialize_arrays_qr_acr_qs proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~build_table_qr_acr_qs->proc~initialize_arrays_qr_acr_qs proc~tempo_init tempo_init proc~tempo_init->proc~initialize_arrays_qr_acr_qs proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qs proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_arrays_qr_acr_qs.html"},{"title":"initialize_arrays_qr_acr_qg – TEMPO Microphysics","text":"public  subroutine initialize_arrays_qr_acr_qg(table_size) initialize data arrays for rain-graupel collection Warning five lookup table arrays are allocated and set here Arguments Type Intent Optional Attributes Name integer, intent(out), optional :: table_size Called by proc~~initialize_arrays_qr_acr_qg~~CalledByGraph proc~initialize_arrays_qr_acr_qg initialize_arrays_qr_acr_qg proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~build_table_qr_acr_qg->proc~initialize_arrays_qr_acr_qg proc~tempo_init tempo_init proc~tempo_init->proc~initialize_arrays_qr_acr_qg proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->proc~build_table_qr_acr_qg proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~build_tables build_tables program~build_tables->proc~tempo_build_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_arrays_qr_acr_qg.html"},{"title":"initialize_arrays_ccn – TEMPO Microphysics","text":"public  subroutine initialize_arrays_ccn(table_size) initialize data arrays for ccn lookup table Warning one lookup table array is allocated and set here Arguments Type Intent Optional Attributes Name integer, intent(out), optional :: table_size Called by proc~~initialize_arrays_ccn~~CalledByGraph proc~initialize_arrays_ccn initialize_arrays_ccn proc~tempo_init tempo_init proc~tempo_init->proc~initialize_arrays_ccn proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_arrays_ccn.html"},{"title":"initialize_arrays_drop_evap – TEMPO Microphysics","text":"public  subroutine initialize_arrays_drop_evap() initialize data arrays for drop evaporation data Warning two lookup table arrays are allocated and set here Arguments None Called by proc~~initialize_arrays_drop_evap~~CalledByGraph proc~initialize_arrays_drop_evap initialize_arrays_drop_evap proc~tempo_init tempo_init proc~tempo_init->proc~initialize_arrays_drop_evap proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_arrays_drop_evap.html"},{"title":"initialize_array_efsw – TEMPO Microphysics","text":"public  subroutine initialize_array_efsw() initializes the collision efficiency data array for snow collecting cloud water Warning one lookup table array is allocated and set here Arguments None Called by proc~~initialize_array_efsw~~CalledByGraph proc~initialize_array_efsw initialize_array_efsw proc~tempo_init tempo_init proc~tempo_init->proc~initialize_array_efsw proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_array_efsw.html"},{"title":"initialize_array_efrw – TEMPO Microphysics","text":"public  subroutine initialize_array_efrw() initializes the collision efficiency data array for rain collecting cloud water Warning one lookup table array is allocated and set here Arguments None Called by proc~~initialize_array_efrw~~CalledByGraph proc~initialize_array_efrw initialize_array_efrw proc~tempo_init tempo_init proc~tempo_init->proc~initialize_array_efrw proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_array_efrw.html"},{"title":"initialize_arrays_qi_aut_qs – TEMPO Microphysics","text":"public  subroutine initialize_arrays_qi_aut_qs() initializes data arrays for cloud ice to snow conversion and growth Warning three lookup table arrays are allocated and set here Arguments None Called by proc~~initialize_arrays_qi_aut_qs~~CalledByGraph proc~initialize_arrays_qi_aut_qs initialize_arrays_qi_aut_qs proc~tempo_init tempo_init proc~tempo_init->proc~initialize_arrays_qi_aut_qs proc~test_tempo_init test_tempo_init proc~test_tempo_init->proc~tempo_init program~run_tempo_tests run_tempo_tests program~run_tempo_tests->proc~test_tempo_init Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module.","tags":"","url":"proc/initialize_arrays_qi_aut_qs.html"},{"title":"module_mp_tempo_aerosols – TEMPO Microphysics","text":"contains produces used when aerosol-aware = true Uses module_mp_tempo_params module~~module_mp_tempo_aerosols~~UsesGraph module~module_mp_tempo_aerosols module_mp_tempo_aerosols module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_aerosols->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~module_mp_tempo_aerosols~~UsedByGraph module~module_mp_tempo_aerosols module_mp_tempo_aerosols module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_main->module~module_mp_tempo_aerosols module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_main module~tests tests module~tests->module~module_mp_tempo_driver program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Functions public  function aerosol_collection_efficiency (d, da, visc, rhoa, temp, species) result(eff_a) computes aerosol collection efficiency for precipitation scavenging\nfrom Wang et al. (2010) Arguments Type Intent Optional Attributes Name real(kind=dp), intent(in) :: d real(kind=wp), intent(in) :: da real(kind=wp), intent(in) :: visc real(kind=wp), intent(in) :: rhoa real(kind=wp), intent(in) :: temp character(len=1), intent(in) :: species Return Value real(kind=wp) Subroutines public  subroutine init_water_friendly_aerosols (dz1d, nwfa) sets water-friendly aerosols to an exponential profile\nif aerosol-aware = true and no initial condition\nis provided by the host model Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: nwfa public  subroutine init_ice_friendly_aerosols (dz1d, nifa) sets ice-friendly aerosols to an exponential profile\nif aerosol-aware = true and no initial condition\nis provided by the host model Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: nifa","tags":"","url":"module/module_mp_tempo_aerosols.html"},{"title":"tests – TEMPO Microphysics","text":"TEMPO tests Uses module_mp_tempo_cfgs module_mp_tempo_driver module~~tests~~UsesGraph module~tests tests module~module_mp_tempo_cfgs module_mp_tempo_cfgs module~tests->module~module_mp_tempo_cfgs module~module_mp_tempo_driver module_mp_tempo_driver module~tests->module~module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_cfgs module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver->module~module_mp_tempo_main module~module_mp_tempo_ml module_mp_tempo_ml module~module_mp_tempo_driver->module~module_mp_tempo_ml module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_driver->module~module_mp_tempo_params module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_driver->module~module_mp_tempo_utils module~module_mp_tempo_main->module~module_mp_tempo_cfgs module~module_mp_tempo_main->module~module_mp_tempo_ml module~module_mp_tempo_main->module~module_mp_tempo_params module~module_mp_tempo_main->module~module_mp_tempo_utils module~module_mp_tempo_aerosols module_mp_tempo_aerosols module~module_mp_tempo_main->module~module_mp_tempo_aerosols module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_main->module~module_mp_tempo_diags module~module_mp_tempo_ml->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types module~module_mp_tempo_utils->module~module_mp_tempo_params module~module_mp_tempo_aerosols->module~module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_utils Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~tests~~UsedByGraph module~tests tests program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Variables Type Visibility Attributes Name Initial type( ty_tempo_cfgs ), private :: tempo_cfgs Subroutines public  subroutine test_tempo_init () test tempo initialization procedure\nuse ml_for_bl_nc_flag = .true. to initialize ml data\nwhich is used for a few tests\ntest specific flags are then set in each test Arguments None public  subroutine test_graupel_sedimentation (dt, semi_sedi) test graupel sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt logical, intent(in) :: semi_sedi public  subroutine test_snow_sedimentation (dt) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt public  subroutine test_cloud_number_aerosolaware (dt) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt public  subroutine test_cloud_number_non_aerosolaware (dt) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt public  subroutine test_cloud_number_ml (dt) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt public  subroutine test_ml_cloud_effective_radius (dt) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt","tags":"","url":"module/tests.html"},{"title":"module_mp_tempo_driver – TEMPO Microphysics","text":"tempo driver that converts 3d model input to 1d arrays used by the main code\nalso allocates and fills diagnostic arrays Uses module_mp_tempo_main module_mp_tempo_cfgs module_mp_tempo_ml module_mp_tempo_utils module_mp_tempo_params module~~module_mp_tempo_driver~~UsesGraph module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_cfgs module_mp_tempo_cfgs module~module_mp_tempo_driver->module~module_mp_tempo_cfgs module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver->module~module_mp_tempo_main module~module_mp_tempo_ml module_mp_tempo_ml module~module_mp_tempo_driver->module~module_mp_tempo_ml module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_driver->module~module_mp_tempo_params module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_driver->module~module_mp_tempo_utils module~module_mp_tempo_main->module~module_mp_tempo_cfgs module~module_mp_tempo_main->module~module_mp_tempo_ml module~module_mp_tempo_main->module~module_mp_tempo_params module~module_mp_tempo_main->module~module_mp_tempo_utils module~module_mp_tempo_aerosols module_mp_tempo_aerosols module~module_mp_tempo_main->module~module_mp_tempo_aerosols module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_main->module~module_mp_tempo_diags module~module_mp_tempo_ml->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types module~module_mp_tempo_utils->module~module_mp_tempo_params module~module_mp_tempo_aerosols->module~module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_utils Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~module_mp_tempo_driver~~UsedByGraph module~module_mp_tempo_driver module_mp_tempo_driver module~tests tests module~tests->module~module_mp_tempo_driver program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Variables Type Visibility Attributes Name Initial type( ty_tempo_table_cfgs ), private :: tempo_table_cfgs Derived Types type, public :: ty_tempo_driver_diags Components Type Visibility Attributes Name Initial real(kind=wp), public, dimension(:,:), allocatable :: rain_precip real(kind=wp), public, dimension(:,:), allocatable :: ice_liquid_equiv_precip real(kind=wp), public, dimension(:,:), allocatable :: snow_liquid_equiv_precip real(kind=wp), public, dimension(:,:), allocatable :: graupel_liquid_equiv_precip real(kind=wp), public, dimension(:,:), allocatable :: frozen_fraction real(kind=wp), public, dimension(:,:), allocatable :: frz_rain_precip real(kind=wp), public, dimension(:,:), allocatable :: max_hail_diameter_sfc real(kind=wp), public, dimension(:,:), allocatable :: max_hail_diameter_column real(kind=wp), public, dimension(:,:,:), allocatable :: refl10cm real(kind=wp), public, dimension(:,:,:), allocatable :: re_cloud real(kind=wp), public, dimension(:,:,:), allocatable :: re_ice real(kind=wp), public, dimension(:,:,:), allocatable :: re_snow real(kind=wp), public, dimension(:,:,:), allocatable :: rain_med_vol_diam real(kind=wp), public, dimension(:,:,:), allocatable :: graupel_med_vol_diam real(kind=wp), public, dimension(:,:,:), allocatable :: cloud_number_mixing_ratio Subroutines public  subroutine tempo_init (aerosolaware_flag, hailaware_flag, ml_for_bl_nc_flag, ml_for_nc_flag, force_init_flag, tempo_cfgs) initialize tempo microphysics\n\\section arg_table_tempo_init Argument Table\n\\htmlinclude tempo_init.html Read more… Arguments Type Intent Optional Attributes Name logical, intent(in), optional :: aerosolaware_flag logical, intent(in), optional :: hailaware_flag logical, intent(in), optional :: ml_for_bl_nc_flag logical, intent(in), optional :: ml_for_nc_flag logical, intent(in), optional :: force_init_flag type( ty_tempo_cfgs ), intent(out) :: tempo_cfgs public  subroutine tempo_run (tempo_cfgs, dt, itimestep, t, th, pii, p, w, dz, qv, qc, qr, qi, qs, qg, ni, nr, nc, nwfa, nifa, ng, qb, qc_bl, qcfrac_bl, qcfrac, qifrac, thten_bl, qvten_bl, qcten_bl, qiten_bl, thten_lwrad, thten_swrad, ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, its, ite, jts, jte, kts, kte, tempo_diags) \\section arg_table_tempo_run Argument Table\n\\htmlinclude tempo_run.html Arguments Type Intent Optional Attributes Name type( ty_tempo_cfgs ), intent(in) :: tempo_cfgs real(kind=wp), intent(in) :: dt timestep integer, intent(in) :: itimestep integer timestep = integration time / dt real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: t temperature real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: th theta real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: pii exner function real(kind=wp), intent(in), dimension(ims:ime, kms:kme, jms:jme) :: p pressure real(kind=wp), intent(in), dimension(ims:ime, kms:kme, jms:jme) :: w vertical velocity real(kind=wp), intent(in), dimension(ims:ime, kms:kme, jms:jme) :: dz vertical grid spacing real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qv 3D water vapor mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qc 3D cloud water mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qr 3D rain water mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qi 3D cloud ice mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qs 3D snow mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: qg 3D graupel mass mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: ni 3D cloud ice number mixing ratio real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: nr 3D rain water number mixing ratio real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: nc 3D cloud water number mixing ratio (aerosol-aware) real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: nwfa 3D water-friendly aerosol number mixing ratio (aerosol-aware) real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: nifa 3D ice-friendly aerosol number mixing ratio (aerosol-aware) real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: ng 3D graupel number mixing ratio (hail-aware) real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: qb 3D graupel volume mixing ratio (hail-aware) real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qc_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qcfrac_bl real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: qcfrac real(kind=wp), intent(inout), optional, dimension(ims:ime, kms:kme, jms:jme) :: qifrac real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: thten_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qvten_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qcten_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: qiten_bl real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: thten_lwrad real(kind=wp), intent(in), optional, dimension(ims:ime, kms:kme, jms:jme) :: thten_swrad integer, intent(in) :: ids domain locations integer, intent(in) :: ide domain locations integer, intent(in) :: jds domain locations integer, intent(in) :: jde domain locations integer, intent(in) :: kds domain locations integer, intent(in) :: kde domain locations integer, intent(in) :: ims memory locations integer, intent(in) :: ime memory locations integer, intent(in) :: jms memory locations integer, intent(in) :: jme memory locations integer, intent(in) :: kms memory locations integer, intent(in) :: kme memory locations integer, intent(in) :: its tile locations integer, intent(in) :: ite tile locations integer, intent(in) :: jts tile locations integer, intent(in) :: jte tile locations integer, intent(in) :: kts tile locations integer, intent(in) :: kte tile locations type( ty_tempo_driver_diags ), intent(out) :: tempo_diags public  subroutine tempo_aerosol_surface_emissions (dt, nwfa, nwfa2d, ims, ime, jms, jme, kms, kme, kts) adds aerosol surface emissions to the 3D field Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: dt real(kind=wp), intent(inout), dimension(ims:ime, kms:kme, jms:jme) :: nwfa real(kind=wp), intent(in), dimension(ims:ime, jms:jme) :: nwfa2d integer, intent(in) :: ims integer, intent(in) :: ime integer, intent(in) :: jms integer, intent(in) :: jme integer, intent(in) :: kms integer, intent(in) :: kme integer, intent(in) :: kts private  subroutine read_table_freezewater (filename, table_size) read lookup table for frozen cloud and rain water Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size private  subroutine read_table_qr_acr_qs (filename, table_size) read lookup table for rain-snow collection Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size private  subroutine read_table_qr_acr_qg (filename, table_size) read lookup table for rain-graupel collection Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size private  subroutine read_table_ccn (filename, table_size) read static file containing CCN activation of aerosols;\nthe data were created from a parcel model by Feingold and Heymsfield (1992)\nhttps://doi.org/10.1175/1520-0469(1992)049<2325:POCGOD>2.0.CO;2\nwith further changes by Eidhammer and Kreidenweis Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size private  subroutine check_before_table_read (filename, table_size) checks that lookup tables exist and are the correct size\nbefore attempting to read them Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename integer, intent(in) :: table_size private  subroutine init_ml_data () initialize machine learning data for tempo microphysics Arguments None","tags":"","url":"module/module_mp_tempo_driver.html"},{"title":"module_mp_tempo_tables – TEMPO Microphysics","text":"initialize variables for tempo microphysics includes a procedure to build and save tempo lookup tables Uses module_mp_tempo_cfgs mpi_f08 module_mp_tempo_utils module_mp_tempo_params module~~module_mp_tempo_tables~~UsesGraph module~module_mp_tempo_tables module_mp_tempo_tables module~module_mp_tempo_cfgs module_mp_tempo_cfgs module~module_mp_tempo_tables->module~module_mp_tempo_cfgs module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_tables->module~module_mp_tempo_params module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_tables->module~module_mp_tempo_utils mpi_f08 mpi_f08 module~module_mp_tempo_tables->mpi_f08 ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types module~module_mp_tempo_utils->module~module_mp_tempo_params Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~module_mp_tempo_tables~~UsedByGraph module~module_mp_tempo_tables module_mp_tempo_tables program~build_tables build_tables program~build_tables->module~module_mp_tempo_tables Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Variables Type Visibility Attributes Name Initial type( ty_tempo_table_cfgs ), private :: tempo_table_cfgs Subroutines public  subroutine tempo_build_tables (build_tables_rank, build_tables_num_proc) builds three lookup tables for tempo microphysics Arguments Type Intent Optional Attributes Name integer, intent(in) :: build_tables_rank integer, intent(in) :: build_tables_num_proc private  subroutine build_table_freezewater () build lookup table data for frozen cloud and rain water Arguments None private  subroutine write_table_freezewater (filename) write data for frozen cloud water and rain to a file Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename private  subroutine build_table_qr_acr_qs (rank, num_proc) build lookup table data for rain-snow collection Arguments Type Intent Optional Attributes Name integer, intent(in) :: rank integer, intent(in) :: num_proc private  subroutine write_table_qr_acr_qs (filename) write data for rain-snow collection to a file Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename private  subroutine build_table_qr_acr_qg (rank, num_proc) build lookup table data for rain-graupel collection Arguments Type Intent Optional Attributes Name integer, intent(in) :: rank integer, intent(in) :: num_proc private  subroutine write_table_qr_acr_qg (filename) write data for rain-graupel collection to a file Arguments Type Intent Optional Attributes Name character(len=*), intent(in) :: filename private  subroutine gather (local_flat, global_flat, sendcounts, displacements, ierror) wrapper to simplify MPI_Gatherv Arguments Type Intent Optional Attributes Name real(kind=table_dp), intent(in), dimension(:) :: local_flat real(kind=table_dp), intent(out), dimension(:) :: global_flat integer, intent(in), dimension(:) :: sendcounts integer, intent(in), dimension(:) :: displacements integer, intent(inout) :: ierror private  subroutine get_index_for_rank (idx, rank, num_proc, start_idx, end_idx) returns start and end index values for an array dimension\nof size idx distributed over num_procs Arguments Type Intent Optional Attributes Name integer, intent(in) :: idx integer, intent(in) :: rank integer, intent(in) :: num_proc integer, intent(out) :: start_idx integer, intent(out) :: end_idx private  subroutine qr_acr_qs (local_start, local_end, ltcs_racs1, ltmr_racs1, ltcs_racs2, ltmr_racs2, ltcr_sacr1, ltms_sacr1, ltcr_sacr2, ltms_sacr2, ltnr_racs1, ltnr_racs2, ltnr_sacr1, ltnr_sacr2) calculates rain collecting snow (and inverse) Arguments Type Intent Optional Attributes Name integer, intent(in) :: local_start integer, intent(in) :: local_end real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltcs_racs1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltmr_racs1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltcs_racs2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltmr_racs2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltcr_sacr1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltms_sacr1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltcr_sacr2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltms_sacr2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltnr_racs1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltnr_racs2 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltnr_sacr1 real(kind=table_dp), intent(out), dimension(:,:,:,:) :: ltnr_sacr2 private  subroutine qr_acr_qg (local_start, local_end, ltcg_racg, ltmr_racg, ltcr_gacr, ltnr_racg, ltnr_gacr) rain collecting graupel (and inverse) using explicit integration Arguments Type Intent Optional Attributes Name integer, intent(in) :: local_start integer, intent(in) :: local_end real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltcg_racg real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltmr_racg real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltcr_gacr real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltnr_racg real(kind=table_dp), intent(out), dimension(:,:,:,:,:) :: ltnr_gacr private  subroutine freezewater () calculates the probability of drops of a particular volume freezing\n from Bigg (1953)\n https://doi.org/10.1002/qj.49707934207 Read more… Arguments None","tags":"","url":"module/module_mp_tempo_tables.html"},{"title":"module_mp_tempo_cfgs – TEMPO Microphysics","text":"tempo configs Used by module~~module_mp_tempo_cfgs~~UsedByGraph module~module_mp_tempo_cfgs module_mp_tempo_cfgs module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_cfgs module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver->module~module_mp_tempo_main module~module_mp_tempo_main->module~module_mp_tempo_cfgs module~module_mp_tempo_tables module_mp_tempo_tables module~module_mp_tempo_tables->module~module_mp_tempo_cfgs module~tests tests module~tests->module~module_mp_tempo_cfgs module~tests->module~module_mp_tempo_driver program~build_tables build_tables program~build_tables->module~module_mp_tempo_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Derived Types type, public :: ty_tempo_cfgs \\section arg_table_ty_tempo_cfgs Argument Table\n\\htmlinclude ty_tempo_cfgs.html Components Type Visibility Attributes Name Initial logical, public :: aerosolaware_flag = .true. flag to run aerosol-aware microphysics logical, public :: hailaware_flag = .true. flag to run hail-aware microphysics logical, public :: ml_for_bl_nc_flag = .false. flag to run machine-learning prediction for subgrid cloud number concentration logical, public :: ml_for_nc_flag = .false. flag to run machine-learning prediction for tempo cloud number concentration logical, public :: semi_sedi_flag = .false. flag for semi-lagrangian sedimentation logical, public :: refl10cm_from_melting_flag = .false. flag to calculate reflectivity for melting snow and graupel logical, public :: turn_off_micro_flag = .false. flag to turn off all microphysical processes logical, public :: verbose = .false. flag to turn on verbose print statements logical, public :: refl10cm_flag = .true. flag to output 10cm reflectivity logical, public :: re_cloud_flag = .true. flag to output cloud effective radius logical, public :: re_ice_flag = .true. flag to output ice effective radius logical, public :: re_snow_flag = .true. flag to output snow effective radius logical, public :: max_hail_diameter_flag = .true. flag to output maximum hail diameter logical, public :: rain_med_vol_diam_flag = .false. flag to output median volume diameter for rain logical, public :: graupel_med_vol_diam_flag = .false. flag to output median volume diameter for graupel logical, public :: cloud_number_mixing_ratio_flag = .false. flag to output cloud number mixing ratio type, public :: ty_tempo_table_cfgs Components Type Visibility Attributes Name Initial character(len=100), public :: ccn_table_name = 'ccn_activate.bin' ccn table name character(len=100), public :: qrqg_table_name = 'qr_acr_qg_data_tempo_v3' rain-graupel collection table name character(len=100), public :: qrqs_table_name = 'qr_acr_qs_data_tempo_v3' rain-snow collection table name character(len=100), public :: freezewater_table_name = 'freeze_water_data_tempo_v3' freeze water collection table name","tags":"","url":"module/module_mp_tempo_cfgs.html"},{"title":"module_mp_tempo_ml – TEMPO Microphysics","text":"neural network module designed for cloud droplet number concentration prediction inspired by work from David John Gagne (NCAR) Uses module_mp_tempo_params module~~module_mp_tempo_ml~~UsesGraph module~module_mp_tempo_ml module_mp_tempo_ml module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_ml->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~module_mp_tempo_ml~~UsedByGraph module~module_mp_tempo_ml module_mp_tempo_ml module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_ml module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver->module~module_mp_tempo_main module~module_mp_tempo_main->module~module_mp_tempo_ml module~tests tests module~tests->module~module_mp_tempo_driver program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Variables Type Visibility Attributes Name Initial integer, public, parameter :: nc_ml_input = 7 integer, public, parameter :: nc_ml_nodes = 24 integer, public, parameter :: nc_ml_output = 1 real(kind=wp), public, parameter,               dimension(nc_ml_input) :: nc_ml_trans_mean = [0.000191556196486247_wp, 3.58145042772654e-05_wp, 3.12611085359273e-07_wp, 5.74303078738579e-05_wp, 84191.2092225319_wp, 279.070551773565_wp, 0.123679354084004_wp] real(kind=wp), public, parameter,               dimension(nc_ml_input) :: nc_ml_trans_var = [5.78143564171777e-08_wp, 3.22834309750552e-08_wp, 6.45745893307455e-11_wp, 4.16625579383794e-08_wp, 215694631.771185_wp, 94.6576255386858_wp, 0.384841247662964_wp] real(kind=wp), public, parameter,               dimension(nc_ml_input * nc_ml_nodes) :: nc_ml_w00 = [-2.006957_wp, -0.2812008_wp, -0.339073_wp, 1.596426_wp, 2.395225_wp, 1.76315_wp, -0.0626798_wp, 1.267002_wp, -0.02234177_wp, -6.522605e-33_wp, 0.4792154_wp, -0.1253034_wp, -3.217191_wp, -3.092887_wp, -0.0863651_wp, 1.071625_wp, 0.09741028_wp, 0.2255831_wp, -0.6929023_wp, -0.02693799_wp, -3.432344e-33_wp, -0.8791879_wp, -0.9359049_wp, 1.083484_wp, -0.07909214_wp, -0.0122418_wp, -0.02815927_wp, 0.1676407_wp, 0.08252326_wp, 0.6697816_wp, -0.4019359_wp, 0.4687141_wp, 0.001813132_wp, -9.792186e-33_wp, 0.0409322_wp, 0.0113192_wp, -0.01354596_wp, 0.00307771_wp, -0.4635534_wp, 0.03835761_wp, -0.1015553_wp, 0.7316446_wp, -0.05791711_wp, -0.0002690362_wp, -7.920147e-33_wp, -0.1216918_wp, -0.3190572_wp, 0.09809405_wp, -0.16476_wp, -0.03387314_wp, 0.005422261_wp, 0.04043967_wp, 0.03901243_wp, 0.07444729_wp, 0.01954299_wp, 0.06918761_wp, 0.04823543_wp, -8.637957e-33_wp, 0.06371575_wp, -0.09250915_wp, -1.109653_wp, -1.373999_wp, -0.2412623_wp, -0.04482195_wp, 0.1584691_wp, 0.06353725_wp, 0.0006248798_wp, 0.04593191_wp, -8.878673e-33_wp, -0.4988684_wp, 0.01110262_wp, 0.04623203_wp, 0.006581791_wp, 0.03536217_wp, -0.1890567_wp, -0.08839592_wp, 0.1327181_wp, 0.03478973_wp, -0.1565902_wp, -0.100401_wp, -0.1179777_wp, -8.879818e-33_wp, -0.1383738_wp, 0.02847495_wp, -0.005902881_wp, 0.005615512_wp, -0.6308192_wp, -0.02431803_wp, -0.141971_wp, -0.3490018_wp, -0.9850957_wp, -0.1449479_wp, -8.059166e-33_wp, -0.1186465_wp, -1.165381_wp, 0.069015_wp, 0.003388841_wp, -0.04041302_wp, 0.1638467_wp, 0.1147008_wp, -0.04833491_wp, -0.07755993_wp, -0.5137688_wp, 0.04546477_wp, 0.04101883_wp, 6.752353e-33_wp, 0.3541977_wp, 0.04880851_wp, -0.00102834_wp, -0.01280629_wp, -0.1116254_wp, -0.02204754_wp, 0.07100908_wp, 0.2354002_wp, 0.07129629_wp, 0.2489657_wp, 8.080785e-33_wp, -0.03449865_wp, 0.06037927_wp, -0.02023619_wp, 0.7779589_wp, 0.04680278_wp, 0.7492616_wp, 0.6545208_wp, -1.09497_wp, -1.176524_wp, -0.451585_wp, 0.881124_wp, -0.4551499_wp, -8.708624e-33_wp, 1.006558_wp, -0.04979523_wp, -0.0006915367_wp, -0.002993054_wp, 0.01654614_wp, -0.07141764_wp, -0.2216591_wp, 0.8637336_wp, 0.8358089_wp, -0.7576646_wp, 8.186339e-33_wp, 0.1161914_wp, 0.7121871_wp, -1.146734_wp, 0.03925339_wp, 0.9975697_wp, -0.06953461_wp, -0.07598846_wp, -0.06418022_wp, -0.01897495_wp, -0.03612464_wp, -0.06703389_wp, -0.103049_wp, 9.364858e-33_wp, -0.03949085_wp, 1.005938_wp, 0.0001625419_wp, -0.01027657_wp, 0.03823901_wp, 0.3197246_wp, -0.1160718_wp, 0.04449431_wp, 0.009831783_wp, 0.6551342_wp, -8.470687e-33_wp, 0.1374123_wp, -0.01782138_wp, 0.01719949_wp] real(kind=wp), public, parameter,               dimension(nc_ml_nodes) :: nc_ml_w01 = [-4.045869_wp, 0.558111_wp, -1.567351_wp, -1.64972_wp, 2.748608_wp, -1.909901_wp, 0.3955558_wp, 1.507247_wp, 0.3599722_wp, -0.0001173223_wp, -0.9398569_wp, -0.6867028_wp, -61.72853_wp, -63.13766_wp, 1.165811_wp, -0.6848684_wp, 0.1931683_wp, 1.1208_wp, 2.63087_wp, 0.740169_wp, -21.62499_wp, 1.545568_wp, 3.575141_wp, -1.299604_wp] real(kind=wp), public, parameter,               dimension(nc_ml_nodes) :: nc_ml_b00 = [-0.9842531_wp, 0.3064759_wp, -0.4500185_wp, 1.28336_wp, 1.384105_wp, 0.528031_wp, 0.8453538_wp, 1.579872_wp, 2.245679_wp, -0.008679952_wp, 0.4549862_wp, -0.136581_wp, -2.576741_wp, -2.483647_wp, -0.2089484_wp, 0.7607977_wp, 1.847745_wp, 0.7316047_wp, -0.287945_wp, 2.227298_wp, -2.314714_wp, -0.2561245_wp, -0.6993448_wp, -0.1359731_wp] real(kind=wp), public, parameter,               dimension(nc_ml_output) :: nc_ml_b01 = [1.572826_wp] Derived Types type, public :: ty_tempo_ml_data Components Type Visibility Attributes Name Initial integer, public :: input_size integer, public :: output_size integer, public :: node_size real(kind=wp), public, dimension(:), allocatable :: transform_mean real(kind=wp), public, dimension(:), allocatable :: transform_var real(kind=wp), public, dimension(:,:), allocatable :: weights00 real(kind=wp), public, dimension(:), allocatable :: bias00 real(kind=wp), public, dimension(:,:), allocatable :: weights01 real(kind=wp), public, dimension(:), allocatable :: bias01 Subroutines public  subroutine save_or_read_ml_data (ml_data_in, ml_data_out) initializes and saves or returns neural network information Arguments Type Intent Optional Attributes Name type( ty_tempo_ml_data ), intent(in), optional, dimension(1) :: ml_data_in type( ty_tempo_ml_data ), intent(out), optional, dimension(1) :: ml_data_out public  subroutine tempo_ml_predict_cloud_number (qc, qr, qi, qs, pres, temp, w, predicted_number) predicts number concentration Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: qc real(kind=wp), intent(in), dimension(:) :: qr real(kind=wp), intent(in), dimension(:) :: qi real(kind=wp), intent(in), dimension(:) :: qs real(kind=wp), intent(in), dimension(:) :: pres real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: w real(kind=wp), intent(inout), dimension(:) :: predicted_number private  subroutine standard_scaler_transform (mean, var, raw_data, transformed_data) standard scaler tranformer Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: mean real(kind=wp), intent(in), dimension(:) :: var real(kind=wp), intent(in), dimension(:,:) :: raw_data real(kind=wp), intent(out), dimension(:,:), allocatable :: transformed_data private  subroutine relu_activation (input, output) relu activation function Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:,:) :: input real(kind=wp), intent(out), dimension(:,:), allocatable :: output","tags":"","url":"module/module_mp_tempo_ml.html"},{"title":"module_mp_tempo_main – TEMPO Microphysics","text":"main tempo microphysics code Uses module_mp_tempo_cfgs module_mp_tempo_utils module_mp_tempo_aerosols module_mp_tempo_ml module_mp_tempo_params module_mp_tempo_diags module~~module_mp_tempo_main~~UsesGraph module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_aerosols module_mp_tempo_aerosols module~module_mp_tempo_main->module~module_mp_tempo_aerosols module~module_mp_tempo_cfgs module_mp_tempo_cfgs module~module_mp_tempo_main->module~module_mp_tempo_cfgs module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_main->module~module_mp_tempo_diags module~module_mp_tempo_ml module_mp_tempo_ml module~module_mp_tempo_main->module~module_mp_tempo_ml module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_main->module~module_mp_tempo_params module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_main->module~module_mp_tempo_utils module~module_mp_tempo_aerosols->module~module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_utils module~module_mp_tempo_ml->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types module~module_mp_tempo_utils->module~module_mp_tempo_params Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~module_mp_tempo_main~~UsedByGraph module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_main module~tests tests module~tests->module~module_mp_tempo_driver program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Variables Type Visibility Attributes Name Initial real(kind=wp), private :: global_dt real(kind=wp), private :: global_inverse_dt Interfaces private        interface get_cloud_number public  subroutine tempo_ml_predict_cloud_number (qc, qr, qi, qs, pres, temp, w, predicted_number) predicts number concentration Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: qc real(kind=wp), intent(in), dimension(:) :: qr real(kind=wp), intent(in), dimension(:) :: qi real(kind=wp), intent(in), dimension(:) :: qs real(kind=wp), intent(in), dimension(:) :: pres real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: w real(kind=wp), intent(inout), dimension(:) :: predicted_number public  subroutine get_constant_cloud_number (land, nc) returns land-specific value of cloud droplet number concentration\nwhen aerosol-aware = false if land = 1, else returns ocean-specific value Arguments Type Intent Optional Attributes Name integer, intent(in), optional :: land real(kind=wp), intent(out), dimension(:) :: nc Derived Types type, public :: ty_tempo_main_diags Components Type Visibility Attributes Name Initial real(kind=wp), public :: rain_precip real(kind=wp), public :: cloud_precip real(kind=wp), public :: ice_liquid_equiv_precip real(kind=wp), public :: snow_liquid_equiv_precip real(kind=wp), public :: graupel_liquid_equiv_precip real(kind=wp), public :: frozen_fraction real(kind=wp), public :: frz_rain_precip real(kind=wp), public, dimension(:), allocatable :: rain_med_vol_diam real(kind=wp), public, dimension(:), allocatable :: graupel_med_vol_diam real(kind=wp), public, dimension(:), allocatable :: refl10cm real(kind=wp), public, dimension(:), allocatable :: re_cloud real(kind=wp), public, dimension(:), allocatable :: re_ice real(kind=wp), public, dimension(:), allocatable :: re_snow real(kind=wp), public, dimension(:), allocatable :: max_hail_diameter real(kind=wp), public, dimension(:), allocatable :: cloud_number_mixing_ratio type, private :: ty_tend Components Type Visibility Attributes Name Initial real(kind=dp), public, allocatable, dimension(:) :: prr_wau real(kind=dp), public, allocatable, dimension(:) :: pnr_wau real(kind=dp), public, allocatable, dimension(:) :: pnc_wau real(kind=dp), public, allocatable, dimension(:) :: prr_rcw real(kind=dp), public, allocatable, dimension(:) :: pnc_rcw real(kind=dp), public, allocatable, dimension(:) :: pnr_rcr real(kind=dp), public, allocatable, dimension(:) :: prs_scw real(kind=dp), public, allocatable, dimension(:) :: pnc_scw real(kind=dp), public, allocatable, dimension(:) :: png_scw real(kind=dp), public, allocatable, dimension(:) :: pbg_scw real(kind=dp), public, allocatable, dimension(:) :: prg_gcw real(kind=dp), public, allocatable, dimension(:) :: pnc_gcw real(kind=dp), public, allocatable, dimension(:) :: pbg_gcw real(kind=dp), public, allocatable, dimension(:) :: pri_ihm real(kind=dp), public, allocatable, dimension(:) :: pni_ihm real(kind=dp), public, allocatable, dimension(:) :: prs_ihm real(kind=dp), public, allocatable, dimension(:) :: prg_ihm real(kind=dp), public, allocatable, dimension(:) :: prg_scw real(kind=dp), public, allocatable, dimension(:) :: prr_rcs real(kind=dp), public, allocatable, dimension(:) :: pnr_rcs real(kind=dp), public, allocatable, dimension(:) :: prg_rcs real(kind=dp), public, allocatable, dimension(:) :: png_rcs real(kind=dp), public, allocatable, dimension(:) :: prs_rcs real(kind=dp), public, allocatable, dimension(:) :: pbg_rcs real(kind=dp), public, allocatable, dimension(:) :: prr_rcg real(kind=dp), public, allocatable, dimension(:) :: pnr_rcg real(kind=dp), public, allocatable, dimension(:) :: prg_rcg real(kind=dp), public, allocatable, dimension(:) :: png_rcg real(kind=dp), public, allocatable, dimension(:) :: pbg_rcg real(kind=dp), public, allocatable, dimension(:) :: pri_inu real(kind=dp), public, allocatable, dimension(:) :: pni_inu real(kind=dp), public, allocatable, dimension(:) :: pri_iha real(kind=dp), public, allocatable, dimension(:) :: pni_iha real(kind=dp), public, allocatable, dimension(:) :: pri_wfz real(kind=dp), public, allocatable, dimension(:) :: pni_wfz real(kind=dp), public, allocatable, dimension(:) :: prg_rfz real(kind=dp), public, allocatable, dimension(:) :: png_rfz real(kind=dp), public, allocatable, dimension(:) :: pnr_rfz real(kind=dp), public, allocatable, dimension(:) :: pri_rfz real(kind=dp), public, allocatable, dimension(:) :: pni_rfz real(kind=dp), public, allocatable, dimension(:) :: pbg_rfz real(kind=dp), public, allocatable, dimension(:) :: prs_sde real(kind=dp), public, allocatable, dimension(:) :: pri_ide real(kind=dp), public, allocatable, dimension(:) :: pni_ide real(kind=dp), public, allocatable, dimension(:) :: prs_ide real(kind=dp), public, allocatable, dimension(:) :: prg_gde real(kind=dp), public, allocatable, dimension(:) :: png_gde real(kind=dp), public, allocatable, dimension(:) :: pni_iau real(kind=dp), public, allocatable, dimension(:) :: prs_iau real(kind=dp), public, allocatable, dimension(:) :: prr_sml real(kind=dp), public, allocatable, dimension(:) :: prr_gml real(kind=dp), public, allocatable, dimension(:) :: pbg_sml real(kind=dp), public, allocatable, dimension(:) :: pbg_gml real(kind=dp), public, allocatable, dimension(:) :: pnr_sml real(kind=dp), public, allocatable, dimension(:) :: pnr_gml real(kind=dp), public, allocatable, dimension(:) :: prr_rci real(kind=dp), public, allocatable, dimension(:) :: pnr_rci real(kind=dp), public, allocatable, dimension(:) :: pri_rci real(kind=dp), public, allocatable, dimension(:) :: pni_rci real(kind=dp), public, allocatable, dimension(:) :: prg_rci real(kind=dp), public, allocatable, dimension(:) :: png_rci real(kind=dp), public, allocatable, dimension(:) :: pbg_rci real(kind=dp), public, allocatable, dimension(:) :: pni_sci real(kind=dp), public, allocatable, dimension(:) :: prs_sci real(kind=dp), public, allocatable, dimension(:) :: prw_vcd real(kind=dp), public, allocatable, dimension(:) :: pnc_wcd real(kind=dp), public, allocatable, dimension(:) :: prv_rev real(kind=dp), public, allocatable, dimension(:) :: pnr_rev real(kind=dp), public, allocatable, dimension(:) :: pna_rca real(kind=dp), public, allocatable, dimension(:) :: pna_sca real(kind=dp), public, allocatable, dimension(:) :: pna_gca real(kind=dp), public, allocatable, dimension(:) :: pnd_rcd real(kind=dp), public, allocatable, dimension(:) :: pnd_scd real(kind=dp), public, allocatable, dimension(:) :: pnd_gcd Functions private  function koop_nucleation (temp, satw, naero) result(nuc) aqueous solution freezing of water from Koop et al. (2000) newer research suggests that the freezing rate should be lower \nthan original paper, so J_rate is reduced by two orders of magnitude Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: temp real(kind=wp), intent(in) :: satw real(kind=wp), intent(in) :: naero Return Value real(kind=wp) private  function activate_cloud_number (temp, w1d, nwfa, land) result(activ) calculations numer of cloud droplets activated Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: temp real(kind=wp), intent(in) :: w1d real(kind=wp), intent(in) :: nwfa integer, intent(in), optional :: land Return Value real(kind=wp) private  function demott_nucleation (tempc, rho, nifa) result(nuc) DeMott nucleation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: tempc real(kind=wp), intent(in) :: rho real(kind=wp), intent(in) :: nifa Return Value real(kind=wp) Subroutines public  subroutine tempo_main (tempo_cfgs, qv1d, qc1d, qi1d, qr1d, qs1d, qg1d, qb1d, ni1d, nr1d, nc1d, ng1d, nwfa1d, nifa1d, t1d, p1d, w1d, dz1d, qcfrac1d, qifrac1d, qc_bl1d, qcfrac_bl1d, thten_bl1d, qvten_bl1d, qcten_bl1d, qiten_bl1d, thten_lwrad1d, thten_swrad1d, kts, kte, dt, ii, jj, tempo_main_diags) tempo main Arguments Type Intent Optional Attributes Name type( ty_tempo_cfgs ), intent(in) :: tempo_cfgs real(kind=wp), intent(inout), dimension(kts:kte) :: qv1d 1D water vapor mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qc1d 1D cloud water mass mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qi1d 1D cloud ice mass mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qr1d 1D rain water mass mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qs1d 1D snow mass mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: qg1d 1D graupel mass mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: qb1d 1D graupel volume mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: ni1d 1D cloud ice number mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: nr1d 1D rain water number mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: nc1d 1D cloud water number mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: ng1d 1D graupel number mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: nwfa1d 1D water-friendly aerosol number mixing ratio real(kind=wp), intent(inout), optional, dimension(:) :: nifa1d 1D ice-friendly aerosol number mixing ratio real(kind=wp), intent(inout), dimension(kts:kte) :: t1d 1D temperature real(kind=wp), intent(in), dimension(kts:kte) :: p1d 1D pressure real(kind=wp), intent(in), dimension(kts:kte) :: w1d 1D vertical velocity real(kind=wp), intent(in), dimension(kts:kte) :: dz1d 1D vertical grid spacing real(kind=wp), intent(inout), optional, dimension(:) :: qcfrac1d cloud fraction real(kind=wp), intent(inout), optional, dimension(:) :: qifrac1d cloud ice fraction real(kind=wp), intent(in), optional, dimension(:) :: qc_bl1d cloud water mixing ratio from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: qcfrac_bl1d cloud fraction from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: thten_bl1d potential temperature tendency from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: qvten_bl1d water vapor mixing ratio tendency from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: qcten_bl1d cloud water mixing ratio tendency from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: qiten_bl1d cloud ice mixing ratio from boundary layer scheme real(kind=wp), intent(in), optional, dimension(:) :: thten_lwrad1d potential temperature tendency from longwave radiation scheme real(kind=wp), intent(in), optional, dimension(:) :: thten_swrad1d potential temperature tendency from shortwave radiation scheme integer, intent(in) :: kts integer, intent(in) :: kte real(kind=wp), intent(in) :: dt integer, intent(in) :: ii integer, intent(in) :: jj type( ty_tempo_main_diags ), intent(out) :: tempo_main_diags private  subroutine aerosol_check_and_update (rho, nwfa1d, nifa1d, nwfa, nifa, nwfaten, nifaten) sets aerosol number concentrations and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(inout), optional, dimension(:) :: nwfa1d real(kind=wp), intent(inout), optional, dimension(:) :: nifa1d real(kind=wp), intent(inout), dimension(:) :: nwfa real(kind=wp), intent(inout), dimension(:) :: nifa real(kind=wp), intent(inout), dimension(:) :: nwfaten real(kind=wp), intent(inout), dimension(:) :: nifaten public  subroutine cloud_check_and_update (rho, l_qc, qc1d, nc1d, rc, nc, qcten, ncten, ilamc, mvd_c) computes cloud water contents, ilamc, and mvd_c and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qc real(kind=wp), intent(inout), dimension(:) :: qc1d real(kind=wp), intent(inout), optional, dimension(:) :: nc1d real(kind=wp), intent(inout), dimension(:) :: rc real(kind=wp), intent(inout), dimension(:) :: nc real(kind=wp), intent(inout), dimension(:) :: qcten real(kind=wp), intent(inout), dimension(:) :: ncten real(kind=dp), intent(out), dimension(:) :: ilamc real(kind=wp), intent(out), dimension(:) :: mvd_c private  subroutine rain_check_and_update (rho, l_qr, qr1d, nr1d, rr, nr, qrten, nrten, ilamr, mvd_r) computes rain water contents, ilamr, and mvd_r and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qr real(kind=wp), intent(inout), dimension(:) :: qr1d real(kind=wp), intent(inout), dimension(:) :: nr1d real(kind=wp), intent(inout), dimension(:) :: rr real(kind=wp), intent(inout), dimension(:) :: nr real(kind=wp), intent(inout), dimension(:) :: qrten real(kind=wp), intent(inout), dimension(:) :: nrten real(kind=dp), intent(out), dimension(:) :: ilamr real(kind=wp), intent(out), dimension(:) :: mvd_r public  subroutine ice_check_and_update (rho, l_qi, qi1d, ni1d, ri, ni, qiten, niten, ilami) computes ice contents, ilami and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qi real(kind=wp), intent(inout), dimension(:) :: qi1d real(kind=wp), intent(inout), dimension(:) :: ni1d real(kind=wp), intent(inout), dimension(:) :: ri real(kind=wp), intent(inout), dimension(:) :: ni real(kind=wp), intent(inout), dimension(:) :: qiten real(kind=wp), intent(inout), dimension(:) :: niten real(kind=dp), intent(out), dimension(:) :: ilami public  subroutine snow_check_and_update (rho, l_qs, qs1d, rs, qsten) computes snow mass Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qs real(kind=wp), intent(inout), dimension(:) :: qs1d real(kind=wp), intent(inout), dimension(:) :: rs real(kind=wp), intent(inout), dimension(:) :: qsten private  subroutine graupel_check_and_update (rho, l_qg, qg1d, ng1d, qb1d, rg, ng, rb, idx, qgten, ngten, qbten, ilamg, mvd_g) computes graupel contents, ilamg, and mvd_g and checks bounds Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho logical, intent(inout), dimension(:) :: l_qg real(kind=wp), intent(inout), dimension(:) :: qg1d real(kind=wp), intent(inout), optional, dimension(:) :: ng1d real(kind=wp), intent(inout), optional, dimension(:) :: qb1d real(kind=wp), intent(inout), dimension(:) :: rg real(kind=wp), intent(inout), dimension(:) :: ng real(kind=wp), intent(inout), dimension(:) :: rb integer, intent(inout), dimension(:) :: idx real(kind=wp), intent(inout), dimension(:) :: qgten real(kind=wp), intent(inout), dimension(:) :: ngten real(kind=wp), intent(inout), dimension(:) :: qbten real(kind=dp), intent(out), dimension(:) :: ilamg real(kind=wp), intent(out), dimension(:) :: mvd_g private  subroutine graupel_init (rho, qg1d, ng1d, qb1d) initializes graupel number and volume if both are zero\nand hail-aware = true Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: qg1d real(kind=wp), intent(inout), dimension(:) :: ng1d real(kind=wp), intent(inout), dimension(:) :: qb1d private  subroutine thermo_vars (qv, temp, pres, rho, rhof, rhof2, qvs, delqvs, qvsi, satw, sati, ssatw, ssati, diffu, visco, vsc2, ocp, lvap, tcond, lvt2, supersaturated) computes thermodynamic variables Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: pres real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(out), dimension(:) :: rhof real(kind=wp), intent(out), dimension(:) :: rhof2 real(kind=wp), intent(out), dimension(:) :: qvs real(kind=wp), intent(out), dimension(:) :: delqvs real(kind=wp), intent(out), dimension(:) :: qvsi real(kind=wp), intent(out), dimension(:) :: satw real(kind=wp), intent(out), dimension(:) :: sati real(kind=wp), intent(out), dimension(:) :: ssatw real(kind=wp), intent(out), dimension(:) :: ssati real(kind=wp), intent(out), dimension(:) :: diffu real(kind=wp), intent(out), dimension(:) :: visco real(kind=wp), intent(out), dimension(:) :: vsc2 real(kind=wp), intent(out), dimension(:) :: ocp real(kind=wp), intent(out), dimension(:) :: lvap real(kind=wp), intent(out), dimension(:) :: tcond real(kind=wp), intent(out), dimension(:) :: lvt2 logical, intent(inout) :: supersaturated private  subroutine check_over_depletion (rho, temp, qvsi, qv, l_qc, rc, l_qi, ri, l_qr, rr, l_qs, rs, l_qg, rg, tend) check to ensure that loss terms don't over-deplete a category and\nadjusts tendencies if needed Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: qv logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc logical, intent(in), dimension(:) :: l_qi real(kind=wp), intent(in), dimension(:) :: ri logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg type( ty_tend ), intent(inout) :: tend private  subroutine sum_tendencies (rho, temp, idx, lvap, ocp, tend, tten, qvten, qcten, ncten, qiten, niten, qsten, qrten, nrten, qgten, ngten, qbten) sums tendencies for each hydrometeor category and temperature and moisture Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp integer, intent(in), dimension(:) :: idx real(kind=wp), intent(in), dimension(:) :: lvap real(kind=wp), intent(in), dimension(:) :: ocp type( ty_tend ), intent(in) :: tend real(kind=wp), intent(inout), dimension(:) :: tten real(kind=wp), intent(inout), dimension(:) :: qvten real(kind=wp), intent(inout), dimension(:) :: qcten real(kind=wp), intent(inout), dimension(:) :: ncten real(kind=wp), intent(inout), dimension(:) :: qiten real(kind=wp), intent(inout), dimension(:) :: niten real(kind=wp), intent(inout), dimension(:) :: qsten real(kind=wp), intent(inout), dimension(:) :: qrten real(kind=wp), intent(inout), dimension(:) :: nrten real(kind=wp), intent(inout), dimension(:) :: qgten real(kind=wp), intent(inout), dimension(:) :: ngten real(kind=wp), intent(inout), dimension(:) :: qbten private  subroutine sedimentation (xr, vt, dz1d, rho, xten, limit, steps, ktop_sedi, precip) computes sedimentation fluxes, adds fluxes to tendencies, and updates hydrometeor\nmass (and number and volume) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(inout), dimension(:) :: xr real(kind=wp), intent(in), dimension(:) :: vt real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(inout), dimension(:) :: xten real(kind=wp), intent(in) :: limit integer, intent(in) :: steps integer, intent(in), optional :: ktop_sedi real(kind=wp), intent(inout), optional :: precip private  subroutine semilagrangian_sedimentation (dz1d, rho, xr, xten, vt, steps, limit, precip) semi-lagrangian sedimentation scheme from Juang and Hong (2010) Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(inout), dimension(:) :: xr real(kind=wp), intent(inout), dimension(:) :: xten real(kind=wp), intent(in), dimension(:) :: vt integer, intent(in) :: steps real(kind=wp), intent(in) :: limit real(kind=wp), intent(out), optional :: precip private  subroutine rain_fallspeed (rhof, l_qr, rr, ilamr, dz1d, vt, vtn, substeps_sedi, ktop_sedi) calculates mass and number weighted fall speeds for rain\nand optionally the substepping required and the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=dp), intent(in), dimension(:) :: ilamr real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(inout), dimension(:) :: vtn integer, intent(out), optional :: substeps_sedi integer, intent(out), optional :: ktop_sedi private  subroutine graupel_fallspeed (rhof, rho, visco, l_qg, rg, rb, qb1d, idx, ilamg, dz1d, vt, vtn, substeps_sedi, ktop_sedi) calculates mass and number weighted fall speeds for graupel\nand optionally the substepping required and the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: visco logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: rb real(kind=wp), intent(in), optional, dimension(:) :: qb1d integer, intent(in), dimension(:) :: idx real(kind=dp), intent(in), dimension(:) :: ilamg real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(inout), dimension(:) :: vtn integer, intent(out), optional :: substeps_sedi integer, intent(out), optional :: ktop_sedi private  subroutine snow_fallspeed (rhof, l_qs, rs, prr_sml, smob, smoc, rr, vtrr, dz1d, vt, vtboost, substeps_sedi, ktop_sedi) calcules mass weighted fall speeds for snow\nand optionally the substepping required and the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: prr_sml real(kind=dp), intent(in), dimension(:) :: smob real(kind=dp), intent(in), dimension(:) :: smoc real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: vtrr real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(in), dimension(:) :: vtboost integer, intent(out), optional :: substeps_sedi integer, intent(out), optional :: ktop_sedi private  subroutine ice_fallspeed (rhof, l_qi, ri, ilami, dz1d, vt, vtn, substeps_sedi, ktop_sedi) calculates mass and number weighted fall speeds for ice\nand the substepping required and the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof logical, intent(in), dimension(:) :: l_qi real(kind=wp), intent(in), dimension(:) :: ri real(kind=dp), intent(in), dimension(:) :: ilami real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(inout), dimension(:) :: vtn integer, intent(out) :: substeps_sedi integer, intent(out) :: ktop_sedi private  subroutine cloud_fallspeed (rhof, w1d, l_qc, rc, nc, ilamc, dz1d, vt, vtn, ktop_sedi) calculates mass and number weighted fall speeds for cloud\nand the top k-level of sedimentation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: w1d logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc real(kind=dp), intent(in), dimension(:) :: ilamc real(kind=wp), intent(in), dimension(:) :: dz1d real(kind=wp), intent(inout), dimension(:) :: vt real(kind=wp), intent(inout), dimension(:) :: vtn integer, intent(out) :: ktop_sedi private  subroutine cloud_condensation (rho, temp, w1d, ssatw, lvap, tcond, diffu, lvt2, nwfa, qv, qvs, l_qc, rc, nc, tend) cloud condensation and evaporation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: w1d real(kind=wp), intent(in), dimension(:) :: ssatw real(kind=wp), intent(in), dimension(:) :: lvap real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: lvt2 real(kind=wp), intent(in), dimension(:) :: nwfa real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: qvs logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc type( ty_tend ), intent(inout) :: tend private  subroutine rain_evaporation (rho, temp, ssatw, lvap, tcond, diffu, vsc2, rhof2, qv, qvs, l_qr, rr, nr, ilamr, tend) rain evaporation that includes reduction in the evaporation rate\nin the presence of melting graupel Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: ssatw real(kind=wp), intent(in), dimension(:) :: lvap real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: vsc2 real(kind=wp), intent(in), dimension(:) :: rhof2 real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: qvs logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr type( ty_tend ), intent(inout) :: tend private  subroutine freeze_cloud_melt_ice (temp, rho, ocp, lvap, qi1d, ni1d, qiten, niten, qc1d, nc1d, ncsave, qcten, ncten, tten) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: ocp real(kind=wp), intent(in), dimension(:) :: lvap real(kind=wp), intent(in), dimension(:) :: qi1d real(kind=wp), intent(in), dimension(:) :: ni1d real(kind=wp), intent(inout), dimension(:) :: qiten real(kind=wp), intent(inout), dimension(:) :: niten real(kind=wp), intent(in), dimension(:) :: qc1d real(kind=wp), intent(in), optional, dimension(:) :: nc1d real(kind=wp), intent(in), optional, dimension(:) :: ncsave real(kind=wp), intent(inout), dimension(:) :: qcten real(kind=wp), intent(inout), dimension(:) :: ncten real(kind=wp), intent(inout), dimension(:) :: tten private  subroutine warm_rain (rhof, l_qc, rc, nc, ilamc, mvd_c, l_qr, rr, nr, mvd_r, tend) computes warm-rain process rates -- condensation/evaporation happen later Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc real(kind=dp), intent(in), dimension(:) :: ilamc real(kind=wp), intent(in), dimension(:) :: mvd_c logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=wp), intent(in), dimension(:) :: mvd_r type( ty_tend ), intent(inout) :: tend private  subroutine riming (temp, rhof, visco, l_qc, rc, nc, ilamc, mvd_c, l_qs, rs, smo0, smob, smoc, smoe, vtboost, l_qg, rg, ng, ilamg, idx, tend) snow and graupel riming Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: visco logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc real(kind=dp), intent(in), dimension(:) :: ilamc real(kind=wp), intent(in), dimension(:) :: mvd_c logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smo0 real(kind=dp), intent(in), dimension(:) :: smob real(kind=dp), intent(in), dimension(:) :: smoc real(kind=dp), intent(in), dimension(:) :: smoe real(kind=wp), intent(out), dimension(:) :: vtboost logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend public  subroutine get_snow_table_index (rs, idx_s) get snow table index from snow mass Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rs integer, intent(out) :: idx_s public  subroutine get_temperature_table_index (tempk, idx_t) get temperature table index Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: tempk integer, intent(out) :: idx_t public  subroutine get_rain_table_index (rr, ilamr, idx_r, idx_r1) get rain table indices from rain mass and lambda Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rr real(kind=dp), intent(in) :: ilamr integer, intent(out) :: idx_r integer, intent(out) :: idx_r1 public  subroutine get_graupel_table_index (rg, ilamg, idx, idx_g, idx_g1) get graupel table indices from graupel mass, lambda, and density index Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rg real(kind=dp), intent(in) :: ilamg integer, intent(in) :: idx integer, intent(out) :: idx_g integer, intent(out) :: idx_g1 public  subroutine get_cloud_table_index (rc, nc, idx_c, idx_n) get cloud table index from mass and number Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rc real(kind=wp), intent(in) :: nc integer, intent(out) :: idx_c integer, intent(out) :: idx_n public  subroutine get_ice_table_index (ri, ni, idx_i, idx_i1) get ice table index from mass and number Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: ri real(kind=wp), intent(in) :: ni integer, intent(out) :: idx_i integer, intent(out) :: idx_i1 private  subroutine rain_snow_rain_graupel (temp, l_qr, rr, nr, ilamr, l_qs, rs, l_qg, rg, ng, ilamg, idx, tend) calculates rain-snow and rain-graupel collection Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend private  subroutine ice_nucleation (temp, rho, w1d, qv, qvsi, ssati, ssatw, nifa, nwfa, ni, smo0, rc, nc, rr, nr, ilamr, tend) ice nulceation Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: w1d real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: ssati real(kind=wp), intent(in), dimension(:) :: ssatw real(kind=wp), intent(in), optional, dimension(:) :: nifa real(kind=wp), intent(in), optional, dimension(:) :: nwfa real(kind=wp), intent(in), dimension(:) :: ni real(kind=dp), intent(in), dimension(:) :: smo0 real(kind=wp), intent(in), dimension(:) :: rc real(kind=wp), intent(in), dimension(:) :: nc real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr type( ty_tend ), intent(inout) :: tend private  subroutine get_in_table_index (xni, idx_in) get ice nuclei table index Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: xni integer, intent(out) :: idx_in private  subroutine get_t1_subl (rho, temp, qvsi, tcond, diffu, ssati, t1_subl) calculations thermodynamic term used in depositional growth and melting Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: ssati real(kind=wp), intent(out), dimension(:) :: t1_subl private  subroutine ice_processes (rhof, rhof2, rho, w1d, temp, qv, qvsi, tcond, diffu, vsc2, ssati, l_qi, ri, ni, ilami, l_qs, rs, smoe, smof, smo1, rr, nr, ilamr, mvd_r, l_qg, rg, ng, ilamg, idx, tend) ice processes including cloud ice depositional growth, conversion of cloud ice\nto snow, snow collecting cloud ice, rain collecting cloud ice, snow depositional growth, \nand graupel sublimation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: rhof2 real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: w1d real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: qv real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: vsc2 real(kind=wp), intent(in), dimension(:) :: ssati logical, intent(in), dimension(:) :: l_qi real(kind=wp), intent(in), dimension(:) :: ri real(kind=wp), intent(in), dimension(:) :: ni real(kind=dp), intent(in), dimension(:) :: ilami logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smoe real(kind=dp), intent(in), dimension(:) :: smof real(kind=dp), intent(in), dimension(:) :: smo1 real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr real(kind=wp), intent(in), dimension(:) :: mvd_r logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend private  subroutine melting (rhof2, rho, temp, qvsi, tcond, diffu, vsc2, ssati, delqvs, l_qs, rs, smof, smo0, smo1, l_qg, rg, ng, ilamg, idx, tend) melting of snow and graupel Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rhof2 real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: qvsi real(kind=wp), intent(in), dimension(:) :: tcond real(kind=wp), intent(in), dimension(:) :: diffu real(kind=wp), intent(in), dimension(:) :: vsc2 real(kind=wp), intent(in), dimension(:) :: ssati real(kind=wp), intent(in), dimension(:) :: delqvs logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smof real(kind=dp), intent(in), dimension(:) :: smo0 real(kind=dp), intent(in), dimension(:) :: smo1 logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend private  subroutine aerosol_scavenging (temp, rho, rhof, visco, nwfa, nifa, l_qr, nr, ilamr, mvd_r, l_qs, rs, smob, smoc, smoe, l_qg, rg, ng, ilamg, idx, tend) scavenging of aerosols by rain, snow, and graupel Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: rhof real(kind=wp), intent(in), dimension(:) :: visco real(kind=wp), intent(in), dimension(:) :: nwfa real(kind=wp), intent(in), dimension(:) :: nifa logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr real(kind=wp), intent(in), dimension(:) :: mvd_r logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smob real(kind=dp), intent(in), dimension(:) :: smoc real(kind=dp), intent(in), dimension(:) :: smoe logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx type( ty_tend ), intent(inout) :: tend","tags":"","url":"module/module_mp_tempo_main.html"},{"title":"module_mp_tempo_diags – TEMPO Microphysics","text":"diagnostic output Uses module_mp_tempo_params module_mp_tempo_utils module~~module_mp_tempo_diags~~UsesGraph module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_params module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_diags->module~module_mp_tempo_utils ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types module~module_mp_tempo_utils->module~module_mp_tempo_params Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~module_mp_tempo_diags~~UsedByGraph module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_main->module~module_mp_tempo_diags module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_main module~tests tests module~tests->module~module_mp_tempo_driver program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Functions private  function find_melting_level (temp, l_qr, l_qs, l_qg) result(k_melt) finds the melting level Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp logical, intent(in), dimension(:) :: l_qr logical, intent(in), dimension(:) :: l_qs logical, intent(in), dimension(:) :: l_qg Return Value integer private  function complex_water_ray (lambda, t) result(refractive_index) complex refractive index of water\nfrom Ray (1972) calculated as function of temperature t [Celsius] (valid from -10 to 30)\nand radar wavelength lambda [m] (valid from 0.001 to 1) Read more… Arguments Type Intent Optional Attributes Name real(kind=dp), intent(in) :: lambda real(kind=dp), intent(in) :: t Return Value complex(kind=dp) private  function complex_ice_maetzler (lambda, t) result(refractive_index) complex refractive index of ice from Maetzler (1998) calculated as function of temperature t [Celsius] (valid from -250 to 0)\nand radar wavelength lambda [m] (valid from 0.0001 to 30) Read more… Arguments Type Intent Optional Attributes Name real(kind=dp), intent(in) :: lambda real(kind=dp), intent(in) :: t Return Value complex(kind=dp) private  function reflectivity_from_melting_graupel (rg, ng, ilamg, idx, rr) result(ze_graupel) calculates radar reflectivity from melting graupel using binned approach Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rg real(kind=wp), intent(in) :: ng real(kind=dp), intent(in) :: ilamg integer, intent(in) :: idx real(kind=wp), intent(in) :: rr Return Value real(kind=wp) private  function reflectivity_from_melting_snow (rs, smob, smoc, rr) result(ze_snow) calculates radar reflectivity from melting snow using binned approach Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rs real(kind=dp), intent(in) :: smob real(kind=dp), intent(in) :: smoc real(kind=wp), intent(in) :: rr Return Value real(kind=wp) Subroutines public  subroutine effective_radius (temp, l_qc, nc, ilamc, l_qi, ilami, l_qs, rs, re_qc, re_qi, re_qs) effective radius values for cloud water, cloud ice and snow Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: temp logical, intent(in), dimension(:) :: l_qc real(kind=wp), intent(in), dimension(:) :: nc real(kind=dp), intent(in), dimension(:) :: ilamc logical, intent(in), dimension(:) :: l_qi real(kind=dp), intent(in), dimension(:) :: ilami logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=wp), intent(out), dimension(:) :: re_qc real(kind=wp), intent(out), dimension(:) :: re_qi real(kind=wp), intent(out), dimension(:) :: re_qs public  subroutine reflectivity_10cm (refl10cm_from_melting_flag, temp, l_qr, rr, nr, ilamr, l_qs, rs, smoc, smob, smoz, l_qg, rg, ng, idx, ilamg, dbz) 10-cm radar reflectivity Read more… Arguments Type Intent Optional Attributes Name logical, intent(in) :: refl10cm_from_melting_flag real(kind=wp), intent(in), dimension(:) :: temp logical, intent(in), dimension(:) :: l_qr real(kind=wp), intent(in), dimension(:) :: rr real(kind=wp), intent(in), dimension(:) :: nr real(kind=dp), intent(in), dimension(:) :: ilamr logical, intent(in), dimension(:) :: l_qs real(kind=wp), intent(in), dimension(:) :: rs real(kind=dp), intent(in), dimension(:) :: smoc real(kind=dp), intent(in), dimension(:) :: smob real(kind=dp), intent(in), dimension(:) :: smoz logical, intent(in), dimension(:) :: l_qg real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng integer, intent(in), dimension(:) :: idx real(kind=dp), intent(in), dimension(:) :: ilamg real(kind=wp), intent(out), dimension(:) :: dbz private  subroutine rayleigh_soak_wetgraupel (x_g, a_geo, b_geo, fmelt, lambda_radar, meltratio_outside, m_w, m_i, backscatter) calculates backscatter cross section of wet snow or graupel\nusing Maxwell-Garnett mixing formula and Rayleigh approximation Read more… Arguments Type Intent Optional Attributes Name real(kind=dp), intent(in) :: x_g real(kind=dp), intent(in) :: a_geo real(kind=dp), intent(in) :: b_geo real(kind=dp), intent(in) :: fmelt real(kind=dp), intent(in) :: lambda_radar real(kind=dp), intent(in) :: meltratio_outside complex(kind=dp), intent(in) :: m_w complex(kind=dp), intent(in) :: m_i real(kind=dp), intent(out) :: backscatter public  subroutine max_hail_diam (rho, rg, ng, ilamg, idx, max_hail_diameter) estimates maximmum hail diameter [mm] using a binned approach Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in), dimension(:) :: rho real(kind=wp), intent(in), dimension(:) :: rg real(kind=wp), intent(in), dimension(:) :: ng real(kind=dp), intent(in), dimension(:) :: ilamg integer, intent(in), dimension(:) :: idx real(kind=wp), intent(out), dimension(:) :: max_hail_diameter public  subroutine freezing_rain (temp, rain_precip, cloud_precip, frz_rain) estimates freezing rain/drizzle accumulation Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: temp real(kind=wp), intent(in) :: rain_precip real(kind=wp), intent(in), optional :: cloud_precip real(kind=wp), intent(out) :: frz_rain","tags":"","url":"module/module_mp_tempo_diags.html"},{"title":"module_mp_tempo_utils – TEMPO Microphysics","text":"utilities for tempo microphysics Uses module_mp_tempo_params module~~module_mp_tempo_utils~~UsesGraph module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_utils->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~module_mp_tempo_utils~~UsedByGraph module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_diags->module~module_mp_tempo_utils module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_utils module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver->module~module_mp_tempo_main module~module_mp_tempo_main->module~module_mp_tempo_utils module~module_mp_tempo_main->module~module_mp_tempo_diags module~module_mp_tempo_tables module_mp_tempo_tables module~module_mp_tempo_tables->module~module_mp_tempo_utils module~tests tests module~tests->module~module_mp_tempo_driver program~build_tables build_tables program~build_tables->module~module_mp_tempo_tables program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Functions public  function calc_gamma_p (a, x) result(gamma_p) normalized lower gamma function calculated either with a \nseries expansion or continued fraction method Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: a real(kind=wp), intent(in) :: x Return Value real(kind=wp) private  function calc_gamma_series (a, x) result(gamma_series) solves the normalized lower gamma function Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: a real(kind=wp), intent(in) :: x Return Value real(kind=wp) private  function calc_gamma_cf (a, x) result(gamma_cf) solves the normalized upper gamma function using a continued fractions method (modified Lentz Algorithm) Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: a real(kind=wp), intent(in) :: x Return Value real(kind=wp) public  function calc_rslf (p, t) result(rslf) calculates liquid saturation vapor mixing ratio Read more… Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: p real(kind=wp), intent(in) :: t Return Value real(kind=wp) public  function calc_rsif (p, t) result(rsif) calculates liquid saturation vapor mixing ratio Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: p real(kind=wp), intent(in) :: t Return Value real(kind=wp) public  function get_nuc (nc) result(nu_c) returns nu_c for cloud water (values from 2-15) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: nc Return Value integer Subroutines public  subroutine get_constant_cloud_number (land, nc) returns land-specific value of cloud droplet number concentration\nwhen aerosol-aware = false if land = 1, else returns ocean-specific value Arguments Type Intent Optional Attributes Name integer, intent(in), optional :: land real(kind=wp), intent(out), dimension(:) :: nc public  subroutine snow_moments (rs, tc, smob, smoc, ns, smo0, smo1, smo2, smoe, smof, smog, smoz) computes snow moments from Field et al. (2005) Arguments Type Intent Optional Attributes Name real(kind=wp), intent(in) :: rs real(kind=wp), intent(in) :: tc real(kind=dp), intent(out) :: smob real(kind=dp), intent(out) :: smoc real(kind=dp), intent(out), optional :: ns real(kind=dp), intent(out), optional :: smo0 real(kind=dp), intent(out), optional :: smo1 real(kind=dp), intent(out), optional :: smo2 real(kind=dp), intent(out), optional :: smoe real(kind=dp), intent(out), optional :: smof real(kind=dp), intent(out), optional :: smog real(kind=dp), intent(out), optional :: smoz public  subroutine compute_efrw () collision efficiency for rain collecting cloud water from Beard and Grover (1974)\nif a/A < 0.25\nhttps://doi.org/10.1175/1520-0469(1974)031<0543:NCEFSR>2.0.CO;2\notherwise uses polynomials to get close match of Pruppacher and Klett Fig. 14-9 Arguments None public  subroutine compute_efsw () collision efficiency for snow collecting cloud water from Wang and Ji (2000)\nhttps://doi.org/10.1175/1520-0469(2000)057<1001:CEOICA>2.0.CO;2\nequating melted snow diameter to effective collision cross-section Arguments None public  subroutine qi_aut_qs () calculates cloud ice conversion to snow\nand depositional growth by binning cloud ice distributions and \ndetermining both the size bins > d0s (that are converted to snow) and the \ndepositional growth up to d0s (for cloud ice) and > d0s for snow \nfollowing Harrington et al. (1995)\nhttps://doi.org/10.1175/1520-0469(1995)052<4344:POICCP>2.0.CO;2 Arguments None public  subroutine compute_drop_evap () calculates droplet evaporation data Arguments None","tags":"","url":"module/module_mp_tempo_utils.html"},{"title":"machine – TEMPO Microphysics","text":"sets the precision if not set by a host model Used by module~~machine~~UsedByGraph module~machine machine module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_params->module~machine module~module_mp_tempo_aerosols module_mp_tempo_aerosols module~module_mp_tempo_aerosols->module~module_mp_tempo_params module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_diags->module~module_mp_tempo_params module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_diags->module~module_mp_tempo_utils module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_params module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver->module~module_mp_tempo_main module~module_mp_tempo_ml module_mp_tempo_ml module~module_mp_tempo_driver->module~module_mp_tempo_ml module~module_mp_tempo_driver->module~module_mp_tempo_utils module~module_mp_tempo_main->module~module_mp_tempo_params module~module_mp_tempo_main->module~module_mp_tempo_aerosols module~module_mp_tempo_main->module~module_mp_tempo_diags module~module_mp_tempo_main->module~module_mp_tempo_ml module~module_mp_tempo_main->module~module_mp_tempo_utils module~module_mp_tempo_ml->module~module_mp_tempo_params module~module_mp_tempo_tables module_mp_tempo_tables module~module_mp_tempo_tables->module~module_mp_tempo_params module~module_mp_tempo_tables->module~module_mp_tempo_utils module~module_mp_tempo_utils->module~module_mp_tempo_params proc~activate_cloud_number activate_cloud_number proc~activate_cloud_number->module~module_mp_tempo_params proc~aerosol_check_and_update aerosol_check_and_update proc~aerosol_check_and_update->module~module_mp_tempo_params proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_collection_efficiency->module~module_mp_tempo_params proc~aerosol_scavenging aerosol_scavenging proc~aerosol_scavenging->module~module_mp_tempo_params proc~build_table_freezewater build_table_freezewater proc~build_table_freezewater->module~module_mp_tempo_params proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~build_table_qr_acr_qg->module~module_mp_tempo_params proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~build_table_qr_acr_qs->module~module_mp_tempo_params proc~check_over_depletion check_over_depletion proc~check_over_depletion->module~module_mp_tempo_params proc~cloud_check_and_update cloud_check_and_update proc~cloud_check_and_update->module~module_mp_tempo_params proc~cloud_condensation cloud_condensation proc~cloud_condensation->module~module_mp_tempo_params proc~cloud_fallspeed cloud_fallspeed proc~cloud_fallspeed->module~module_mp_tempo_params proc~complex_water_ray complex_water_ray proc~complex_water_ray->module~module_mp_tempo_params proc~compute_drop_evap compute_drop_evap proc~compute_drop_evap->module~module_mp_tempo_params proc~compute_efrw compute_efrw proc~compute_efrw->module~module_mp_tempo_params proc~compute_efsw compute_efsw proc~compute_efsw->module~module_mp_tempo_params proc~demott_nucleation demott_nucleation proc~demott_nucleation->module~module_mp_tempo_params proc~effective_radius effective_radius proc~effective_radius->module~module_mp_tempo_params proc~find_melting_level find_melting_level proc~find_melting_level->module~module_mp_tempo_params proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~freeze_cloud_melt_ice->module~module_mp_tempo_params proc~freezewater freezewater proc~freezewater->module~module_mp_tempo_params proc~freezing_rain freezing_rain proc~freezing_rain->module~module_mp_tempo_params proc~gather gather proc~gather->module~module_mp_tempo_params proc~get_cloud_table_index get_cloud_table_index proc~get_cloud_table_index->module~module_mp_tempo_params proc~get_constant_cloud_number get_constant_cloud_number proc~get_constant_cloud_number->module~module_mp_tempo_params proc~get_graupel_table_index get_graupel_table_index proc~get_graupel_table_index->module~module_mp_tempo_params proc~get_ice_table_index get_ice_table_index proc~get_ice_table_index->module~module_mp_tempo_params proc~get_in_table_index get_in_table_index proc~get_in_table_index->module~module_mp_tempo_params proc~get_nuc get_nuc proc~get_nuc->module~module_mp_tempo_params proc~get_rain_table_index get_rain_table_index proc~get_rain_table_index->module~module_mp_tempo_params proc~get_snow_table_index get_snow_table_index proc~get_snow_table_index->module~module_mp_tempo_params proc~get_t1_subl get_t1_subl proc~get_t1_subl->module~module_mp_tempo_params proc~get_temperature_table_index get_temperature_table_index proc~get_temperature_table_index->module~module_mp_tempo_params proc~graupel_check_and_update graupel_check_and_update proc~graupel_check_and_update->module~module_mp_tempo_params proc~graupel_fallspeed graupel_fallspeed proc~graupel_fallspeed->module~module_mp_tempo_params proc~graupel_init graupel_init proc~graupel_init->module~module_mp_tempo_params proc~ice_check_and_update ice_check_and_update proc~ice_check_and_update->module~module_mp_tempo_params proc~ice_fallspeed ice_fallspeed proc~ice_fallspeed->module~module_mp_tempo_params proc~ice_nucleation ice_nucleation proc~ice_nucleation->module~module_mp_tempo_params proc~ice_processes ice_processes proc~ice_processes->module~module_mp_tempo_params proc~koop_nucleation koop_nucleation proc~koop_nucleation->module~module_mp_tempo_params proc~max_hail_diam max_hail_diam proc~max_hail_diam->module~module_mp_tempo_params proc~melting melting proc~melting->module~module_mp_tempo_params proc~qi_aut_qs qi_aut_qs proc~qi_aut_qs->module~module_mp_tempo_params proc~qr_acr_qg qr_acr_qg proc~qr_acr_qg->module~module_mp_tempo_params proc~qr_acr_qs qr_acr_qs proc~qr_acr_qs->module~module_mp_tempo_params proc~rain_check_and_update rain_check_and_update proc~rain_check_and_update->module~module_mp_tempo_params proc~rain_evaporation rain_evaporation proc~rain_evaporation->module~module_mp_tempo_params proc~rain_fallspeed rain_fallspeed proc~rain_fallspeed->module~module_mp_tempo_params proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~rain_snow_rain_graupel->module~module_mp_tempo_params proc~read_table_ccn read_table_ccn proc~read_table_ccn->module~module_mp_tempo_params proc~read_table_freezewater read_table_freezewater proc~read_table_freezewater->module~module_mp_tempo_params proc~read_table_qr_acr_qg read_table_qr_acr_qg proc~read_table_qr_acr_qg->module~module_mp_tempo_params proc~read_table_qr_acr_qs read_table_qr_acr_qs proc~read_table_qr_acr_qs->module~module_mp_tempo_params proc~reflectivity_10cm reflectivity_10cm proc~reflectivity_10cm->module~module_mp_tempo_params proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_from_melting_graupel->module~module_mp_tempo_params proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_from_melting_snow->module~module_mp_tempo_params proc~riming riming proc~riming->module~module_mp_tempo_params proc~sedimentation sedimentation proc~sedimentation->module~module_mp_tempo_params proc~snow_check_and_update snow_check_and_update proc~snow_check_and_update->module~module_mp_tempo_params proc~snow_fallspeed snow_fallspeed proc~snow_fallspeed->module~module_mp_tempo_params proc~snow_moments snow_moments proc~snow_moments->module~module_mp_tempo_params proc~sum_tendencies sum_tendencies proc~sum_tendencies->module~module_mp_tempo_params proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->module~module_mp_tempo_params proc~tempo_init tempo_init proc~tempo_init->module~module_mp_tempo_params proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->module~module_mp_tempo_params proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->module~module_mp_tempo_params proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->module~module_mp_tempo_params proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->module~module_mp_tempo_params proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->module~module_mp_tempo_params proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->module~module_mp_tempo_params proc~thermo_vars thermo_vars proc~thermo_vars->module~module_mp_tempo_params proc~warm_rain warm_rain proc~warm_rain->module~module_mp_tempo_params proc~write_table_freezewater write_table_freezewater proc~write_table_freezewater->module~module_mp_tempo_params proc~write_table_qr_acr_qg write_table_qr_acr_qg proc~write_table_qr_acr_qg->module~module_mp_tempo_params proc~write_table_qr_acr_qs write_table_qr_acr_qs proc~write_table_qr_acr_qs->module~module_mp_tempo_params program~build_tables build_tables program~build_tables->module~module_mp_tempo_params program~build_tables->module~module_mp_tempo_tables module~tests tests module~tests->module~module_mp_tempo_driver program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Variables Type Visibility Attributes Name Initial integer, public, parameter :: kind_sngl_prec = 4 integer, public, parameter :: kind_dbl_prec = 8 integer, public, parameter :: kind_phys = kind_dbl_prec integer, private, parameter :: kind_phys = kind_sngl_prec integer, public, parameter :: kind_io8 = kind_phys","tags":"","url":"module/machine.html"},{"title":"module_mp_tempo_params – TEMPO Microphysics","text":"parameters and variables used in tempo microphysics Uses ccpp_kind_types iso_fortran_env machine mpas_kind_types module~~module_mp_tempo_params~~UsesGraph module~module_mp_tempo_params module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Used by module~~module_mp_tempo_params~~UsedByGraph module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_aerosols module_mp_tempo_aerosols module~module_mp_tempo_aerosols->module~module_mp_tempo_params module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_diags->module~module_mp_tempo_params module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_diags->module~module_mp_tempo_utils module~module_mp_tempo_driver module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_params module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver->module~module_mp_tempo_main module~module_mp_tempo_ml module_mp_tempo_ml module~module_mp_tempo_driver->module~module_mp_tempo_ml module~module_mp_tempo_driver->module~module_mp_tempo_utils module~module_mp_tempo_main->module~module_mp_tempo_params module~module_mp_tempo_main->module~module_mp_tempo_aerosols module~module_mp_tempo_main->module~module_mp_tempo_diags module~module_mp_tempo_main->module~module_mp_tempo_ml module~module_mp_tempo_main->module~module_mp_tempo_utils module~module_mp_tempo_ml->module~module_mp_tempo_params module~module_mp_tempo_tables module_mp_tempo_tables module~module_mp_tempo_tables->module~module_mp_tempo_params module~module_mp_tempo_tables->module~module_mp_tempo_utils module~module_mp_tempo_utils->module~module_mp_tempo_params proc~activate_cloud_number activate_cloud_number proc~activate_cloud_number->module~module_mp_tempo_params proc~aerosol_check_and_update aerosol_check_and_update proc~aerosol_check_and_update->module~module_mp_tempo_params proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_collection_efficiency->module~module_mp_tempo_params proc~aerosol_scavenging aerosol_scavenging proc~aerosol_scavenging->module~module_mp_tempo_params proc~build_table_freezewater build_table_freezewater proc~build_table_freezewater->module~module_mp_tempo_params proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~build_table_qr_acr_qg->module~module_mp_tempo_params proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~build_table_qr_acr_qs->module~module_mp_tempo_params proc~check_over_depletion check_over_depletion proc~check_over_depletion->module~module_mp_tempo_params proc~cloud_check_and_update cloud_check_and_update proc~cloud_check_and_update->module~module_mp_tempo_params proc~cloud_condensation cloud_condensation proc~cloud_condensation->module~module_mp_tempo_params proc~cloud_fallspeed cloud_fallspeed proc~cloud_fallspeed->module~module_mp_tempo_params proc~complex_water_ray complex_water_ray proc~complex_water_ray->module~module_mp_tempo_params proc~compute_drop_evap compute_drop_evap proc~compute_drop_evap->module~module_mp_tempo_params proc~compute_efrw compute_efrw proc~compute_efrw->module~module_mp_tempo_params proc~compute_efsw compute_efsw proc~compute_efsw->module~module_mp_tempo_params proc~demott_nucleation demott_nucleation proc~demott_nucleation->module~module_mp_tempo_params proc~effective_radius effective_radius proc~effective_radius->module~module_mp_tempo_params proc~find_melting_level find_melting_level proc~find_melting_level->module~module_mp_tempo_params proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~freeze_cloud_melt_ice->module~module_mp_tempo_params proc~freezewater freezewater proc~freezewater->module~module_mp_tempo_params proc~freezing_rain freezing_rain proc~freezing_rain->module~module_mp_tempo_params proc~gather gather proc~gather->module~module_mp_tempo_params proc~get_cloud_table_index get_cloud_table_index proc~get_cloud_table_index->module~module_mp_tempo_params proc~get_constant_cloud_number get_constant_cloud_number proc~get_constant_cloud_number->module~module_mp_tempo_params proc~get_graupel_table_index get_graupel_table_index proc~get_graupel_table_index->module~module_mp_tempo_params proc~get_ice_table_index get_ice_table_index proc~get_ice_table_index->module~module_mp_tempo_params proc~get_in_table_index get_in_table_index proc~get_in_table_index->module~module_mp_tempo_params proc~get_nuc get_nuc proc~get_nuc->module~module_mp_tempo_params proc~get_rain_table_index get_rain_table_index proc~get_rain_table_index->module~module_mp_tempo_params proc~get_snow_table_index get_snow_table_index proc~get_snow_table_index->module~module_mp_tempo_params proc~get_t1_subl get_t1_subl proc~get_t1_subl->module~module_mp_tempo_params proc~get_temperature_table_index get_temperature_table_index proc~get_temperature_table_index->module~module_mp_tempo_params proc~graupel_check_and_update graupel_check_and_update proc~graupel_check_and_update->module~module_mp_tempo_params proc~graupel_fallspeed graupel_fallspeed proc~graupel_fallspeed->module~module_mp_tempo_params proc~graupel_init graupel_init proc~graupel_init->module~module_mp_tempo_params proc~ice_check_and_update ice_check_and_update proc~ice_check_and_update->module~module_mp_tempo_params proc~ice_fallspeed ice_fallspeed proc~ice_fallspeed->module~module_mp_tempo_params proc~ice_nucleation ice_nucleation proc~ice_nucleation->module~module_mp_tempo_params proc~ice_processes ice_processes proc~ice_processes->module~module_mp_tempo_params proc~koop_nucleation koop_nucleation proc~koop_nucleation->module~module_mp_tempo_params proc~max_hail_diam max_hail_diam proc~max_hail_diam->module~module_mp_tempo_params proc~melting melting proc~melting->module~module_mp_tempo_params proc~qi_aut_qs qi_aut_qs proc~qi_aut_qs->module~module_mp_tempo_params proc~qr_acr_qg qr_acr_qg proc~qr_acr_qg->module~module_mp_tempo_params proc~qr_acr_qs qr_acr_qs proc~qr_acr_qs->module~module_mp_tempo_params proc~rain_check_and_update rain_check_and_update proc~rain_check_and_update->module~module_mp_tempo_params proc~rain_evaporation rain_evaporation proc~rain_evaporation->module~module_mp_tempo_params proc~rain_fallspeed rain_fallspeed proc~rain_fallspeed->module~module_mp_tempo_params proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~rain_snow_rain_graupel->module~module_mp_tempo_params proc~read_table_ccn read_table_ccn proc~read_table_ccn->module~module_mp_tempo_params proc~read_table_freezewater read_table_freezewater proc~read_table_freezewater->module~module_mp_tempo_params proc~read_table_qr_acr_qg read_table_qr_acr_qg proc~read_table_qr_acr_qg->module~module_mp_tempo_params proc~read_table_qr_acr_qs read_table_qr_acr_qs proc~read_table_qr_acr_qs->module~module_mp_tempo_params proc~reflectivity_10cm reflectivity_10cm proc~reflectivity_10cm->module~module_mp_tempo_params proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_from_melting_graupel->module~module_mp_tempo_params proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_from_melting_snow->module~module_mp_tempo_params proc~riming riming proc~riming->module~module_mp_tempo_params proc~sedimentation sedimentation proc~sedimentation->module~module_mp_tempo_params proc~snow_check_and_update snow_check_and_update proc~snow_check_and_update->module~module_mp_tempo_params proc~snow_fallspeed snow_fallspeed proc~snow_fallspeed->module~module_mp_tempo_params proc~snow_moments snow_moments proc~snow_moments->module~module_mp_tempo_params proc~sum_tendencies sum_tendencies proc~sum_tendencies->module~module_mp_tempo_params proc~tempo_build_tables tempo_build_tables proc~tempo_build_tables->module~module_mp_tempo_params proc~tempo_init tempo_init proc~tempo_init->module~module_mp_tempo_params proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware proc~test_cloud_number_aerosolaware->module~module_mp_tempo_params proc~test_cloud_number_ml test_cloud_number_ml proc~test_cloud_number_ml->module~module_mp_tempo_params proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware proc~test_cloud_number_non_aerosolaware->module~module_mp_tempo_params proc~test_graupel_sedimentation test_graupel_sedimentation proc~test_graupel_sedimentation->module~module_mp_tempo_params proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius proc~test_ml_cloud_effective_radius->module~module_mp_tempo_params proc~test_snow_sedimentation test_snow_sedimentation proc~test_snow_sedimentation->module~module_mp_tempo_params proc~thermo_vars thermo_vars proc~thermo_vars->module~module_mp_tempo_params proc~warm_rain warm_rain proc~warm_rain->module~module_mp_tempo_params proc~write_table_freezewater write_table_freezewater proc~write_table_freezewater->module~module_mp_tempo_params proc~write_table_qr_acr_qg write_table_qr_acr_qg proc~write_table_qr_acr_qg->module~module_mp_tempo_params proc~write_table_qr_acr_qs write_table_qr_acr_qs proc~write_table_qr_acr_qs->module~module_mp_tempo_params program~build_tables build_tables program~build_tables->module~module_mp_tempo_params program~build_tables->module~module_mp_tempo_tables module~tests tests module~tests->module~module_mp_tempo_driver program~run_tempo_tests run_tempo_tests program~run_tempo_tests->module~tests Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. Variables Type Visibility Attributes Name Initial integer, public, parameter :: dp = selected_real_kind(15, 307) character(len=11), public :: tempo_version tempo version string (max is xxx.xxx.xxx) integer, public, parameter :: idx_bg1 = 6 index from rho_g when hail_aware = false: density = 500 real(kind=wp), public, parameter :: av_r = 4854._wp Note av_r is the rain fallspeed power-law coefficient fallspeed power law relations are and coefficients are from from Ferrier (1994) for rain and Thompson et al. (2008) for ice, snow, and graupel real(kind=wp), public, parameter :: bv_r = 1.0_wp rain fallspeed power-law coefficient real(kind=wp), public, parameter :: av_s = 40._wp snow fallspeed power-law coefficient real(kind=wp), public, parameter :: bv_s = 0.55_wp snow fallspeed power-law coefficient real(kind=wp), public, parameter :: fv_s = 100._wp snow fallspeed power-law coefficient real(kind=wp), public, parameter :: bv_c = 2.0_wp cloud fallspeed power-law coefficient real(kind=wp), public, parameter :: bv_i = 1.0_wp ice fallspeed power-law coefficient real(kind=wp), public, parameter :: av_g_old = 442._wp graupel fallspeed power-law coefficient (hail_aware = false) real(kind=wp), public, parameter :: bv_g_old = 0.89_wp graupel fallspeed power-law coefficient (hail_aware = false) real(kind=wp), public, parameter :: av_g_new = 161.794724_wp graupel fallspeed power-law coefficient HARDCODED for idx_bg1 = 6 (hail_aware = true) real(kind=wp), public, parameter :: bv_g_new = 0.640961647_wp graupel fallspeed power-law coefficient HARDCODED for idx_bg1 = 6 (hail_aware = true) real(kind=wp), public, parameter :: fv_r = 195.0_wp rain fallspeed power-law coefficient real(kind=wp), public, parameter :: av_c = 0.316946e8_wp cloud fallspeed power-law coefficient real(kind=wp), public, parameter :: a_coeff = 0.47244157_wp graupel fallspeed power-law coefficient real(kind=wp), public, parameter :: b_coeff = 0.54698726_wp grapuel fallspeed power-law coefficient real(kind=wp), public, parameter :: av_i = 1493.9 ice fallspeed power-law coefficient real(kind=wp), public, parameter :: am_s = 0.069_wp Note am_s is the snow mass power-law coefficient mass power law relations are and coefficients for snow are from Field et al. (2005) and others assume a spherical form real(kind=wp), public, parameter :: bm_s = 2.0_wp snow mass power-law coefficient real(kind=wp), public, parameter :: bm_g = 3.0_wp graupel mass power-law coefficient real(kind=wp), public, parameter :: bm_i = 3.0_wp ice mass power-law coefficient real(kind=wp), public, parameter :: bm_r = 3.0_wp rain mass power-law coefficient real(kind=wp), public, parameter :: rho_i = 890._wp density of cloud ice real(kind=wp), public, parameter :: xm0i = 1.e-12_wp ice initiates with this mass real(kind=wp), public, parameter :: d0c = 1.e-6_wp minimum diameter of cloud droplets real(kind=wp), public, parameter :: d0r = 50.e-6_wp minimum diameter of raindrops real(kind=wp), public, parameter :: d0s = 300.e-6_wp minimum diameter of snow real(kind=wp), public, parameter :: d0g = 350.e-6_wp minimum diameter of graupel real(kind=wp), public, parameter :: d0r_max = 2.5e-3_wp maximum diameter of raindrops real(kind=wp), public, parameter :: c_cube = 0.5_wp capacitance of a sphere real(kind=wp), public, parameter :: c_sqrd = 0.15_wp capacitance of plates/aggregates real(kind=wp), public, parameter :: mu_r = 0.0_wp Note mu_r is the shape parameter for rain\ngeneralized gamma distributions for rain, graupel and cloud ice have the form real(kind=wp), public, parameter :: mu_s = 0.6357_wp shape parameter for snow real(kind=wp), public, parameter :: mu_g = 0.0_wp shape parameter for graupel real(kind=wp), public, parameter :: mu_i = 0.0_wp shape parameter for cloud ice real(kind=wp), public, parameter :: nu_c_scale = 1000.e6_wp scaling parameter for nu_c integer, public, parameter :: nu_c_max = 15 maximum value for nu_c integer, public, parameter :: nu_c_min = 2 minimum value for nu_c real(kind=wp), public, parameter :: naccn0 = 300.0e6_wp used for water-friendly aerosol initialization real(kind=wp), public, parameter :: naccn1 = 50.0e6_wp used for water-friendly aerosol initialization real(kind=wp), public, parameter :: nain0 = 1.5e6_wp used for ice-friendly aerosol initialization real(kind=wp), public, parameter :: nain1 = 0.5e6_wp used for ice-friendly aerosol initialization real(kind=wp), public, parameter :: nwfa_default = 11.1e6_wp default value for water-friendly aerosols real(kind=wp), public, parameter :: nifa_default = nain1*0.01_wp default value for ice-friendly aerosols real(kind=wp), public, parameter :: aero_max = 9999.e6_wp maximum aerosol value real(kind=wp), public, parameter :: hgfrz = 235.16_wp temperature to freeze all liquid real(kind=wp), public, parameter :: nt_c_o = 50.e6_wp cloud number concentration over ocean (non-aerosol aware) real(kind=wp), public, parameter :: nt_c_l = 100.e6_wp cloud number concentration over land (non-aerosol aware) real(kind=wp), public, parameter :: nt_c_max = 1999.e6_wp maximum cloud number concentration real(kind=wp), public, parameter :: nt_c_min = 2._wp minimum cloud number concentration real(kind=wp), public, parameter :: tno = 5.0_wp constant in the Cooper curve for ice nucleation real(kind=wp), public, parameter :: ato = 0.304_wp constant in the Cooper curve for ice nucleation real(kind=wp), public :: rho_s = 100.0_wp density of snow real(kind=wp), public, parameter :: demott_nuc_ssati = 0.25_wp ice supersaturation threshold for DeMott nucleation real(kind=dp), public, parameter :: max_ni = 4999.e3_wp maximum ice number concentration real(kind=wp), public, parameter :: icenuc_max = 1000.e3_wp maximum ice nucleation number real(kind=wp), public, parameter :: rime_threshold = 2.0_wp snow to graupel rime threshold parameter real(kind=wp), public, parameter :: rime_conversion = 0.95_wp snow to graupel rime conversion parameter real(kind=wp), public, parameter :: ef_si = 0.05_wp snow-ice collection efficiency real(kind=wp), public, parameter :: ef_rs = 0.95_wp rain-snow collection efficiency real(kind=wp), public, parameter :: ef_rg = 0.75_wp rain-graupel collection efficiency real(kind=wp), public, parameter :: ef_ri = 0.95_wp rain-ice collection efficiency real(kind=wp), public, parameter :: autocon_nr_factor = 10._wp factor controlling rain number tendency from autconversion (larger produces few drops) real(kind=wp), public, parameter :: timestep_conversion_rime_to_rain = 120._wp timestep above which rime above freezing becomes rain (this timestep should be at least 120s) integer, public, parameter :: table_sp = real32 precision for lookup tables (machine independent) integer, public, parameter :: table_dp = real64 precision for lookup tables (machine independent) integer, public, parameter :: nrhg = 9 graupel density array size when hail_aware = true integer, public, parameter :: nrhg1 = 1 graupel density array size when hail_aware = false real(kind=wp), public, parameter :: min_qv = 1.e-10_wp minimum value of water vapor mixing ratio real(kind=wp), public, parameter :: r1 = 1.e-12_wp minimum hydrometeor mass real(kind=wp), public, parameter :: r2 = 1.e-6_wp minimum hydrometeor number real(kind=wp), public, parameter :: low_limit_mass_for_precip = 1.e-9_wp minimum hydrometor mass needed in the lowest-model level for precipitation real(kind=wp), public, parameter :: eps = 1.e-15_wp small non-zero number real(kind=wp), public, parameter :: meters3_to_liters = 1000._wp number of liters in 1 real(kind=dp), public, parameter :: gonv_min = 1.e2_dp minimum graupel y-intercept real(kind=dp), public, parameter :: gonv_max = 1.e6_dp maximum graupel y-intercept real(kind=wp), public, parameter :: t0 = 273.15_wp melting point of ice real(kind=wp), public, parameter :: rho_w = 1000._wp density of liquid water real(kind=wp), public, parameter,               dimension(nrhg) :: rho_g = [50._wp, 100._wp, 200._wp, 300._wp, 400._wp, 500._wp, 600._wp, 700._wp, 800._wp] !! densities of graupel when hail_aware = true real(kind=wp), public, parameter :: sc = 0.632_wp schmidt number real(kind=wp), public :: pi = 3.1415926536_wp pi is approximately 355/113 real(kind=wp), public :: lsub = 2.834e6_wp enthalpy of sublimation real(kind=wp), public :: lvap0 = 2.5e6_wp enthalpy of vaporization real(kind=wp), public :: rv = 461.5_wp gas constant for water vapor real(kind=wp), public :: rdry = 287.04_wp gas constant for dry air real(kind=wp), public :: roverrv = 0.622_wp dry gas constant divided by water vapor gas constant real(kind=wp), public :: r = 287.04_wp gas constant for dry air real(kind=wp), public :: rho_not density constant real(kind=wp), public :: rho_not0 density constant real(kind=wp), public :: cp = 1004.0_wp heat capacity of air at constant pressure real(kind=wp), public :: r_uni = 8.314 gas constant real(kind=wp), public, parameter :: kap0 = 490.6_wp snow parameter from Field et al. (2005) real(kind=wp), public, parameter :: kap1 = 17.46_wp snow parameter from Field et al. (2005) real(kind=wp), public, parameter :: lam0 = 20.78_wp snow parameter from Field et al. (2005) real(kind=wp), public, parameter :: lam1 = 3.29_wp snow parameter from Field et al. (2005) integer, public, parameter :: nbins = 100 lookup table dimension (number of bins) integer, public, parameter :: nbc = nbins lookup table dimension for cloud water integer, public, parameter :: nbr = nbins lookup table dimension for rain integer, public, parameter :: nbs = nbins lookup table dimension for snow integer, public, parameter :: nbi = nbins lookup table dimension integer, public, parameter :: nbg = nbins lookup table dimension integer, public, parameter :: ntb_i = 64 lookup table dimension for cloud ice integer, public, parameter :: ntb_i1 = 55 lookup table dimension for cloud ice integer, public, parameter :: ntb_c = 37 lookup table dimension for cloud water integer, public, parameter :: ntb_t = 9 lookup table dimension for temperature integer, public, parameter :: ntb_g1 = 37 lookup table dimension for graupel integer, public, parameter :: ntb_s = 37 lookup table dimension for snow integer, public, parameter :: ntb_g = 37 lookup table dimension for graupel integer, public, parameter :: ntb_r = 37 lookup table dimension for rain integer, public, parameter :: ntb_r1 = 37 lookup table dimension for rain integer, public, parameter :: ntb_t1 = 45 lookup table dimension for temperature integer, public, parameter :: ntb_in = 55 lookup table dimension for IN integer, public, parameter :: ntb_arc = 7 lookup table dimension for CCN activation integer, public, parameter :: ntb_arw = 9 lookup table dimension for CCN activation integer, public, parameter :: ntb_art = 7 lookup table dimension for CCN activation integer, public, parameter :: ntb_arr = 5 lookup table dimension for CCN activation integer, public, parameter :: ntb_ark = 4 lookup table dimension for CCN activation real(kind=wp), public, parameter,               dimension(ntb_c) :: r_c = [1.e-6_wp, 2.e-6_wp, 3.e-6_wp, 4.e-6_wp, 5.e-6_wp, 6.e-6_wp, 7.e-6_wp, 8.e-6_wp, 9.e-6_wp, 1.e-5_wp, 2.e-5_wp, 3.e-5_wp, 4.e-5_wp, 5.e-5_wp, 6.e-5_wp, 7.e-5_wp, 8.e-5_wp, 9.e-5_wp, 1.e-4_wp, 2.e-4_wp, 3.e-4_wp, 4.e-4_wp, 5.e-4_wp, 6.e-4_wp, 7.e-4_wp, 8.e-4_wp, 9.e-4_wp, 1.e-3_wp, 2.e-3_wp, 3.e-3_wp, 4.e-3_wp, 5.e-3_wp, 6.e-3_wp, 7.e-3_wp, 8.e-3_wp, 9.e-3_wp, 1.e-2_wp] mass bins for cloud water real(kind=wp), public, parameter,               dimension(ntb_i) :: r_i = [1.e-10_wp, 2.e-10_wp, 3.e-10_wp, 4.e-10_wp, 5.e-10_wp, 6.e-10_wp, 7.e-10_wp, 8.e-10_wp, 9.e-10_wp, 1.e-9_wp, 2.e-9_wp, 3.e-9_wp, 4.e-9_wp, 5.e-9_wp, 6.e-9_wp, 7.e-9_wp, 8.e-9_wp, 9.e-9_wp, 1.e-8_wp, 2.e-8_wp, 3.e-8_wp, 4.e-8_wp, 5.e-8_wp, 6.e-8_wp, 7.e-8_wp, 8.e-8_wp, 9.e-8_wp, 1.e-7_wp, 2.e-7_wp, 3.e-7_wp, 4.e-7_wp, 5.e-7_wp, 6.e-7_wp, 7.e-7_wp, 8.e-7_wp, 9.e-7_wp, 1.e-6_wp, 2.e-6_wp, 3.e-6_wp, 4.e-6_wp, 5.e-6_wp, 6.e-6_wp, 7.e-6_wp, 8.e-6_wp, 9.e-6_wp, 1.e-5_wp, 2.e-5_wp, 3.e-5_wp, 4.e-5_wp, 5.e-5_wp, 6.e-5_wp, 7.e-5_wp, 8.e-5_wp, 9.e-5_wp, 1.e-4_wp, 2.e-4_wp, 3.e-4_wp, 4.e-4_wp, 5.e-4_wp, 6.e-4_wp, 7.e-4_wp, 8.e-4_wp, 9.e-4_wp, 1.e-3_wp] mass bins for ice water real(kind=wp), public, parameter,               dimension(ntb_r) :: r_r = [1.e-6_wp, 2.e-6_wp, 3.e-6_wp, 4.e-6_wp, 5.e-6_wp, 6.e-6_wp, 7.e-6_wp, 8.e-6_wp, 9.e-6_wp, 1.e-5_wp, 2.e-5_wp, 3.e-5_wp, 4.e-5_wp, 5.e-5_wp, 6.e-5_wp, 7.e-5_wp, 8.e-5_wp, 9.e-5_wp, 1.e-4_wp, 2.e-4_wp, 3.e-4_wp, 4.e-4_wp, 5.e-4_wp, 6.e-4_wp, 7.e-4_wp, 8.e-4_wp, 9.e-4_wp, 1.e-3_wp, 2.e-3_wp, 3.e-3_wp, 4.e-3_wp, 5.e-3_wp, 6.e-3_wp, 7.e-3_wp, 8.e-3_wp, 9.e-3_wp, 1.e-2_wp] mass bins for rain real(kind=wp), public, parameter,               dimension(ntb_s) :: r_s = [1.e-6_wp, 2.e-6_wp, 3.e-6_wp, 4.e-6_wp, 5.e-6_wp, 6.e-6_wp, 7.e-6_wp, 8.e-6_wp, 9.e-6_wp, 1.e-5_wp, 2.e-5_wp, 3.e-5_wp, 4.e-5_wp, 5.e-5_wp, 6.e-5_wp, 7.e-5_wp, 8.e-5_wp, 9.e-5_wp, 1.e-4_wp, 2.e-4_wp, 3.e-4_wp, 4.e-4_wp, 5.e-4_wp, 6.e-4_wp, 7.e-4_wp, 8.e-4_wp, 9.e-4_wp, 1.e-3_wp, 2.e-3_wp, 3.e-3_wp, 4.e-3_wp, 5.e-3_wp, 6.e-3_wp, 7.e-3_wp, 8.e-3_wp, 9.e-3_wp, 1.e-2_wp] mass bins for snow real(kind=wp), public, parameter,               dimension(ntb_g) :: r_g = [1.e-6_wp, 2.e-6_wp, 3.e-6_wp, 4.e-6_wp, 5.e-6_wp, 6.e-6_wp, 7.e-6_wp, 8.e-6_wp, 9.e-6_wp, 1.e-5_wp, 2.e-5_wp, 3.e-5_wp, 4.e-5_wp, 5.e-5_wp, 6.e-5_wp, 7.e-5_wp, 8.e-5_wp, 9.e-5_wp, 1.e-4_wp, 2.e-4_wp, 3.e-4_wp, 4.e-4_wp, 5.e-4_wp, 6.e-4_wp, 7.e-4_wp, 8.e-4_wp, 9.e-4_wp, 1.e-3_wp, 2.e-3_wp, 3.e-3_wp, 4.e-3_wp, 5.e-3_wp, 6.e-3_wp, 7.e-3_wp, 8.e-3_wp, 9.e-3_wp, 1.e-2_wp] mass bins for graupel real(kind=wp), public, parameter,               dimension(ntb_r1) :: n0r_exp = [1.e6_wp, 2.e6_wp, 3.e6_wp, 4.e6_wp, 5.e6_wp, 6.e6_wp, 7.e6_wp, 8.e6_wp, 9.e6_wp, 1.e7_wp, 2.e7_wp, 3.e7_wp, 4.e7_wp, 5.e7_wp, 6.e7_wp, 7.e7_wp, 8.e7_wp, 9.e7_wp, 1.e8_wp, 2.e8_wp, 3.e8_wp, 4.e8_wp, 5.e8_wp, 6.e8_wp, 7.e8_wp, 8.e8_wp, 9.e8_wp, 1.e9_wp, 2.e9_wp, 3.e9_wp, 4.e9_wp, 5.e9_wp, 6.e9_wp, 7.e9_wp, 8.e9_wp, 9.e9_wp, 1.e10_wp] y-intercept bins for rain real(kind=wp), public, parameter,               dimension(ntb_g1) :: n0g_exp = [1.e2_wp, 2.e2_wp, 3.e2_wp, 4.e2_wp, 5.e2_wp, 6.e2_wp, 7.e2_wp, 8.e2_wp, 9.e2_wp, 1.e3_wp, 2.e3_wp, 3.e3_wp, 4.e3_wp, 5.e3_wp, 6.e3_wp, 7.e3_wp, 8.e3_wp, 9.e3_wp, 1.e4_wp, 2.e4_wp, 3.e4_wp, 4.e4_wp, 5.e4_wp, 6.e4_wp, 7.e4_wp, 8.e4_wp, 9.e4_wp, 1.e5_wp, 2.e5_wp, 3.e5_wp, 4.e5_wp, 5.e5_wp, 6.e5_wp, 7.e5_wp, 8.e5_wp, 9.e5_wp, 1.e6_wp] y-intercept bins for graupel real(kind=wp), public, parameter,               dimension(ntb_i1) :: nt_i = [1.0_wp, 2.0_wp, 3.0_wp, 4.0_wp, 5.0_wp, 6.0_wp, 7.0_wp, 8.0_wp, 9.0_wp, 1.e1_wp, 2.e1_wp, 3.e1_wp, 4.e1_wp, 5.e1_wp, 6.e1_wp, 7.e1_wp, 8.e1_wp, 9.e1_wp, 1.e2_wp, 2.e2_wp, 3.e2_wp, 4.e2_wp, 5.e2_wp, 6.e2_wp, 7.e2_wp, 8.e2_wp, 9.e2_wp, 1.e3_wp, 2.e3_wp, 3.e3_wp, 4.e3_wp, 5.e3_wp, 6.e3_wp, 7.e3_wp, 8.e3_wp, 9.e3_wp, 1.e4_wp, 2.e4_wp, 3.e4_wp, 4.e4_wp, 5.e4_wp, 6.e4_wp, 7.e4_wp, 8.e4_wp, 9.e4_wp, 1.e5_wp, 2.e5_wp, 3.e5_wp, 4.e5_wp, 5.e5_wp, 6.e5_wp, 7.e5_wp, 8.e5_wp, 9.e5_wp, 1.e6_wp] number bins for ice real(kind=wp), public, parameter,               dimension(ntb_in) :: nt_in = [1.0_wp, 2.0_wp, 3.0_wp, 4.0_wp, 5.0_wp, 6.0_wp, 7.0_wp, 8.0_wp, 9.0_wp, 1.e1_wp, 2.e1_wp, 3.e1_wp, 4.e1_wp, 5.e1_wp, 6.e1_wp, 7.e1_wp, 8.e1_wp, 9.e1_wp, 1.e2_wp, 2.e2_wp, 3.e2_wp, 4.e2_wp, 5.e2_wp, 6.e2_wp, 7.e2_wp, 8.e2_wp, 9.e2_wp, 1.e3_wp, 2.e3_wp, 3.e3_wp, 4.e3_wp, 5.e3_wp, 6.e3_wp, 7.e3_wp, 8.e3_wp, 9.e3_wp, 1.e4_wp, 2.e4_wp, 3.e4_wp, 4.e4_wp, 5.e4_wp, 6.e4_wp, 7.e4_wp, 8.e4_wp, 9.e4_wp, 1.e5_wp, 2.e5_wp, 3.e5_wp, 4.e5_wp, 5.e5_wp, 6.e5_wp, 7.e5_wp, 8.e5_wp, 9.e5_wp, 1.e6_wp] number bins for IN concentration from real(kind=wp), public, parameter,               dimension(ntb_arc) :: ta_na = [10._wp, 31.6_wp, 100._wp, 316._wp, 1000._wp, 3160._wp, 10000._wp] aerosol lookup table bins for number concentration real(kind=wp), public, parameter,               dimension(ntb_arw) :: ta_ww = [0.01_wp, 0.0316_wp, 0.1_wp, 0.316_wp, 1._wp, 3.16_wp, 10._wp, 31.6_wp, 100._wp] aerosol lookup table bins for vertical velocity real(kind=wp), public, parameter,               dimension(ntb_art) :: ta_tk = [243.15_wp, 253.15_wp, 263.15_wp, 273.15_wp, 283.15_wp, 293.15_wp, 303.15_wp] aerosol lookup table bins for temperature real(kind=wp), public, parameter,               dimension(ntb_arr) :: ta_ra = [0.01_wp, 0.02_wp, 0.04_wp, 0.08_wp, 0.16_wp] aerosol lookup table bins for radius real(kind=wp), public, parameter,               dimension(ntb_ark) :: ta_ka = [0.2_wp, 0.4_wp, 0.6_wp, 0.8_wp] aerosol lookup table bins for hygroscopicity real(kind=wp), public, parameter,               dimension(10) :: sa = [5.065339_wp, -0.062659_wp, -3.032362_wp, 0.029469_wp, -0.000285_wp, 0.31255_wp, 0.000204_wp, 0.003199_wp, 0._wp, -0.015952_wp] snow moment data from Field et al. (2005) real(kind=wp), public, parameter,               dimension(10) :: sb = [0.476221_wp, -0.015896_wp, 0.165977_wp, 0.007468_wp, -0.000141_wp, 0.060366_wp, 0.000079_wp, 0.000594_wp, 0._wp, -0.003577_wp] snow moment data from Field et al. (2005) real(kind=wp), public, parameter,               dimension(ntb_t) :: tc = [-0.01_wp, -5._wp, -10._wp, -15._wp, -20._wp, -25._wp, -30._wp, -35._wp, -40._wp] temperature lookup table data integer, public :: nic2 lookup table indexes integer, public :: nii2 lookup table indexes integer, public :: nii3 lookup table indexes integer, public :: nir2 lookup table indexes integer, public :: nir3 lookup table indexes integer, public :: nis2 lookup table indexes integer, public :: nig2 lookup table indexes integer, public :: nig3 lookup table indexes integer, public :: niin2 lookup table indexes real(kind=dp), public :: nic1 History nic1 is used for cloud droplet number concentration lookup table nic1 was changed from integer in previous code versions integer, public, parameter :: nhbins = 50 used for hail size calculation integer, public, parameter :: radar_bins = 50 used for radar caculation real(kind=dp), public, allocatable, dimension(:,:) :: t_efrw collection efficiency data arrays real(kind=dp), public, allocatable, dimension(:,:) :: t_efsw collection efficiency data arrays real(kind=dp), public, allocatable, dimension(:,:,:) :: tpc_wev evaporation data arrays real(kind=dp), public, allocatable, dimension(:,:,:) :: tnc_wev evaporation data arrays real(kind=table_sp), public, allocatable, dimension(:,:,:,:,:) :: tnccn_act cloud condensation nuclei data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:,:) :: tcg_racg rain-graupel collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:,:) :: tmr_racg rain-graupel collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:,:) :: tcr_gacr rain-graupel collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:,:) :: tnr_racg rain-graupel collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:,:) :: tnr_gacr rain-graupel collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tcs_racs1 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tmr_racs1 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tcs_racs2 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tmr_racs2 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tcr_sacr1 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tms_sacr1 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tcr_sacr2 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tms_sacr2 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tnr_racs1 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tnr_racs2 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tnr_sacr1 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tnr_sacr2 rain-snow collection data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tpi_qcfz cloud droplet freezing data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tni_qcfz cloud droplet freezing data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tpi_qrfz rain freezing data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tpg_qrfz rain freezing data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tni_qrfz rain freezing data arrays real(kind=table_dp), public, allocatable, dimension(:,:,:,:) :: tnr_qrfz rain freezing data arrays real(kind=dp), public, allocatable, dimension(:,:) :: tps_iaus cloud ice depositional growth and conversion to snow data array real(kind=dp), public, allocatable, dimension(:,:) :: tni_iaus cloud ice depositional growth and conversion to snow data array real(kind=dp), public, allocatable, dimension(:,:) :: tpi_ide cloud ice depositional growth and conversion to snow data array Subroutines public  subroutine get_version (version) returns the tempo version string from the README.md file\nor returns empty string if not found Arguments Type Intent Optional Attributes Name character(len=*), intent(inout) :: version public  subroutine initialize_graupel_vars (hail_flag) initialize graupel variables based on hail-aware configuration flag Arguments Type Intent Optional Attributes Name logical, intent(in) :: hail_flag public  subroutine initialize_parameters () initialize tempo parameters and variables Arguments None public  subroutine initialize_bins_for_tables () initialize log-spaced bins of hydrometer quantities used for lookup tables Arguments None public  subroutine initialize_bins_for_hail_size () initialize log-spaced bins for hail size calculation Arguments None public  subroutine initialize_bins_for_radar () initialize log-spaced bins for radar calculation Arguments None public  subroutine create_bins (numbins, lowbin, highbin, bins, deltabins) calculates log-spaced bins of hydrometer sizes to simplify calculations later Arguments Type Intent Optional Attributes Name integer, intent(in) :: numbins real(kind=dp), intent(in) :: lowbin real(kind=dp), intent(in) :: highbin real(kind=dp), intent(out), dimension(:) :: bins real(kind=dp), intent(out), optional, dimension(:) :: deltabins public  subroutine initialize_arrays_freezewater (table_size) initialize data arrays for Bigg (1953) freezing of cloud water and rain Read more… Arguments Type Intent Optional Attributes Name integer, intent(out), optional :: table_size public  subroutine initialize_arrays_qr_acr_qs (table_size) initialize data arrays for rain-snow collection Read more… Arguments Type Intent Optional Attributes Name integer, intent(out), optional :: table_size public  subroutine initialize_arrays_qr_acr_qg (table_size) initialize data arrays for rain-graupel collection Read more… Arguments Type Intent Optional Attributes Name integer, intent(out), optional :: table_size public  subroutine initialize_arrays_ccn (table_size) initialize data arrays for ccn lookup table Read more… Arguments Type Intent Optional Attributes Name integer, intent(out), optional :: table_size public  subroutine initialize_arrays_drop_evap () initialize data arrays for drop evaporation data Read more… Arguments None public  subroutine initialize_array_efsw () initializes the collision efficiency data array for snow collecting cloud water Read more… Arguments None public  subroutine initialize_array_efrw () initializes the collision efficiency data array for rain collecting cloud water Read more… Arguments None public  subroutine initialize_arrays_qi_aut_qs () initializes data arrays for cloud ice to snow conversion and growth Read more… Arguments None","tags":"","url":"module/module_mp_tempo_params.html"},{"title":"run_tempo_tests – TEMPO Microphysics","text":"Uses tests program~~run_tempo_tests~~UsesGraph program~run_tempo_tests run_tempo_tests module~tests tests program~run_tempo_tests->module~tests module~module_mp_tempo_cfgs module_mp_tempo_cfgs module~tests->module~module_mp_tempo_cfgs module~module_mp_tempo_driver module_mp_tempo_driver module~tests->module~module_mp_tempo_driver module~module_mp_tempo_driver->module~module_mp_tempo_cfgs module~module_mp_tempo_main module_mp_tempo_main module~module_mp_tempo_driver->module~module_mp_tempo_main module~module_mp_tempo_ml module_mp_tempo_ml module~module_mp_tempo_driver->module~module_mp_tempo_ml module~module_mp_tempo_params module_mp_tempo_params module~module_mp_tempo_driver->module~module_mp_tempo_params module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_driver->module~module_mp_tempo_utils module~module_mp_tempo_main->module~module_mp_tempo_cfgs module~module_mp_tempo_main->module~module_mp_tempo_ml module~module_mp_tempo_main->module~module_mp_tempo_params module~module_mp_tempo_main->module~module_mp_tempo_utils module~module_mp_tempo_aerosols module_mp_tempo_aerosols module~module_mp_tempo_main->module~module_mp_tempo_aerosols module~module_mp_tempo_diags module_mp_tempo_diags module~module_mp_tempo_main->module~module_mp_tempo_diags module~module_mp_tempo_ml->module~module_mp_tempo_params ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types module~module_mp_tempo_utils->module~module_mp_tempo_params module~module_mp_tempo_aerosols->module~module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_params module~module_mp_tempo_diags->module~module_mp_tempo_utils Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. runs tempo tests Calls program~~run_tempo_tests~~CallsGraph program~run_tempo_tests run_tempo_tests proc~test_cloud_number_aerosolaware test_cloud_number_aerosolaware program~run_tempo_tests->proc~test_cloud_number_aerosolaware proc~test_cloud_number_ml test_cloud_number_ml program~run_tempo_tests->proc~test_cloud_number_ml proc~test_cloud_number_non_aerosolaware test_cloud_number_non_aerosolaware program~run_tempo_tests->proc~test_cloud_number_non_aerosolaware proc~test_graupel_sedimentation test_graupel_sedimentation program~run_tempo_tests->proc~test_graupel_sedimentation proc~test_ml_cloud_effective_radius test_ml_cloud_effective_radius program~run_tempo_tests->proc~test_ml_cloud_effective_radius proc~test_snow_sedimentation test_snow_sedimentation program~run_tempo_tests->proc~test_snow_sedimentation proc~test_tempo_init test_tempo_init program~run_tempo_tests->proc~test_tempo_init proc~tempo_run tempo_run proc~test_cloud_number_aerosolaware->proc~tempo_run proc~test_cloud_number_ml->proc~tempo_run proc~test_cloud_number_non_aerosolaware->proc~tempo_run proc~test_graupel_sedimentation->proc~tempo_run proc~test_ml_cloud_effective_radius->proc~tempo_run proc~test_snow_sedimentation->proc~tempo_run proc~tempo_init tempo_init proc~test_tempo_init->proc~tempo_init proc~compute_drop_evap compute_drop_evap proc~tempo_init->proc~compute_drop_evap proc~compute_efrw compute_efrw proc~tempo_init->proc~compute_efrw proc~compute_efsw compute_efsw proc~tempo_init->proc~compute_efsw proc~get_version get_version proc~tempo_init->proc~get_version proc~init_ml_data init_ml_data proc~tempo_init->proc~init_ml_data proc~initialize_array_efrw initialize_array_efrw proc~tempo_init->proc~initialize_array_efrw proc~initialize_array_efsw initialize_array_efsw proc~tempo_init->proc~initialize_array_efsw proc~initialize_arrays_ccn initialize_arrays_ccn proc~tempo_init->proc~initialize_arrays_ccn proc~initialize_arrays_drop_evap initialize_arrays_drop_evap proc~tempo_init->proc~initialize_arrays_drop_evap proc~initialize_arrays_freezewater initialize_arrays_freezewater proc~tempo_init->proc~initialize_arrays_freezewater proc~initialize_arrays_qi_aut_qs initialize_arrays_qi_aut_qs proc~tempo_init->proc~initialize_arrays_qi_aut_qs proc~initialize_arrays_qr_acr_qg initialize_arrays_qr_acr_qg proc~tempo_init->proc~initialize_arrays_qr_acr_qg proc~initialize_arrays_qr_acr_qs initialize_arrays_qr_acr_qs proc~tempo_init->proc~initialize_arrays_qr_acr_qs proc~initialize_bins_for_hail_size initialize_bins_for_hail_size proc~tempo_init->proc~initialize_bins_for_hail_size proc~initialize_bins_for_radar initialize_bins_for_radar proc~tempo_init->proc~initialize_bins_for_radar proc~initialize_bins_for_tables initialize_bins_for_tables proc~tempo_init->proc~initialize_bins_for_tables proc~initialize_graupel_vars initialize_graupel_vars proc~tempo_init->proc~initialize_graupel_vars proc~initialize_parameters initialize_parameters proc~tempo_init->proc~initialize_parameters proc~qi_aut_qs qi_aut_qs proc~tempo_init->proc~qi_aut_qs proc~read_table_ccn read_table_ccn proc~tempo_init->proc~read_table_ccn proc~read_table_freezewater read_table_freezewater proc~tempo_init->proc~read_table_freezewater proc~read_table_qr_acr_qg read_table_qr_acr_qg proc~tempo_init->proc~read_table_qr_acr_qg proc~read_table_qr_acr_qs read_table_qr_acr_qs proc~tempo_init->proc~read_table_qr_acr_qs proc~tempo_main tempo_main proc~tempo_run->proc~tempo_main proc~get_nuc get_nuc proc~compute_drop_evap->proc~get_nuc proc~save_or_read_ml_data save_or_read_ml_data proc~init_ml_data->proc~save_or_read_ml_data proc~create_bins create_bins proc~initialize_bins_for_hail_size->proc~create_bins proc~initialize_bins_for_radar->proc~create_bins proc~initialize_bins_for_tables->proc~create_bins proc~calc_gamma_p calc_gamma_p proc~qi_aut_qs->proc~calc_gamma_p proc~check_before_table_read check_before_table_read proc~read_table_ccn->proc~check_before_table_read proc~read_table_freezewater->proc~check_before_table_read proc~read_table_qr_acr_qg->proc~check_before_table_read proc~read_table_qr_acr_qs->proc~check_before_table_read interface~get_cloud_number get_cloud_number proc~tempo_main->interface~get_cloud_number proc~aerosol_check_and_update aerosol_check_and_update proc~tempo_main->proc~aerosol_check_and_update proc~aerosol_scavenging aerosol_scavenging proc~tempo_main->proc~aerosol_scavenging proc~check_over_depletion check_over_depletion proc~tempo_main->proc~check_over_depletion proc~cloud_check_and_update cloud_check_and_update proc~tempo_main->proc~cloud_check_and_update proc~cloud_condensation cloud_condensation proc~tempo_main->proc~cloud_condensation proc~cloud_fallspeed cloud_fallspeed proc~tempo_main->proc~cloud_fallspeed proc~effective_radius effective_radius proc~tempo_main->proc~effective_radius proc~freeze_cloud_melt_ice freeze_cloud_melt_ice proc~tempo_main->proc~freeze_cloud_melt_ice proc~freezing_rain freezing_rain proc~tempo_main->proc~freezing_rain proc~graupel_check_and_update graupel_check_and_update proc~tempo_main->proc~graupel_check_and_update proc~graupel_fallspeed graupel_fallspeed proc~tempo_main->proc~graupel_fallspeed proc~graupel_init graupel_init proc~tempo_main->proc~graupel_init proc~ice_check_and_update ice_check_and_update proc~tempo_main->proc~ice_check_and_update proc~ice_fallspeed ice_fallspeed proc~tempo_main->proc~ice_fallspeed proc~ice_nucleation ice_nucleation proc~tempo_main->proc~ice_nucleation proc~ice_processes ice_processes proc~tempo_main->proc~ice_processes proc~init_ice_friendly_aerosols init_ice_friendly_aerosols proc~tempo_main->proc~init_ice_friendly_aerosols proc~init_water_friendly_aerosols init_water_friendly_aerosols proc~tempo_main->proc~init_water_friendly_aerosols proc~max_hail_diam max_hail_diam proc~tempo_main->proc~max_hail_diam proc~melting melting proc~tempo_main->proc~melting proc~rain_check_and_update rain_check_and_update proc~tempo_main->proc~rain_check_and_update proc~rain_evaporation rain_evaporation proc~tempo_main->proc~rain_evaporation proc~rain_fallspeed rain_fallspeed proc~tempo_main->proc~rain_fallspeed proc~rain_snow_rain_graupel rain_snow_rain_graupel proc~tempo_main->proc~rain_snow_rain_graupel proc~reflectivity_10cm reflectivity_10cm proc~tempo_main->proc~reflectivity_10cm proc~riming riming proc~tempo_main->proc~riming proc~sedimentation sedimentation proc~tempo_main->proc~sedimentation proc~semilagrangian_sedimentation semilagrangian_sedimentation proc~tempo_main->proc~semilagrangian_sedimentation proc~snow_check_and_update snow_check_and_update proc~tempo_main->proc~snow_check_and_update proc~snow_fallspeed snow_fallspeed proc~tempo_main->proc~snow_fallspeed proc~snow_moments snow_moments proc~tempo_main->proc~snow_moments proc~sum_tendencies sum_tendencies proc~tempo_main->proc~sum_tendencies proc~thermo_vars thermo_vars proc~tempo_main->proc~thermo_vars proc~warm_rain warm_rain proc~tempo_main->proc~warm_rain proc~get_constant_cloud_number get_constant_cloud_number interface~get_cloud_number->proc~get_constant_cloud_number proc~tempo_ml_predict_cloud_number tempo_ml_predict_cloud_number interface~get_cloud_number->proc~tempo_ml_predict_cloud_number proc~aerosol_collection_efficiency aerosol_collection_efficiency proc~aerosol_scavenging->proc~aerosol_collection_efficiency proc~calc_gamma_cf calc_gamma_cf proc~calc_gamma_p->proc~calc_gamma_cf proc~calc_gamma_series calc_gamma_series proc~calc_gamma_p->proc~calc_gamma_series proc~cloud_check_and_update->proc~get_nuc proc~activate_cloud_number activate_cloud_number proc~cloud_condensation->proc~activate_cloud_number proc~get_cloud_table_index get_cloud_table_index proc~cloud_condensation->proc~get_cloud_table_index proc~cloud_fallspeed->proc~get_nuc proc~effective_radius->proc~get_nuc proc~effective_radius->proc~snow_moments proc~demott_nucleation demott_nucleation proc~ice_nucleation->proc~demott_nucleation proc~ice_nucleation->proc~get_cloud_table_index proc~get_in_table_index get_in_table_index proc~ice_nucleation->proc~get_in_table_index proc~get_rain_table_index get_rain_table_index proc~ice_nucleation->proc~get_rain_table_index proc~koop_nucleation koop_nucleation proc~ice_nucleation->proc~koop_nucleation proc~get_ice_table_index get_ice_table_index proc~ice_processes->proc~get_ice_table_index proc~get_t1_subl get_t1_subl proc~ice_processes->proc~get_t1_subl proc~melting->proc~get_t1_subl proc~get_graupel_table_index get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_graupel_table_index proc~rain_snow_rain_graupel->proc~get_rain_table_index proc~get_snow_table_index get_snow_table_index proc~rain_snow_rain_graupel->proc~get_snow_table_index proc~get_temperature_table_index get_temperature_table_index proc~rain_snow_rain_graupel->proc~get_temperature_table_index proc~find_melting_level find_melting_level proc~reflectivity_10cm->proc~find_melting_level proc~reflectivity_from_melting_graupel reflectivity_from_melting_graupel proc~reflectivity_10cm->proc~reflectivity_from_melting_graupel proc~reflectivity_from_melting_snow reflectivity_from_melting_snow proc~reflectivity_10cm->proc~reflectivity_from_melting_snow proc~riming->proc~get_nuc proc~calc_rsif calc_rsif proc~thermo_vars->proc~calc_rsif proc~calc_rslf calc_rslf proc~thermo_vars->proc~calc_rslf proc~warm_rain->proc~get_nuc proc~complex_ice_maetzler complex_ice_maetzler proc~reflectivity_from_melting_graupel->proc~complex_ice_maetzler proc~complex_water_ray complex_water_ray proc~reflectivity_from_melting_graupel->proc~complex_water_ray proc~rayleigh_soak_wetgraupel rayleigh_soak_wetgraupel proc~reflectivity_from_melting_graupel->proc~rayleigh_soak_wetgraupel proc~reflectivity_from_melting_snow->proc~complex_ice_maetzler proc~reflectivity_from_melting_snow->proc~complex_water_ray proc~reflectivity_from_melting_snow->proc~rayleigh_soak_wetgraupel proc~tempo_ml_predict_cloud_number->proc~save_or_read_ml_data proc~relu_activation relu_activation proc~tempo_ml_predict_cloud_number->proc~relu_activation proc~standard_scaler_transform standard_scaler_transform proc~tempo_ml_predict_cloud_number->proc~standard_scaler_transform Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Variables Type Attributes Name Initial real, dimension(7) :: sedi_tests = [1., 10., 20., 60., 120., 300., 600.] integer :: t","tags":"","url":"program/run_tempo_tests.html"},{"title":"build_tables – TEMPO Microphysics","text":"Uses module_mp_tempo_params module_mp_tempo_tables mpi_f08 program~~build_tables~~UsesGraph program~build_tables build_tables module~module_mp_tempo_params module_mp_tempo_params program~build_tables->module~module_mp_tempo_params module~module_mp_tempo_tables module_mp_tempo_tables program~build_tables->module~module_mp_tempo_tables mpi_f08 mpi_f08 program~build_tables->mpi_f08 ccpp_kind_types ccpp_kind_types module~module_mp_tempo_params->ccpp_kind_types iso_fortran_env iso_fortran_env module~module_mp_tempo_params->iso_fortran_env module~machine machine module~module_mp_tempo_params->module~machine mpas_kind_types mpas_kind_types module~module_mp_tempo_params->mpas_kind_types module~module_mp_tempo_tables->module~module_mp_tempo_params module~module_mp_tempo_tables->mpi_f08 module~module_mp_tempo_cfgs module_mp_tempo_cfgs module~module_mp_tempo_tables->module~module_mp_tempo_cfgs module~module_mp_tempo_utils module_mp_tempo_utils module~module_mp_tempo_tables->module~module_mp_tempo_utils module~module_mp_tempo_utils->module~module_mp_tempo_params Help Graph Key Nodes of different colours represent the following: Graph Key Module Module Submodule Submodule Subroutine Subroutine Function Function Program Program This Page's Entity This Page's Entity Solid arrows point from a submodule to the (sub)module which it is\ndescended from. Dashed arrows point from a module or program unit to \nmodules which it uses. program to build 3 lookup tables for tempo microphysics example build make build_tables -f Makefile.intel mpi=1 timing information (ursa) to build the largest lookup table (rain-graupel collection) Description Time (s) gfortran (-O2) 3000 mpif90 (-O2) 1 process 3000 mpif90 (-O2) 13 processes 250 ifort (-fp-model consistent) 1300 mpiifort (-fp-model consistent) 1 process 1300 mpiifort (-fp-model consistent) 13 processes 120 Calls program~~build_tables~~CallsGraph program~build_tables build_tables mpi_comm_rank mpi_comm_rank program~build_tables->mpi_comm_rank mpi_comm_size mpi_comm_size program~build_tables->mpi_comm_size mpi_finalize mpi_finalize program~build_tables->mpi_finalize mpi_init mpi_init program~build_tables->mpi_init mpi_type_size mpi_type_size program~build_tables->mpi_type_size proc~tempo_build_tables tempo_build_tables program~build_tables->proc~tempo_build_tables proc~build_table_freezewater build_table_freezewater proc~tempo_build_tables->proc~build_table_freezewater proc~build_table_qr_acr_qg build_table_qr_acr_qg proc~tempo_build_tables->proc~build_table_qr_acr_qg proc~build_table_qr_acr_qs build_table_qr_acr_qs proc~tempo_build_tables->proc~build_table_qr_acr_qs proc~get_version get_version proc~tempo_build_tables->proc~get_version proc~initialize_bins_for_tables initialize_bins_for_tables proc~tempo_build_tables->proc~initialize_bins_for_tables proc~initialize_graupel_vars initialize_graupel_vars proc~tempo_build_tables->proc~initialize_graupel_vars proc~initialize_parameters initialize_parameters proc~tempo_build_tables->proc~initialize_parameters proc~write_table_freezewater write_table_freezewater proc~tempo_build_tables->proc~write_table_freezewater proc~write_table_qr_acr_qg write_table_qr_acr_qg proc~tempo_build_tables->proc~write_table_qr_acr_qg proc~write_table_qr_acr_qs write_table_qr_acr_qs proc~tempo_build_tables->proc~write_table_qr_acr_qs proc~freezewater freezewater proc~build_table_freezewater->proc~freezewater proc~initialize_arrays_freezewater initialize_arrays_freezewater proc~build_table_freezewater->proc~initialize_arrays_freezewater mpi_allgather mpi_allgather proc~build_table_qr_acr_qg->mpi_allgather mpi_barrier mpi_barrier proc~build_table_qr_acr_qg->mpi_barrier mpi_wtime mpi_wtime proc~build_table_qr_acr_qg->mpi_wtime proc~gather gather proc~build_table_qr_acr_qg->proc~gather proc~get_index_for_rank get_index_for_rank proc~build_table_qr_acr_qg->proc~get_index_for_rank proc~initialize_arrays_qr_acr_qg initialize_arrays_qr_acr_qg proc~build_table_qr_acr_qg->proc~initialize_arrays_qr_acr_qg proc~qr_acr_qg qr_acr_qg proc~build_table_qr_acr_qg->proc~qr_acr_qg proc~build_table_qr_acr_qs->mpi_allgather proc~build_table_qr_acr_qs->mpi_barrier proc~build_table_qr_acr_qs->mpi_wtime proc~build_table_qr_acr_qs->proc~gather proc~build_table_qr_acr_qs->proc~get_index_for_rank proc~initialize_arrays_qr_acr_qs initialize_arrays_qr_acr_qs proc~build_table_qr_acr_qs->proc~initialize_arrays_qr_acr_qs proc~qr_acr_qs qr_acr_qs proc~build_table_qr_acr_qs->proc~qr_acr_qs proc~create_bins create_bins proc~initialize_bins_for_tables->proc~create_bins mpi_gatherv mpi_gatherv proc~gather->mpi_gatherv proc~snow_moments snow_moments proc~qr_acr_qs->proc~snow_moments Help Graph Key Nodes of different colours represent the following: Graph Key Subroutine Subroutine Function Function Interface Interface Type Bound Procedure Type Bound Procedure Unknown Procedure Type Unknown Procedure Type Program Program This Page's Entity This Page's Entity Solid arrows point from a procedure to one which it calls. Dashed \narrows point from an interface to procedures which implement that interface.\nThis could include the module procedures in a generic interface or the\nimplementation in a submodule of an interface in a parent module. Variables Type Attributes Name Initial integer :: build_tables_rank integer :: build_tables_num_proc integer :: ierror integer :: mpi_dp_size","tags":"","url":"program/build_tables.html"},{"title":"module_mp_tempo_aerosols.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~module_mp_tempo_aerosols.f90~~EfferentGraph sourcefile~module_mp_tempo_aerosols.f90 module_mp_tempo_aerosols.F90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~module_mp_tempo_aerosols.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~module_mp_tempo_aerosols.f90~~AfferentGraph sourcefile~module_mp_tempo_aerosols.f90 module_mp_tempo_aerosols.F90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_aerosols.f90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_aerosols !! contains produces used when aerosol-aware = true use module_mp_tempo_params , only : wp , sp , dp , & naccn0 , naccn1 , nain0 , nain1 , nwfa_default , aero_max implicit none private public :: init_water_friendly_aerosols , init_ice_friendly_aerosols , & aerosol_collection_efficiency contains subroutine init_water_friendly_aerosols ( dz1d , nwfa ) !! sets water-friendly aerosols to an exponential profile !! if aerosol-aware = true and no initial condition !! is provided by the host model real ( wp ), dimension (:), intent ( in ) :: dz1d real ( wp ), dimension (:), intent ( inout ) :: nwfa real ( wp ), dimension (:), allocatable :: hgt real ( wp ) :: h_01 , niccn3 integer :: k , nz nz = size ( dz1d ) allocate ( hgt ( nz ), source = 0._wp ) do k = 2 , nz hgt ( k ) = hgt ( k - 1 ) + dz1d ( k ) enddo if ( hgt ( 1 ) <= 100 0.0_wp ) then h_01 = 0.8_wp elseif ( hgt ( 1 ) >= 250 0.0_wp ) then h_01 = 0.01_wp else h_01 = 0.8_wp * cos ( hgt ( 1 ) * 0.001_wp - 1.0_wp ) endif niccn3 = - 1.0_wp * log ( naccn1 / naccn0 ) / h_01 nwfa ( 1 ) = naccn1 + naccn0 * exp ( - (( hgt ( 2 ) - hgt ( 1 )) / 100 0._wp ) * niccn3 ) do k = 2 , nz nwfa ( k ) = naccn1 + naccn0 * exp ( - (( hgt ( k ) - hgt ( 1 )) / 100 0._wp ) * niccn3 ) enddo end subroutine init_water_friendly_aerosols subroutine init_ice_friendly_aerosols ( dz1d , nifa ) !! sets ice-friendly aerosols to an exponential profile !! if aerosol-aware = true and no initial condition !! is provided by the host model real ( wp ), dimension (:), intent ( in ) :: dz1d real ( wp ), dimension (:), intent ( inout ) :: nifa real ( wp ), dimension (:), allocatable :: hgt real ( wp ) :: h_01 , niin3 integer :: k , nz nz = size ( dz1d ) allocate ( hgt ( nz ), source = 0._wp ) do k = 2 , nz hgt ( k ) = hgt ( k - 1 ) + dz1d ( k ) enddo if ( hgt ( 1 ) <= 100 0.0_wp ) then h_01 = 0.8_wp elseif ( hgt ( 1 ) >= 250 0.0_wp ) then h_01 = 0.01_wp else h_01 = 0.8_wp * cos ( hgt ( 1 ) * 0.001_wp - 1.0_wp ) endif niin3 = - 1.0_wp * log ( nain1 / nain0 ) / h_01 nifa ( 1 ) = nain1 + nain0 * exp ( - (( hgt ( 2 ) - hgt ( 1 )) / 100 0._wp ) * niin3 ) do k = 2 , nz nifa ( k ) = nain1 + nain0 * exp ( - (( hgt ( k ) - hgt ( 1 )) / 100 0._wp ) * niin3 ) enddo end subroutine init_ice_friendly_aerosols function aerosol_collection_efficiency ( d , da , visc , rhoa , temp , species ) result ( eff_a ) !! computes aerosol collection efficiency for precipitation scavenging !! from [Wang et al. (2010)](https://doi.org/10.5194/acp-10-5685-2010) use module_mp_tempo_params , only : rho_w , rho_s , av_s , bv_s , & idx_bg1 , pi , av_g , bv_g , rho_g real ( dp ), intent ( in ) :: d real ( wp ), intent ( in ) :: da , visc , rhoa , temp character ( len = 1 ), intent ( in ) :: species real ( wp ) :: aval , cc , diff , re , sc , st , st2 , vt , eff , rho_p real ( wp ), parameter :: boltzman = 1.3806503e-23_wp real ( wp ), parameter :: meanpath = 0.0256e-6_wp real ( wp ) :: eff_a vt = 1._wp rho_p = rho_w ! rain if ( species == 'r' ) then vt = - 0.1021 + 4.932e3_wp * d - 0.9551e6_wp * d * d + & 0.07934e9_wp * d * d * d - 0.002362e12_wp * d * d * d * d rho_p = rho_w ! snow elseif ( species == 's' ) then vt = av_s * d ** bv_s rho_p = rho_s ! graupel elseif ( species . eq . 'g' ) then vt = av_g ( idx_bg1 ) * d ** bv_g ( idx_bg1 ) rho_p = rho_g ( idx_bg1 ) endif cc = 1._wp + 2._wp * meanpath / da * ( 1.257_wp + 0.4_wp * exp ( - 0.55 * da / meanpath )) diff = boltzman * temp * cc / ( 3._wp * pi * visc * da ) re = 0.5_wp * rhoa * d * vt / visc sc = visc / ( rhoa * diff ) st = ( rho_p - rhoa ) * da * da * vt * cc / ( 9._wp * visc * d ) aval = log ( 1._wp + re ) st2 = ( 1.2_wp + 1._wp / 1 2._wp * aval ) / ( 1._wp + aval ) eff = 4._wp / ( re * sc ) * ( 1._wp + 0.4_wp * sqrt ( re ) * sc ** 0.3333_wp + & 0.16_wp * sqrt ( re ) * sqrt ( sc )) + 4._wp * da / d * & ( 0.02_wp + da / d * ( 1._wp + 2._wp * sqrt ( re ))) if ( st > st2 ) eff = eff + (( st - st2 ) / ( st - st2 + 0.666667_wp )) ** 1.5_wp eff_a = max ( 1.e-5_wp , min ( eff , 1._wp )) end function aerosol_collection_efficiency end module module_mp_tempo_aerosols","tags":"","url":"sourcefile/module_mp_tempo_aerosols.f90.html"},{"title":"tests.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~tests.f90~~EfferentGraph sourcefile~tests.f90 tests.F90 sourcefile~module_mp_tempo_cfgs.f90 module_mp_tempo_cfgs.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~module_mp_tempo_ml.f90 module_mp_tempo_ml.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_aerosols.f90 module_mp_tempo_aerosols.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_aerosols.f90 sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_diags.f90 sourcefile~module_mp_tempo_ml.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_aerosols.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_utils.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~tests.f90~~AfferentGraph sourcefile~tests.f90 tests.F90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module tests !! TEMPO tests use module_mp_tempo_cfgs , only : ty_tempo_cfgs use module_mp_tempo_driver , only : tempo_init , tempo_run , ty_tempo_driver_diags implicit none private public :: test_tempo_init , test_graupel_sedimentation , test_snow_sedimentation , & test_cloud_number_aerosolaware , test_cloud_number_non_aerosolaware , & test_cloud_number_ml , test_ml_cloud_effective_radius type ( ty_tempo_cfgs ) :: tempo_cfgs contains subroutine test_tempo_init () !! test tempo initialization procedure !! use ml_for_bl_nc_flag = .true. to initialize ml data !! which is used for a few tests !! test specific flags are then set in each test call tempo_init ( ml_for_bl_nc_flag = . true ., tempo_cfgs = tempo_cfgs ) end subroutine test_tempo_init subroutine test_graupel_sedimentation ( dt , semi_sedi ) !! test graupel sedimentation use module_mp_tempo_params , only : wp , sp , dp integer :: itimestep real ( wp ), intent ( in ) :: dt logical , intent ( in ) :: semi_sedi integer , parameter :: nz = 59 integer , parameter :: ids = 1 , ide = 1 , ims = 1 , ime = 1 , its = 1 , ite = 1 integer , parameter :: jds = 1 , jde = 1 , jms = 1 , jme = 1 , jts = 1 , jte = 1 integer , parameter :: kds = 1 , kde = nz , kms = 1 , kme = nz , kts = 1 , kte = nz real ( wp ), dimension ( its : ite , kts : kte , jts : jte ) :: qv , t , th , pii , p , w , dz , & qc , qr , qi , qs , qg , ni , nr , ng , qb real ( wp ), dimension ( nz ) :: klevs_in , qv_in , qc_in , qr_in , qi_in , qs_in , & qg_in , ni_in , nr_in , nc_in , nwfa_in , nifa_in , theta_in , ng_in , volg_in , & pressure_in , w_in , dz_in real ( wp ) :: precip_sum character ( len = 20 ) :: dt_string , tt_string character ( len = 20 ) :: semi_sedi_string type ( ty_tempo_driver_diags ) :: tempo_driver_diags type ( ty_tempo_cfgs ) :: tempo_cfgs integer :: io1 , io2 , io3 , io4 , k , total_timesteps integer , parameter :: integration_time = 1200 write ( dt_string , '(I7)' ) int ( dt ) if ( semi_sedi ) then write ( semi_sedi_string , '(A)' ) '_semi_sedi' else write ( semi_sedi_string , '(A)' ) '' endif ! read input file io1 = 11 open ( io1 , file = '../test/data/mpas_59lev_test.txt' , status = 'old' ) read ( io1 , * ) ! header do k = 1 , nz read ( io1 , * ) klevs_in ( k ), qv_in ( k ), qc_in ( k ), qr_in ( k ), qi_in ( k ), qs_in ( k ), & qg_in ( k ), ni_in ( k ), nr_in ( k ), nc_in ( k ), nwfa_in ( k ), nifa_in ( k ), & theta_in ( k ), ng_in ( k ), volg_in ( k ), pressure_in ( k ), w_in ( k ), dz_in ( k ) end do close ( io1 ) qv ( 1 ,:, 1 ) = qv_in t ( 1 ,:, 1 ) = theta_in * ( pressure_in / 10000 0. ) ** 0.286 p ( 1 ,:, 1 ) = pressure_in dz ( 1 ,:, 1 ) = dz_in w = 0._wp qc = 0._wp qr = 0._wp nr = 0._wp qi = 0._wp qs = 0._wp ni = 0._wp qg ( 1 ,:, 1 ) = qg_in ng ( 1 ,:, 1 ) = ng_in qb ( 1 ,:, 1 ) = volg_in * 100 0. ! convert meters&#94;3 -> liters ! set configs tempo_cfgs % turn_off_micro_flag = . true . tempo_cfgs % graupel_med_vol_diam_flag = . true . tempo_cfgs % semi_sedi_flag = semi_sedi total_timesteps = int ( integration_time / dt ) precip_sum = 0._wp open ( newunit = io2 , file = \"graupel_precip_dt_\" // trim ( adjustl ( dt_string )) // \"\" // trim ( semi_sedi_string ) // \".txt\" , & status = \"new\" , action = \"write\" ) do itimestep = 1 , total_timesteps call tempo_run ( tempo_cfgs = tempo_cfgs , itimestep = itimestep , dt = dt , & ids = ids , ide = ide , ims = ims , ime = ime , its = its , ite = ite , & jds = jds , jde = jde , jms = jms , jme = jme , jts = jts , jte = jte , & kds = kds , kde = kde , kms = kms , kme = kme , kts = kts , kte = kte , & t = t , p = p , w = w , dz = dz , qv = qv , th = th , pii = pii , & qc = qc , qr = qr , qi = qi , qs = qs , qg = qg , ni = ni , nr = nr , ng = ng , qb = qb , & tempo_diags = tempo_driver_diags ) precip_sum = precip_sum + tempo_driver_diags % graupel_liquid_equiv_precip ( 1 , 1 ) write ( io2 , '(I7, 1E12.4)' ) int ( itimestep * dt ), precip_sum if ( dt == 1. . and . . not . semi_sedi . and . itimestep == 1 ) then open ( newunit = io3 , file = \"graupel_sedi_init.txt\" , status = \"new\" , action = \"write\" ) write ( io3 , '(5A)' ) 'k ' , 'mass ' , 'number ' , 'density ' , 'mvd' do k = 1 , nz if ( qb ( 1 , k , 1 ) > 0._wp ) then write ( io3 , '(I5, 4E12.4)' ) k , qg ( 1 , k , 1 ), ng ( 1 , k , 1 ), 100 0. * qg ( 1 , k , 1 ) / qb ( 1 , k , 1 ), tempo_driver_diags % graupel_med_vol_diam ( 1 , k , 1 ) else write ( io3 , '(I5, 4E12.4)' ) k , qg ( 1 , k , 1 ), ng ( 1 , k , 1 ), 0._wp , tempo_driver_diags % graupel_med_vol_diam ( 1 , k , 1 ) endif enddo endif enddo write ( tt_string , '(I7)' ) integration_time open ( newunit = io4 , file = \"graupel_sedi_dt_\" // trim ( adjustl ( dt_string )) // \"\" // trim ( semi_sedi_string ) // & \"_runtime\" // trim ( adjustl ( tt_string )) // \".txt\" , status = \"new\" , action = \"write\" ) write ( io4 , '(5A)' ) 'k ' , 'mass ' , 'number ' , 'density ' , 'mvd' do k = 1 , nz if ( qb ( 1 , k , 1 ) > 0._wp ) then write ( io4 , '(I5, 4E12.4)' ) k , qg ( 1 , k , 1 ), ng ( 1 , k , 1 ), 100 0. * qg ( 1 , k , 1 ) / qb ( 1 , k , 1 ), & tempo_driver_diags % graupel_med_vol_diam ( 1 , k , 1 ) else write ( io4 , '(I5, 4E12.4)' ) k , qg ( 1 , k , 1 ), ng ( 1 , k , 1 ), 0._wp , & tempo_driver_diags % graupel_med_vol_diam ( 1 , k , 1 ) endif enddo end subroutine test_graupel_sedimentation subroutine test_snow_sedimentation ( dt ) use module_mp_tempo_params , only : wp , sp , dp integer :: itimestep real ( wp ), intent ( in ) :: dt integer , parameter :: nz = 59 integer , parameter :: ids = 1 , ide = 1 , ims = 1 , ime = 1 , its = 1 , ite = 1 integer , parameter :: jds = 1 , jde = 1 , jms = 1 , jme = 1 , jts = 1 , jte = 1 integer , parameter :: kds = 1 , kde = nz , kms = 1 , kme = nz , kts = 1 , kte = nz real ( wp ), dimension ( its : ite , kts : kte , jts : jte ) :: qv , t , th , pii , p , w , dz , & qc , qr , qi , qs , qg , ni , nr , ng , qb real ( wp ), dimension ( nz ) :: klevs_in , qv_in , qc_in , qr_in , qi_in , qs_in , & qg_in , ni_in , nr_in , nc_in , nwfa_in , nifa_in , theta_in , ng_in , volg_in , & pressure_in , w_in , dz_in real ( wp ) :: precip_sum character ( len = 20 ) :: dt_string , tt_string type ( ty_tempo_driver_diags ) :: tempo_driver_diags type ( ty_tempo_cfgs ) :: tempo_cfgs integer :: io1 , io2 , io3 , io4 , k , total_timesteps integer , parameter :: integration_time = 1200 write ( dt_string , '(I7)' ) int ( dt ) ! read input file io1 = 11 open ( io1 , file = '../test/data/mpas_59lev_test.txt' , status = 'old' ) read ( io1 , * ) ! header do k = 1 , nz read ( io1 , * ) klevs_in ( k ), qv_in ( k ), qc_in ( k ), qr_in ( k ), qi_in ( k ), qs_in ( k ), & qg_in ( k ), ni_in ( k ), nr_in ( k ), nc_in ( k ), nwfa_in ( k ), nifa_in ( k ), & theta_in ( k ), ng_in ( k ), volg_in ( k ), pressure_in ( k ), w_in ( k ), dz_in ( k ) end do close ( io1 ) qv ( 1 ,:, 1 ) = qv_in t ( 1 ,:, 1 ) = theta_in * ( pressure_in / 10000 0. ) ** 0.286 p ( 1 ,:, 1 ) = pressure_in dz ( 1 ,:, 1 ) = dz_in w = 0._wp qc = 0._wp qr = 0._wp nr = 0._wp qi = 0._wp qs ( 1 ,:, 1 ) = qs_in ni = 0._wp qg = 0._wp ng = 0._wp qb = 0._wp ! set configs tempo_cfgs % turn_off_micro_flag = . true . total_timesteps = int ( integration_time / dt ) precip_sum = 0._wp open ( newunit = io2 , file = \"snow_precip_dt_\" // trim ( adjustl ( dt_string )) // \".txt\" , & status = \"new\" , action = \"write\" ) do itimestep = 1 , total_timesteps call tempo_run ( tempo_cfgs = tempo_cfgs , itimestep = itimestep , dt = dt , & ids = ids , ide = ide , ims = ims , ime = ime , its = its , ite = ite , & jds = jds , jde = jde , jms = jms , jme = jme , jts = jts , jte = jte , & kds = kds , kde = kde , kms = kms , kme = kme , kts = kts , kte = kte , & t = t , p = p , w = w , dz = dz , qv = qv , th = th , pii = pii , & qc = qc , qr = qr , qi = qi , qs = qs , qg = qg , ni = ni , nr = nr , ng = ng , qb = qb , & tempo_diags = tempo_driver_diags ) precip_sum = precip_sum + tempo_driver_diags % snow_liquid_equiv_precip ( 1 , 1 ) write ( io2 , '(I7, 1E12.4)' ) int ( itimestep * dt ), precip_sum if ( dt == 1. . and . itimestep == 1 ) then open ( newunit = io3 , file = \"snow_sedi_init.txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io3 , '(I5, 4E12.4)' ) k , qs ( 1 , k , 1 ) enddo endif enddo write ( tt_string , '(I7)' ) integration_time open ( newunit = io4 , file = \"snow_sedi_dt_\" // trim ( adjustl ( dt_string )) // & \"_runtime\" // trim ( adjustl ( tt_string )) // \".txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io4 , '(I5, 4E12.4)' ) k , qs ( 1 , k , 1 ) enddo end subroutine test_snow_sedimentation subroutine test_cloud_number_aerosolaware ( dt ) use module_mp_tempo_params , only : wp , sp , dp integer :: itimestep real ( wp ), intent ( in ) :: dt integer , parameter :: nz = 59 integer , parameter :: ids = 1 , ide = 1 , ims = 1 , ime = 1 , its = 1 , ite = 1 integer , parameter :: jds = 1 , jde = 1 , jms = 1 , jme = 1 , jts = 1 , jte = 1 integer , parameter :: kds = 1 , kde = nz , kms = 1 , kme = nz , kts = 1 , kte = nz real ( wp ), dimension ( its : ite , kts : kte , jts : jte ) :: qv , t , th , pii , p , w , dz , & qc , qr , qi , qs , qg , ni , nr , ng , qb , nc real ( wp ), dimension ( nz ) :: klevs_in , qv_in , qc_in , qr_in , qi_in , qs_in , & qg_in , ni_in , nr_in , nc_in , nwfa_in , nifa_in , theta_in , ng_in , volg_in , & pressure_in , w_in , dz_in real ( wp ) :: precip_sum character ( len = 20 ) :: dt_string , tt_string type ( ty_tempo_driver_diags ) :: tempo_driver_diags type ( ty_tempo_cfgs ) :: tempo_cfgs integer :: io1 , io2 , io3 , io4 , k , total_timesteps integer , parameter :: integration_time = 1200 write ( dt_string , '(I7)' ) int ( dt ) ! read input file io1 = 11 open ( io1 , file = '../test/data/mpas_59lev_test.txt' , status = 'old' ) read ( io1 , * ) ! header do k = 1 , nz read ( io1 , * ) klevs_in ( k ), qv_in ( k ), qc_in ( k ), qr_in ( k ), qi_in ( k ), qs_in ( k ), & qg_in ( k ), ni_in ( k ), nr_in ( k ), nc_in ( k ), nwfa_in ( k ), nifa_in ( k ), & theta_in ( k ), ng_in ( k ), volg_in ( k ), pressure_in ( k ), w_in ( k ), dz_in ( k ) end do close ( io1 ) qv ( 1 ,:, 1 ) = qv_in t ( 1 ,:, 1 ) = theta_in * ( pressure_in / 10000 0. ) ** 0.286 p ( 1 ,:, 1 ) = pressure_in dz ( 1 ,:, 1 ) = dz_in w ( 1 ,:, 1 ) = w_in qc ( 1 ,:, 1 ) = qc_in nc ( 1 ,:, 1 ) = nc_in qr ( 1 ,:, 1 ) = qr_in nr ( 1 ,:, 1 ) = nr_in qi ( 1 ,:, 1 ) = qi_in qs ( 1 ,:, 1 ) = qs_in ni ( 1 ,:, 1 ) = ni_in qg = 0._wp ng = 0._wp qb = 0._wp ! set configs tempo_cfgs % turn_off_micro_flag = . true . total_timesteps = int ( integration_time / dt ) do itimestep = 1 , total_timesteps call tempo_run ( tempo_cfgs = tempo_cfgs , itimestep = itimestep , dt = dt , & ids = ids , ide = ide , ims = ims , ime = ime , its = its , ite = ite , & jds = jds , jde = jde , jms = jms , jme = jme , jts = jts , jte = jte , & kds = kds , kde = kde , kms = kms , kme = kme , kts = kts , kte = kte , & t = t , p = p , w = w , dz = dz , qv = qv , th = th , pii = pii , & qc = qc , nc = nc , qr = qr , qi = qi , qs = qs , qg = qg , ni = ni , nr = nr , & tempo_diags = tempo_driver_diags ) if ( itimestep == 1 ) then open ( newunit = io3 , file = \"cloud_number_init.txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io3 , '(I5, 4E12.4)' ) k , qc ( 1 , k , 1 ), nc ( 1 , k , 1 ) enddo endif enddo write ( tt_string , '(I7)' ) integration_time open ( newunit = io4 , file = \"cloud_number_dt_\" // trim ( adjustl ( dt_string )) // & \"_runtime\" // trim ( adjustl ( tt_string )) // \".txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io4 , '(I5, 4E12.4)' ) k , qc ( 1 , k , 1 ), nc ( 1 , k , 1 ) enddo end subroutine test_cloud_number_aerosolaware subroutine test_cloud_number_non_aerosolaware ( dt ) use module_mp_tempo_params , only : wp , sp , dp integer :: itimestep real ( wp ), intent ( in ) :: dt integer , parameter :: nz = 59 integer , parameter :: ids = 1 , ide = 1 , ims = 1 , ime = 1 , its = 1 , ite = 1 integer , parameter :: jds = 1 , jde = 1 , jms = 1 , jme = 1 , jts = 1 , jte = 1 integer , parameter :: kds = 1 , kde = nz , kms = 1 , kme = nz , kts = 1 , kte = nz real ( wp ), dimension ( its : ite , kts : kte , jts : jte ) :: qv , t , th , pii , p , w , dz , & qc , qr , qi , qs , qg , ni , nr , ng , qb , nc real ( wp ), dimension ( nz ) :: klevs_in , qv_in , qc_in , qr_in , qi_in , qs_in , & qg_in , ni_in , nr_in , nc_in , nwfa_in , nifa_in , theta_in , ng_in , volg_in , & pressure_in , w_in , dz_in real ( wp ) :: precip_sum character ( len = 20 ) :: dt_string , tt_string type ( ty_tempo_driver_diags ) :: tempo_driver_diags type ( ty_tempo_cfgs ) :: tempo_cfgs integer :: io1 , io2 , io3 , io4 , k , total_timesteps integer , parameter :: integration_time = 1200 write ( dt_string , '(I7)' ) int ( dt ) ! read input file io1 = 11 open ( io1 , file = '../test/data/mpas_59lev_test.txt' , status = 'old' ) read ( io1 , * ) ! header do k = 1 , nz read ( io1 , * ) klevs_in ( k ), qv_in ( k ), qc_in ( k ), qr_in ( k ), qi_in ( k ), qs_in ( k ), & qg_in ( k ), ni_in ( k ), nr_in ( k ), nc_in ( k ), nwfa_in ( k ), nifa_in ( k ), & theta_in ( k ), ng_in ( k ), volg_in ( k ), pressure_in ( k ), w_in ( k ), dz_in ( k ) end do close ( io1 ) qv ( 1 ,:, 1 ) = qv_in t ( 1 ,:, 1 ) = theta_in * ( pressure_in / 10000 0. ) ** 0.286 p ( 1 ,:, 1 ) = pressure_in dz ( 1 ,:, 1 ) = dz_in w ( 1 ,:, 1 ) = w_in qc ( 1 ,:, 1 ) = qc_in nc ( 1 ,:, 1 ) = 0._wp qr ( 1 ,:, 1 ) = qr_in nr ( 1 ,:, 1 ) = nr_in qi ( 1 ,:, 1 ) = qi_in qs ( 1 ,:, 1 ) = qs_in ni ( 1 ,:, 1 ) = ni_in qg = 0._wp ng = 0._wp qb = 0._wp ! set configs tempo_cfgs % turn_off_micro_flag = . true . tempo_cfgs % cloud_number_mixing_ratio_flag = . true . tempo_cfgs % ml_for_nc_flag = . false . total_timesteps = int ( integration_time / dt ) do itimestep = 1 , total_timesteps call tempo_run ( tempo_cfgs = tempo_cfgs , itimestep = itimestep , dt = dt , & ids = ids , ide = ide , ims = ims , ime = ime , its = its , ite = ite , & jds = jds , jde = jde , jms = jms , jme = jme , jts = jts , jte = jte , & kds = kds , kde = kde , kms = kms , kme = kme , kts = kts , kte = kte , & t = t , p = p , w = w , dz = dz , qv = qv , th = th , pii = pii , & qc = qc , qr = qr , qi = qi , qs = qs , qg = qg , ni = ni , nr = nr , & tempo_diags = tempo_driver_diags ) if ( itimestep == 1 ) then open ( newunit = io3 , file = \"cloud_number_constant_init.txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io3 , '(I5, 4E12.4)' ) k , qc ( 1 , k , 1 ), tempo_driver_diags % cloud_number_mixing_ratio ( 1 , k , 1 ) enddo endif enddo write ( tt_string , '(I7)' ) integration_time open ( newunit = io4 , file = \"cloud_number_constant_dt_\" // trim ( adjustl ( dt_string )) // & \"_runtime\" // trim ( adjustl ( tt_string )) // \".txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io4 , '(I5, 4E12.4)' ) k , qc ( 1 , k , 1 ), tempo_driver_diags % cloud_number_mixing_ratio ( 1 , k , 1 ) enddo end subroutine test_cloud_number_non_aerosolaware subroutine test_cloud_number_ml ( dt ) use module_mp_tempo_params , only : wp , sp , dp integer :: itimestep real ( wp ), intent ( in ) :: dt integer , parameter :: nz = 59 integer , parameter :: ids = 1 , ide = 1 , ims = 1 , ime = 1 , its = 1 , ite = 1 integer , parameter :: jds = 1 , jde = 1 , jms = 1 , jme = 1 , jts = 1 , jte = 1 integer , parameter :: kds = 1 , kde = nz , kms = 1 , kme = nz , kts = 1 , kte = nz real ( wp ), dimension ( its : ite , kts : kte , jts : jte ) :: qv , t , th , pii , p , w , dz , & qc , qr , qi , qs , qg , ni , nr , ng , qb , nc real ( wp ), dimension ( nz ) :: klevs_in , qv_in , qc_in , qr_in , qi_in , qs_in , & qg_in , ni_in , nr_in , nc_in , nwfa_in , nifa_in , theta_in , ng_in , volg_in , & pressure_in , w_in , dz_in real ( wp ) :: precip_sum character ( len = 20 ) :: dt_string , tt_string type ( ty_tempo_driver_diags ) :: tempo_driver_diags type ( ty_tempo_cfgs ) :: tempo_cfgs integer :: io1 , io2 , io3 , io4 , k , total_timesteps integer , parameter :: integration_time = 1200 write ( dt_string , '(I7)' ) int ( dt ) ! read input file io1 = 11 open ( io1 , file = '../test/data/mpas_59lev_test.txt' , status = 'old' ) read ( io1 , * ) ! header do k = 1 , nz read ( io1 , * ) klevs_in ( k ), qv_in ( k ), qc_in ( k ), qr_in ( k ), qi_in ( k ), qs_in ( k ), & qg_in ( k ), ni_in ( k ), nr_in ( k ), nc_in ( k ), nwfa_in ( k ), nifa_in ( k ), & theta_in ( k ), ng_in ( k ), volg_in ( k ), pressure_in ( k ), w_in ( k ), dz_in ( k ) end do close ( io1 ) qv ( 1 ,:, 1 ) = qv_in t ( 1 ,:, 1 ) = theta_in * ( pressure_in / 10000 0. ) ** 0.286 p ( 1 ,:, 1 ) = pressure_in dz ( 1 ,:, 1 ) = dz_in w ( 1 ,:, 1 ) = w_in qc ( 1 ,:, 1 ) = qc_in nc ( 1 ,:, 1 ) = 0._wp qr ( 1 ,:, 1 ) = qr_in nr ( 1 ,:, 1 ) = nr_in qi ( 1 ,:, 1 ) = qi_in qs ( 1 ,:, 1 ) = qs_in ni ( 1 ,:, 1 ) = ni_in qg = 0._wp ng = 0._wp qb = 0._wp ! set configs tempo_cfgs % turn_off_micro_flag = . true . tempo_cfgs % cloud_number_mixing_ratio_flag = . true . tempo_cfgs % ml_for_nc_flag = . true . total_timesteps = int ( integration_time / dt ) do itimestep = 1 , total_timesteps call tempo_run ( tempo_cfgs = tempo_cfgs , itimestep = itimestep , dt = dt , & ids = ids , ide = ide , ims = ims , ime = ime , its = its , ite = ite , & jds = jds , jde = jde , jms = jms , jme = jme , jts = jts , jte = jte , & kds = kds , kde = kde , kms = kms , kme = kme , kts = kts , kte = kte , & t = t , p = p , w = w , dz = dz , qv = qv , th = th , pii = pii , & qc = qc , qr = qr , qi = qi , qs = qs , qg = qg , ni = ni , nr = nr , & tempo_diags = tempo_driver_diags ) if ( itimestep == 1 ) then open ( newunit = io3 , file = \"cloud_number_ml_init.txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io3 , '(I5, 4E12.4)' ) k , qc ( 1 , k , 1 ), tempo_driver_diags % cloud_number_mixing_ratio ( 1 , k , 1 ) enddo endif enddo write ( tt_string , '(I7)' ) integration_time open ( newunit = io4 , file = \"cloud_number_ml_dt_\" // trim ( adjustl ( dt_string )) // & \"_runtime\" // trim ( adjustl ( tt_string )) // \".txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io4 , '(I5, 4E12.4)' ) k , qc ( 1 , k , 1 ), tempo_driver_diags % cloud_number_mixing_ratio ( 1 , k , 1 ) enddo end subroutine test_cloud_number_ml subroutine test_ml_cloud_effective_radius ( dt ) use module_mp_tempo_params , only : wp , sp , dp integer :: itimestep real ( wp ), intent ( in ) :: dt integer , parameter :: nz = 59 integer , parameter :: ids = 1 , ide = 1 , ims = 1 , ime = 1 , its = 1 , ite = 1 integer , parameter :: jds = 1 , jde = 1 , jms = 1 , jme = 1 , jts = 1 , jte = 1 integer , parameter :: kds = 1 , kde = nz , kms = 1 , kme = nz , kts = 1 , kte = nz real ( wp ), dimension ( its : ite , kts : kte , jts : jte ) :: qv , t , th , pii , p , w , dz , & qc , qr , qi , qs , qg , ni , nr , ng , qb , nc , qc_bl , qcfrac_bl real ( wp ), dimension ( nz ) :: klevs_in , qv_in , qc_in , qr_in , qi_in , qs_in , & qg_in , ni_in , nr_in , nc_in , nwfa_in , nifa_in , theta_in , ng_in , volg_in , & pressure_in , w_in , dz_in real ( wp ) :: precip_sum character ( len = 20 ) :: dt_string , tt_string type ( ty_tempo_driver_diags ) :: tempo_driver_diags type ( ty_tempo_cfgs ) :: tempo_cfgs integer :: io1 , io2 , io3 , io4 , k , total_timesteps integer , parameter :: integration_time = 1200 write ( dt_string , '(I7)' ) int ( dt ) ! read input file io1 = 11 open ( io1 , file = '../test/data/mpas_59lev_test.txt' , status = 'old' ) read ( io1 , * ) ! header do k = 1 , nz read ( io1 , * ) klevs_in ( k ), qv_in ( k ), qc_in ( k ), qr_in ( k ), qi_in ( k ), qs_in ( k ), & qg_in ( k ), ni_in ( k ), nr_in ( k ), nc_in ( k ), nwfa_in ( k ), nifa_in ( k ), & theta_in ( k ), ng_in ( k ), volg_in ( k ), pressure_in ( k ), w_in ( k ), dz_in ( k ) end do close ( io1 ) qv ( 1 ,:, 1 ) = qv_in t ( 1 ,:, 1 ) = theta_in * ( pressure_in / 10000 0. ) ** 0.286 p ( 1 ,:, 1 ) = pressure_in dz ( 1 ,:, 1 ) = dz_in w ( 1 ,:, 1 ) = w_in qc ( 1 ,:, 1 ) = qc_in nc ( 1 ,:, 1 ) = nc_in qr ( 1 ,:, 1 ) = qr_in nr ( 1 ,:, 1 ) = nr_in qi ( 1 ,:, 1 ) = qi_in qs ( 1 ,:, 1 ) = qs_in ni ( 1 ,:, 1 ) = ni_in qc_bl ( 1 ,:, 1 ) = 0._wp qcfrac_bl ( 1 ,:, 1 ) = 0._wp do k = 1 , nz if ( k < 20 ) then qc_bl ( 1 , k , 1 ) = qc_in ( k + 15 ) * 0.2_wp endif if ( qc_bl ( 1 , k , 1 ) > 0._wp ) then qcfrac_bl ( 1 , k , 1 ) = 0.35_wp endif enddo qg = 0._wp ng = 0._wp qb = 0._wp ! set configs tempo_cfgs % turn_off_micro_flag = . true . tempo_cfgs % ml_for_bl_nc_flag = . true . tempo_cfgs % cloud_number_mixing_ratio_flag = . true . total_timesteps = int ( integration_time / dt ) do itimestep = 1 , total_timesteps call tempo_run ( tempo_cfgs = tempo_cfgs , itimestep = itimestep , dt = dt , & ids = ids , ide = ide , ims = ims , ime = ime , its = its , ite = ite , & jds = jds , jde = jde , jms = jms , jme = jme , jts = jts , jte = jte , & kds = kds , kde = kde , kms = kms , kme = kme , kts = kts , kte = kte , & t = t , p = p , w = w , dz = dz , qv = qv , th = th , pii = pii , & qc_bl = qc_bl , qcfrac_bl = qcfrac_bl , & qc = qc , nc = nc , qr = qr , qi = qi , qs = qs , qg = qg , ni = ni , nr = nr , & tempo_diags = tempo_driver_diags ) if ( itimestep == 1 ) then open ( newunit = io3 , file = \"cloud_re_init.txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io3 , '(I5, 5E12.4)' ) k , qc ( 1 , k , 1 ), qc_bl ( 1 , k , 1 ), qcfrac_bl ( 1 , k , 1 ), & tempo_driver_diags % cloud_number_mixing_ratio ( 1 , k , 1 ), tempo_driver_diags % re_cloud ( 1 , k , 1 ) * 1.e6_wp enddo endif enddo write ( tt_string , '(I7)' ) integration_time open ( newunit = io4 , file = \"cloud_re_dt_\" // trim ( adjustl ( dt_string )) // & \"_runtime\" // trim ( adjustl ( tt_string )) // \".txt\" , status = \"new\" , action = \"write\" ) do k = 1 , nz write ( io4 , '(I5, 5E12.4)' ) k , qc ( 1 , k , 1 ), qc_bl ( 1 , k , 1 ), qcfrac_bl ( 1 , k , 1 ), & tempo_driver_diags % cloud_number_mixing_ratio ( 1 , k , 1 ), tempo_driver_diags % re_cloud ( 1 , k , 1 ) * 1.e6_wp enddo end subroutine test_ml_cloud_effective_radius end module tests","tags":"","url":"sourcefile/tests.f90.html"},{"title":"module_mp_tempo_driver.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~module_mp_tempo_driver.f90~~EfferentGraph sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_cfgs.f90 module_mp_tempo_cfgs.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~module_mp_tempo_ml.f90 module_mp_tempo_ml.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_aerosols.f90 module_mp_tempo_aerosols.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_aerosols.f90 sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_diags.f90 sourcefile~module_mp_tempo_ml.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_aerosols.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_utils.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~module_mp_tempo_driver.f90~~AfferentGraph sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_driver !! tempo driver that converts 3d model input to 1d arrays used by the main code !! also allocates and fills diagnostic arrays use module_mp_tempo_cfgs , only : ty_tempo_cfgs , ty_tempo_table_cfgs use module_mp_tempo_params , only : wp , sp , dp use module_mp_tempo_main , only : tempo_main , ty_tempo_main_diags use module_mp_tempo_utils , only : compute_efrw , compute_efsw , compute_drop_evap , qi_aut_qs use module_mp_tempo_ml , only : ty_tempo_ml_data , nc_ml_nodes , nc_ml_input , nc_ml_output , & nc_ml_trans_mean , nc_ml_trans_var , nc_ml_w00 , nc_ml_w01 , nc_ml_b00 , nc_ml_b01 , save_or_read_ml_data implicit none private public :: tempo_init , tempo_run , ty_tempo_driver_diags , tempo_aerosol_surface_emissions type ( ty_tempo_table_cfgs ) :: tempo_table_cfgs type :: ty_tempo_driver_diags real ( wp ), dimension (:,:), allocatable :: rain_precip real ( wp ), dimension (:,:), allocatable :: ice_liquid_equiv_precip real ( wp ), dimension (:,:), allocatable :: snow_liquid_equiv_precip real ( wp ), dimension (:,:), allocatable :: graupel_liquid_equiv_precip real ( wp ), dimension (:,:), allocatable :: frozen_fraction real ( wp ), dimension (:,:), allocatable :: frz_rain_precip real ( wp ), dimension (:,:), allocatable :: max_hail_diameter_sfc real ( wp ), dimension (:,:), allocatable :: max_hail_diameter_column real ( wp ), dimension (:,:,:), allocatable :: refl10cm real ( wp ), dimension (:,:,:), allocatable :: re_cloud real ( wp ), dimension (:,:,:), allocatable :: re_ice real ( wp ), dimension (:,:,:), allocatable :: re_snow real ( wp ), dimension (:,:,:), allocatable :: rain_med_vol_diam real ( wp ), dimension (:,:,:), allocatable :: graupel_med_vol_diam real ( wp ), dimension (:,:,:), allocatable :: cloud_number_mixing_ratio end type contains !> initialize tempo microphysics !! \\section arg_table_tempo_init Argument Table !! \\htmlinclude tempo_init.html !! subroutine tempo_init ( aerosolaware_flag , hailaware_flag , & ml_for_bl_nc_flag , ml_for_nc_flag , force_init_flag , tempo_cfgs ) !! initialize tempo microphysics use module_mp_tempo_params , only : get_version , tempo_version , t_efrw , & initialize_graupel_vars , initialize_parameters , initialize_bins_for_tables , & initialize_array_efrw , initialize_array_efsw , initialize_arrays_drop_evap , & initialize_arrays_ccn , initialize_arrays_qi_aut_qs , & initialize_arrays_qr_acr_qs , initialize_arrays_qr_acr_qg , initialize_arrays_freezewater , & initialize_bins_for_hail_size , initialize_bins_for_radar logical , intent ( in ), optional :: aerosolaware_flag , hailaware_flag , & ml_for_bl_nc_flag , ml_for_nc_flag , force_init_flag type ( ty_tempo_cfgs ), intent ( out ) :: tempo_cfgs character ( len = 100 ) :: table_filename integer :: table_size logical :: initialize_mp_vars , force_init ! get tempo version from readme file call get_version ( tempo_version ) ! check an allocatable array (t_efrw) to see if initialization can be skipped ! but allow for force initialization useful for testing force_init = . false . if ( present ( force_init_flag )) force_init = force_init_flag initialize_mp_vars = . true . if ( allocated ( t_efrw )) initialize_mp_vars = . false . if ( force_init ) initialize_mp_vars = . true . if ( initialize_mp_vars ) then if ( present ( aerosolaware_flag )) tempo_cfgs % aerosolaware_flag = aerosolaware_flag if ( present ( hailaware_flag )) tempo_cfgs % hailaware_flag = hailaware_flag if ( present ( ml_for_bl_nc_flag )) tempo_cfgs % ml_for_bl_nc_flag = ml_for_bl_nc_flag if ( present ( ml_for_nc_flag )) tempo_cfgs % ml_for_nc_flag = ml_for_nc_flag if ( tempo_cfgs % verbose ) then write ( * , '(A)' ) 'tempo_init() --- TEMPO microphysics configuration options: ' write ( * , '(A,L)' ) 'tempo_init() --- aerosol aware = ' , tempo_cfgs % aerosolaware_flag write ( * , '(A,L)' ) 'tempo_init() --- hail aware = ' , tempo_cfgs % hailaware_flag write ( * , '(A,L)' ) 'tempo_init() --- ML for subgrid cloud number = ' , tempo_cfgs % ml_for_bl_nc_flag write ( * , '(A,L)' ) 'tempo_init() --- ML for cloud number = ' , tempo_cfgs % ml_for_nc_flag endif ! set graupel variables from hail_aware_flag call initialize_graupel_vars ( tempo_cfgs % hailaware_flag ) if ( tempo_cfgs % verbose ) then write ( * , '(A,L)' ) 'tempo_init() --- initialized graupel variables using hail aware = ' , tempo_cfgs % hailaware_flag endif ! set parameters that can depend on the host model call initialize_parameters () if ( tempo_cfgs % verbose ) write ( * , '(A)' ) 'tempo_init() --- initialized parameters' ! creates log-spaced bins of hydrometers for tables call initialize_bins_for_tables () if ( tempo_cfgs % verbose ) write ( * , '(A)' ) 'tempo_init() --- initialized bins for lookup tables' ! collision efficiencies between rain/snow and cloud water. call initialize_array_efrw () call compute_efrw () if ( tempo_cfgs % verbose ) then write ( * , '(A)' ) 'tempo_init() --- initialized collision efficiency data for rain collecting cloud water' endif call initialize_array_efsw () call compute_efsw () if ( tempo_cfgs % verbose ) then write ( * , '(A)' ) 'tempo_init() --- initialized collision efficiency data for snow collecting cloud water' endif ! drop evaporation call initialize_arrays_drop_evap () call compute_drop_evap () if ( tempo_cfgs % verbose ) write ( * , '(A)' ) 'tempo_init() --- initialized drop evaporation data' ! cloud ice to snow and depositional growth call initialize_arrays_qi_aut_qs () call qi_aut_qs () ! CCN activation table table_filename = tempo_table_cfgs % ccn_table_name call initialize_arrays_ccn ( table_size ) call read_table_ccn ( trim ( table_filename ), table_size ) if ( tempo_cfgs % verbose ) write ( * , '(A)' ) 'tempo_init() --- initialized data for ccn lookup table' ! freeze water collection lookup table table_filename = tempo_table_cfgs % freezewater_table_name call initialize_arrays_freezewater ( table_size ) call read_table_freezewater ( trim ( table_filename ), table_size ) if ( tempo_cfgs % verbose ) then write ( * , '(A)' ) 'tempo_init() --- initialized data for frozen cloud water and rain lookup table' endif ! rain-snow collection lookup table table_filename = tempo_table_cfgs % qrqs_table_name call initialize_arrays_qr_acr_qs ( table_size ) call read_table_qr_acr_qs ( trim ( table_filename ), table_size ) if ( tempo_cfgs % verbose ) then write ( * , '(A)' ) 'tempo_init() --- initialized data for rain-snow collection lookup table' endif ! rain-graupel collection lookup table table_filename = tempo_table_cfgs % qrqg_table_name call initialize_arrays_qr_acr_qg ( table_size ) call read_table_qr_acr_qg ( trim ( table_filename ), table_size ) if ( tempo_cfgs % verbose ) then write ( * , '(A)' ) 'tempo_init() --- initialized data for rain-graupel collection lookup table' endif ! bins used for optional refl10cm calculation with melting if ( tempo_cfgs % refl10cm_from_melting_flag ) then call initialize_bins_for_radar () if ( tempo_cfgs % verbose ) then write ( * , '(A,L)' ) 'tempo_init() ---  flag to calcuate reflectivity with contributions from melting snow and graupel = ' , & tempo_cfgs % refl10cm_from_melting_flag write ( * , '(A)' ) 'tempo_init() --- initialized bins for reflectivity calcuation with meting snow and graupel' endif endif ! bins used for optional hail size calculation if ( tempo_cfgs % max_hail_diameter_flag ) then call initialize_bins_for_hail_size () if ( tempo_cfgs % verbose ) then write ( * , '(A,L)' ) 'tempo_init() ---  flag to calculate max hail diameter = ' , & tempo_cfgs % max_hail_diameter_flag write ( * , '(A)' ) 'tempo_init() --- initialized bins for hail size calculation' endif endif ! data for machine learning if ( tempo_cfgs % ml_for_bl_nc_flag . or . tempo_cfgs % ml_for_nc_flag ) then call init_ml_data () if ( tempo_cfgs % verbose ) write ( * , '(A)' ) 'tempo_init() --- initialized data for cloud number machine learning' endif endif end subroutine tempo_init !> \\section arg_table_tempo_run Argument Table !! \\htmlinclude tempo_run.html !! subroutine tempo_run ( tempo_cfgs , dt , itimestep , & t , th , pii , p , w , dz , & qv , qc , qr , qi , qs , qg , ni , nr , & nc , nwfa , nifa , ng , qb , & qc_bl , qcfrac_bl , & qcfrac , qifrac , & thten_bl , qvten_bl , qcten_bl , qiten_bl , & thten_lwrad , thten_swrad , & ids , ide , jds , jde , kds , kde , & ims , ime , jms , jme , kms , kme , & its , ite , jts , jte , kts , kte , tempo_diags ) type ( ty_tempo_cfgs ), intent ( in ) :: tempo_cfgs real ( wp ), intent ( in ) :: dt !! timestep [s]] integer , intent ( in ) :: itimestep !! integer timestep = integration time / dt integer , intent ( in ) :: ids , ide , jds , jde , kds , kde !! domain locations integer , intent ( in ) :: ims , ime , jms , jme , kms , kme !! memory locations integer , intent ( in ) :: its , ite , jts , jte , kts , kte !! tile locations real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: t !! temperature [K] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: th !! theta [K] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ) :: p !! pressure [Pa] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ) :: w !! vertical velocity [m\\; s&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ) :: dz !! vertical grid spacing [m] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: pii !! exner function real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: qv !! 3D water vapor mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: qc !! 3D cloud water mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: qr !! 3D rain water mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: qi !! 3D cloud ice mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: qs !! 3D snow mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: qg !! 3D graupel mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: ni !! 3D cloud ice number mixing ratio [kg&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: nr !! 3D rain water number mixing ratio [kg&#94;{-1}] real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: nc !! 3D cloud water number mixing ratio [kg&#94;{-1}] (aerosol-aware) real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: nwfa !! 3D water-friendly aerosol number mixing ratio [kg&#94;{-1}] (aerosol-aware) real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: nifa !! 3D ice-friendly aerosol number mixing ratio [kg&#94;{-1}] (aerosol-aware) real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: qb !! 3D graupel volume mixing ratio [m&#94;{-3}\\; kg&#94;{-1}] (hail-aware) real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: ng !! 3D graupel number mixing ratio [kg&#94;{-1}] (hail-aware) ! additional optional arguments real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: qcfrac real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ), optional :: qifrac real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: qc_bl real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: qcfrac_bl real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: thten_bl real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: qvten_bl real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: qcten_bl real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: qiten_bl real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: thten_lwrad real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( in ), optional :: thten_swrad real ( wp ), dimension ( kts : kte ) :: t1d !! 1D temperature [K] real ( wp ), dimension ( kts : kte ) :: p1d !! 1D pressure [Pa] real ( wp ), dimension ( kts : kte ) :: qv1d !! 1D water vapor mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: qc1d !! 1D cloud water mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: qr1d !! 1D rain water mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: qi1d !! 1D cloud ice mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: qs1d !! 1D snow mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: qg1d !! 1D graupel mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: ni1d !! 1D cloud ice number mixing ratio [kg&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: nr1d !! 1D rain water number mixing ratio [kg&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: w1d !! 1D vertical velocity m\\; s&#94;{-1}] real ( wp ), dimension ( kts : kte ) :: dz1d !! 1D vertical grid spacing [m] real ( wp ), dimension (:), allocatable :: nc1d !! 1D cloud water number mixing ratio [kg&#94;{-1}] (aerosol-aware) real ( wp ), dimension (:), allocatable :: nwfa1d !! 1D water-friendly aerosol number mixing ratio [kg&#94;{-1}] (aerosol-aware) real ( wp ), dimension (:), allocatable :: nifa1d !! 1D ice-friendly aerosol number mixing ratio [kg&#94;{-1}] (aerosol-aware) real ( wp ), dimension (:), allocatable :: qb1d !! 1D graupel volume mixing ratio [m&#94;{-3}\\; kg&#94;{-1}] (hail-aware) real ( wp ), dimension (:), allocatable :: ng1d !! 1D graupel number mixing ratio [kg&#94;{-1}] (hail-aware) ! additional optional 1d arrays real ( wp ), dimension (:), allocatable :: qcfrac1d real ( wp ), dimension (:), allocatable :: qifrac1d real ( wp ), dimension (:), allocatable :: qc_bl1d real ( wp ), dimension (:), allocatable :: qcfrac_bl1d real ( wp ), dimension (:), allocatable :: thten_bl1d real ( wp ), dimension (:), allocatable :: qvten_bl1d real ( wp ), dimension (:), allocatable :: qcten_bl1d real ( wp ), dimension (:), allocatable :: qiten_bl1d real ( wp ), dimension (:), allocatable :: thten_lwrad1d real ( wp ), dimension (:), allocatable :: thten_swrad1d integer :: i , j , k , nz logical :: use_temperature type ( ty_tempo_main_diags ) :: tempo_main_diags type ( ty_tempo_driver_diags ), intent ( out ) :: tempo_diags nz = kte - kts + 1 ! allocate 1d arrays if 3d arrays are present if ( present ( nwfa )) allocate ( nwfa1d ( nz ), source = 0._wp ) if ( present ( nifa )) allocate ( nifa1d ( nz ), source = 0._wp ) if ( present ( nc )) allocate ( nc1d ( nz ), source = 0._wp ) if ( present ( ng )) allocate ( ng1d ( nz ), source = 0._wp ) if ( present ( qb )) allocate ( qb1d ( nz ), source = 0._wp ) ! additional optional 1d arrays if ( present ( qcfrac )) allocate ( qcfrac1d ( nz ), source = 0._wp ) if ( present ( qifrac )) allocate ( qifrac1d ( nz ), source = 0._wp ) if ( present ( qc_bl )) allocate ( qc_bl1d ( nz ), source = 0._wp ) if ( present ( qcfrac_bl )) allocate ( qcfrac_bl1d ( nz ), source = 0._wp ) if ( present ( thten_bl )) allocate ( thten_bl1d ( nz ), source = 0._wp ) if ( present ( qvten_bl )) allocate ( qvten_bl1d ( nz ), source = 0._wp ) if ( present ( qcten_bl )) allocate ( qcten_bl1d ( nz ), source = 0._wp ) if ( present ( qiten_bl )) allocate ( qiten_bl1d ( nz ), source = 0._wp ) if ( present ( thten_lwrad )) allocate ( thten_lwrad1d ( nz ), source = 0._wp ) if ( present ( thten_swrad )) allocate ( thten_swrad1d ( nz ), source = 0._wp ) ! allocate diagnostics ! 3d diagnostics have configuration flags if ( tempo_cfgs % cloud_number_mixing_ratio_flag ) allocate ( tempo_diags % cloud_number_mixing_ratio ( its : ite , kts : kte , jts : jte ), source = 0._wp ) if ( tempo_cfgs % rain_med_vol_diam_flag ) allocate ( tempo_diags % rain_med_vol_diam ( its : ite , kts : kte , jts : jte ), source = 0._wp ) if ( tempo_cfgs % graupel_med_vol_diam_flag ) allocate ( tempo_diags % graupel_med_vol_diam ( its : ite , kts : kte , jts : jte ), source = 0._wp ) if ( tempo_cfgs % refl10cm_flag ) allocate ( tempo_diags % refl10cm ( its : ite , kts : kte , jts : jte ), source =- 3 5._wp ) if ( tempo_cfgs % re_cloud_flag ) allocate ( tempo_diags % re_cloud ( its : ite , kts : kte , jts : jte ), source = 0._wp ) if ( tempo_cfgs % re_ice_flag ) allocate ( tempo_diags % re_ice ( its : ite , kts : kte , jts : jte ), source = 0._wp ) if ( tempo_cfgs % re_snow_flag ) allocate ( tempo_diags % re_snow ( its : ite , kts : kte , jts : jte ), source = 0._wp ) if ( tempo_cfgs % max_hail_diameter_flag ) allocate ( tempo_diags % max_hail_diameter_sfc ( its : ite , jts : jte ), source = 0._wp ) if ( tempo_cfgs % max_hail_diameter_flag ) allocate ( tempo_diags % max_hail_diameter_column ( its : ite , jts : jte ), source = 0._wp ) ! precipitation allocate ( tempo_diags % rain_precip ( its : ite , jts : jte ), source = 0._wp ) allocate ( tempo_diags % ice_liquid_equiv_precip ( its : ite , jts : jte ), source = 0._wp ) allocate ( tempo_diags % snow_liquid_equiv_precip ( its : ite , jts : jte ), source = 0._wp ) allocate ( tempo_diags % graupel_liquid_equiv_precip ( its : ite , jts : jte ), source = 0._wp ) allocate ( tempo_diags % frozen_fraction ( its : ite , jts : jte ), source = 0._wp ) allocate ( tempo_diags % frz_rain_precip ( its : ite , jts : jte ), source = 0._wp ) ! temperature or theta and exner if ( present ( t )) then use_temperature = . true . elseif ( present ( th ) . and . present ( pii )) then use_temperature = . false . else error stop \"tempo_run() --- requires either temperature or theta and Exner function\" endif ! tempo driver code do j = jts , jte do i = its , ite do k = kts , kte if ( use_temperature ) then t1d ( k ) = t ( i , k , j ) else t1d ( k ) = th ( i , k , j ) * pii ( i , k , j ) endif p1d ( k ) = p ( i , k , j ) w1d ( k ) = w ( i , k , j ) dz1d ( k ) = dz ( i , k , j ) qv1d ( k ) = qv ( i , k , j ) qc1d ( k ) = qc ( i , k , j ) qi1d ( k ) = qi ( i , k , j ) qr1d ( k ) = qr ( i , k , j ) qs1d ( k ) = qs ( i , k , j ) qg1d ( k ) = qg ( i , k , j ) ni1d ( k ) = ni ( i , k , j ) nr1d ( k ) = nr ( i , k , j ) ! nwfa, nifa, and nc are optional aerosol-aware variables if ( present ( nwfa )) nwfa1d ( k ) = nwfa ( i , k , j ) if ( present ( nifa )) nifa1d ( k ) = nifa ( i , k , j ) if ( present ( nc )) nc1d ( k ) = nc ( i , k , j ) ! ng and qb are optional hail-aware variables if (( present ( ng )) . and . ( present ( qb ))) then ng1d ( k ) = ng ( i , k , j ) qb1d ( k ) = qb ( i , k , j ) endif ! machine learning for pbl clouds if ( present ( qc_bl ) . and . present ( qcfrac_bl )) then qc_bl1d ( k ) = qc_bl ( i , k , j ) qcfrac_bl1d ( k ) = qcfrac_bl ( i , k , j ) endif enddo ! main call to the 1d tempo microphysics call tempo_main ( tempo_cfgs = tempo_cfgs , & qv1d = qv1d , qc1d = qc1d , qi1d = qi1d , qr1d = qr1d , qs1d = qs1d , qg1d = qg1d , qb1d = qb1d , & ni1d = ni1d , nr1d = nr1d , nc1d = nc1d , ng1d = ng1d , nwfa1d = nwfa1d , nifa1d = nifa1d , t1d = t1d , p1d = p1d , & w1d = w1d , dz1d = dz1d , & qcfrac1d = qcfrac1d , qifrac1d = qifrac1d , qc_bl1d = qc_bl1d , qcfrac_bl1d = qcfrac_bl1d , & thten_bl1d = thten_bl1d , qvten_bl1d = qvten_bl1d , qcten_bl1d = qcten_bl1d , qiten_bl1d = qiten_bl1d , & thten_lwrad1d = thten_lwrad1d , thten_swrad1d = thten_swrad1d , & kts = kts , kte = kte , dt = dt , ii = i , jj = j , tempo_main_diags = tempo_main_diags ) ! precipitation tempo_diags % rain_precip ( i , j ) = tempo_main_diags % rain_precip tempo_diags % ice_liquid_equiv_precip ( i , j ) = tempo_main_diags % ice_liquid_equiv_precip tempo_diags % snow_liquid_equiv_precip ( i , j ) = tempo_main_diags % snow_liquid_equiv_precip tempo_diags % graupel_liquid_equiv_precip ( i , j ) = tempo_main_diags % graupel_liquid_equiv_precip tempo_diags % frozen_fraction ( i , j ) = tempo_main_diags % frozen_fraction tempo_diags % frz_rain_precip ( i , j ) = tempo_main_diags % frz_rain_precip ! 3d diagnostics if ( allocated ( tempo_diags % cloud_number_mixing_ratio ) . and . allocated ( tempo_main_diags % cloud_number_mixing_ratio )) then tempo_diags % cloud_number_mixing_ratio ( i ,:, j ) = tempo_main_diags % cloud_number_mixing_ratio endif if ( allocated ( tempo_diags % rain_med_vol_diam ) . and . allocated ( tempo_main_diags % rain_med_vol_diam )) then tempo_diags % rain_med_vol_diam ( i ,:, j ) = tempo_main_diags % rain_med_vol_diam endif if ( allocated ( tempo_diags % graupel_med_vol_diam ) . and . allocated ( tempo_main_diags % graupel_med_vol_diam )) then tempo_diags % graupel_med_vol_diam ( i ,:, j ) = tempo_main_diags % graupel_med_vol_diam endif if ( allocated ( tempo_diags % re_cloud ) . and . allocated ( tempo_main_diags % re_cloud )) then tempo_diags % re_cloud ( i ,:, j ) = tempo_main_diags % re_cloud endif if ( allocated ( tempo_diags % re_ice ) . and . allocated ( tempo_main_diags % re_ice )) then tempo_diags % re_ice ( i ,:, j ) = tempo_main_diags % re_ice endif if ( allocated ( tempo_diags % re_snow ) . and . allocated ( tempo_main_diags % re_snow )) then tempo_diags % re_snow ( i ,:, j ) = tempo_main_diags % re_snow endif if ( allocated ( tempo_diags % refl10cm ) . and . allocated ( tempo_main_diags % refl10cm )) then tempo_diags % refl10cm ( i ,:, j ) = tempo_main_diags % refl10cm endif if ( allocated ( tempo_diags % max_hail_diameter_sfc ) . and . allocated ( tempo_diags % max_hail_diameter_column ) . and . allocated ( tempo_main_diags % max_hail_diameter )) then tempo_diags % max_hail_diameter_sfc ( i , j ) = tempo_main_diags % max_hail_diameter ( 1 ) tempo_diags % max_hail_diameter_column ( i , j ) = maxval ( tempo_main_diags % max_hail_diameter ) endif ! return variables to model do k = kts , kte if ( present ( nc )) nc ( i , k , j ) = nc1d ( k ) if ( present ( nwfa )) nwfa ( i , k , j ) = nwfa1d ( k ) if ( present ( nifa )) nifa ( i , k , j ) = nifa1d ( k ) if (( present ( ng )) . and . ( present ( qb ))) then ng ( i , k , j ) = ng1d ( k ) qb ( i , k , j ) = qb1d ( k ) endif qv ( i , k , j ) = qv1d ( k ) qc ( i , k , j ) = qc1d ( k ) qi ( i , k , j ) = qi1d ( k ) qr ( i , k , j ) = qr1d ( k ) qs ( i , k , j ) = qs1d ( k ) qg ( i , k , j ) = qg1d ( k ) ni ( i , k , j ) = ni1d ( k ) nr ( i , k , j ) = nr1d ( k ) ! tempo main returns temperature (t1d), so convert to theta if needed if ( use_temperature ) then t ( i , k , j ) = t1d ( k ) else th ( i , k , j ) = t1d ( k ) / pii ( i , k , j ) endif enddo enddo enddo end subroutine tempo_run subroutine tempo_aerosol_surface_emissions ( dt , nwfa , nwfa2d , ims , ime , jms , jme , kms , kme , kts ) !! adds aerosol surface emissions to the 3D field real ( wp ), intent ( in ) :: dt real ( wp ), dimension ( ims : ime , kms : kme , jms : jme ), intent ( inout ) :: nwfa real ( wp ), dimension ( ims : ime , jms : jme ), intent ( in ) :: nwfa2d integer , intent ( in ) :: ims , ime , jms , jme , kms , kme , kts integer :: i , j do j = jms , jme do i = ims , ime nwfa ( i , kts , j ) = nwfa ( i , kts , j ) + nwfa2d ( i , j ) * dt enddo enddo end subroutine tempo_aerosol_surface_emissions subroutine read_table_freezewater ( filename , table_size ) !! read lookup table for frozen cloud and rain water use module_mp_tempo_params , only : tpi_qrfz , tni_qrfz , & tpg_qrfz , tnr_qrfz , tpi_qcfz , tni_qcfz character ( len =* ), intent ( in ) :: filename integer , intent ( in ) :: table_size integer :: mp_unit , istat mp_unit = 11 call check_before_table_read ( filename , table_size ) open ( unit = mp_unit , file = filename , form = 'unformatted' , status = 'old' , access = 'stream' , & action = 'read' , iostat = istat , convert = 'big_endian' ) read ( mp_unit ) tpi_qrfz read ( mp_unit ) tni_qrfz read ( mp_unit ) tpg_qrfz read ( mp_unit ) tnr_qrfz read ( mp_unit ) tpi_qcfz read ( mp_unit ) tni_qcfz close ( unit = mp_unit ) end subroutine read_table_freezewater subroutine read_table_qr_acr_qs ( filename , table_size ) !! read lookup table for rain-snow collection use module_mp_tempo_params , only : tcs_racs1 , tmr_racs1 , & tcs_racs2 , tmr_racs2 , tcr_sacr1 , tms_sacr1 , tcr_sacr2 , & tms_sacr2 , tnr_racs1 , tnr_racs2 , tnr_sacr1 , tnr_sacr2 character ( len =* ), intent ( in ) :: filename integer , intent ( in ) :: table_size integer :: mp_unit , istat mp_unit = 11 call check_before_table_read ( filename , table_size ) open ( unit = mp_unit , file = filename , form = 'unformatted' , status = 'old' , access = 'stream' , & action = 'read' , iostat = istat , convert = 'big_endian' ) read ( mp_unit ) tcs_racs1 read ( mp_unit ) tmr_racs1 read ( mp_unit ) tcs_racs2 read ( mp_unit ) tmr_racs2 read ( mp_unit ) tcr_sacr1 read ( mp_unit ) tms_sacr1 read ( mp_unit ) tcr_sacr2 read ( mp_unit ) tms_sacr2 read ( mp_unit ) tnr_racs1 read ( mp_unit ) tnr_racs2 read ( mp_unit ) tnr_sacr1 read ( mp_unit ) tnr_sacr2 close ( unit = mp_unit ) end subroutine read_table_qr_acr_qs subroutine read_table_qr_acr_qg ( filename , table_size ) !! read lookup table for rain-graupel collection use module_mp_tempo_params , only : tcg_racg , tmr_racg , & tcr_gacr , tnr_racg , tnr_gacr character ( len =* ), intent ( in ) :: filename integer , intent ( in ) :: table_size integer :: mp_unit , istat mp_unit = 11 call check_before_table_read ( filename , table_size ) open ( unit = mp_unit , file = filename , form = 'unformatted' , status = 'old' , access = 'stream' , & action = 'read' , iostat = istat , convert = 'big_endian' ) read ( mp_unit ) tcg_racg read ( mp_unit ) tmr_racg read ( mp_unit ) tcr_gacr read ( mp_unit ) tnr_racg read ( mp_unit ) tnr_gacr close ( unit = mp_unit ) end subroutine read_table_qr_acr_qg subroutine read_table_ccn ( filename , table_size ) !! read static file containing CCN activation of aerosols; !! the data were created from a parcel model by Feingold and Heymsfield (1992) !! https://doi.org/10.1175/1520-0469(1992)049<2325:POCGOD>2.0.CO;2 !! with further changes by Eidhammer and Kreidenweis use module_mp_tempo_params , only : tnccn_act character ( len =* ), intent ( in ) :: filename integer , intent ( in ) :: table_size integer :: mp_unit , istat call check_before_table_read ( filename = filename , table_size = table_size ) mp_unit = 11 open ( unit = mp_unit , file = filename , form = 'unformatted' , status = 'old' , & action = 'read' , iostat = istat , convert = 'big_endian' ) read ( mp_unit ) tnccn_act close ( unit = mp_unit ) end subroutine read_table_ccn subroutine check_before_table_read ( filename , table_size ) !! checks that lookup tables exist and are the correct size !! before attempting to read them character ( len =* ), intent ( in ) :: filename integer , intent ( in ) :: table_size logical :: fileexists integer :: filesize character ( len = 100 ) :: int_to_str1 , int_to_str2 inquire ( file = filename , size = filesize , exist = fileexists ) if (. not . fileexists ) then write ( * , '(3A)' ) 'tempo_init() --- *** FATAL *** file \"' , filename , & '\" was not found in this directory.' write ( * , '(A)' ) '' write ( * , '(A)' ) 'How to fix issues with tables (datasets stored in files):' write ( * , '(3A)' ) '   (1) The table ' , trim ( tempo_table_cfgs % ccn_table_name ), & ' is located in the TEMPO/tables/ directory. Copy this file to the directory where the model executable is located.' write ( * , '(8A)' ) '   (2) Three tables:' , trim ( tempo_table_cfgs % qrqs_table_name ), ', ' , trim ( tempo_table_cfgs % qrqg_table_name ), ', and ' , & trim ( tempo_table_cfgs % freezewater_table_name ), & ' can be build by compiling and running the executable \"build_tables\" in the main TEMPO directory. ' , & 'Then copy the file to the directory where the model executable is located.' write ( * , '(A)' ) '   (3) Ask the developers for tables. They are willing to share.' write ( * , '(A)' ) '' error stop '--- file \"' // filename // '\" needed for TEMPO microphysics was not found.' endif if ( filesize /= table_size ) then write ( int_to_str1 , '(I0)' ) filesize write ( int_to_str2 , '(I0)' ) table_size write ( * , '(7A)' ) 'tempo_init() --- *** FATAL *** file \"' , filename , '\" has a size of ' , & trim ( int_to_str1 ), ' bytes but the array allocated to hold the data expects a file size of ' , & trim ( int_to_str2 ), ' bytes.' write ( * , '(A)' ) '' write ( * , '(A)' ) 'How to fix issues with tables (datasets stored in files):' write ( * , '(3A)' ) '   (1) The table ' , trim ( tempo_table_cfgs % ccn_table_name ), & ' is located in the TEMPO/tables/ directory. Copy this file to the directory where the model executable is located.' write ( * , '(8A)' ) '   (2) Three tables: ' , trim ( tempo_table_cfgs % qrqs_table_name ), ', ' , trim ( tempo_table_cfgs % qrqg_table_name ), ', and ' , & trim ( tempo_table_cfgs % freezewater_table_name ), & ' can be build by compiling and running the executable \"build_tables\" in the main TEMPO directory. ' , & 'Then copy the file to the directory where the model executable is located.' write ( * , '(A)' ) '   (3) Ask the developers for tables. They are willing to share.' write ( * , '(A)' ) '' error stop '--- size of file \"' // filename // '\" needed for TEMPO microphysics is inconsistent with expected size.' endif end subroutine check_before_table_read subroutine init_ml_data () !! initialize machine learning data for tempo microphysics type ( ty_tempo_ml_data ), dimension ( 1 ) :: tempo_ml_data ! cloud water tempo_ml_data ( 1 )% input_size = nc_ml_input tempo_ml_data ( 1 )% node_size = nc_ml_nodes tempo_ml_data ( 1 )% output_size = nc_ml_output if (. not . allocated ( tempo_ml_data ( 1 )% transform_mean )) allocate ( tempo_ml_data ( 1 )% transform_mean ( nc_ml_input )) if (. not . allocated ( tempo_ml_data ( 1 )% transform_var )) allocate ( tempo_ml_data ( 1 )% transform_var ( nc_ml_input )) tempo_ml_data ( 1 )% transform_mean = nc_ml_trans_mean tempo_ml_data ( 1 )% transform_var = nc_ml_trans_var if (. not . allocated ( tempo_ml_data ( 1 )% weights00 )) allocate ( tempo_ml_data ( 1 )% weights00 ( nc_ml_nodes , nc_ml_input )) if (. not . allocated ( tempo_ml_data ( 1 )% weights01 )) allocate ( tempo_ml_data ( 1 )% weights01 ( nc_ml_output , nc_ml_nodes )) if (. not . allocated ( tempo_ml_data ( 1 )% bias00 )) allocate ( tempo_ml_data ( 1 )% bias00 ( nc_ml_nodes )) if (. not . allocated ( tempo_ml_data ( 1 )% bias01 )) allocate ( tempo_ml_data ( 1 )% bias01 ( nc_ml_output )) tempo_ml_data ( 1 )% weights00 = reshape ( nc_ml_w00 , ( / nc_ml_nodes , nc_ml_input / )) tempo_ml_data ( 1 )% weights01 = reshape ( nc_ml_w01 , ( / nc_ml_output , nc_ml_nodes / )) tempo_ml_data ( 1 )% bias00 = nc_ml_b00 tempo_ml_data ( 1 )% bias01 = nc_ml_b01 ! save neural network call save_or_read_ml_data ( ml_data_in = tempo_ml_data ) end subroutine init_ml_data end module module_mp_tempo_driver","tags":"","url":"sourcefile/module_mp_tempo_driver.f90.html"},{"title":"run_tempo_tests.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~run_tempo_tests.f90~~EfferentGraph sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~tests.f90 tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 sourcefile~module_mp_tempo_cfgs.f90 module_mp_tempo_cfgs.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~module_mp_tempo_ml.f90 module_mp_tempo_ml.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_aerosols.f90 module_mp_tempo_aerosols.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_aerosols.f90 sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_diags.f90 sourcefile~module_mp_tempo_ml.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_aerosols.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_utils.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code program run_tempo_tests !! runs tempo tests use tests , only : test_tempo_init , test_graupel_sedimentation , & test_snow_sedimentation , test_cloud_number_aerosolaware , & test_cloud_number_non_aerosolaware , test_cloud_number_ml , & test_ml_cloud_effective_radius implicit none real , dimension ( 7 ) :: sedi_tests = & [ 1. , 1 0. , 2 0. , 6 0. , 12 0. , 30 0. , 60 0. ] integer :: t ! tempo init call test_tempo_init () ! ml cloud effective radius call test_ml_cloud_effective_radius ( dt = 2 0. ) ! test cloud number concentration call test_cloud_number_aerosolaware ( dt = 2 0. ) call test_cloud_number_non_aerosolaware ( dt = 2 0. ) call test_cloud_number_ml ( dt = 2 0. ) ! graupel sedimentation do t = 1 , size ( sedi_tests ) call test_graupel_sedimentation ( dt = sedi_tests ( t ), semi_sedi = . false .) enddo do t = 1 , size ( sedi_tests ) call test_graupel_sedimentation ( dt = sedi_tests ( t ), semi_sedi = . true .) enddo ! snow sedimentation do t = 1 , size ( sedi_tests ) call test_snow_sedimentation ( dt = sedi_tests ( t )) enddo end program run_tempo_tests","tags":"","url":"sourcefile/run_tempo_tests.f90.html"},{"title":"module_mp_tempo_tables.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~module_mp_tempo_tables.f90~~EfferentGraph sourcefile~module_mp_tempo_tables.f90 module_mp_tempo_tables.F90 sourcefile~module_mp_tempo_cfgs.f90 module_mp_tempo_cfgs.F90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~module_mp_tempo_tables.f90~~AfferentGraph sourcefile~module_mp_tempo_tables.f90 module_mp_tempo_tables.F90 sourcefile~build_tables.f90 build_tables.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_tables.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_tables !! initialize variables for tempo microphysics !! !! includes a procedure to build and save tempo lookup tables use module_mp_tempo_cfgs , only : ty_tempo_cfgs , ty_tempo_table_cfgs use module_mp_tempo_params , only : wp , sp , dp use module_mp_tempo_utils , only : snow_moments , calc_gamma_p , get_nuc #ifdef build_tables_with_mpi use mpi_f08 #endif implicit none private public :: tempo_build_tables type ( ty_tempo_table_cfgs ) :: tempo_table_cfgs contains subroutine tempo_build_tables ( build_tables_rank , build_tables_num_proc ) !! builds three lookup tables for tempo microphysics use module_mp_tempo_params , only : get_version , tempo_version , & initialize_graupel_vars , initialize_parameters , initialize_bins_for_tables integer , intent ( in ) :: build_tables_rank , build_tables_num_proc character ( len = 100 ) :: table_filename logical , parameter :: build_table_hail_flag = . true . ! MPI to speed up the table building process integer :: rank , num_proc ! set global variables rank and num_proc from MPI_Comm in build_tables program rank = build_tables_rank num_proc = build_tables_num_proc ! get tempo version from readme file call get_version ( tempo_version ) #ifdef build_tables_with_mpi write ( * , '(A,I4,A)' ) 'tempo_build_tables() --- building lookup tables with MPI and' , num_proc , ' process(es)' #else write ( * , '(A,I4,A)' ) 'tempo_build_tables() --- building lookup tables with' , num_proc , ' process' #endif ! hard-code hail aware = true to build lookup tables call initialize_graupel_vars ( build_table_hail_flag ) write ( * , '(A,L)' ) 'tempo_build_tables() --- initialized graupel variables using hail aware = ' , build_table_hail_flag ! set parameters that can depend on the host model call initialize_parameters () write ( * , '(A)' ) 'tempo_build_tables() --- initialized parameters' ! creates log-spaced bins of hydrometers for tables call initialize_bins_for_tables () write ( * , '(A)' ) 'tempo_build_tables() --- initialized bins for lookup tables' ! freeze water collection lookup table table_filename = tempo_table_cfgs % freezewater_table_name write ( * , '(2A)' ) 'tempo_build_tables() --- building table ' , trim ( table_filename ) call build_table_freezewater () if ( rank == 0 ) call write_table_freezewater ( trim ( table_filename )) ! rain-snow collection lookup table table_filename = tempo_table_cfgs % qrqs_table_name write ( * , '(2A)' ) 'tempo_build_tables() --- building table ' , trim ( table_filename ) call build_table_qr_acr_qs ( rank , num_proc ) if ( rank == 0 ) call write_table_qr_acr_qs ( trim ( table_filename )) ! rain-graupel collection lookup table table_filename = tempo_table_cfgs % qrqg_table_name write ( * , '(2A)' ) 'tempo_build_tables() --- building table ' , trim ( table_filename ) call build_table_qr_acr_qg ( rank , num_proc ) if ( rank == 0 ) call write_table_qr_acr_qg ( trim ( table_filename )) end subroutine tempo_build_tables subroutine build_table_freezewater () !! build lookup table data for frozen cloud and rain water use module_mp_tempo_params , only : initialize_arrays_freezewater real ( wp ) :: timing_start , timing_end call initialize_arrays_freezewater () call cpu_time ( timing_start ) call freezewater () call cpu_time ( timing_end ) write ( * , '(A,I5,A)' ) 'build_table_freezewater() --- time to build table: ' , int ( timing_end - timing_start ), ' s' end subroutine build_table_freezewater subroutine write_table_freezewater ( filename ) !! write data for frozen cloud water and rain to a file use module_mp_tempo_params , only : tpi_qrfz , tni_qrfz , tpg_qrfz , & tnr_qrfz , tpi_qcfz , tni_qcfz character ( len =* ), intent ( in ) :: filename integer :: mp_unit , istat logical :: fileexists inquire ( file = filename , exist = fileexists ) if ( fileexists ) then write ( * , * ) 'write_table_freezewater() --- please delete or move lookup table ' , trim ( filename ), & ' before attempted to create a new table' error stop 'attempting to overwrite a table that already exists' endif mp_unit = 11 open ( unit = mp_unit , file = filename , form = 'unformatted' , status = 'new' , access = 'stream' , & iostat = istat , convert = 'big_endian' ) write ( mp_unit ) tpi_qrfz write ( mp_unit ) tni_qrfz write ( mp_unit ) tpg_qrfz write ( mp_unit ) tnr_qrfz write ( mp_unit ) tpi_qcfz write ( mp_unit ) tni_qcfz close ( unit = mp_unit ) end subroutine write_table_freezewater subroutine build_table_qr_acr_qs ( rank , num_proc ) !! build lookup table data for rain-snow collection use module_mp_tempo_params , only : table_dp , initialize_arrays_qr_acr_qs , & tcs_racs1 , tmr_racs1 , tcs_racs2 , tmr_racs2 , tcr_sacr1 , tms_sacr1 , & ! data arrays tcr_sacr2 , tms_sacr2 , tnr_racs1 , tnr_racs2 , tnr_sacr1 , tnr_sacr2 , & ! data arrays ntb_s , ntb_t , ntb_r1 , ntb_r ! dimensions integer , intent ( in ) :: rank , num_proc #ifdef build_tables_with_mpi integer :: ierror #endif real ( wp ) :: timing_start , timing_end integer :: start_idx , end_idx , local_dim_size , local_flat_size integer , allocatable , dimension (:) :: sendcounts , displacements real ( table_dp ), allocatable , dimension (:) :: tcs_racs1_flat , tmr_racs1_flat , & tcs_racs2_flat , tmr_racs2_flat , tcr_sacr1_flat , tms_sacr1_flat , & tcr_sacr2_flat , tms_sacr2_flat , tnr_racs1_flat , tnr_racs2_flat , & tnr_sacr1_flat , tnr_sacr2_flat real ( table_dp ), allocatable , dimension (:,:,:,:) :: tcs_racs1_ , tmr_racs1_ , & tcs_racs2_ , tmr_racs2_ , tcr_sacr1_ , tms_sacr1_ , tcr_sacr2_ , & tms_sacr2_ , tnr_racs1_ , tnr_racs2_ , tnr_sacr1_ , tnr_sacr2_ if ( rank == 0 ) then ! initialize lookup table arrays and flatten for MPI call initialize_arrays_qr_acr_qs () allocate ( tcs_racs1_flat ( size ( tcs_racs1 ))) allocate ( tmr_racs1_flat ( size ( tmr_racs1 ))) allocate ( tcs_racs2_flat ( size ( tcs_racs2 ))) allocate ( tmr_racs2_flat ( size ( tmr_racs2 ))) allocate ( tcr_sacr1_flat ( size ( tcr_sacr1 ))) allocate ( tms_sacr1_flat ( size ( tms_sacr1 ))) allocate ( tcr_sacr2_flat ( size ( tcr_sacr2 ))) allocate ( tms_sacr2_flat ( size ( tms_sacr2 ))) allocate ( tnr_racs1_flat ( size ( tnr_racs1 ))) allocate ( tnr_racs2_flat ( size ( tnr_racs2 ))) allocate ( tnr_sacr1_flat ( size ( tnr_sacr1 ))) allocate ( tnr_sacr2_flat ( size ( tnr_sacr2 ))) endif ! split over the last dimension, nrb_r call get_index_for_rank ( ntb_r , rank , num_proc , start_idx , end_idx ) local_dim_size = end_idx - start_idx + 1 local_flat_size = local_dim_size * ntb_s * ntb_t * ntb_r1 ! local arrays for MPI allocate ( tcs_racs1_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tmr_racs1_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tcs_racs2_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tmr_racs2_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tcr_sacr1_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tms_sacr1_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tcr_sacr2_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tms_sacr2_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tnr_racs1_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tnr_racs2_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tnr_sacr1_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( tnr_sacr2_ ( ntb_s , ntb_t , ntb_r1 , local_dim_size )) allocate ( sendcounts ( num_proc ), displacements ( num_proc )) if ( num_proc == 1 ) then sendcounts ( 1 ) = local_flat_size displacements ( 1 ) = 0 ! MPI displacements start at zero endif #ifdef build_tables_with_mpi call MPI_Allgather ( local_flat_size , 1 , MPI_INTEGER , sendcounts , 1 , MPI_INTEGER , MPI_COMM_WORLD , ierror ) ! MPI displacements start at zero, i.e., start_idx-1 below call MPI_Allgather (( start_idx - 1 ) * ntb_s * ntb_t * ntb_r1 , 1 , MPI_INTEGER , displacements , 1 , MPI_INTEGER , MPI_COMM_WORLD , ierror ) #endif #ifdef build_tables_with_mpi timing_start = MPI_Wtime () #else call cpu_time ( timing_start ) #endif call qr_acr_qs ( start_idx , end_idx , & tcs_racs1_ , tmr_racs1_ , tcs_racs2_ , tmr_racs2_ , & tcr_sacr1_ , tms_sacr1_ , tcr_sacr2_ , tms_sacr2_ , & tnr_racs1_ , tnr_racs2_ , tnr_sacr1_ , tnr_sacr2_ ) #ifdef build_tables_with_mpi timing_end = MPI_Wtime () #else call cpu_time ( timing_end ) #endif if ( rank == 0 ) write ( * , '(A,I5,A)' ) 'build_table_qr_acr_qs() --- time to build table: ' , int ( timing_end - timing_start ), ' s' #ifdef build_tables_with_mpi call MPI_Barrier ( MPI_COMM_WORLD , ierror ) call gather ( reshape ( tcs_racs1_ , ( / local_flat_size / )), tcs_racs1_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tmr_racs1_ , ( / local_flat_size / )), tmr_racs1_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tcs_racs2_ , ( / local_flat_size / )), tcs_racs2_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tmr_racs2_ , ( / local_flat_size / )), tmr_racs2_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tcr_sacr1_ , ( / local_flat_size / )), tcr_sacr1_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tms_sacr1_ , ( / local_flat_size / )), tms_sacr1_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tcr_sacr2_ , ( / local_flat_size / )), tcr_sacr2_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tms_sacr2_ , ( / local_flat_size / )), tms_sacr2_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tnr_racs1_ , ( / local_flat_size / )), tnr_racs1_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tnr_racs2_ , ( / local_flat_size / )), tnr_racs2_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tnr_sacr1_ , ( / local_flat_size / )), tnr_sacr1_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tnr_sacr2_ , ( / local_flat_size / )), tnr_sacr2_flat , sendcounts , displacements , ierror ) if ( rank == 0 ) then tcs_racs1 = reshape ( tcs_racs1_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tmr_racs1 = reshape ( tmr_racs1_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tcs_racs2 = reshape ( tcs_racs2_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tmr_racs2 = reshape ( tmr_racs2_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tcr_sacr1 = reshape ( tcr_sacr1_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tms_sacr1 = reshape ( tms_sacr1_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tcr_sacr2 = reshape ( tcr_sacr2_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tms_sacr2 = reshape ( tms_sacr2_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tnr_racs1 = reshape ( tnr_racs1_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tnr_racs2 = reshape ( tnr_racs2_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tnr_sacr1 = reshape ( tnr_sacr1_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) tnr_sacr2 = reshape ( tnr_sacr2_flat , ( / ntb_s , ntb_t , ntb_r1 , ntb_r / )) endif #else tcs_racs1 = tcs_racs1_ tmr_racs1 = tmr_racs1_ tcs_racs2 = tcs_racs2_ tmr_racs2 = tmr_racs2_ tcr_sacr1 = tcr_sacr1_ tms_sacr1 = tms_sacr1_ tcr_sacr2 = tcr_sacr2_ tms_sacr2 = tms_sacr2_ tnr_racs1 = tnr_racs1_ tnr_racs2 = tnr_racs2_ tnr_sacr1 = tnr_sacr1_ tnr_sacr2 = tnr_sacr2_ #endif #if build_tables_with_mpi call MPI_Barrier ( MPI_COMM_WORLD , ierror ) #endif end subroutine build_table_qr_acr_qs subroutine write_table_qr_acr_qs ( filename ) !! write data for rain-snow collection to a file use module_mp_tempo_params , only : tcs_racs1 , tmr_racs1 , tcs_racs2 , & tmr_racs2 , tcr_sacr1 , tms_sacr1 , tcr_sacr2 , tms_sacr2 , tnr_racs1 , & tnr_racs2 , tnr_sacr1 , tnr_sacr2 character ( len =* ), intent ( in ) :: filename integer :: mp_unit , istat logical :: fileexists inquire ( file = filename , exist = fileexists ) if ( fileexists ) then write ( * , * ) 'write_table_qr_acr_qs() --- please delete or move lookup table ' , trim ( filename ), & ' before attempted to create a new table' error stop 'attempting to overwrite a table that already exists' endif mp_unit = 11 open ( unit = mp_unit , file = filename , form = 'unformatted' , status = 'new' , access = 'stream' , & iostat = istat , convert = 'big_endian' ) write ( mp_unit ) tcs_racs1 write ( mp_unit ) tmr_racs1 write ( mp_unit ) tcs_racs2 write ( mp_unit ) tmr_racs2 write ( mp_unit ) tcr_sacr1 write ( mp_unit ) tms_sacr1 write ( mp_unit ) tcr_sacr2 write ( mp_unit ) tms_sacr2 write ( mp_unit ) tnr_racs1 write ( mp_unit ) tnr_racs2 write ( mp_unit ) tnr_sacr1 write ( mp_unit ) tnr_sacr2 close ( unit = mp_unit ) end subroutine write_table_qr_acr_qs subroutine build_table_qr_acr_qg ( rank , num_proc ) !! build lookup table data for rain-graupel collection use module_mp_tempo_params , only : table_dp , initialize_arrays_qr_acr_qg , & tcg_racg , tmr_racg , tcr_gacr , tnr_racg , tnr_gacr , & ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r integer , intent ( in ) :: rank , num_proc #ifdef build_tables_with_mpi integer :: ierror #endif real ( wp ) :: timing_start , timing_end integer :: start_idx , end_idx , local_dim_size , local_flat_size integer , allocatable , dimension (:) :: sendcounts , displacements real ( table_dp ), allocatable , dimension (:) :: tcg_racg_flat , tmr_racg_flat , & tcr_gacr_flat , tnr_racg_flat , tnr_gacr_flat real ( table_dp ), allocatable , dimension (:,:,:,:,:) :: tcg_racg_ , & tmr_racg_ , tcr_gacr_ , tnr_racg_ , tnr_gacr_ if ( rank == 0 ) then ! initialize lookup table arrays and flatten for MPI call initialize_arrays_qr_acr_qg () allocate ( tcg_racg_flat ( size ( tcg_racg ))) allocate ( tmr_racg_flat ( size ( tmr_racg ))) allocate ( tcr_gacr_flat ( size ( tcr_gacr ))) allocate ( tnr_racg_flat ( size ( tnr_racg ))) allocate ( tnr_gacr_flat ( size ( tnr_gacr ))) endif ! split over the last dimension, nrb_r call get_index_for_rank ( ntb_r , rank , num_proc , start_idx , end_idx ) local_dim_size = end_idx - start_idx + 1 local_flat_size = local_dim_size * ntb_g1 * ntb_g * nrhg * ntb_r1 ! local arrays for MPI allocate ( tcg_racg_ ( ntb_g1 , ntb_g , nrhg , ntb_r1 , local_dim_size )) allocate ( tmr_racg_ ( ntb_g1 , ntb_g , nrhg , ntb_r1 , local_dim_size )) allocate ( tcr_gacr_ ( ntb_g1 , ntb_g , nrhg , ntb_r1 , local_dim_size )) allocate ( tnr_racg_ ( ntb_g1 , ntb_g , nrhg , ntb_r1 , local_dim_size )) allocate ( tnr_gacr_ ( ntb_g1 , ntb_g , nrhg , ntb_r1 , local_dim_size )) allocate ( sendcounts ( num_proc ), displacements ( num_proc )) if ( num_proc == 1 ) then sendcounts ( 1 ) = local_flat_size displacements ( 1 ) = 0 ! MPI displacements start at zero endif #ifdef build_tables_with_mpi call MPI_Allgather ( local_flat_size , 1 , MPI_INTEGER , sendcounts , 1 , MPI_INTEGER , MPI_COMM_WORLD , ierror ) ! MPI displacements start at zero, i.e., start_idx-1 below call MPI_Allgather (( start_idx - 1 ) * ntb_g1 * ntb_g * nrhg * ntb_r1 , 1 , MPI_INTEGER , displacements , 1 , MPI_INTEGER , MPI_COMM_WORLD , ierror ) #endif #ifdef build_tables_with_mpi timing_start = MPI_Wtime () #else call cpu_time ( timing_start ) #endif call qr_acr_qg ( start_idx , end_idx , & tcg_racg_ , tmr_racg_ , tcr_gacr_ , tnr_racg_ , tnr_gacr_ ) #ifdef build_tables_with_mpi timing_end = MPI_Wtime () #else call cpu_time ( timing_end ) #endif if ( rank == 0 ) write ( * , '(A,I5,A)' ) 'build_table_qr_acr_qg() --- time to build table: ' , int ( timing_end - timing_start ), ' s' #ifdef build_tables_with_mpi call MPI_Barrier ( MPI_COMM_WORLD , ierror ) call gather ( reshape ( tcg_racg_ , ( / local_flat_size / )), tcg_racg_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tmr_racg_ , ( / local_flat_size / )), tmr_racg_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tcr_gacr_ , ( / local_flat_size / )), tcr_gacr_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tnr_racg_ , ( / local_flat_size / )), tnr_racg_flat , sendcounts , displacements , ierror ) call gather ( reshape ( tnr_gacr_ , ( / local_flat_size / )), tnr_gacr_flat , sendcounts , displacements , ierror ) if ( rank == 0 ) then tcg_racg = reshape ( tcg_racg_flat , ( / ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r / )) tmr_racg = reshape ( tmr_racg_flat , ( / ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r / )) tcr_gacr = reshape ( tcr_gacr_flat , ( / ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r / )) tnr_racg = reshape ( tnr_racg_flat , ( / ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r / )) tnr_gacr = reshape ( tnr_gacr_flat , ( / ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r / )) endif #else tcg_racg = tcg_racg_ tmr_racg = tmr_racg_ tcr_gacr = tcr_gacr_ tnr_racg = tnr_racg_ tnr_gacr = tnr_gacr_ #endif #if build_tables_with_mpi call MPI_Barrier ( MPI_COMM_WORLD , ierror ) #endif end subroutine build_table_qr_acr_qg subroutine write_table_qr_acr_qg ( filename ) !! write data for rain-graupel collection to a file use module_mp_tempo_params , only : tcg_racg , tmr_racg , & tcr_gacr , tnr_racg , tnr_gacr character ( len =* ), intent ( in ) :: filename integer :: mp_unit , istat logical :: fileexists inquire ( file = filename , exist = fileexists ) if ( fileexists ) then write ( * , * ) 'write_table_qr_acr_qg() --- please delete or move lookup table ' , trim ( filename ), & ' before attempted to create a new table' error stop 'attempting to overwrite a table that already exists' endif mp_unit = 11 open ( unit = mp_unit , file = filename , form = 'unformatted' , status = 'new' , access = 'stream' , & iostat = istat , convert = 'big_endian' ) write ( mp_unit ) tcg_racg write ( mp_unit ) tmr_racg write ( mp_unit ) tcr_gacr write ( mp_unit ) tnr_racg write ( mp_unit ) tnr_gacr close ( unit = mp_unit ) end subroutine write_table_qr_acr_qg #ifdef build_tables_with_mpi subroutine gather ( local_flat , global_flat , sendcounts , displacements , ierror ) !! wrapper to simplify MPI_Gatherv use module_mp_tempo_params , only : table_dp real ( table_dp ), dimension (:), intent ( in ) :: local_flat real ( table_dp ), dimension (:), intent ( out ) :: global_flat integer , intent ( inout ) :: ierror integer , dimension (:), intent ( in ) :: sendcounts , displacements integer :: local_size local_size = size ( local_flat ) call MPI_Gatherv ( local_flat , local_size , MPI_DOUBLE_PRECISION , & global_flat , sendcounts , displacements , & MPI_DOUBLE_PRECISION , 0 , MPI_COMM_WORLD , ierror ) end subroutine gather #endif subroutine get_index_for_rank ( idx , rank , num_proc , start_idx , end_idx ) !! returns start and end index values for an array dimension !! of size idx distributed over num_procs integer , intent ( in ) :: idx , rank , num_proc integer , intent ( out ) :: start_idx , end_idx integer :: values_per_proc if ( num_proc > idx ) then write ( * , '(A,I4,A,I4)' ) 'num_proc' , num_proc , 'cannot be larger than idx' , idx error stop '--- reduce the number of processes' endif values_per_proc = idx / num_proc if ( rank < mod ( idx , num_proc )) then values_per_proc = values_per_proc + 1 endif if ( rank < mod ( idx , num_proc )) then start_idx = rank * values_per_proc + 1 end_idx = ( rank + 1 ) * values_per_proc else start_idx = mod ( idx , num_proc ) + rank * values_per_proc + 1 end_idx = mod ( idx , num_proc ) + ( rank + 1 ) * values_per_proc endif end subroutine get_index_for_rank subroutine qr_acr_qs ( local_start , local_end , & ltcs_racs1 , ltmr_racs1 , ltcs_racs2 , ltmr_racs2 , ltcr_sacr1 , ltms_sacr1 , & ltcr_sacr2 , ltms_sacr2 , ltnr_racs1 , ltnr_racs2 , ltnr_sacr1 , ltnr_sacr2 ) !! calculates rain collecting snow (and inverse) use module_mp_tempo_params , only : table_dp , & nbr , nbs , dr , av_s , bv_s , ds , fv_s , & ntb_r , ntb_r1 , n0r_exp , am_r , cre , crg , ore1 , r_r , & org1 , org2 , obmr , mu_r , dtr , ntb_t , ntb_s , r_s , & sa , sb , tc , bm_s , mu_s , lam0 , lam1 , kap0 , kap1 , dts , & bm_r , am_s , pi , ef_rs , table_dp integer , intent ( in ) :: local_start , local_end real ( table_dp ), intent ( out ), dimension (:,:,:,:) :: & ltcs_racs1 , ltmr_racs1 , ltcs_racs2 , ltmr_racs2 , & ltcr_sacr1 , ltms_sacr1 , ltcr_sacr2 , ltms_sacr2 , & ltnr_racs1 , ltnr_racs2 , ltnr_sacr1 , ltnr_sacr2 integer :: i , j , k , m , n , n2 real ( dp ), dimension ( nbr ) :: vr , d1 , n_r real ( dp ), dimension ( nbs ) :: vs , n_s real ( dp ) :: m0 , m2 , m3 , mrat , om3 real ( dp ) :: n0_r , lam_exp , lamr , slam1 , slam2 real ( dp ) :: dvs , dvr , masss , massr real ( dp ) :: t1 , t2 , t3 , t4 , z1 , z2 , z3 , z4 real ( dp ) :: y1 , y2 , y3 , y4 do n2 = 1 , nbr vr ( n2 ) = - 0.1021_dp + 4.932e3_dp * dr ( n2 ) - 0.9551e6_dp * dr ( n2 ) * dr ( n2 ) & + 0.07934e9_dp * dr ( n2 ) * dr ( n2 ) * dr ( n2 ) & - 0.002362e12_dp * dr ( n2 ) * dr ( n2 ) * dr ( n2 ) * dr ( n2 ) d1 ( n2 ) = ( vr ( n2 ) / av_s ) ** ( 1._dp / bv_s ) enddo do n = 1 , nbs vs ( n ) = 1.5_dp * av_s * ds ( n ) ** bv_s * exp ( real ( - fv_s * ds ( n ), kind = dp )) enddo do m = local_start , local_end do k = 1 , ntb_r1 lam_exp = ( n0r_exp ( k ) * am_r * crg ( 1 ) / r_r ( m )) ** ore1 lamr = lam_exp * ( crg ( 3 ) * org2 * org1 ) ** obmr n0_r = n0r_exp ( k ) / ( crg ( 2 ) * lam_exp ) * lamr ** cre ( 2 ) do n2 = 1 , nbr n_r ( n2 ) = n0_r * dr ( n2 ) ** mu_r * exp ( - lamr * dr ( n2 )) * dtr ( n2 ) enddo do j = 1 , ntb_t do i = 1 , ntb_s call snow_moments ( rs = r_s ( i ), tc = tc ( j ), smob = m2 , smoc = m3 ) om3 = 1._wp / m3 mrat = m2 * ( m2 * om3 ) * ( m2 * om3 ) * ( m2 * om3 ) m0 = ( m2 * om3 ) ** mu_s slam1 = m2 * om3 * lam0 slam2 = m2 * om3 * lam1 do n = 1 , nbs n_s ( n ) = mrat * ( kap0 * exp ( - slam1 * ds ( n )) & + kap1 * m0 * ds ( n ) ** mu_s * exp ( - slam2 * ds ( n ))) * dts ( n ) enddo t1 = 0._dp t2 = 0._dp t3 = 0._dp t4 = 0._dp z1 = 0._dp z2 = 0._dp z3 = 0._dp z4 = 0._dp y1 = 0._dp y2 = 0._dp y3 = 0._dp y4 = 0._dp do n2 = 1 , nbr massr = am_r * dr ( n2 ) ** bm_r do n = 1 , nbs masss = am_s * ds ( n ) ** bm_s dvs = 0.5_dp * (( vr ( n2 ) - vs ( n )) + abs ( vr ( n2 ) - vs ( n ))) dvr = 0.5_dp * (( vs ( n ) - vr ( n2 )) + abs ( vs ( n ) - vr ( n2 ))) if ( massr > 1.5 * masss ) then t1 = t1 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvs * masss * n_s ( n ) * n_r ( n2 ) z1 = z1 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvs * massr * n_s ( n ) * n_r ( n2 ) y1 = y1 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvs * n_s ( n ) * n_r ( n2 ) else t3 = t3 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvs * masss * n_s ( n ) * n_r ( n2 ) z3 = z3 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvs * massr * n_s ( n ) * n_r ( n2 ) y3 = y3 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvs * n_s ( n ) * n_r ( n2 ) endif if ( massr > 1.5_dp * masss ) then t2 = t2 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvr * massr * n_s ( n ) * n_r ( n2 ) y2 = y2 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvr * n_s ( n ) * n_r ( n2 ) z2 = z2 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvr * masss * n_s ( n ) * n_r ( n2 ) else t4 = t4 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvr * massr * n_s ( n ) * n_r ( n2 ) y4 = y4 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvr * n_s ( n ) * n_r ( n2 ) z4 = z4 + pi * . 25_dp * ef_rs * ( ds ( n ) + dr ( n2 )) * ( ds ( n ) + dr ( n2 )) & * dvr * masss * n_s ( n ) * n_r ( n2 ) endif enddo enddo ltcs_racs1 ( i , j , k , m - local_start + 1 ) = t1 ltmr_racs1 ( i , j , k , m - local_start + 1 ) = min ( z1 , real ( r_r ( m ), kind = dp )) ltcs_racs2 ( i , j , k , m - local_start + 1 ) = t3 ltmr_racs2 ( i , j , k , m - local_start + 1 ) = z3 ltcr_sacr1 ( i , j , k , m - local_start + 1 ) = t2 ltms_sacr1 ( i , j , k , m - local_start + 1 ) = z2 ltcr_sacr2 ( i , j , k , m - local_start + 1 ) = t4 ltms_sacr2 ( i , j , k , m - local_start + 1 ) = z4 ltnr_racs1 ( i , j , k , m - local_start + 1 ) = y1 ltnr_racs2 ( i , j , k , m - local_start + 1 ) = y3 ltnr_sacr1 ( i , j , k , m - local_start + 1 ) = y2 ltnr_sacr2 ( i , j , k , m - local_start + 1 ) = y4 enddo enddo enddo enddo end subroutine qr_acr_qs subroutine qr_acr_qg ( local_start , local_end , & ltcg_racg , ltmr_racg , ltcr_gacr , ltnr_racg , ltnr_gacr ) !! rain collecting graupel (and inverse) using explicit integration use module_mp_tempo_params , only : table_dp , nrhg , nbg , nbr , dr , & av_g , dg , bv_g , ntb_r , ntb_r1 , & n0r_exp , am_r , cre , crg , r_r , ore1 , org1 , org2 , & obmr , mu_r , dtr , ntb_g , ntb_g1 , n0g_exp , am_g , cge , cgg , & r_g , oge1 , ogg1 , ogg2 , obmg , mu_g , dtg , bm_r , bm_g , pi , ef_rg integer , intent ( in ) :: local_start , local_end real ( table_dp ), intent ( out ), dimension (:,:,:,:,:) :: & ltcg_racg , ltmr_racg , ltcr_gacr , ltnr_racg , ltnr_gacr integer :: i , j , k , m , n , n2 , n3 real ( dp ), dimension ( nbg ) :: n_g real ( dp ), dimension ( nbg , nrhg ) :: vg real ( dp ), dimension ( nbr ) :: vr , n_r real ( dp ) :: n0_r , n0_g , lam_exp , lamg , lamr real ( dp ) :: massg , massr , dvg , dvr , t1 , t2 , z1 , z2 , y1 , y2 do n2 = 1 , nbr vr ( n2 ) = - 0.1021_dp + 4.932e3_dp * dr ( n2 ) - 0.9551e6_dp * dr ( n2 ) * dr ( n2 ) & + 0.07934e9_dp * dr ( n2 ) * dr ( n2 ) * dr ( n2 ) & - 0.002362e12_dp * dr ( n2 ) * dr ( n2 ) * dr ( n2 ) * dr ( n2 ) enddo do n3 = 1 , nrhg do n = 1 , nbg vg ( n , n3 ) = av_g ( n3 ) * dg ( n ) ** bv_g ( n3 ) enddo enddo do m = local_start , local_end do k = 1 , ntb_r1 lam_exp = ( n0r_exp ( k ) * am_r * crg ( 1 ) / r_r ( m )) ** ore1 lamr = lam_exp * ( crg ( 3 ) * org2 * org1 ) ** obmr n0_r = n0r_exp ( k ) / ( crg ( 2 ) * lam_exp ) * lamr ** cre ( 2 ) do n2 = 1 , nbr n_r ( n2 ) = n0_r * dr ( n2 ) ** mu_r * exp ( - lamr * dr ( n2 )) * dtr ( n2 ) enddo do n3 = 1 , nrhg do j = 1 , ntb_g do i = 1 , ntb_g1 lam_exp = ( n0g_exp ( i ) * am_g ( n3 ) * cgg ( 1 , 1 ) / r_g ( j )) ** oge1 lamg = lam_exp * ( cgg ( 3 , 1 ) * ogg2 * ogg1 ) ** obmg n0_g = n0g_exp ( i ) / ( cgg ( 2 , 1 ) * lam_exp ) * lamg ** cge ( 2 , 1 ) do n = 1 , nbg n_g ( n ) = n0_g * dg ( n ) ** mu_g * exp ( - lamg * dg ( n )) * dtg ( n ) enddo t1 = 0._dp t2 = 0._dp z1 = 0._dp z2 = 0._dp y1 = 0._dp y2 = 0._dp do n2 = 1 , nbr massr = am_r * dr ( n2 ) ** bm_r do n = 1 , nbg massg = am_g ( n3 ) * dg ( n ) ** bm_g dvg = 0.5_dp * (( vr ( n2 ) - vg ( n , n3 )) + abs ( vr ( n2 ) - vg ( n , n3 ))) dvr = 0.5_dp * (( vg ( n , n3 ) - vr ( n2 )) + abs ( vg ( n , n3 ) - vr ( n2 ))) t1 = t1 + pi * . 25_wp * ef_rg * ( dg ( n ) + dr ( n2 )) * ( dg ( n ) + dr ( n2 )) & * dvg * massg * n_g ( n ) * n_r ( n2 ) z1 = z1 + pi * . 25_wp * ef_rg * ( dg ( n ) + dr ( n2 )) * ( dg ( n ) + dr ( n2 )) & * dvg * massr * n_g ( n ) * n_r ( n2 ) y1 = y1 + pi * . 25_wp * ef_rg * ( dg ( n ) + dr ( n2 )) * ( dg ( n ) + dr ( n2 )) & * dvg * n_g ( n ) * n_r ( n2 ) t2 = t2 + pi * . 25_wp * ef_rg * ( dg ( n ) + dr ( n2 )) * ( dg ( n ) + dr ( n2 )) & * dvr * massr * n_g ( n ) * n_r ( n2 ) y2 = y2 + pi * . 25_wp * ef_rg * ( dg ( n ) + dr ( n2 )) * ( dg ( n ) + dr ( n2 )) & * dvr * n_g ( n ) * n_r ( n2 ) z2 = z2 + pi * . 25_wp * ef_rg * ( dg ( n ) + dr ( n2 )) * ( dg ( n ) + dr ( n2 )) & * dvr * massg * n_g ( n ) * n_r ( n2 ) enddo enddo ltcg_racg ( i , j , n3 , k , m - local_start + 1 ) = t1 ltmr_racg ( i , j , n3 , k , m - local_start + 1 ) = min ( z1 , real ( r_r ( m ), kind = dp )) ltcr_gacr ( i , j , n3 , k , m - local_start + 1 ) = t2 ltnr_racg ( i , j , n3 , k , m - local_start + 1 ) = y1 ltnr_gacr ( i , j , n3 , k , m - local_start + 1 ) = y2 enddo enddo enddo enddo enddo end subroutine qr_acr_qg subroutine freezewater () !! calculates the probability of drops of a particular volume freezing !! from Bigg (1953) !! https://doi.org/10.1002/qj.49707934207 use module_mp_tempo_params , only : nbc , nbr , rho_w , & am_r , dr , dtr , bm_r , dc , dtc , ntb_in , ntb_r1 , ntb_r , nt_in , & n0r_exp , cre , crg , r_r , ore1 , org2 , org1 , obmr , mu_r , & nu_c_scale , xm0g , t_nc , cce , ccg , ocg1 , r_c , ntb_c , & tpi_qrfz , tni_qrfz , tpg_qrfz , tnr_qrfz , tpi_qcfz , tni_qcfz ! data arrays integer :: i , j , k , m , n , n2 real ( dp ) :: n_r , n_c real ( dp ), dimension ( nbr ) :: massr real ( dp ), dimension ( nbc ) :: massc real ( dp ) :: sum1 , sum2 , sumn1 , sumn2 , & prob , vol , texp , orho_w , & lam_exp , lamr , N0_r , lamc , n0_c integer :: nu_c real ( wp ) :: t_adjust orho_w = 1._wp / rho_w do n2 = 1 , nbr massr ( n2 ) = am_r * dr ( n2 ) ** bm_r enddo do n = 1 , nbc massc ( n ) = am_r * dc ( n ) ** bm_r enddo ! the smallest drops become cloud ice, otherwise graupel do m = 1 , ntb_in t_adjust = max ( - 3.0_wp , min ( 3.0_wp - log10 ( nt_in ( m )), 3.0_wp )) do k = 1 , 45 texp = exp ( real ( k , kind = dp ) - real ( t_adjust , kind = dp )) - 1.0_dp do j = 1 , ntb_r1 do i = 1 , ntb_r lam_exp = ( n0r_exp ( j ) * am_r * crg ( 1 ) / r_r ( i )) ** ore1 lamr = lam_exp * ( crg ( 3 ) * org2 * org1 ) ** obmr n0_r = n0r_exp ( j ) / ( crg ( 2 ) * lam_exp ) * lamr ** cre ( 2 ) sum1 = 0._dp sum2 = 0._dp sumn1 = 0._dp sumn2 = 0._dp do n2 = nbr , 1 , - 1 n_r = n0_r * dr ( n2 ) ** mu_r * exp ( - lamr * dr ( n2 )) * dtr ( n2 ) vol = massr ( n2 ) * orho_w prob = max ( 0.0_dp , 1.0_dp - exp ( - 12 0.0_dp * vol * 5.2d-4 * texp )) !>@note !> Graupel tuning parameter: In this table, if the frozen raindrop mass is >= xm0g, !> initialization to graupel occurs. !>@endnote if ( massr ( n2 ) < xm0g ) then sumn1 = sumn1 + prob * n_r sum1 = sum1 + prob * n_r * massr ( n2 ) else sumn2 = sumn2 + prob * n_r sum2 = sum2 + prob * n_r * massr ( n2 ) endif if (( sum1 + sum2 ) >= r_r ( i )) exit enddo tpi_qrfz ( i , j , k , m ) = sum1 tni_qrfz ( i , j , k , m ) = sumn1 tpg_qrfz ( i , j , k , m ) = sum2 tnr_qrfz ( i , j , k , m ) = sumn2 enddo enddo do j = 1 , nbc nu_c = min ( 15 , nint ( nu_c_scale / t_nc ( j )) + 2 ) do i = 1 , ntb_c lamc = ( t_nc ( j ) * am_r * ccg ( 2 , nu_c ) * ocg1 ( nu_c ) / r_c ( i )) ** obmr n0_c = t_nc ( j ) * ocg1 ( nu_c ) * lamc ** cce ( 1 , nu_c ) sum1 = 0._dp sumn2 = 0._dp do n = nbc , 1 , - 1 vol = massc ( n ) * orho_w prob = max ( 0.0_dp , 1.0_dp - exp ( - 12 0.0_dp * vol * 5.2e-4_dp * texp )) n_c = n0_c * dc ( n ) ** nu_c * exp ( - lamc * dc ( n )) * dtc ( n ) sumn2 = min ( t_nc ( j ), sumn2 + prob * n_c ) sum1 = sum1 + prob * n_c * massc ( n ) if ( sum1 >= r_c ( i )) exit enddo tpi_qcfz ( i , j , k , m ) = sum1 tni_qcfz ( i , j , k , m ) = sumn2 enddo enddo enddo enddo end subroutine freezewater end module module_mp_tempo_tables","tags":"","url":"sourcefile/module_mp_tempo_tables.f90.html"},{"title":"build_tables.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~build_tables.f90~~EfferentGraph sourcefile~build_tables.f90 build_tables.F90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_tables.f90 module_mp_tempo_tables.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_tables.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_cfgs.f90 module_mp_tempo_cfgs.F90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code program build_tables !! program to build 3 lookup tables for tempo microphysics !! !! example build `make build_tables -f Makefile.intel mpi=1` !! !> timing information (ursa) to build the largest lookup table (rain-graupel collection) !> !> | Description | Time (s) | !> |-----------|-------------| !> | gfortran (-O2)                               | 3000 | !> | mpif90 (-O2) 1 process                       | 3000 | !> | mpif90 (-O2) 13 processes                    | 250 | !> | ifort (-fp-model consistent)                 | 1300 | !> | mpiifort (-fp-model consistent) 1 process    | 1300 | !> | mpiifort (-fp-model consistent) 13 processes | 120 | use module_mp_tempo_params , only : table_dp use module_mp_tempo_tables , only : tempo_build_tables #ifdef build_tables_with_mpi use mpi_f08 #endif implicit none integer :: build_tables_rank , build_tables_num_proc #ifdef build_tables_with_mpi integer :: ierror , mpi_dp_size #endif build_tables_rank = 0 build_tables_num_proc = 1 #ifdef build_tables_with_mpi call MPI_Init ( ierror ) call MPI_Comm_size ( MPI_COMM_WORLD , build_tables_num_proc , ierror ) call MPI_Comm_rank ( MPI_COMM_WORLD , build_tables_rank , ierror ) call MPI_Type_size ( MPI_DOUBLE_PRECISION , mpi_dp_size , ierror ) if ( mpi_dp_size /= table_dp ) then write ( * , '(A,I1,A,I1,A)' ) 'MPI double precision size (' , mpi_dp_size , & ') does not match fortran double precision size (' , table_dp , ')' error stop 'MPI and fortran double precision sizes do not match.' endif #endif call tempo_build_tables ( build_tables_rank , build_tables_num_proc ) #ifdef build_tables_with_mpi call MPI_Finalize ( ierror ) #endif end program build_tables","tags":"","url":"sourcefile/build_tables.f90.html"},{"title":"module_mp_tempo_cfgs.F90 – TEMPO Microphysics","text":"Files dependent on this one sourcefile~~module_mp_tempo_cfgs.f90~~AfferentGraph sourcefile~module_mp_tempo_cfgs.f90 module_mp_tempo_cfgs.F90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_tables.f90 module_mp_tempo_tables.F90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~build_tables.f90 build_tables.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_tables.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_cfgs !! tempo configs implicit none private public :: ty_tempo_cfgs , ty_tempo_table_cfgs !> \\section arg_table_ty_tempo_cfgs Argument Table !! \\htmlinclude ty_tempo_cfgs.html !! ! tempo configuration flags for init type :: ty_tempo_cfgs logical :: aerosolaware_flag = . true . !! flag to run aerosol-aware microphysics logical :: hailaware_flag = . true . !! flag to run hail-aware microphysics logical :: ml_for_bl_nc_flag = . false . !! flag to run machine-learning prediction for subgrid cloud number concentration logical :: ml_for_nc_flag = . false . !! flag to run machine-learning prediction for tempo cloud number concentration logical :: semi_sedi_flag = . false . !! flag for semi-lagrangian sedimentation logical :: refl10cm_from_melting_flag = . false . !! flag to calculate reflectivity for melting snow and graupel logical :: turn_off_micro_flag = . false . !! flag to turn off all microphysical processes logical :: verbose = . false . !! flag to turn on verbose print statements ! flags to turn on/off diagnostic output logical :: refl10cm_flag = . true . !! flag to output 10cm reflectivity logical :: re_cloud_flag = . true . !! flag to output cloud effective radius logical :: re_ice_flag = . true . !! flag to output ice effective radius logical :: re_snow_flag = . true . !! flag to output snow effective radius logical :: max_hail_diameter_flag = . true . !! flag to output maximum hail diameter logical :: rain_med_vol_diam_flag = . false . !! flag to output median volume diameter for rain logical :: graupel_med_vol_diam_flag = . false . !! flag to output median volume diameter for graupel logical :: cloud_number_mixing_ratio_flag = . false . !! flag to output cloud number mixing ratio end type ! tempo lookup table filenames type :: ty_tempo_table_cfgs character ( len = 100 ) :: ccn_table_name = 'ccn_activate.bin' !! ccn table name character ( len = 100 ) :: qrqg_table_name = 'qr_acr_qg_data_tempo_v3' !! rain-graupel collection table name character ( len = 100 ) :: qrqs_table_name = 'qr_acr_qs_data_tempo_v3' !! rain-snow collection table name character ( len = 100 ) :: freezewater_table_name = 'freeze_water_data_tempo_v3' !! freeze water collection table name end type end module module_mp_tempo_cfgs","tags":"","url":"sourcefile/module_mp_tempo_cfgs.f90.html"},{"title":"module_mp_tempo_ml.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~module_mp_tempo_ml.f90~~EfferentGraph sourcefile~module_mp_tempo_ml.f90 module_mp_tempo_ml.F90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~module_mp_tempo_ml.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~module_mp_tempo_ml.f90~~AfferentGraph sourcefile~module_mp_tempo_ml.f90 module_mp_tempo_ml.F90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_ml !! neural network module designed for cloud droplet number concentration prediction !! !! inspired by work from [David John Gagne (NCAR)](https://github.com/NCAR/mlmicrophysics) use module_mp_tempo_params , only : wp , sp , dp implicit none private public :: ty_tempo_ml_data , save_or_read_ml_data , tempo_ml_predict_cloud_number , & nc_ml_nodes , nc_ml_input , nc_ml_output , nc_ml_trans_mean , nc_ml_trans_var , & nc_ml_w00 , nc_ml_w01 , nc_ml_b00 , nc_ml_b01 type ty_tempo_ml_data integer :: input_size integer :: output_size integer :: node_size real ( wp ), dimension (:), allocatable :: transform_mean real ( wp ), dimension (:), allocatable :: transform_var real ( wp ), dimension (:,:), allocatable :: weights00 real ( wp ), dimension (:), allocatable :: bias00 real ( wp ), dimension (:,:), allocatable :: weights01 real ( wp ), dimension (:), allocatable :: bias01 end type ty_tempo_ml_data ! input / output dimensions integer , parameter :: nc_ml_input = 7 integer , parameter :: nc_ml_nodes = 24 integer , parameter :: nc_ml_output = 1 real ( wp ), dimension ( nc_ml_input ), parameter :: & nc_ml_trans_mean = [ 0.000191556196486247_wp , 3.58145042772654e-05_wp , & 3.12611085359273e-07_wp , 5.74303078738579e-05_wp , 8419 1.2092225319_wp , & 27 9.070551773565_wp , 0.123679354084004_wp ] real ( wp ), dimension ( nc_ml_input ), parameter :: & nc_ml_trans_var = [ 5.78143564171777e-08_wp , 3.22834309750552e-08_wp , & 6.45745893307455e-11_wp , 4.16625579383794e-08_wp , 21569463 1.771185_wp , & 9 4.6576255386858_wp , 0.384841247662964_wp ] real ( wp ), dimension ( nc_ml_input * nc_ml_nodes ), parameter :: & nc_ml_w00 = [ - 2.006957_wp , - 0.2812008_wp , - 0.339073_wp , 1.596426_wp , 2.395225_wp , 1.76315_wp , & - 0.0626798_wp , 1.267002_wp , - 0.02234177_wp , - 6.522605e-33_wp , 0.4792154_wp , - 0.1253034_wp , & - 3.217191_wp , - 3.092887_wp , - 0.0863651_wp , 1.071625_wp , 0.09741028_wp , 0.2255831_wp , & - 0.6929023_wp , - 0.02693799_wp , - 3.432344e-33_wp , - 0.8791879_wp , - 0.9359049_wp , 1.083484_wp , & - 0.07909214_wp , - 0.0122418_wp , - 0.02815927_wp , 0.1676407_wp , 0.08252326_wp , 0.6697816_wp , & - 0.4019359_wp , 0.4687141_wp , 0.001813132_wp , - 9.792186e-33_wp , 0.0409322_wp , 0.0113192_wp , & - 0.01354596_wp , 0.00307771_wp , - 0.4635534_wp , 0.03835761_wp , - 0.1015553_wp , 0.7316446_wp , & - 0.05791711_wp , - 0.0002690362_wp , - 7.920147e-33_wp , - 0.1216918_wp , - 0.3190572_wp , 0.09809405_wp , & - 0.16476_wp , - 0.03387314_wp , 0.005422261_wp , 0.04043967_wp , 0.03901243_wp , 0.07444729_wp , & 0.01954299_wp , 0.06918761_wp , 0.04823543_wp , - 8.637957e-33_wp , 0.06371575_wp , - 0.09250915_wp , & - 1.109653_wp , - 1.373999_wp , - 0.2412623_wp , - 0.04482195_wp , 0.1584691_wp , 0.06353725_wp , & 0.0006248798_wp , 0.04593191_wp , - 8.878673e-33_wp , - 0.4988684_wp , 0.01110262_wp , 0.04623203_wp , & 0.006581791_wp , 0.03536217_wp , - 0.1890567_wp , - 0.08839592_wp , 0.1327181_wp , 0.03478973_wp , & - 0.1565902_wp , - 0.100401_wp , - 0.1179777_wp , - 8.879818e-33_wp , - 0.1383738_wp , 0.02847495_wp , & - 0.005902881_wp , 0.005615512_wp , - 0.6308192_wp , - 0.02431803_wp , - 0.141971_wp , - 0.3490018_wp , & - 0.9850957_wp , - 0.1449479_wp , - 8.059166e-33_wp , - 0.1186465_wp , - 1.165381_wp , 0.069015_wp , & 0.003388841_wp , - 0.04041302_wp , 0.1638467_wp , 0.1147008_wp , - 0.04833491_wp , - 0.07755993_wp , & - 0.5137688_wp , 0.04546477_wp , 0.04101883_wp , 6.752353e-33_wp , 0.3541977_wp , 0.04880851_wp , & - 0.00102834_wp , - 0.01280629_wp , - 0.1116254_wp , - 0.02204754_wp , 0.07100908_wp , 0.2354002_wp , & 0.07129629_wp , 0.2489657_wp , 8.080785e-33_wp , - 0.03449865_wp , 0.06037927_wp , - 0.02023619_wp , & 0.7779589_wp , 0.04680278_wp , 0.7492616_wp , 0.6545208_wp , - 1.09497_wp , - 1.176524_wp , & - 0.451585_wp , 0.881124_wp , - 0.4551499_wp , - 8.708624e-33_wp , 1.006558_wp , - 0.04979523_wp , & - 0.0006915367_wp , - 0.002993054_wp , 0.01654614_wp , - 0.07141764_wp , - 0.2216591_wp , 0.8637336_wp , & 0.8358089_wp , - 0.7576646_wp , 8.186339e-33_wp , 0.1161914_wp , 0.7121871_wp , - 1.146734_wp , & 0.03925339_wp , 0.9975697_wp , - 0.06953461_wp , - 0.07598846_wp , - 0.06418022_wp , - 0.01897495_wp , & - 0.03612464_wp , - 0.06703389_wp , - 0.103049_wp , 9.364858e-33_wp , - 0.03949085_wp , 1.005938_wp , & 0.0001625419_wp , - 0.01027657_wp , 0.03823901_wp , 0.3197246_wp , - 0.1160718_wp , 0.04449431_wp , & 0.009831783_wp , 0.6551342_wp , - 8.470687e-33_wp , 0.1374123_wp , - 0.01782138_wp , 0.01719949_wp ] real ( wp ), dimension ( nc_ml_nodes ), parameter :: & nc_ml_w01 = [ - 4.045869_wp , 0.558111_wp , - 1.567351_wp , - 1.64972_wp , 2.748608_wp , & - 1.909901_wp , 0.3955558_wp , 1.507247_wp , 0.3599722_wp , - 0.0001173223_wp , - 0.9398569_wp , & - 0.6867028_wp , - 6 1.72853_wp , - 6 3.13766_wp , 1.165811_wp , - 0.6848684_wp , 0.1931683_wp , & 1.1208_wp , 2.63087_wp , 0.740169_wp , - 2 1.62499_wp , 1.545568_wp , 3.575141_wp , - 1.299604_wp ] real ( wp ), dimension ( nc_ml_nodes ), parameter :: & nc_ml_b00 = [ - 0.9842531_wp , 0.3064759_wp , - 0.4500185_wp , 1.28336_wp , 1.384105_wp , 0.528031_wp , & 0.8453538_wp , 1.579872_wp , 2.245679_wp , - 0.008679952_wp , 0.4549862_wp , - 0.136581_wp , & - 2.576741_wp , - 2.483647_wp , - 0.2089484_wp , 0.7607977_wp , 1.847745_wp , 0.7316047_wp , & - 0.287945_wp , 2.227298_wp , - 2.314714_wp , - 0.2561245_wp , - 0.6993448_wp , - 0.1359731_wp ] real ( wp ), dimension ( nc_ml_output ), parameter :: & nc_ml_b01 = [ 1.572826_wp ] contains subroutine save_or_read_ml_data ( ml_data_in , ml_data_out ) !! initializes and saves or returns neural network information logical , save :: not_initialized = . true . type ( ty_tempo_ml_data ), dimension ( 1 ), intent ( in ), optional :: ml_data_in type ( ty_tempo_ml_data ), dimension ( 1 ), intent ( out ), optional :: ml_data_out type ( ty_tempo_ml_data ), dimension ( 1 ), save :: tempo_ml_data_save if ( not_initialized ) then if ( present ( ml_data_in )) tempo_ml_data_save = ml_data_in not_initialized = . false . endif if ( present ( ml_data_out )) then ml_data_out = tempo_ml_data_save endif end subroutine save_or_read_ml_data subroutine tempo_ml_predict_cloud_number ( qc , qr , qi , qs , pres , temp , w , & predicted_number ) !! predicts number concentration real ( wp ), dimension (:), intent ( in ) :: qc , qr , qi , qs , pres , temp , w real ( wp ), dimension (:), intent ( inout ) :: predicted_number type ( ty_tempo_ml_data ), dimension ( 1 ) :: get_ml_data type ( ty_tempo_ml_data ) :: ml_data integer , parameter :: input_rows = 1 real ( wp ), dimension (:,:), allocatable :: input , input_transformed real ( wp ), dimension (:,:), allocatable :: output00 , output00_activ , reshaped_bias00 real ( wp ), dimension (:,:), allocatable :: output01 , output01_activ , reshaped_bias01 real ( wp ), parameter :: logMin = - 6.0 ! r2 real ( wp ), parameter :: logMax = 9.3010299957 ! 2000 cm&#94;-3 real ( wp ) :: predicted_exp , bias_corr integer :: k , nz ! get neural network data call save_or_read_ml_data ( ml_data_out = get_ml_data ) ml_data = get_ml_data ( 1 ) nz = size ( qc ) ! allocate arrays for input data and transformation if (. not . allocated ( input )) then allocate ( input ( ml_data % input_size , nz )) endif if (. not . allocated ( input_transformed )) then allocate ( input_transformed ( ml_data % input_size , nz )) endif ! collect input data input ( 1 ,:) = qc input ( 2 ,:) = qr input ( 3 ,:) = qi input ( 4 ,:) = qs input ( 5 ,:) = pres input ( 6 ,:) = temp input ( 7 ,:) = w ! transform input data call standard_scaler_transform ( mean = ml_data % transform_mean , var = ml_data % transform_var , & raw_data = input , transformed_data = input_transformed ) ! Allocate arrays if (. not . allocated ( output00 )) then allocate ( output00 ( ml_data % node_size , nz )) endif if (. not . allocated ( output00_activ )) then allocate ( output00_activ ( ml_data % node_size , nz )) endif if (. not . allocated ( reshaped_bias00 )) then allocate ( reshaped_bias00 ( ml_data % node_size , nz )) endif if (. not . allocated ( output01 )) then allocate ( output01 ( ml_data % output_size , nz )) endif if (. not . allocated ( output01_activ )) then allocate ( output01_activ ( ml_data % output_size , nz )) endif if (. not . allocated ( reshaped_bias01 )) then allocate ( reshaped_bias01 ( ml_data % output_size , nz )) endif do k = 1 , nz reshaped_bias00 (:, k ) = ml_data % bias00 reshaped_bias01 ( 1 , k ) = ml_data % bias01 ( 1 ) enddo ! reconstruct neural network ! first layer output00 = matmul ( ml_data % weights00 , input_transformed ) + reshaped_bias00 call relu_activation ( input = output00 , output = output00_activ ) ! second layer output01 = matmul ( ml_data % weights01 , output00_activ ) + reshaped_bias01 call relu_activation ( input = output01 , output = output01_activ ) ! prediction do k = 1 , nz predicted_exp = min ( logMax , max ( logMin , output01_activ ( 1 , k ))) ! bias correction bias_corr = 1.0 if (( predicted_exp >= 0._wp ) . and . ( predicted_exp < 3._wp )) then bias_corr = - 0.2704_wp * predicted_exp ** 5 + 1.838_wp * predicted_exp ** 4 - & 5.127_wp * predicted_exp ** 3 + 8.547_wp * predicted_exp ** 2 - & 8.439_wp * predicted_exp + 4.297_wp endif predicted_number ( k ) = bias_corr * ( 1 0._wp ** predicted_exp ) enddo end subroutine tempo_ml_predict_cloud_number subroutine standard_scaler_transform ( mean , var , raw_data , transformed_data ) !! standard scaler tranformer real ( wp ), dimension (:,:), intent ( in ) :: raw_data real ( wp ), dimension (:), intent ( in ) :: mean , var real ( wp ), dimension (:,:), allocatable , intent ( out ) :: transformed_data integer :: i allocate ( transformed_data ( size ( raw_data , 1 ), size ( raw_data , 2 ))) do i = 1 , size ( raw_data , 1 ) transformed_data ( i ,:) = ( raw_data ( i ,:) - mean ( i )) / sqrt ( var ( i )) end do end subroutine standard_scaler_transform subroutine relu_activation ( input , output ) !! relu activation function real ( wp ), dimension (:,:), intent ( in ) :: input real ( wp ), dimension (:,:), allocatable , intent ( out ) :: output integer :: i , j allocate ( output ( size ( input , 1 ), size ( input , 2 ))) do i = 1 , size ( input , 1 ) do j = 1 , size ( input , 2 ) output ( i , j ) = max ( input ( i , j ), 0._wp ) end do end do end subroutine relu_activation end module module_mp_tempo_ml","tags":"","url":"sourcefile/module_mp_tempo_ml.f90.html"},{"title":"module_mp_tempo_main.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~module_mp_tempo_main.f90~~EfferentGraph sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_aerosols.f90 module_mp_tempo_aerosols.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_aerosols.f90 sourcefile~module_mp_tempo_cfgs.f90 module_mp_tempo_cfgs.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_cfgs.f90 sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_diags.f90 sourcefile~module_mp_tempo_ml.f90 module_mp_tempo_ml.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_aerosols.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_ml.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~module_mp_tempo_main.f90~~AfferentGraph sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_main !! main tempo microphysics code use module_mp_tempo_cfgs , only : ty_tempo_cfgs use module_mp_tempo_params , only : wp , sp , dp , & min_qv , roverrv , rdry , r1 , r2 , nt_c_max , t0 , nrhg , rho_g , & meters3_to_liters , eps , aero_max , nwfa_default , nifa_default use module_mp_tempo_utils , only : get_nuc , get_constant_cloud_number , snow_moments , calc_rslf , calc_rsif use module_mp_tempo_diags , only : reflectivity_10cm , effective_radius , max_hail_diam , & freezing_rain use module_mp_tempo_aerosols , only : init_ice_friendly_aerosols , init_water_friendly_aerosols , & aerosol_collection_efficiency use module_mp_tempo_ml , only : tempo_ml_predict_cloud_number implicit none private public :: tempo_main , ty_tempo_main_diags #ifdef FV3 public :: cloud_check_and_update , ice_check_and_update , snow_check_and_update #endif #ifdef unit_testing public :: get_cloud_table_index , get_snow_table_index , & get_temperature_table_index , get_rain_table_index , & get_graupel_table_index , get_ice_table_index #endif real ( wp ) :: global_dt , global_inverse_dt type :: ty_tempo_main_diags real ( wp ) :: rain_precip real ( wp ) :: cloud_precip real ( wp ) :: ice_liquid_equiv_precip real ( wp ) :: snow_liquid_equiv_precip real ( wp ) :: graupel_liquid_equiv_precip real ( wp ) :: frozen_fraction real ( wp ) :: frz_rain_precip real ( wp ), dimension (:), allocatable :: rain_med_vol_diam real ( wp ), dimension (:), allocatable :: graupel_med_vol_diam real ( wp ), dimension (:), allocatable :: refl10cm real ( wp ), dimension (:), allocatable :: re_cloud real ( wp ), dimension (:), allocatable :: re_ice real ( wp ), dimension (:), allocatable :: re_snow real ( wp ), dimension (:), allocatable :: max_hail_diameter real ( wp ), dimension (:), allocatable :: cloud_number_mixing_ratio end type type :: ty_tend real ( dp ), allocatable , dimension (:) :: & prr_wau , pnr_wau , pnc_wau , prr_rcw , pnc_rcw , pnr_rcr , & ! warm rain prs_scw , pnc_scw , png_scw , pbg_scw , prg_gcw , pnc_gcw , pbg_gcw , & ! riming pri_ihm , pni_ihm , prs_ihm , prg_ihm , prg_scw , & ! riming prr_rcs , pnr_rcs , prg_rcs , png_rcs , prs_rcs , pbg_rcs , & ! rain-snow prr_rcg , pnr_rcg , prg_rcg , png_rcg , pbg_rcg , & ! rain-graupel pri_inu , pni_inu , pri_iha , pni_iha , & ! ice nucleation pri_wfz , pni_wfz , & ! water freezing prg_rfz , png_rfz , pnr_rfz , pri_rfz , pni_rfz , pbg_rfz , & ! rain freezing prs_sde , pri_ide , pni_ide , prs_ide , prg_gde , png_gde , & ! depositional growth pni_iau , prs_iau , & ! ice-snow conversion prr_sml , prr_gml , pbg_sml , pbg_gml , pnr_sml , pnr_gml , & ! melting prr_rci , pnr_rci , pri_rci , pni_rci , prg_rci , png_rci , pbg_rci , & ! rain-ice pni_sci , prs_sci , & ! snow-ice prw_vcd , pnc_wcd , prv_rev , pnr_rev , & ! condensation/evaporation pna_rca , pna_sca , pna_gca , pnd_rcd , pnd_scd , pnd_gcd ! aerosol end type interface get_cloud_number module procedure tempo_ml_predict_cloud_number module procedure get_constant_cloud_number end interface contains subroutine tempo_main ( tempo_cfgs , & qv1d , qc1d , qi1d , qr1d , qs1d , qg1d , qb1d , ni1d , nr1d , nc1d , ng1d , & nwfa1d , nifa1d , t1d , p1d , w1d , dz1d , & qcfrac1d , qifrac1d , qc_bl1d , qcfrac_bl1d , & thten_bl1d , qvten_bl1d , qcten_bl1d , qiten_bl1d , & thten_lwrad1d , thten_swrad1d , & kts , kte , dt , ii , jj , tempo_main_diags ) !! tempo main type ( ty_tend ) :: tend type ( ty_tempo_main_diags ), intent ( out ) :: tempo_main_diags type ( ty_tempo_cfgs ), intent ( in ) :: tempo_cfgs integer , intent ( in ) :: kts , kte , ii , jj real ( wp ), intent ( in ) :: dt real ( wp ), dimension ( kts : kte ), intent ( inout ) :: t1d !! 1D temperature [K] real ( wp ), dimension ( kts : kte ), intent ( in ) :: p1d !! 1D pressure [Pa] real ( wp ), dimension ( kts : kte ), intent ( inout ) :: qv1d !! 1D water vapor mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( inout ) :: qc1d !! 1D cloud water mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( inout ) :: qr1d !! 1D rain water mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( inout ) :: qi1d !! 1D cloud ice mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( inout ) :: qs1d !! 1D snow mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( inout ) :: qg1d !! 1D graupel mass mixing ratio [kg\\; kg&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( inout ) :: ni1d !! 1D cloud ice number mixing ratio [kg&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( inout ) :: nr1d !! 1D rain water number mixing ratio [kg&#94;{-1}] real ( wp ), dimension (:), intent ( inout ), optional :: nc1d !! 1D cloud water number mixing ratio [kg&#94;{-1}] real ( wp ), dimension (:), intent ( inout ), optional :: nwfa1d !! 1D water-friendly aerosol number mixing ratio [kg&#94;{-1}] real ( wp ), dimension (:), intent ( inout ), optional :: nifa1d !! 1D ice-friendly aerosol number mixing ratio [kg&#94;{-1}] real ( wp ), dimension (:), intent ( inout ), optional :: qb1d !! 1D graupel volume mixing ratio [m&#94;{-3}\\; kg&#94;{-1}] real ( wp ), dimension (:), intent ( inout ), optional :: ng1d !! 1D graupel number mixing ratio [kg&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( in ) :: w1d !! 1D vertical velocity m\\; s&#94;{-1}] real ( wp ), dimension ( kts : kte ), intent ( in ) :: dz1d !! 1D vertical grid spacing [m] ! additional optional arrays real ( wp ), dimension (:), intent ( inout ), optional :: qcfrac1d !! cloud fraction real ( wp ), dimension (:), intent ( inout ), optional :: qifrac1d !! cloud ice fraction real ( wp ), dimension (:), intent ( in ), optional :: qc_bl1d !! cloud water mixing ratio from boundary layer scheme real ( wp ), dimension (:), intent ( in ), optional :: qcfrac_bl1d !! cloud fraction from boundary layer scheme real ( wp ), dimension (:), intent ( in ), optional :: thten_bl1d !! potential temperature tendency from boundary layer scheme real ( wp ), dimension (:), intent ( in ), optional :: qvten_bl1d !! water vapor mixing ratio tendency from boundary layer scheme real ( wp ), dimension (:), intent ( in ), optional :: qcten_bl1d !! cloud water mixing ratio tendency from boundary layer scheme real ( wp ), dimension (:), intent ( in ), optional :: qiten_bl1d !! cloud ice mixing ratio from boundary layer scheme real ( wp ), dimension (:), intent ( in ), optional :: thten_lwrad1d !! potential temperature tendency from longwave radiation scheme real ( wp ), dimension (:), intent ( in ), optional :: thten_swrad1d !! potential temperature tendency from shortwave radiation scheme real ( wp ), dimension ( kts : kte ) :: tten , qvten , qcten , qiten , qrten , qsten , & qgten , qbten , niten , nrten , ncten , ngten , nwfaten , nifaten !! tendencies logical , dimension ( kts : kte ) :: l_qc , l_qi , l_qr , l_qs , l_qg !! hydrometeor existence logicals integer , dimension ( kts : kte ) :: idx_bg !! graupel density index ! thermodynamic variables real ( wp ), dimension ( kts : kte ) :: temp , pres , qv !! thermodynamic variables real ( wp ), dimension ( kts : kte ) :: rho , rhof , rhof2 !! thermodynamic variables real ( wp ), dimension ( kts : kte ) :: qvs , qvsi , delqvs !! thermodynamic variables real ( wp ), dimension ( kts : kte ) :: satw , sati , ssatw , ssati !! thermodynamic variables real ( wp ), dimension ( kts : kte ) :: diffu , visco , vsc2 , tcond , lvap , ocp , lvt2 !! thermodynamic variables real ( wp ), dimension ( kts : kte ) :: rc , ri , rr , rs , rg , rb !! local microphysical variables real ( wp ), dimension ( kts : kte ) :: ni , nr , nc , ng , nwfa , nifa !! local microphysics variables real ( dp ), dimension ( kts : kte ) :: ilamc , ilami , ilamr , ilamg !! inverse lambda real ( wp ), dimension ( kts : kte ) :: mvd_r , mvd_c , mvd_g !! median volume diameter real ( dp ), dimension ( kts : kte ) :: smob , smo2 , smo1 , smo0 , smoc , smoe , smof , smog , ns , smoz !! snow moments real ( wp ), dimension ( kts : kte ) :: xrx , xnx !! temporary arrays real ( wp ), dimension (:), allocatable :: xncx , xngx , xqbx , ncsave !! temporary arrays real ( wp ), dimension ( kts : kte + 1 ) :: vtrr , vtnr , vtrs , vtri , vtni , vtrg , vtng , vtrc , vtnc !! fallspeeds real ( wp ), dimension ( kts : kte ) :: vtboost !! snow fallspeed boost factor integer :: substeps_sedi , ktop_sedi , n !! sedimentation substepping variables real ( wp ) :: semi_sedi_factor !! semi-lagrangian sedimentation factor ! local variables real ( wp ) :: tempc , tc0 logical :: do_micro , supersaturated logical , save :: first_call_main = . true . integer :: k , nz ! -------------------------------------------------------------------------------------------- do_micro = . false . supersaturated = . false . global_dt = dt global_inverse_dt = 1._wp / dt nz = size ( qv1d ) allocate ( tend % pnr_rcr ( nz ), source = 0._dp ) allocate ( tend % prr_wau ( nz ), source = 0._dp ) allocate ( tend % pnr_wau ( nz ), source = 0._dp ) allocate ( tend % pnc_wau ( nz ), source = 0._dp ) allocate ( tend % prr_rcw ( nz ), source = 0._dp ) allocate ( tend % pnc_rcw ( nz ), source = 0._dp ) allocate ( tend % prs_scw ( nz ), source = 0._dp ) allocate ( tend % pnc_scw ( nz ), source = 0._dp ) allocate ( tend % png_scw ( nz ), source = 0._dp ) allocate ( tend % prg_scw ( nz ), source = 0._dp ) allocate ( tend % pbg_scw ( nz ), source = 0._dp ) allocate ( tend % prg_gcw ( nz ), source = 0._dp ) allocate ( tend % pbg_gcw ( nz ), source = 0._dp ) allocate ( tend % pnc_gcw ( nz ), source = 0._dp ) allocate ( tend % pri_ihm ( nz ), source = 0._dp ) allocate ( tend % prs_ihm ( nz ), source = 0._dp ) allocate ( tend % prg_ihm ( nz ), source = 0._dp ) allocate ( tend % pni_ihm ( nz ), source = 0._dp ) allocate ( tend % prr_rcs ( nz ), source = 0._dp ) allocate ( tend % prs_rcs ( nz ), source = 0._dp ) allocate ( tend % prg_rcs ( nz ), source = 0._dp ) allocate ( tend % pnr_rcs ( nz ), source = 0._dp ) allocate ( tend % png_rcs ( nz ), source = 0._dp ) allocate ( tend % pbg_rcs ( nz ), source = 0._dp ) allocate ( tend % prg_rcg ( nz ), source = 0._dp ) allocate ( tend % prr_rcg ( nz ), source = 0._dp ) allocate ( tend % png_rcg ( nz ), source = 0._dp ) allocate ( tend % pnr_rcg ( nz ), source = 0._dp ) allocate ( tend % pbg_rcg ( nz ), source = 0._dp ) allocate ( tend % prg_rfz ( nz ), source = 0._dp ) allocate ( tend % pri_rfz ( nz ), source = 0._dp ) allocate ( tend % pni_rfz ( nz ), source = 0._dp ) allocate ( tend % png_rfz ( nz ), source = 0._dp ) allocate ( tend % pnr_rfz ( nz ), source = 0._dp ) allocate ( tend % pbg_rfz ( nz ), source = 0._dp ) allocate ( tend % pri_wfz ( nz ), source = 0._dp ) allocate ( tend % pni_wfz ( nz ), source = 0._dp ) allocate ( tend % pri_inu ( nz ), source = 0._dp ) allocate ( tend % pni_inu ( nz ), source = 0._dp ) allocate ( tend % pri_iha ( nz ), source = 0._dp ) allocate ( tend % pni_iha ( nz ), source = 0._dp ) allocate ( tend % pri_ide ( nz ), source = 0._dp ) allocate ( tend % pni_ide ( nz ), source = 0._dp ) allocate ( tend % prs_ide ( nz ), source = 0._dp ) allocate ( tend % prs_iau ( nz ), source = 0._dp ) allocate ( tend % pni_iau ( nz ), source = 0._dp ) allocate ( tend % prs_sde ( nz ), source = 0._dp ) allocate ( tend % prg_gde ( nz ), source = 0._dp ) allocate ( tend % png_gde ( nz ), source = 0._dp ) allocate ( tend % prr_sml ( nz ), source = 0._dp ) allocate ( tend % pnr_sml ( nz ), source = 0._dp ) allocate ( tend % pbg_sml ( nz ), source = 0._dp ) allocate ( tend % prr_gml ( nz ), source = 0._dp ) allocate ( tend % pnr_gml ( nz ), source = 0._dp ) allocate ( tend % pbg_gml ( nz ), source = 0._dp ) allocate ( tend % pri_rci ( nz ), source = 0._dp ) allocate ( tend % prr_rci ( nz ), source = 0._dp ) allocate ( tend % pnr_rci ( nz ), source = 0._dp ) allocate ( tend % pni_rci ( nz ), source = 0._dp ) allocate ( tend % prg_rci ( nz ), source = 0._dp ) allocate ( tend % png_rci ( nz ), source = 0._dp ) allocate ( tend % pbg_rci ( nz ), source = 0._dp ) allocate ( tend % pni_sci ( nz ), source = 0._dp ) allocate ( tend % prs_sci ( nz ), source = 0._dp ) allocate ( tend % prw_vcd ( nz ), source = 0._dp ) allocate ( tend % pnc_wcd ( nz ), source = 0._dp ) allocate ( tend % prv_rev ( nz ), source = 0._dp ) allocate ( tend % pnr_rev ( nz ), source = 0._dp ) allocate ( tend % pna_rca ( nz ), source = 0._dp ) allocate ( tend % pna_sca ( nz ), source = 0._dp ) allocate ( tend % pna_gca ( nz ), source = 0._dp ) allocate ( tend % pnd_rcd ( nz ), source = 0._dp ) allocate ( tend % pnd_scd ( nz ), source = 0._dp ) allocate ( tend % pnd_gcd ( nz ), source = 0._dp ) ! zero tendencies do k = 1 , nz tten ( k ) = 0._wp qvten ( k ) = 0._wp qcten ( k ) = 0._wp qiten ( k ) = 0._wp qrten ( k ) = 0._wp qsten ( k ) = 0._wp qgten ( k ) = 0._wp ngten ( k ) = 0._wp qbten ( k ) = 0._wp niten ( k ) = 0._wp nrten ( k ) = 0._wp ncten ( k ) = 0._wp nwfaten ( k ) = 0._wp nifaten ( k ) = 0._wp smo0 ( k ) = 0._dp smo1 ( k ) = 0._dp smo2 ( k ) = 0._dp smob ( k ) = 0._dp smoc ( k ) = 0._dp smoe ( k ) = 0._dp smof ( k ) = 0._dp smog ( k ) = 0._dp smoz ( k ) = 0._dp ns ( k ) = 0._dp vtboost ( k ) = 1._wp enddo ! fallspeeds and sedimentation do k = 1 , nz + 1 vtrr ( k ) = 0._wp vtnr ( k ) = 0._wp vtrs ( k ) = 0._wp vtri ( k ) = 0._wp vtni ( k ) = 0._wp vtrc ( k ) = 0._wp vtnc ( k ) = 0._wp vtrg ( k ) = 0._wp vtng ( k ) = 0._wp enddo ! initialization ----------------------------------------------------------------------------- do k = 1 , nz temp ( k ) = t1d ( k ) qv ( k ) = max ( min_qv , qv1d ( k )) pres ( k ) = p1d ( k ) rho ( k ) = roverrv * pres ( k ) / ( rdry * temp ( k ) * ( qv ( k ) + roverrv )) enddo if ( first_call_main ) then if ( present ( nwfa1d )) then if ( sum ( nwfa1d ) < eps ) call init_water_friendly_aerosols ( dz1d , nwfa ) endif if ( present ( nifa1d )) then if ( sum ( nifa1d ) < eps ) call init_ice_friendly_aerosols ( dz1d , nifa ) endif endif call aerosol_check_and_update ( rho = rho , nwfa1d = nwfa1d , nifa1d = nifa1d , & nwfa = nwfa , nifa = nifa , nwfaten = nwfaten , nifaten = nifaten ) call rain_check_and_update ( rho , l_qr , qr1d , nr1d , rr , nr , qrten , nrten , ilamr , mvd_r ) call ice_check_and_update ( rho , l_qi , qi1d , ni1d , ri , ni , qiten , niten , ilami ) call snow_check_and_update ( rho , l_qs , qs1d , rs , qsten ) ! snow moments do k = 1 , nz if ( l_qs ( k )) then tc0 = min ( - 0.1 , temp ( k ) - t0 ) call snow_moments ( rs = rs ( k ), tc = tc0 , & smob = smob ( k ), smoc = smoc ( k ), ns = ns ( k ), & smo0 = smo0 ( k ), smo1 = smo1 ( k ), smo2 = smo2 ( k ), & smoe = smoe ( k ), smof = smof ( k ), smog = smog ( k )) endif enddo ! set one-moment cloud number concentration if (. not . present ( nc1d )) then if ( tempo_cfgs % ml_for_nc_flag ) then xrx = qc1d where ( xrx <= 1.e-12_wp ) xrx = 0._wp ! ml prediction call get_cloud_number ( xrx , qr1d , qi1d , qs1d , pres , temp , w1d , xnx ) nc = xnx * rho else ! single modment constant value call get_cloud_number ( nc = nc ) endif allocate ( ncsave ( nz ), source = nc ) endif call cloud_check_and_update ( rho = rho , l_qc = l_qc , qc1d = qc1d , nc1d = nc1d , & rc = rc , nc = nc , qcten = qcten , ncten = ncten , ilamc = ilamc , mvd_c = mvd_c ) ! init ng and qb if ( first_call_main ) then if ( present ( ng1d ) . and . present ( qb1d )) then if ( sum ( qg1d ) > r1 . and . sum ( ng1d ) < eps . and . sum ( qb1d ) < eps ) then call graupel_init ( rho , qg1d , ng1d , qb1d ) endif endif endif call graupel_check_and_update ( rho = rho , l_qg = l_qg , qg1d = qg1d , ng1d = ng1d , & qb1d = qb1d , rg = rg , ng = ng , rb = rb , idx = idx_bg , qgten = qgten , ngten = ngten , & qbten = qbten , ilamg = ilamg , mvd_g = mvd_g ) ! re-zero tendencies after initial check zero tendencies do k = 1 , nz qcten ( k ) = 0._wp qiten ( k ) = 0._wp qrten ( k ) = 0._wp qsten ( k ) = 0._wp qgten ( k ) = 0._wp ngten ( k ) = 0._wp qbten ( k ) = 0._wp niten ( k ) = 0._wp nrten ( k ) = 0._wp ncten ( k ) = 0._wp enddo call thermo_vars ( qv , temp , pres , rho , rhof , rhof2 , qvs , delqvs , qvsi , & satw , sati , ssatw , ssati , diffu , visco , vsc2 , ocp , lvap , tcond , lvt2 , & supersaturated ) if ( first_call_main ) first_call_main = . false . ! check for hydrometeors or supersaturation -------------------------------------------------- do_micro = any ( l_qc ) . or . any ( l_qr ) . or . any ( l_qi ) . or . any ( l_qs ) . or . any ( l_qg ) if (. not . do_micro . and . . not . supersaturated ) return ! main microphysical processes --------------------------------------------------------------- if (. not . tempo_cfgs % turn_off_micro_flag ) then call warm_rain ( rhof , l_qc , rc , nc , ilamc , mvd_c , l_qr , rr , nr , mvd_r , tend ) endif if (. not . tempo_cfgs % turn_off_micro_flag ) then call rain_snow_rain_graupel ( temp , l_qr , rr , nr , ilamr , l_qs , rs , & l_qg , rg , ng , ilamg , idx_bg , tend ) endif if (. not . tempo_cfgs % turn_off_micro_flag ) then call ice_nucleation ( temp , rho , w1d , qv , qvsi , ssati , ssatw , & nifa , nwfa , ni , smo0 , rc , nc , rr , nr , ilamr , tend ) endif if (. not . tempo_cfgs % turn_off_micro_flag ) then call ice_processes ( rhof , rhof2 , rho , w1d , temp , qv , qvsi , tcond , diffu , & vsc2 , ssati , l_qi , ri , ni , ilami , l_qs , rs , smoe , smof , smo1 , rr , nr , & ilamr , mvd_r , l_qg , rg , ng , ilamg , idx_bg , tend ) endif if (. not . tempo_cfgs % turn_off_micro_flag ) then call riming ( temp , rhof , visco , l_qc , rc , nc , ilamc , mvd_c , l_qs , rs , & smo0 , smob , smoc , smoe , vtboost , l_qg , rg , ng , ilamg , idx_bg , tend ) endif if (. not . tempo_cfgs % turn_off_micro_flag ) then call melting ( rhof2 , rho , temp , qvsi , tcond , diffu , vsc2 , ssati , delqvs , & l_qs , rs , smof , smo0 , smo1 , l_qg , rg , ng , ilamg , idx_bg , tend ) endif if (. not . tempo_cfgs % turn_off_micro_flag ) then call aerosol_scavenging ( temp , rho , rhof , visco , nwfa , nifa , l_qr , nr , ilamr , & mvd_r , l_qs , rs , smob , smoc , smoe , l_qg , rg , ng , ilamg , idx_bg , tend ) endif ! check and sum tendencies ------------------------------------------------------------------- call check_over_depletion ( rho , temp , qvsi , qv , l_qc , rc , l_qi , ri , & l_qr , rr , l_qs , rs , l_qg , rg , tend ) call sum_tendencies ( rho , temp , idx_bg , lvap , ocp , tend , tten , qvten , qcten , & ncten , qiten , niten , qsten , qrten , nrten , qgten , ngten , qbten ) ! update after tendencies applied ------------------------------------------------------------ do k = 1 , nz temp ( k ) = t1d ( k ) + tten ( k ) * global_dt tempc = temp ( k ) - t0 qv ( k ) = max ( min_qv , qv1d ( k ) + qvten ( k ) * global_dt ) rho ( k ) = roverrv * pres ( k ) / ( rdry * temp ( k ) * ( qv ( k ) + roverrv )) nwfaten ( k ) = nwfaten ( k ) - ( tend % pna_rca ( k ) + tend % pna_sca ( k ) + tend % pna_gca ( k ) + & tend % pni_iha ( k )) / rho ( k ) nifaten ( k ) = nifaten ( k ) - ( tend % pnd_rcd ( k ) + tend % pnd_scd ( k ) + tend % pnd_gcd ( k )) / rho ( k ) enddo ! only updates nwfa, nifa call aerosol_check_and_update ( rho = rho , nwfa1d = nwfa1d , nifa1d = nifa1d , & nwfa = nwfa , nifa = nifa , nwfaten = nwfaten , nifaten = nifaten ) ! send temporary arrays to avoid updates to 1d variables at this point xrx = qc1d if ( present ( nc1d )) then if (. not . allocated ( xncx )) allocate ( xncx ( nz ), source = 0._wp ) xncx = nc1d endif call cloud_check_and_update ( rho = rho , l_qc = l_qc , qc1d = xrx , nc1d = xncx , & rc = rc , nc = nc , qcten = qcten , ncten = ncten , ilamc = ilamc , mvd_c = mvd_c ) xrx = qr1d xnx = nr1d call rain_check_and_update ( rho , l_qr , xrx , xnx , rr , nr , qrten , nrten , ilamr , mvd_r ) xrx = qi1d xnx = ni1d call ice_check_and_update ( rho , l_qi , xrx , xnx , ri , ni , qiten , niten , ilami ) xrx = qs1d call snow_check_and_update ( rho , l_qs , xrx , rs , qsten ) ! snow moments do k = 1 , nz smo0 ( k ) = 0._dp smo1 ( k ) = 0._dp smo2 ( k ) = 0._dp smob ( k ) = 0._dp smoc ( k ) = 0._dp smoe ( k ) = 0._dp smof ( k ) = 0._dp smog ( k ) = 0._dp ns ( k ) = 0._dp if ( l_qs ( k )) then tc0 = min ( - 0.1 , temp ( k ) - t0 ) call snow_moments ( rs = rs ( k ), tc = tc0 , & smob = smob ( k ), smoc = smoc ( k ), & smo2 = smo2 ( k )) endif enddo xrx = qg1d if ( present ( ng1d ) . and . present ( qb1d )) then if (. not . allocated ( xngx )) allocate ( xngx ( nz ), source = 0._wp ) if (. not . allocated ( xqbx )) allocate ( xqbx ( nz ), source = 0._wp ) xngx = ng1d xqbx = qb1d endif call graupel_check_and_update ( rho = rho , l_qg = l_qg , qg1d = xrx , ng1d = xngx , & qb1d = xqbx , rg = rg , ng = ng , rb = rb , idx = idx_bg , qgten = qgten , ngten = ngten , & qbten = qbten , ilamg = ilamg , mvd_g = mvd_g ) call thermo_vars ( qv , temp , pres , rho , rhof , rhof2 , qvs , delqvs , qvsi , & satw , sati , ssatw , ssati , diffu , visco , vsc2 , ocp , lvap , tcond , lvt2 , & supersaturated ) ! after update do cloud condensation / rain evaporation -------------------------------------- ! cloud condensation if (. not . tempo_cfgs % turn_off_micro_flag ) then call cloud_condensation ( rho , temp , w1d , ssatw , lvap , tcond , diffu , lvt2 , & nwfa , qv , qvs , l_qc , rc , nc , tend ) do k = 1 , nz qvten ( k ) = qvten ( k ) - tend % prw_vcd ( k ) qcten ( k ) = qcten ( k ) + tend % prw_vcd ( k ) ncten ( k ) = ncten ( k ) + tend % pnc_wcd ( k ) nwfaten ( k ) = nwfaten ( k ) - tend % pnc_wcd ( k ) tten ( k ) = tten ( k ) + lvap ( k ) * ocp ( k ) * tend % prw_vcd ( k ) enddo xrx = qc1d if ( present ( nc1d )) then if (. not . allocated ( xncx )) allocate ( xncx ( nz ), source = 0._wp ) xncx = nc1d endif call cloud_check_and_update ( rho = rho , l_qc = l_qc , qc1d = xrx , nc1d = xncx , & rc = rc , nc = nc , qcten = qcten , ncten = ncten , ilamc = ilamc , mvd_c = mvd_c ) do k = 1 , nz qv ( k ) = max ( min_qv , qv1d ( k ) + qvten ( k ) * global_dt ) temp ( k ) = t1d ( k ) + tten ( k ) * global_dt rho ( k ) = roverrv * pres ( k ) / ( rdry * temp ( k ) * ( qv ( k ) + roverrv )) enddo call thermo_vars ( qv , temp , pres , rho , rhof , rhof2 , qvs , delqvs , qvsi , & satw , sati , ssatw , ssati , diffu , visco , vsc2 , ocp , lvap , tcond , lvt2 , & supersaturated ) endif ! rain evaporation if (. not . tempo_cfgs % turn_off_micro_flag ) then call rain_evaporation ( rho , temp , ssatw , lvap , tcond , diffu , vsc2 , rhof2 , & qv , qvs , l_qr , rr , nr , ilamr , tend ) do k = 1 , nz qrten ( k ) = qrten ( k ) - tend % prv_rev ( k ) qvten ( k ) = qvten ( k ) + tend % prv_rev ( k ) nrten ( k ) = nrten ( k ) - tend % pnr_rev ( k ) nwfaten ( k ) = nwfaten ( k ) + tend % pnr_rev ( k ) tten ( k ) = tten ( k ) - lvap ( k ) * ocp ( k ) * tend % prv_rev ( k ) enddo xrx = qr1d xnx = nr1d call rain_check_and_update ( rho , l_qr , xrx , xnx , rr , nr , qrten , nrten , ilamr , mvd_r ) do k = 1 , nz qv ( k ) = max ( min_qv , qv1d ( k ) + qvten ( k ) * global_dt ) temp ( k ) = t1d ( k ) + tten ( k ) * global_dt rho ( k ) = roverrv * pres ( k ) / ( rdry * temp ( k ) * ( qv ( k ) + roverrv )) enddo call thermo_vars ( qv , temp , pres , rho , rhof , rhof2 , qvs , delqvs , qvsi , & satw , sati , ssatw , ssati , diffu , visco , vsc2 , ocp , lvap , tcond , lvt2 , & supersaturated ) endif ! sedimentation ------------------------------------------------------------------------------ tempo_main_diags % rain_precip = 0._wp tempo_main_diags % cloud_precip = 0._wp tempo_main_diags % ice_liquid_equiv_precip = 0._wp tempo_main_diags % snow_liquid_equiv_precip = 0._wp tempo_main_diags % graupel_liquid_equiv_precip = 0._wp tempo_main_diags % frz_rain_precip = 0._wp ! rain ktop_sedi = 1 substeps_sedi = 1 semi_sedi_factor = 1 0._wp if ( any ( l_qr )) then call rain_fallspeed ( rhof = rhof , l_qr = l_qr , rr = rr , ilamr = ilamr , dz1d = dz1d , & vt = vtrr , vtn = vtnr , substeps_sedi = substeps_sedi , ktop_sedi = ktop_sedi ) if ( tempo_cfgs % semi_sedi_flag ) then substeps_sedi = max ( int ( substeps_sedi / semi_sedi_factor ) + 1 , 1 ) do n = 1 , substeps_sedi call semilagrangian_sedimentation ( dz1d = dz1d , rho = rho , xr = rr , xten = qrten , & vt = vtrr , steps = substeps_sedi , limit = r1 , precip = tempo_main_diags % rain_precip ) call semilagrangian_sedimentation ( dz1d = dz1d , rho = rho , xr = nr , xten = nrten , & vt = vtnr , steps = substeps_sedi , limit = r2 ) vtrr = 0._wp vtnr = 0._wp xrx = qr1d xnx = nr1d call rain_check_and_update ( rho , l_qr , xrx , xnx , rr , nr , qrten , nrten , ilamr , mvd_r ) call rain_fallspeed ( rhof = rhof , l_qr = l_qr , rr = rr , ilamr = ilamr , dz1d = dz1d , & vt = vtrr , vtn = vtnr ) enddo else do n = 1 , substeps_sedi call sedimentation ( xr = rr , vt = vtrr , dz1d = dz1d , rho = rho , xten = qrten , limit = r1 , & steps = substeps_sedi , ktop_sedi = ktop_sedi , precip = tempo_main_diags % rain_precip ) call sedimentation ( xr = nr , vt = vtnr , dz1d = dz1d , rho = rho , xten = nrten , limit = r2 , & steps = substeps_sedi , ktop_sedi = ktop_sedi ) vtrr = 0._wp vtnr = 0._wp xrx = qr1d xnx = nr1d call rain_check_and_update ( rho , l_qr , xrx , xnx , rr , nr , qrten , nrten , ilamr , mvd_r ) call rain_fallspeed ( rhof = rhof , l_qr = l_qr , rr = rr , ilamr = ilamr , dz1d = dz1d , & vt = vtrr , vtn = vtnr ) enddo endif endif ! graupel ktop_sedi = 1 substeps_sedi = 1 semi_sedi_factor = 1 0._wp if ( any ( l_qg )) then call graupel_fallspeed ( rhof = rhof , rho = rho , visco = visco , & l_qg = l_qg , rg = rg , rb = rb , qb1d = qb1d , idx = idx_bg , ilamg = ilamg , dz1d = dz1d , & vt = vtrg , vtn = vtng , substeps_sedi = substeps_sedi , ktop_sedi = ktop_sedi ) if ( tempo_cfgs % semi_sedi_flag ) then substeps_sedi = max ( int ( substeps_sedi / semi_sedi_factor ) + 1 , 1 ) do n = 1 , substeps_sedi call semilagrangian_sedimentation ( dz1d = dz1d , rho = rho , xr = rg , xten = qgten , & vt = vtrg , steps = substeps_sedi , limit = r1 , precip = tempo_main_diags % graupel_liquid_equiv_precip ) call semilagrangian_sedimentation ( dz1d = dz1d , rho = rho , xr = ng , xten = ngten , & vt = vtng , steps = substeps_sedi , limit = r2 ) call semilagrangian_sedimentation ( dz1d = dz1d , rho = rho , xr = rb , xten = qbten , & vt = vtrg , steps = substeps_sedi , limit = meters3_to_liters * r1 / rho_g ( nrhg )) vtrg = 0._wp vtng = 0._wp xrx = qg1d if ( present ( ng1d ) . and . present ( qb1d )) then if (. not . allocated ( xngx )) allocate ( xngx ( nz ), source = 0._wp ) if (. not . allocated ( xqbx )) allocate ( xqbx ( nz ), source = 0._wp ) xngx = ng1d xqbx = qb1d endif call graupel_check_and_update ( rho = rho , l_qg = l_qg , qg1d = xrx , ng1d = xngx , & qb1d = xqbx , rg = rg , ng = ng , rb = rb , idx = idx_bg , qgten = qgten , ngten = ngten , & qbten = qbten , ilamg = ilamg , mvd_g = mvd_g ) call graupel_fallspeed ( rhof = rhof , rho = rho , visco = visco , & l_qg = l_qg , rg = rg , rb = rb , qb1d = qb1d , idx = idx_bg , ilamg = ilamg , dz1d = dz1d , & vt = vtrg , vtn = vtng ) enddo else do n = 1 , substeps_sedi call sedimentation ( xr = rg , vt = vtrg , dz1d = dz1d , rho = rho , xten = qgten , limit = r1 , & steps = substeps_sedi , ktop_sedi = ktop_sedi , precip = tempo_main_diags % graupel_liquid_equiv_precip ) call sedimentation ( xr = ng , vt = vtng , dz1d = dz1d , rho = rho , xten = ngten , limit = r2 , & steps = substeps_sedi , ktop_sedi = ktop_sedi ) call sedimentation ( xr = rb , vt = vtrg , dz1d = dz1d , rho = rho , xten = qbten , & limit = meters3_to_liters * r1 / rho_g ( nrhg ), steps = substeps_sedi , ktop_sedi = ktop_sedi ) vtrg = 0._wp vtng = 0._wp xrx = qg1d if ( present ( ng1d ) . and . present ( qb1d )) then if (. not . allocated ( xngx )) allocate ( xngx ( nz ), source = 0._wp ) if (. not . allocated ( xqbx )) allocate ( xqbx ( nz ), source = 0._wp ) xngx = ng1d xqbx = qb1d endif call graupel_check_and_update ( rho = rho , l_qg = l_qg , qg1d = xrx , ng1d = xngx , & qb1d = xqbx , rg = rg , ng = ng , rb = rb , idx = idx_bg , qgten = qgten , ngten = ngten , & qbten = qbten , ilamg = ilamg , mvd_g = mvd_g ) call graupel_fallspeed ( rhof = rhof , rho = rho , visco = visco , & l_qg = l_qg , rg = rg , rb = rb , qb1d = qb1d , idx = idx_bg , ilamg = ilamg , dz1d = dz1d , & vt = vtrg , vtn = vtng ) enddo endif endif ! snow ktop_sedi = 1 substeps_sedi = 1 if ( any ( l_qs )) then call snow_fallspeed ( rhof = rhof , l_qs = l_qs , rs = rs , prr_sml = tend % prr_sml , smob = smob , smoc = smoc , & rr = rr , vtrr = vtrr , dz1d = dz1d , vt = vtrs , vtboost = vtboost , substeps_sedi = substeps_sedi , ktop_sedi = ktop_sedi ) do n = 1 , substeps_sedi call sedimentation ( xr = rs , vt = vtrs , dz1d = dz1d , rho = rho , xten = qsten , limit = r1 , & steps = substeps_sedi , ktop_sedi = ktop_sedi , precip = tempo_main_diags % snow_liquid_equiv_precip ) enddo endif ! ice ktop_sedi = 1 substeps_sedi = 1 if ( any ( l_qi )) then call ice_fallspeed ( rhof , l_qi , ri , ilami , dz1d , vtri , vtni , & substeps_sedi , ktop_sedi ) call sedimentation ( xr = ri , vt = vtri , dz1d = dz1d , rho = rho , xten = qiten , limit = r1 , & steps = substeps_sedi , ktop_sedi = ktop_sedi , precip = tempo_main_diags % ice_liquid_equiv_precip ) call sedimentation ( xr = ni , vt = vtni , dz1d = dz1d , rho = rho , xten = niten , limit = r2 , & steps = substeps_sedi , ktop_sedi = ktop_sedi ) endif ! cloud ktop_sedi = 1 substeps_sedi = 1 if ( any ( l_qc )) then call cloud_fallspeed ( rhof , w1d , l_qc , rc , nc , ilamc , dz1d , vtrc , vtnc , ktop_sedi ) call sedimentation ( xr = rc , vt = vtrc , dz1d = dz1d , rho = rho , xten = qcten , limit = r1 , & steps = substeps_sedi , ktop_sedi = ktop_sedi , precip = tempo_main_diags % cloud_precip ) call sedimentation ( xr = nc , vt = vtnc , dz1d = dz1d , rho = rho , xten = ncten , limit = r2 , & steps = substeps_sedi , ktop_sedi = ktop_sedi ) endif ! after sedimentation freeze all cloud water below hgfrz temperature ! and melt all cloud ice above freezing if (. not . tempo_cfgs % turn_off_micro_flag ) then call freeze_cloud_melt_ice ( temp = temp , rho = rho , ocp = ocp , lvap = lvap , & qi1d = qi1d , ni1d = ni1d , qiten = qiten , niten = niten , qc1d = qc1d , nc1d = nc1d , & ncsave = ncsave , qcten = qcten , ncten = ncten , tten = tten ) endif ! final update ------------------------------------------------------------------------------- do k = 1 , nz t1d ( k ) = t1d ( k ) + tten ( k ) * global_dt qv1d ( k ) = max ( min_qv , ( qv1d ( k ) + qvten ( k ) * global_dt )) rho ( k ) = roverrv * pres ( k ) / ( rdry * temp ( k ) * ( qv ( k ) + roverrv )) if ( present ( nwfa1d )) then nwfa1d ( k ) = max ( nwfa_default , min ( aero_max , ( nwfa1d ( k ) + nwfaten ( k ) * global_dt ))) endif if ( present ( nifa1d )) then nifa1d ( k ) = max ( nifa_default , min ( aero_max , ( nifa1d ( k ) + nifaten ( k ) * global_dt ))) endif enddo call cloud_check_and_update ( rho = rho , l_qc = l_qc , qc1d = qc1d , nc1d = nc1d , & rc = rc , nc = nc , qcten = qcten , ncten = ncten , ilamc = ilamc , mvd_c = mvd_c ) call rain_check_and_update ( rho , l_qr , qr1d , nr1d , rr , nr , qrten , nrten , ilamr , mvd_r ) call ice_check_and_update ( rho , l_qi , qi1d , ni1d , ri , ni , qiten , niten , ilami ) call snow_check_and_update ( rho , l_qs , qs1d , rs , qsten ) ! snow moments do k = 1 , nz smo0 ( k ) = 0._dp smo1 ( k ) = 0._dp smo2 ( k ) = 0._dp smob ( k ) = 0._dp smoc ( k ) = 0._dp smoe ( k ) = 0._dp smof ( k ) = 0._dp smog ( k ) = 0._dp smoz ( k ) = 0._dp ns ( k ) = 0._dp if ( l_qs ( k )) then tc0 = min ( - 0.1 , temp ( k ) - t0 ) call snow_moments ( rs = rs ( k ), tc = tc0 , & smob = smob ( k ), smoc = smoc ( k ), & smo2 = smo2 ( k ), smoz = smoz ( k )) endif enddo call graupel_check_and_update ( rho = rho , l_qg = l_qg , qg1d = qg1d , ng1d = ng1d , & qb1d = qb1d , rg = rg , ng = ng , rb = rb , idx = idx_bg , qgten = qgten , ngten = ngten , & qbten = qbten , ilamg = ilamg , mvd_g = mvd_g ) ! diagnostic output -------------------------------------------------------------------------- ! frozen fraction tempo_main_diags % frozen_fraction = & ( tempo_main_diags % ice_liquid_equiv_precip + tempo_main_diags % snow_liquid_equiv_precip + & tempo_main_diags % graupel_liquid_equiv_precip ) / & ( tempo_main_diags % ice_liquid_equiv_precip + tempo_main_diags % snow_liquid_equiv_precip + & tempo_main_diags % graupel_liquid_equiv_precip + tempo_main_diags % rain_precip + r1 ) ! freezing rain call freezing_rain ( temp = temp ( 1 ), rain_precip = tempo_main_diags % rain_precip , & cloud_precip = tempo_main_diags % cloud_precip , & frz_rain = tempo_main_diags % frz_rain_precip ) if ( tempo_cfgs % cloud_number_mixing_ratio_flag ) then allocate ( tempo_main_diags % cloud_number_mixing_ratio ( nz ), source = nc * rho ) endif ! median volume diameter of rain and graupel if ( tempo_cfgs % rain_med_vol_diam_flag ) then allocate ( tempo_main_diags % rain_med_vol_diam ( nz ), source = 0._wp ) tempo_main_diags % rain_med_vol_diam = mvd_r endif if ( tempo_cfgs % graupel_med_vol_diam_flag ) then allocate ( tempo_main_diags % graupel_med_vol_diam ( nz ), source = 0._wp ) tempo_main_diags % graupel_med_vol_diam = mvd_g endif ! max hail diameter if ( tempo_cfgs % max_hail_diameter_flag ) then allocate ( tempo_main_diags % max_hail_diameter ( nz ), source = 0._wp ) call max_hail_diam ( rho , rg , ng , ilamg , idx_bg , & tempo_main_diags % max_hail_diameter ) endif ! 10-cm reflectivity if ( tempo_cfgs % refl10cm_flag ) then allocate ( tempo_main_diags % refl10cm ( nz ), source =- 3 5._wp ) call reflectivity_10cm ( tempo_cfgs % refl10cm_from_melting_flag , & temp , l_qr , rr , nr , ilamr , & l_qs , rs , smoc , smob , smoz , l_qg , rg , ng , idx_bg , ilamg , & tempo_main_diags % refl10cm ) endif ! effective radii if (( tempo_cfgs % re_cloud_flag ) . and . ( tempo_cfgs % re_ice_flag ) . and . ( tempo_cfgs % re_snow_flag )) then allocate ( tempo_main_diags % re_cloud ( nz ), source = 0._wp ) allocate ( tempo_main_diags % re_ice ( nz ), source = 0._wp ) allocate ( tempo_main_diags % re_snow ( nz ), source = 0._wp ) ! this next code block optionally adds pbl clouds to resolved clouds ! for the effective radius calculation ! thus qc -> qc + qc_bl, a new value of nc is predicted with ML, ! and then ilamc is updated along with rc and nc before re is calculated ! please output any cloud diagnostics before this calculation ! because rc, nc, ilamc, and mvd_c will include contributions from ! resolved and explicit clouds and qcten and ncten are zeroed if ( present ( qc_bl1d ) . and . present ( qcfrac_bl1d )) then xrx = qc1d if (. not . allocated ( xncx )) allocate ( xncx ( nz ), source = 0._wp ) xncx = nc1d do k = 1 , nz if (( xrx ( k ) <= r1 ) . and . & ( qc_bl1d ( k ) > 1.e-9_wp ) . and . ( qcfrac_bl1d ( k ) > 0._wp )) then xrx ( k ) = xrx ( k ) + qc_bl1d ( k ) / qcfrac_bl1d ( k ) ! use in-cloud PBL mass endif enddo where ( xrx <= 1.e-12_wp ) xrx = 0._wp ! ml prediction call get_cloud_number ( xrx , qr1d , qi1d , qs1d , pres , temp , w1d , xncx ) ! xrx and xncx have been updated to include pbl contribution -> update ilamc and nc ! for effective radius calculation qcten = 0._wp ncten = 0._wp call cloud_check_and_update ( rho = rho , l_qc = l_qc , qc1d = xrx , nc1d = xncx , & rc = rc , nc = nc , qcten = qcten , ncten = ncten , ilamc = ilamc , mvd_c = mvd_c ) endif call effective_radius ( temp , l_qc , nc , ilamc , l_qi , ilami , l_qs , rs , & tempo_main_diags % re_cloud , tempo_main_diags % re_ice , tempo_main_diags % re_snow ) endif end subroutine tempo_main subroutine aerosol_check_and_update ( rho , nwfa1d , nifa1d , nwfa , nifa , nwfaten , nifaten ) !! sets aerosol number concentrations and checks bounds use module_mp_tempo_params , only : nwfa_default , aero_max , nifa_default real ( wp ), dimension (:), intent ( in ) :: rho real ( wp ), dimension (:), intent ( inout ) :: nwfa , nifa , nwfaten , nifaten real ( wp ), dimension (:), intent ( inout ), optional :: nwfa1d , nifa1d integer :: k , nz nz = size ( rho ) do k = 1 , nz if ( present ( nwfa1d )) then nwfa ( k ) = ( nwfa1d ( k ) + nwfaten ( k ) * global_dt ) * rho ( k ) endif if ( present ( nifa1d )) then nifa ( k ) = ( nifa1d ( k ) + nifaten ( k ) * global_dt ) * rho ( k ) endif nwfa ( k ) = max ( nwfa_default * rho ( k ), min ( aero_max * rho ( k ), nwfa ( k ))) nifa ( k ) = max ( nifa_default * rho ( k ), min ( aero_max * rho ( k ), nifa ( k ))) enddo end subroutine aerosol_check_and_update subroutine cloud_check_and_update ( rho , l_qc , qc1d , nc1d , rc , nc , & qcten , ncten , ilamc , mvd_c ) !! computes cloud water contents, ilamc, and mvd_c and checks bounds use module_mp_tempo_params , only : r1 , nt_c_max , nt_c_min , nu_c_scale , & am_r , bm_r , cce , ccg , d0c , d0r , ocg1 , ocg2 , obmr , nt_c_l , d0r real ( wp ), dimension (:), intent ( in ) :: rho real ( wp ), dimension (:), intent ( inout ) :: qc1d , qcten , ncten , rc , nc real ( wp ), dimension (:), intent ( out ) :: mvd_c real ( dp ), dimension (:), intent ( out ) :: ilamc real ( wp ), dimension (:), intent ( inout ), optional :: nc1d logical , dimension (:), intent ( inout ) :: l_qc integer :: k , nz , nu_c real ( dp ) :: lamc , xdc logical :: hit_limit nz = size ( qc1d ) do k = 1 , nz hit_limit = . false . if ( qc1d ( k ) + qcten ( k ) * global_dt > r1 ) then l_qc ( k ) = . true . ! update mass rc ( k ) = ( qc1d ( k ) + qcten ( k ) * global_dt ) * rho ( k ) qc1d ( k ) = qc1d ( k ) + qcten ( k ) * global_dt ! update number if ( present ( nc1d )) then nc ( k ) = max ( nt_c_min , ( nc1d ( k ) + ncten ( k ) * global_dt ) * rho ( k )) ! number check if ( nc ( k ) <= nt_c_min ) then hit_limit = . true . nc ( k ) = nt_c_min endif if ( nc ( k ) > nt_c_max ) then hit_limit = . true . nc ( k ) = nt_c_max endif ! size check nu_c = get_nuc ( nc ( k )) lamc = ( nc ( k ) * am_r * ccg ( 2 , nu_c ) * ocg1 ( nu_c ) / rc ( k )) ** obmr xdc = ( bm_r + nu_c + 1._dp ) / lamc if ( xdc < d0c ) then lamc = cce ( 2 , nu_c ) / d0c hit_limit = . true . elseif ( xDc > d0r * 2._dp ) then lamc = cce ( 2 , nu_c ) / ( d0r * 2._dp ) hit_limit = . true . endif ! update number to be consistent with lamc nc ( k ) = ccg ( 1 , nu_c ) * ocg2 ( nu_c ) * rc ( k ) / am_r * lamc ** bm_r if ( hit_limit ) ncten ( k ) = ( nc ( k ) / rho ( k ) - nc1d ( k )) * global_inverse_dt nc1d ( k ) = max ( nt_c_min / rho ( k ), & min ( ccg ( 1 , nu_c ) * ocg2 ( nu_c ) * qc1d ( k ) / am_r * lamc ** bm_r , nt_c_max / rho ( k ))) ! else ! nc(k) = get_cloud_number() endif nu_c = get_nuc ( nc ( k )) lamc = ( nc ( k ) * am_r * ccg ( 2 , nu_c ) * ocg1 ( nu_c ) / rc ( k )) ** obmr ilamc ( k ) = 1._dp / lamc mvd_c ( k ) = max ( min (( 3.0_wp + nu_c + 0.672_wp ) * ilamc ( k ), d0r ), d0c ) else l_qc ( k ) = . false . rc ( k ) = r1 nc ( k ) = nt_c_min mvd_c ( k ) = d0c ilamc ( k ) = 0._dp qcten ( k ) = - qc1d ( k ) * global_inverse_dt qc1d ( k ) = 0.0_wp if ( present ( nc1d )) then ncten ( k ) = - nc1d ( k ) * global_inverse_dt nc1d ( k ) = 0.0_wp endif endif enddo end subroutine cloud_check_and_update subroutine rain_check_and_update ( rho , l_qr , qr1d , nr1d , rr , nr , & qrten , nrten , ilamr , mvd_r ) !! computes rain water contents, ilamr, and mvd_r and checks bounds use module_mp_tempo_params , only : r1 , r2 , mu_r , crg , & am_r , bm_r , obmr , d0r , d0r_max , org2 , org3 , rho_g real ( wp ), dimension (:), intent ( in ) :: rho real ( wp ), dimension (:), intent ( inout ) :: qr1d , nr1d , qrten , nrten , rr , nr real ( wp ), dimension (:), intent ( out ) :: mvd_r real ( dp ), dimension (:), intent ( out ) :: ilamr logical , dimension (:), intent ( inout ) :: l_qr integer :: k , nz real ( dp ) :: lamr logical :: hit_limit nz = size ( qr1d ) do k = 1 , nz hit_limit = . false . if ( qr1d ( k ) + qrten ( k ) * global_dt > r1 ) then l_qr ( k ) = . true . ! update mass rr ( k ) = ( qr1d ( k ) + qrten ( k ) * global_dt ) * rho ( k ) qr1d ( k ) = qr1d ( k ) + qrten ( k ) * global_dt ! update number nr ( k ) = max ( r2 , ( nr1d ( k ) + nrten ( k ) * global_dt ) * rho ( k )) ! number check if ( nr ( k ) <= r2 ) then hit_limit = . true . mvd_r ( k ) = 1.0e-3_wp lamr = ( 3.0_dp + mu_r + 0.672_dp ) / mvd_r ( k ) nr ( k ) = crg ( 2 ) * org3 * rr ( k ) * lamr ** bm_r / am_r endif ! size check lamr = ( am_r * crg ( 3 ) * org2 * nr ( k ) / rr ( k )) ** obmr mvd_r ( k ) = ( 3.0_wp + mu_r + 0.672_wp ) / lamr if ( mvd_r ( k ) > d0r_max ) then hit_limit = . true . mvd_r ( k ) = d0r_max lamr = ( 3.0_dp + mu_r + 0.672_dp ) / mvd_r ( k ) nr ( k ) = crg ( 2 ) * org3 * rr ( k ) * lamr ** bm_r / am_r elseif ( mvd_r ( k ) < d0r * 0.75_wp ) then hit_limit = . true . mvd_r ( k ) = d0r * 0.75_wp lamr = ( 3.0_dp + mu_r + 0.672_dp ) / mvd_r ( k ) nr ( k ) = crg ( 2 ) * org3 * rr ( k ) * lamr ** bm_r / am_r endif ! update number to be consistent with lamc if ( hit_limit ) nrten ( k ) = ( nr ( k ) / rho ( k ) - nr1d ( k )) * global_inverse_dt nr1d ( k ) = crg ( 2 ) * org3 * qr1d ( k ) * lamr ** bm_r / am_r ilamr ( k ) = 1._dp / lamr else l_qr ( k ) = . false . rr ( k ) = r1 nr ( k ) = r2 mvd_r ( k ) = d0r ilamr ( k ) = 0._dp qrten ( k ) = - qr1d ( k ) * global_inverse_dt nrten ( k ) = - nr1d ( k ) * global_inverse_dt qr1d ( k ) = 0.0_wp nr1d ( k ) = 0.0_wp endif enddo end subroutine rain_check_and_update subroutine ice_check_and_update ( rho , l_qi , qi1d , ni1d , ri , ni , & qiten , niten , ilami ) !! computes ice contents, ilami and checks bounds use module_mp_tempo_params , only : max_ni , r1 , r2 , cie , cig , & mu_i , am_i , bm_i , oig1 , oig2 , obmi , d0s real ( wp ), dimension (:), intent ( in ) :: rho real ( wp ), dimension (:), intent ( inout ) :: qi1d , ni1d , qiten , niten , ri , ni real ( dp ), dimension (:), intent ( out ) :: ilami logical , dimension (:), intent ( inout ) :: l_qi integer :: k , nz real ( dp ) :: lami , xdi logical :: hit_limit nz = size ( qi1d ) do k = 1 , nz hit_limit = . false . if ( qi1d ( k ) + qiten ( k ) * global_dt > r1 ) then l_qi ( k ) = . true . !update mass ri ( k ) = ( qi1d ( k ) + qiten ( k ) * global_dt ) * rho ( k ) qi1d ( k ) = qi1d ( k ) + qiten ( k ) * global_dt !update number ni ( k ) = max ( r2 , ( ni1d ( k ) + niten ( k ) * global_dt ) * rho ( k )) ! check number if ( ni ( k ) <= r2 ) then hit_limit = . true . lami = cie ( 2 ) / 5.e-6_dp ni ( k ) = min ( max_ni , cig ( 1 ) * oig2 * ri ( k ) / am_i * lami ** bm_i ) endif ! check size lami = ( am_i * cig ( 2 ) * oig1 * ni ( k ) / ri ( k )) ** obmi xdi = ( bm_i + mu_i + 1._dp ) / lami if ( xdi < 5.e-6_dp ) then hit_limit = . true . lami = cie ( 2 ) / 5.e-6_dp ni ( k ) = min ( max_ni , cig ( 1 ) * oig2 * ri ( k ) / am_i * lami ** bm_i ) elseif ( xdi > d0s ) then hit_limit = . true . lami = cie ( 2 ) / d0s ni ( k ) = cig ( 1 ) * oig2 * ri ( k ) / am_i * lami ** bm_i endif if ( hit_limit ) niten ( k ) = ( ni ( k ) / rho ( k ) - ni1d ( k )) * global_inverse_dt ni1d ( k ) = max ( r2 / rho ( k ), & min ( cig ( 1 ) * oig2 * qi1d ( k ) / am_i * lami ** bm_i , max_ni / rho ( k ))) ilami ( k ) = 1._dp / lami else l_qi ( k ) = . false . ri ( k ) = r1 ni ( k ) = r2 ilami ( k ) = 0._dp qiten ( k ) = - qi1d ( k ) * global_inverse_dt niten ( k ) = - ni1d ( k ) * global_inverse_dt qi1d ( k ) = 0.0_wp ni1d ( k ) = 0.0_wp endif enddo end subroutine ice_check_and_update subroutine snow_check_and_update ( rho , l_qs , qs1d , rs , qsten ) !! computes snow mass use module_mp_tempo_params , only : max_ni , r1 , r2 real ( wp ), dimension (:), intent ( in ) :: rho real ( wp ), dimension (:), intent ( inout ) :: qs1d , rs , qsten logical , dimension (:), intent ( inout ) :: l_qs integer :: k , nz nz = size ( qs1d ) do k = 1 , nz if ( qs1d ( k ) + qsten ( k ) * global_dt > r1 ) then l_qs ( k ) = . true . ! update mass rs ( k ) = ( qs1d ( k ) + qsten ( k ) * global_dt ) * rho ( k ) qs1d ( k ) = qs1d ( k ) + qsten ( k ) * global_dt else l_qs ( k ) = . false . rs ( k ) = r1 qsten ( k ) = - qs1d ( k ) * global_inverse_dt qs1d ( k ) = 0.0_wp endif enddo end subroutine snow_check_and_update subroutine graupel_check_and_update ( rho , l_qg , qg1d , ng1d , qb1d , rg , ng , rb , & idx , qgten , ngten , qbten , ilamg , mvd_g ) !! computes graupel contents, ilamg, and mvd_g and checks bounds use module_mp_tempo_params , only : r1 , r2 , nrhg , rho_g , mu_g , & am_g , bm_g , ogg3 , cgg , ogg2 , obmg , d0r , idx_bg1 , gonv_max , & gonv_min , oge1 , ogg1 , d0g , meters3_to_liters real ( wp ), dimension (:), intent ( in ) :: rho real ( wp ), dimension (:), intent ( inout ) :: qg1d , qgten , rg , ng , rb , ngten , qbten real ( wp ), dimension (:), intent ( inout ), optional :: ng1d , qb1d real ( dp ), dimension (:), intent ( out ) :: ilamg real ( wp ), dimension (:), intent ( out ) :: mvd_g logical , dimension (:), intent ( inout ) :: l_qg integer , dimension (:), intent ( inout ) :: idx integer :: k , nz real ( dp ) :: lamg , ygra1 , zans1 , n0_exp , lam_exp logical :: hit_limit nz = size ( qg1d ) do k = 1 , nz hit_limit = . false . if ( qg1d ( k ) + qgten ( k ) * global_dt > r1 ) then l_qg ( k ) = . true . !update mass rg ( k ) = ( qg1d ( k ) + qgten ( k ) * global_dt ) * rho ( k ) qg1d ( k ) = qg1d ( k ) + qgten ( k ) * global_dt !update number and density if ( present ( ng1d ) . and . present ( qb1d )) then ng ( k ) = max ( r2 , ( ng1d ( k ) + ngten ( k ) * global_dt ) * rho ( k )) ! qb1d is L/kg and rb is L/m&#94;3 rb ( k ) = min ( max ( rg ( k ) * meters3_to_liters / rho_g ( nrhg ), & ( qb1d ( k ) + qbten ( k ) * global_dt ) * rho ( k )), rg ( k ) * meters3_to_liters / rho_g ( 1 )) idx ( k ) = max ( 1 , min ( nint ( 1 0._wp * rg ( k ) / rb ( k )) + 1 , nrhg )) ! check number if ( ng ( k ) <= r2 ) then hit_limit = . true . mvd_g ( k ) = 1.5e-3_wp lamg = ( 3.0_dp + mu_g + 0.672_dp ) / mvd_g ( k ) ng ( k ) = cgg ( 2 , 1 ) * ogg3 * rg ( k ) * lamg ** bm_g / am_g ( idx ( k )) endif ! check size lamg = ( am_g ( idx ( k )) * cgg ( 3 , 1 ) * ogg2 * ng ( k ) / rg ( k )) ** obmg mvd_g ( k ) = ( 3.0_wp + mu_g + 0.672_wp ) / lamg if ( mvd_g ( k ) > 2 5.4e-3_wp ) then hit_limit = . true . mvd_g ( k ) = 2 5.4e-3_wp lamg = ( 3.0_dp + mu_g + 0.672_dp ) / mvd_g ( k ) ng ( k ) = cgg ( 2 , 1 ) * ogg3 * rg ( k ) * lamg ** bm_g / am_g ( idx ( k )) elseif ( mvd_g ( k ) < d0r ) then hit_limit = . true . mvd_g ( k ) = d0r lamg = ( 3.0_dp + mu_g + 0.672_dp ) / mvd_g ( k ) ng ( k ) = cgg ( 2 , 1 ) * ogg3 * rg ( k ) * lamg ** bm_g / am_g ( idx ( k )) endif if ( hit_limit ) ngten ( k ) = ( ng ( k ) / rho ( k ) - ng1d ( k )) * global_inverse_dt ng1d ( k ) = cgg ( 2 , 1 ) * ogg3 * qg1d ( k ) * lamg ** bm_g / am_g ( idx ( k )) qb1d ( k ) = min ( max ( qg1d ( k ) * meters3_to_liters / rho_g ( nrhg ), & qb1d ( k ) + qbten ( k ) * global_dt ), meters3_to_liters * qg1d ( k ) / rho_g ( 1 )) idx ( k ) = max ( 1 , min ( nint ( 1 0._wp * qg1d ( k ) / qb1d ( k )) + 1 , nrhg )) else idx ( k ) = idx_bg1 ygra1 = log10 ( max ( 1.e-9_dp , real ( rg ( k ), kind = dp ))) zans1 = 3.4_dp + 2._dp / 7._dp * ( ygra1 + 8._dp ) n0_exp = max ( gonv_min , min ( 1 0._dp ** ( zans1 ), gonv_max )) lam_exp = ( n0_exp * am_g ( idx ( k )) * cgg ( 1 , 1 ) / rg ( k )) ** oge1 lamg = lam_exp * ( cgg ( 3 , 1 ) * ogg2 * ogg1 ) ** obmg ng ( k ) = cgg ( 2 , 1 ) * ogg3 * rg ( k ) * lamg ** bm_g / am_g ( idx ( k )) rb ( k ) = meters3_to_liters * rg ( k ) / rho_g ( idx ( k )) endif ilamg ( k ) = 1._dp / lamg mvd_g ( k ) = ( 3.0_wp + mu_g + 0.672_wp ) * ilamg ( k ) else l_qg ( k ) = . false . rg ( k ) = r1 ng ( k ) = r2 mvd_g ( k ) = d0g ilamg ( k ) = 0._dp idx ( k ) = idx_bg1 rb ( k ) = meters3_to_liters * r1 / rho_g ( idx ( k )) qgten ( k ) = - qg1d ( k ) * global_inverse_dt qg1d ( k ) = 0.0_wp if ( present ( ng1d ) . and . present ( qb1d )) then ngten ( k ) = - ng1d ( k ) * global_inverse_dt qbten ( k ) = - qb1d ( k ) * global_inverse_dt ng1d ( k ) = 0.0_wp qb1d ( k ) = 0.0_wp endif endif enddo end subroutine graupel_check_and_update subroutine graupel_init ( rho , qg1d , ng1d , qb1d ) !! initializes graupel number and volume if both are zero !! and hail-aware = true use module_mp_tempo_params , only : r1 , meters3_to_liters , & idx_bg1 , am_g , bm_g , mu_g , ogg3 , cgg real ( wp ), dimension (:), intent ( in ) :: rho real ( wp ), dimension (:), intent ( in ) :: qg1d real ( wp ), dimension (:), intent ( inout ) :: ng1d , qb1d integer :: k , nz , idx real ( dp ) :: lamg real ( wp ) :: mvd_g , rg , ng , rb nz = size ( rho ) do k = 1 , nz if ( qg1d ( k ) > r1 ) then rg = qg1d ( k ) * rho ( k ) rb = rg * meters3_to_liters / rho_g ( idx_bg1 ) idx = max ( 1 , min ( nint ( 1 0._wp * rg / rb ) + 1 , nrhg )) mvd_g = 5.e-3_wp lamg = ( 3.0_dp + mu_g + 0.672_dp ) / mvd_g ng = cgg ( 2 , 1 ) * ogg3 * rg * lamg ** bm_g / am_g ( idx ) ng1d ( k ) = ng / rho ( k ) qb1d ( k ) = rb / rho ( k ) endif enddo end subroutine graupel_init subroutine thermo_vars ( qv , temp , pres , rho , rhof , rhof2 , qvs , delqvs , qvsi , & satw , sati , ssatw , ssati , diffu , visco , vsc2 , ocp , lvap , tcond , lvt2 , & supersaturated ) !! computes thermodynamic variables use module_mp_tempo_params , only : t0 , rho_not , eps , cp , lvap0 , orv real ( wp ), dimension (:), intent ( in ) :: qv , temp , pres , rho real ( wp ), dimension (:), intent ( out ) :: rhof , rhof2 , qvs , & delqvs , qvsi , satw , sati , ssatw , ssati , diffu , visco , vsc2 , & ocp , lvap , tcond , lvt2 logical , intent ( inout ) :: supersaturated integer :: k , nz real ( wp ) :: tempc , otemp nz = size ( temp ) supersaturated = . false . do k = 1 , nz otemp = 1._wp / temp ( k ) tempc = temp ( k ) - t0 rhof ( k ) = sqrt ( rho_not / rho ( k )) rhof2 ( k ) = sqrt ( rhof ( k )) qvs ( k ) = calc_rslf ( pres ( k ), temp ( k )) delqvs ( k ) = max ( 0._wp , calc_rslf ( pres ( k ), t0 ) - qv ( k )) if ( tempc <= 0._wp ) then qvsi ( k ) = calc_rsif ( pres ( k ), temp ( k )) else qvsi ( k ) = qvs ( k ) endif satw ( k ) = qv ( k ) / qvs ( k ) sati ( k ) = qv ( k ) / qvsi ( k ) ssatw ( k ) = satw ( k ) - 1._wp ssati ( k ) = sati ( k ) - 1._wp if ( abs ( ssatw ( k )) < eps ) ssatw ( k ) = 0._wp if ( abs ( ssati ( k )) < eps ) ssati ( k ) = 0._wp if ( ssati ( k ) > 0._wp ) supersaturated = . true . diffu ( k ) = 2.11e-5_wp * ( temp ( k ) / t0 ) ** 1.94_wp * ( 10132 5._wp / pres ( k )) if ( tempc >= 0._wp ) then visco ( k ) = ( 1.718_wp + 0.0049_wp * tempc ) * 1.0e-5_wp else visco ( k ) = ( 1.718_wp + 0.0049_wp * tempc - 1.2e-5_wp * tempc * tempc ) * 1.0e-5_wp endif ocp ( k ) = 1._wp / ( cp * ( 1._wp + 0.887_wp * qv ( k ))) vsc2 ( k ) = sqrt ( rho ( k ) / visco ( k )) lvap ( k ) = lvap0 + ( 210 6.0_wp - 421 8.0_wp ) * tempc tcond ( k ) = ( 5.69_wp + 0.0168_wp * tempc ) * 1.0e-5_wp * 41 8.936_wp lvt2 ( k ) = lvap ( k ) * lvap ( k ) * ocp ( k ) * orv * otemp * otemp enddo end subroutine thermo_vars subroutine check_over_depletion ( rho , temp , qvsi , qv , l_qc , rc , l_qi , ri , & l_qr , rr , l_qs , rs , l_qg , rg , tend ) !! check to ensure that loss terms don't over-deplete a category and !! adjusts tendencies if needed use module_mp_tempo_params , only : eps , rho_i , t0 , meters3_to_liters type ( ty_tend ), intent ( inout ) :: tend logical , dimension (:), intent ( in ) :: l_qc , l_qi , l_qr , l_qs , l_qg real ( wp ), dimension (:), intent ( in ) :: rho , temp , qvsi , qv , rc , ri , rr , rs , rg real ( wp ) :: sump , rate_max , ratio integer :: k , nz nz = size ( qv ) do k = 1 , nz ! losses to vapor include, deposition nucleation; ice, snow, and graupel ! depositional growth; Koop nucleation sump = tend % pri_inu ( k ) + tend % pri_ide ( k ) + tend % prs_ide ( k ) + & tend % prs_sde ( k ) + tend % prg_gde ( k ) + tend % pri_iha ( k ) rate_max = ( qv ( k ) - qvsi ( k )) * rho ( k ) * global_inverse_dt * 0.999_wp if (( sump > eps . and . sump > rate_max ) . or . & ( sump < - eps . and . sump < rate_max )) then ratio = rate_max / sump tend % pri_inu ( k ) = tend % pri_inu ( k ) * ratio tend % pri_ide ( k ) = tend % pri_ide ( k ) * ratio tend % pni_ide ( k ) = tend % pni_ide ( k ) * ratio ! scales with pri_ide tend % prs_ide ( k ) = tend % prs_ide ( k ) * ratio tend % prs_sde ( k ) = tend % prs_sde ( k ) * ratio tend % prg_gde ( k ) = tend % prg_gde ( k ) * ratio tend % pri_iha ( k ) = tend % pri_iha ( k ) * ratio endif ! losses to cloud water include conversion to rain; ! freezing; collection by rain, snow, and graupel. sump = - tend % prr_wau ( k ) - tend % pri_wfz ( k ) - tend % prr_rcw ( k ) - & tend % prs_scw ( k ) - tend % prg_scw ( k ) - tend % prg_gcw ( k ) rate_max = - rc ( k ) * global_inverse_dt if ( l_qc ( k )) then if ( sump < rate_max ) then ratio = rate_max / sump tend % prr_wau ( k ) = tend % prr_wau ( k ) * ratio tend % pri_wfz ( k ) = tend % pri_wfz ( k ) * ratio tend % prr_rcw ( k ) = tend % prr_rcw ( k ) * ratio tend % prs_scw ( k ) = tend % prs_scw ( k ) * ratio tend % prg_scw ( k ) = tend % prg_scw ( k ) * ratio tend % prg_gcw ( k ) = tend % prg_gcw ( k ) * ratio endif endif ! losses to cloud ice include sublimation; conversion to snow; ! collection by snow and rain sump = tend % pri_ide ( k ) - tend % prs_iau ( k ) - tend % prs_sci ( k ) - tend % pri_rci ( k ) rate_max = - ri ( k ) * global_inverse_dt if ( l_qi ( k )) then if ( sump < rate_max ) then ratio = rate_max / sump tend % pri_ide ( k ) = tend % pri_ide ( k ) * ratio tend % prs_iau ( k ) = tend % prs_iau ( k ) * ratio tend % prs_sci ( k ) = tend % prs_sci ( k ) * ratio tend % pri_rci ( k ) = tend % pri_rci ( k ) * ratio endif endif ! losses to rain include freezing; collection by ice, snow, and graupel ! resulting in freezing sump = - tend % prg_rfz ( k ) - tend % pri_rfz ( k ) - tend % prr_rci ( k ) + & tend % prr_rcs ( k ) + tend % prr_rcg ( k ) rate_max = - rr ( k ) * global_inverse_dt if ( l_qr ( k )) then if ( sump < rate_max ) then ratio = rate_max / sump tend % prg_rfz ( k ) = tend % prg_rfz ( k ) * ratio tend % pbg_rfz ( k ) = tend % pbg_rfz ( k ) * ratio ! scales with prg_rfz tend % pri_rfz ( k ) = tend % pri_rfz ( k ) * ratio tend % prr_rci ( k ) = tend % prr_rci ( k ) * ratio tend % prr_rcs ( k ) = tend % prr_rcs ( k ) * ratio tend % prr_rcg ( k ) = tend % prr_rcg ( k ) * ratio endif endif ! losses to snow include sublimation; melting; collection by rain; ! rime splintering sump = tend % prs_sde ( k ) - tend % prs_ihm ( k ) - tend % prr_sml ( k ) + & tend % prs_rcs ( k ) rate_max = - rs ( k ) * global_inverse_dt if ( l_qs ( k )) then if ( sump < rate_max ) then ratio = rate_max / sump tend % prs_sde ( k ) = tend % prs_sde ( k ) * ratio tend % prs_ihm ( k ) = tend % prs_ihm ( k ) * ratio tend % prr_sml ( k ) = tend % prr_sml ( k ) * ratio tend % prs_rcs ( k ) = tend % prs_rcs ( k ) * ratio endif endif ! losses to graupel include sublimation; melting; rime splintering; ! collection by rain sump = tend % prg_gde ( k ) - tend % prg_ihm ( k ) - tend % prr_gml ( k ) + tend % prg_rcg ( k ) rate_max = - rg ( k ) * global_inverse_dt if ( l_qg ( k )) then if ( sump < rate_max ) then ratio = rate_max / sump tend % prg_gde ( k ) = tend % prg_gde ( k ) * ratio tend % prg_ihm ( k ) = tend % prg_ihm ( k ) * ratio tend % prr_gml ( k ) = tend % prr_gml ( k ) * ratio tend % prg_rcg ( k ) = tend % prg_rcg ( k ) * ratio tend % pbg_rcg ( k ) = tend % pbg_rcg ( k ) * ratio ! scales with prg_rcg endif endif ! updates after adjustments ! reset sum of rime splintering tend % pri_ihm ( k ) = tend % prs_ihm ( k ) + tend % prg_ihm ( k ) ! reset total rain-graupel collection amount if reduced ratio = min ( abs ( tend % prr_rcg ( k )), abs ( tend % prg_rcg ( k ))) tend % prr_rcg ( k ) = ratio * sign ( 1.0_dp , tend % prr_rcg ( k )) tend % prg_rcg ( k ) = - tend % prr_rcg ( k ) tend % pbg_rcg ( k ) = meters3_to_liters * tend % prg_rcg ( k ) / rho_i ! scale density change ! reset total rain-snow collection amount if reduced if ( temp ( k ) > t0 ) then ratio = min ( abs ( tend % prr_rcs ( k )), abs ( tend % prs_rcs ( k ))) tend % prr_rcs ( k ) = ratio * sign ( 1.0_dp , tend % prr_rcs ( k )) tend % prs_rcs ( k ) = - tend % prr_rcs ( k ) endif enddo end subroutine check_over_depletion subroutine sum_tendencies ( rho , temp , idx , lvap , ocp , tend , tten , qvten , qcten , & ncten , qiten , niten , qsten , qrten , nrten , qgten , ngten , qbten ) !! sums tendencies for each hydrometeor category and temperature and moisture use module_mp_tempo_params , only : lsub , rho_g , t0 , lfus , meters3_to_liters type ( ty_tend ), intent ( in ) :: tend real ( wp ), dimension (:), intent ( in ) :: rho , temp , lvap , ocp integer , dimension (:), intent ( in ) :: idx real ( wp ), dimension (:), intent ( inout ) :: qvten , qcten , ncten , qiten , niten , & qsten , qrten , nrten , qgten , ngten , qbten , tten real ( wp ) :: orho , lfus2 integer :: k , nz nz = size ( temp ) do k = 1 , nz orho = 1. / rho ( k ) lfus2 = lsub - lvap ( k ) qvten ( k ) = qvten ( k ) + ( - tend % pri_inu ( k ) - tend % pri_iha ( k ) - tend % pri_ide ( k ) - & tend % prs_ide ( k ) - tend % prs_sde ( k ) - tend % prg_gde ( k )) * orho qcten ( k ) = qcten ( k ) + ( - tend % prr_wau ( k ) - tend % pri_wfz ( k ) - tend % prr_rcw ( k ) - & tend % prs_scw ( k ) - tend % prg_scw ( k ) - tend % prg_gcw ( k )) * orho ncten ( k ) = ncten ( k ) + ( - tend % pnc_wau ( k ) - tend % pnc_rcw ( k ) - tend % pni_wfz ( k ) - & tend % pnc_scw ( k ) - tend % pnc_gcw ( k )) * orho qiten ( k ) = qiten ( k ) + ( tend % pri_inu ( k ) + tend % pri_iha ( k ) + tend % pri_ihm ( k ) + & tend % pri_wfz ( k ) + tend % pri_rfz ( k ) + tend % pri_ide ( k ) - tend % prs_iau ( k ) - & tend % prs_sci ( k ) - tend % pri_rci ( k )) * orho niten ( k ) = niten ( k ) + ( tend % pni_inu ( k ) + tend % pni_iha ( k ) + tend % pni_ihm ( k ) + & tend % pni_wfz ( k ) + tend % pni_rfz ( k ) + tend % pni_ide ( k ) - tend % pni_iau ( k ) - & tend % pni_sci ( k ) - tend % pni_rci ( k )) * orho qrten ( k ) = qrten ( k ) + ( tend % prr_wau ( k ) + tend % prr_rcw ( k ) + tend % prr_sml ( k ) + & tend % prr_gml ( k ) + tend % prr_rcs ( k ) + tend % prr_rcg ( k ) - tend % prg_rfz ( k ) - & tend % pri_rfz ( k ) - tend % prr_rci ( k )) * orho nrten ( k ) = nrten ( k ) + ( tend % pnr_wau ( k ) + tend % pnr_sml ( k ) + tend % pnr_gml ( k ) - & ( tend % pnr_rfz ( k ) + tend % pnr_rcr ( k ) + tend % pnr_rcg ( k ) + tend % pnr_rcs ( k ) + & tend % pnr_rci ( k ) + tend % pni_rfz ( k ))) * orho qsten ( k ) = qsten ( k ) + ( tend % prs_iau ( k ) + tend % prs_sde ( k ) + tend % prs_sci ( k ) + & tend % prs_scw ( k ) + tend % prs_rcs ( k ) + tend % prs_ide ( k ) - tend % prs_ihm ( k ) - & tend % prr_sml ( k )) * orho qgten ( k ) = qgten ( k ) + ( tend % prg_scw ( k ) + tend % prg_rfz ( k ) + tend % prg_gde ( k ) + & tend % prg_rcg ( k ) + tend % prg_gcw ( k ) + tend % prg_rci ( k ) + tend % prg_rcs ( k ) - & tend % prg_ihm ( k ) - tend % prr_gml ( k )) * orho ngten ( k ) = ngten ( k ) + ( tend % png_scw ( k ) + tend % png_rfz ( k ) - tend % png_rcg ( k ) + & tend % png_rci ( k ) + tend % png_rcs ( k ) + tend % png_gde ( k ) - tend % pnr_gml ( k )) * orho qbten ( k ) = qbten ( k ) + ( tend % pbg_scw ( k ) + tend % pbg_rfz ( k ) + tend % pbg_gcw ( k ) + & tend % pbg_rci ( k ) + tend % pbg_rcs ( k ) + tend % pbg_rcg ( k ) + tend % pbg_sml ( k ) - & tend % pbg_gml ( k ) + meters3_to_liters * ( tend % prg_gde ( k ) - tend % prg_ihm ( k )) / rho_g ( idx ( k ))) * orho if ( temp ( k ) < t0 ) then tten ( k ) = tten ( k ) + & ( lsub * ocp ( k ) * ( tend % pri_inu ( k ) + tend % pri_ide ( k ) + & tend % prs_ide ( k ) + tend % prs_sde ( k ) + tend % prg_gde ( k ) + tend % pri_iha ( k )) + & lfus2 * ocp ( k ) * ( tend % pri_wfz ( k ) + tend % pri_rfz ( k ) + tend % prg_rfz ( k ) + & tend % prs_scw ( k ) + tend % prg_scw ( k ) + tend % prg_gcw ( k ) + tend % prg_rcs ( k ) + & tend % prs_rcs ( k ) + tend % prr_rci ( k ) + tend % prg_rcg ( k ))) * orho else tten ( k ) = tten ( k ) + & ( lfus * ocp ( k ) * ( - tend % prr_sml ( k ) - tend % prr_gml ( k ) - & tend % prr_rcg ( k ) - tend % prr_rcs ( k )) + & lsub * ocp ( k ) * ( tend % prs_sde ( k ) + tend % prg_gde ( k ))) * orho endif enddo end subroutine sum_tendencies subroutine sedimentation ( xr , vt , dz1d , rho , xten , limit , steps , ktop_sedi , precip ) !! computes sedimentation fluxes, adds fluxes to tendencies, and updates hydrometeor !! mass (and number and volume) use module_mp_tempo_params , only : low_limit_mass_for_precip integer , intent ( in ) :: steps integer , intent ( in ), optional :: ktop_sedi real ( wp ), dimension (:), intent ( inout ) :: xr , xten real ( wp ), dimension (:), intent ( in ) :: dz1d , rho real ( wp ), dimension (:), intent ( in ) :: vt real ( wp ), intent ( in ) :: limit real ( wp ), intent ( inout ), optional :: precip real ( wp ) :: odz , orho real ( wp ), allocatable , dimension (:) :: sed_r integer :: k , nz , ktop nz = size ( xr ) allocate ( sed_r ( nz ), source = 0._wp ) ktop = nz - 1 if ( present ( ktop_sedi )) ktop = ktop_sedi do k = nz , 1 , - 1 sed_r ( k ) = vt ( k ) * xr ( k ) enddo k = nz odz = 1._wp / dz1d ( k ) orho = 1._wp / rho ( k ) xten ( k ) = xten ( k ) - sed_r ( k ) * odz * ( 1._wp / real ( steps , kind = wp )) * orho xr ( k ) = max ( limit , xr ( k ) - sed_r ( k ) * odz * global_dt * ( 1._wp / real ( steps , kind = wp ))) do k = ktop , 1 , - 1 odz = 1._wp / dz1d ( k ) orho = 1._wp / rho ( k ) xten ( k ) = xten ( k ) + ( sed_r ( k + 1 )) * ( 1._wp / dz1d ( k )) * ( 1._wp / real ( steps , kind = wp )) / rho ( k ) xten ( k ) = xten ( k ) - ( sed_r ( k )) * odz * ( 1._wp / real ( steps , kind = wp )) * orho xr ( k ) = max ( limit , xr ( k ) + ( sed_r ( k + 1 )) * ( 1._wp / dz1d ( k )) * global_dt * ( 1._wp / real ( steps , kind = wp ))) xr ( k ) = max ( limit , xr ( k ) - ( sed_r ( k )) * odz * global_dt * ( 1._wp / real ( steps , kind = wp ))) enddo if ( present ( precip )) then if ( xr ( 1 ) > low_limit_mass_for_precip ) then precip = precip + sed_r ( 1 ) * global_dt * ( 1._wp / real ( steps , kind = wp )) endif endif end subroutine sedimentation subroutine semilagrangian_sedimentation ( dz1d , rho , xr , xten , vt , steps , limit , precip ) !! semi-lagrangian sedimentation scheme from !! [Juang and Hong (2010)](https://doi.org/10.1175/2009MWR3109.1) !! !! original author: hann-ming henry juang <henry.juang@noaa.gov> !! original implemented by: song-you hong integer , intent ( in ) :: steps real ( wp ), intent ( in ) :: limit real ( wp ), dimension (:), intent ( in ) :: dz1d , rho real ( wp ), dimension (:), intent ( inout ) :: xr , xten real ( wp ), dimension (:), intent ( in ) :: vt real ( wp ) :: fa1 , fa2 , con1 , decfl , dip , dim , tl , th , tl2 , th2 , qqd , qqh , qql , zsum , qsum , & orho , dql , dqh real ( wp ), dimension (:), allocatable :: zi , wi , za , dza , qa , qmi , qpi , net_flx , precip_flx , rr_save real ( wp ), intent ( out ), optional :: precip integer :: k , nz , kk , kb , kt , m nz = size ( dz1d ) allocate ( zi ( nz + 1 ), source = 0._wp ) allocate ( wi ( nz + 1 ), source = 0._wp ) allocate ( dza ( nz + 1 ), source = 0._wp ) allocate ( za ( nz + 2 ), source = 0._wp ) allocate ( qa ( nz + 1 ), source = 0._wp ) allocate ( qmi ( nz + 1 ), source = 0._wp ) allocate ( qpi ( nz + 1 ), source = 0._wp ) allocate ( net_flx ( nz ), source = 0._wp ) allocate ( precip_flx ( nz ), source = 0._wp ) allocate ( rr_save ( nz ), source = xr ) zi ( 1 ) = 0._wp ! zi(1) needs to be zero so zero out explicitly do k = 1 , nz zi ( k + 1 ) = zi ( k ) + dz1d ( k ) enddo ! 3rd order interpolation to get wi fa1 = 9._wp / 1 6._wp fa2 = 1._wp / 1 6._wp wi ( 1 ) = vt ( 1 ) wi ( 2 ) = 0.5_wp * ( vt ( 2 ) + vt ( 1 )) do k = 3 , nz - 1 wi ( k ) = fa1 * ( vt ( k ) + vt ( k - 1 )) - fa2 * ( vt ( k + 1 ) + vt ( k - 2 )) enddo wi ( nz ) = 0.5_wp * ( vt ( nz ) + vt ( nz - 1 )) wi ( nz + 1 ) = vt ( nz + 1 ) do k = 2 , nz if ( vt ( k ) == 0._wp ) wi ( k ) = vt ( k - 1 ) enddo ! diffusivity of wi ! con1 should be > 0 and < 1 con1 = 0.05_wp do k = nz , 1 , - 1 decfl = ( wi ( k + 1 ) - wi ( k )) * global_dt * ( 1._wp / real ( steps , kind = wp )) / dz1d ( k ) if ( decfl > con1 ) then wi ( k ) = wi ( k + 1 ) - con1 * dz1d ( k ) * global_inverse_dt * real ( steps , kind = wp ) endif enddo ! compute arrival point do k = 1 , nz + 1 za ( k ) = zi ( k ) - wi ( k ) * global_dt * ( 1._wp / real ( steps , kind = wp )) enddo za ( nz + 2 ) = zi ( nz + 1 ) do k = 1 , nz + 1 dza ( k ) = za ( k + 1 ) - za ( k ) enddo ! computer deformation at arrival point do k = 1 , nz qa ( k ) = xr ( k ) * dz1d ( k ) / dza ( k ) enddo qa ( nz + 1 ) = 0._wp ! estimate values at arrival cell interface with monotone do k = 2 , nz dip = ( qa ( k + 1 ) - qa ( k )) / ( dza ( k + 1 ) + dza ( k )) dim = ( qa ( k ) - qa ( k - 1 )) / ( dza ( k - 1 ) + dza ( k )) if ( dip * dim <= 0._wp ) then qmi ( k ) = qa ( k ) qpi ( k ) = qa ( k ) else qpi ( k ) = qa ( k ) + 0.5_wp * ( dip + dim ) * dza ( k ) qmi ( k ) = 2._wp * qa ( k ) - qpi ( k ) if ( qpi ( k ) > 0._wp . or . qmi ( k ) < 0._wp ) then qpi ( k ) = qa ( k ) qmi ( k ) = qa ( k ) endif endif enddo qpi ( 1 ) = qa ( 1 ) qmi ( 1 ) = qa ( 1 ) qmi ( nz + 1 ) = qa ( nz + 1 ) qpi ( nz + 1 ) = qa ( nz + 1 ) ! interpolation to regular point kb = 1 kt = 1 intp : do k = 1 , nz kb = max ( kb - 1 , 1 ) kt = max ( kt - 1 , 1 ) ! find kb and kt if ( zi ( k ) >= za ( nz + 1 )) then exit intp else find_kb : do kk = kb , nz if ( zi ( k ) <= za ( kk + 1 )) then kb = kk exit find_kb else cycle find_kb endif enddo find_kb find_kt : do kk = kt , nz + 2 if ( zi ( k + 1 ) <= za ( kk )) then kt = kk exit find_kt else cycle find_kt endif enddo find_kt kt = kt - 1 ! compute q with piecewise constant method if ( kt == kb ) then tl = ( zi ( k ) - za ( kb )) / dza ( kb ) th = ( zi ( k + 1 ) - za ( kb )) / dza ( kb ) tl2 = tl * tl th2 = th * th qqd = 0.5_wp * ( qpi ( kb ) - qmi ( kb )) qqh = qqd * th2 + qmi ( kb ) * th qql = qqd * tl2 + qmi ( kb ) * tl xr ( k ) = ( qqh - qql ) / ( th - tl ) elseif ( kt > kb ) then tl = ( zi ( k ) - za ( kb )) / dza ( kb ) tl2 = tl * tl qqd = 0.5_wp * ( qpi ( kb ) - qmi ( kb )) qql = qqd * tl2 + qmi ( kb ) * tl dql = qa ( kb ) - qql zsum = ( 1._wp - tl ) * dza ( kb ) qsum = dql * dza ( kb ) if ( kt - kb > 1 ) then do m = kb + 1 , kt - 1 zsum = zsum + dza ( m ) qsum = qsum + qa ( m ) * dza ( m ) enddo endif th = ( zi ( k + 1 ) - za ( kt )) / dza ( kt ) th2 = th * th qqd = 0.5_wp * ( qpi ( kt ) - qmi ( kt )) dqh = qqd * th2 + qmi ( kt ) * th zsum = zsum + th * dza ( kt ) qsum = qsum + dqh * dza ( kt ) xr ( k ) = qsum / zsum endif endif orho = 1._wp / rho ( k ) xr ( k ) = max ( xr ( k ), limit ) xten ( k ) = xten ( k ) + ( xr ( k ) - rr_save ( k )) * & orho * global_inverse_dt enddo intp precip_loop : do k = 1 , nz if ( za ( k ) < 0._wp . and . za ( k + 1 ) <= 0.0_wp ) then if ( present ( precip )) precip = precip + qa ( k ) * dza ( k ) net_flx ( k ) = qa ( k ) * dza ( k ) elseif ( za ( k ) < 0._wp . and . za ( k + 1 ) > 0._wp ) then th = ( 0._wp - za ( k )) / dza ( k ) th2 = th * th qqd = 0.5_wp * ( qpi ( k ) - qmi ( k )) qqh = qqd * th2 + qmi ( k ) * th if ( present ( precip )) precip = precip + qqh * dza ( k ) net_flx ( k ) = qqh * dza ( k ) exit precip_loop endif enddo precip_loop ! calculating precipitation fluxes do k = nz , 1 , - 1 if ( k == nz ) then precip_flx ( k ) = net_flx ( k ) else precip_flx ( k ) = precip_flx ( k + 1 ) + net_flx ( k ) end if enddo end subroutine semilagrangian_sedimentation subroutine rain_fallspeed ( rhof , l_qr , rr , ilamr , dz1d , vt , vtn , substeps_sedi , ktop_sedi ) !! calculates mass and number weighted fall speeds for rain !! and optionally the substepping required and the top k-level of sedimentation use module_mp_tempo_params , only : crg , av_r , org3 , fv_r , cre real ( wp ), dimension (:), intent ( in ) :: rhof , dz1d , rr real ( dp ), dimension (:), intent ( in ) :: ilamr logical , dimension (:), intent ( in ) :: l_qr real ( wp ), dimension (:), intent ( inout ) :: vt , vtn integer , intent ( out ), optional :: substeps_sedi , ktop_sedi real ( wp ) :: dz_by_vt real ( dp ) :: lamr integer :: k , nz nz = size ( l_qr ) if ( present ( ktop_sedi )) ktop_sedi = 1 if ( present ( substeps_sedi )) substeps_sedi = 1 do k = nz , 1 , - 1 if ( rr ( k ) > r1 ) then lamr = 1._dp / ilamr ( k ) vt ( k ) = rhof ( k ) * av_r * crg ( 6 ) * org3 * lamr ** cre ( 3 ) * (( lamr + fv_r ) ** ( - cre ( 6 ))) vtn ( k ) = rhof ( k ) * av_r * crg ( 7 ) / crg ( 12 ) * lamr ** cre ( 12 ) * (( lamr + fv_r ) ** ( - cre ( 7 ))) else vt ( k ) = vt ( k + 1 ) vtn ( k ) = vtn ( k + 1 ) endif if ( max ( vt ( k ), vtn ( k )) > 1.e-3_wp ) then if ( present ( ktop_sedi )) ktop_sedi = max ( ktop_sedi , k ) dz_by_vt = dz1d ( k ) / ( max ( vt ( k ), vtn ( k ))) if ( present ( substeps_sedi )) then substeps_sedi = max ( substeps_sedi , int ( global_dt / dz_by_vt + 1._wp )) endif endif enddo if ( present ( ktop_sedi )) then if ( ktop_sedi == nz ) ktop_sedi = nz - 1 endif end subroutine rain_fallspeed subroutine graupel_fallspeed ( rhof , rho , visco , l_qg , rg , rb , qb1d , idx , ilamg , & dz1d , vt , vtn , substeps_sedi , ktop_sedi ) !! calculates mass and number weighted fall speeds for graupel !! and optionally the substepping required and the top k-level of sedimentation use module_mp_tempo_params , only : nrhg , rho_g , av_g_old , bv_g_old , & cgg , t0 , mu_g , ogg2 , ogg3 , a_coeff , b_coeff , meters3_to_liters real ( wp ), dimension (:), intent ( in ) :: rhof , rho , visco , dz1d , rg , rb real ( wp ), dimension (:), intent ( in ), optional :: qb1d real ( dp ), dimension (:), intent ( in ) :: ilamg logical , dimension (:), intent ( in ) :: l_qg integer , dimension (:), intent ( in ) :: idx real ( wp ), dimension (:), intent ( inout ) :: vt , vtn integer , intent ( out ), optional :: substeps_sedi , ktop_sedi real ( wp ) :: dz_by_vt , dens_g , afall , bfall integer :: k , nz nz = size ( l_qg ) if ( present ( ktop_sedi )) ktop_sedi = 1 if ( present ( substeps_sedi )) substeps_sedi = 1 do k = nz , 1 , - 1 if ( rg ( k ) > r1 ) then if ( present ( qb1d )) then dens_g = max ( rho_g ( 1 ), min ( meters3_to_liters * rg ( k ) / rb ( k ), rho_g ( nrhg ))) afall = a_coeff * (( 4._wp * dens_g * 9.8_wp ) / ( 3._wp * rho ( k ))) ** b_coeff afall = afall * visco ( k ) ** ( 1._wp - 2._wp * b_coeff ) bfall = 3._wp * b_coeff - 1._wp else afall = av_g_old bfall = bv_g_old endif vt ( k ) = rhof ( k ) * afall * cgg ( 6 , idx ( k )) * ogg3 * ilamg ( k ) ** bfall ! idea: if (temp(k) > t0) vt(k) = max(vt(k), vtrr(k)) if ( mu_g == 0 ) then vtn ( k ) = rhof ( k ) * afall * cgg ( 7 , idx ( k )) / cgg ( 12 , idx ( k )) * ilamg ( k ) ** bfall else vtn ( k ) = rhof ( k ) * afall * cgg ( 8 , idx ( k )) * ogg2 * ilamg ( k ) ** bfall endif else vt ( k ) = vt ( k + 1 ) vtn ( k ) = vtn ( k + 1 ) endif if ( vt ( k ) > 1.e-3_wp ) then if ( present ( ktop_sedi )) ktop_sedi = max ( ktop_sedi , k ) dz_by_vt = dz1d ( k ) / vt ( k ) if ( present ( substeps_sedi )) then substeps_sedi = max ( substeps_sedi , int ( global_dt / dz_by_vt + 1._wp )) endif endif enddo if ( present ( ktop_sedi )) then if ( ktop_sedi == nz ) ktop_sedi = nz - 1 endif end subroutine graupel_fallspeed subroutine snow_fallspeed ( rhof , l_qs , rs , prr_sml , smob , smoc , & rr , vtrr , dz1d , vt , vtboost , substeps_sedi , ktop_sedi ) !! calcules mass weighted fall speeds for snow !! and optionally the substepping required and the top k-level of sedimentation use module_mp_tempo_params , only : lam0 , lam1 , fv_s , kap0 , kap1 , mu_s , & cse , csg , av_s real ( wp ), dimension (:), intent ( in ) :: rhof , dz1d , rs , rr , vtboost real ( wp ), dimension (:), intent ( in ) :: vtrr logical , dimension (:), intent ( in ) :: l_qs real ( wp ), dimension (:), intent ( inout ) :: vt real ( dp ), dimension (:), intent ( in ) :: smob , smoc , prr_sml integer , intent ( out ), optional :: substeps_sedi , ktop_sedi real ( wp ) :: dz_by_vt , vts , sr real ( dp ) :: xds , mrat , ils1 , ils2 , t1_vts , t2_vts , t3_vts , t4_vts integer :: k , nz nz = size ( l_qs ) if ( present ( ktop_sedi )) ktop_sedi = 1 if ( present ( substeps_sedi )) substeps_sedi = 1 do k = nz , 1 , - 1 if ( rs ( k ) > r1 ) then xds = smoc ( k ) / smob ( k ) mrat = 1._dp / xds ils1 = 1._dp / ( mrat * lam0 + fv_s ) ils2 = 1._dp / ( mrat * lam1 + fv_s ) t1_vts = kap0 * csg ( 4 ) * ils1 ** cse ( 4 ) t2_vts = kap1 * mrat ** mu_s * csg ( 10 ) * ils2 ** cse ( 10 ) ils1 = 1._dp / ( mrat * lam0 ) ils2 = 1._dp / ( mrat * lam1 ) t3_vts = kap0 * csg ( 1 ) * ils1 ** cse ( 1 ) t4_vts = kap1 * mrat ** mu_s * csg ( 7 ) * ils2 ** cse ( 7 ) vts = rhof ( k ) * av_s * ( t1_vts + t2_vts ) / ( t3_vts + t4_vts ) if ( prr_sml ( k ) > 0._dp ) then sr = rs ( k ) / ( rs ( k ) + rr ( k )) vt ( k ) = vts * sr + ( 1._wp - sr ) * vtrr ( k ) else vt ( k ) = vts * vtboost ( k ) endif else vt ( k ) = vt ( k + 1 ) endif if ( vt ( k ) > 1.e-3_wp ) then if ( present ( ktop_sedi )) ktop_sedi = max ( ktop_sedi , k ) dz_by_vt = dz1d ( k ) / vt ( k ) if ( present ( substeps_sedi )) then substeps_sedi = max ( substeps_sedi , int ( global_dt / dz_by_vt + 1._wp )) endif endif enddo if ( present ( ktop_sedi )) then if ( ktop_sedi == nz ) ktop_sedi = nz - 1 endif end subroutine snow_fallspeed subroutine ice_fallspeed ( rhof , l_qi , ri , ilami , dz1d , vt , vtn , & substeps_sedi , ktop_sedi ) !! calculates mass and number weighted fall speeds for ice !! and the substepping required and the top k-level of sedimentation use module_mp_tempo_params , only : av_i , cig , oig2 , bv_i real ( wp ), dimension (:), intent ( in ) :: rhof , dz1d , ri real ( dp ), dimension (:), intent ( in ) :: ilami logical , dimension (:), intent ( in ) :: l_qi real ( wp ), dimension (:), intent ( inout ) :: vt , vtn integer , intent ( out ) :: substeps_sedi , ktop_sedi real ( wp ) :: dz_by_vt integer :: k , nz nz = size ( l_qi ) ktop_sedi = 1 substeps_sedi = 1 do k = nz , 1 , - 1 if ( ri ( k ) > r1 ) then vt ( k ) = rhof ( k ) * av_i * cig ( 3 ) * oig2 * ilami ( k ) ** bv_i vtn ( k ) = rhof ( k ) * av_i * cig ( 6 ) / cig ( 7 ) * ilami ( k ) ** bv_i else vt ( k ) = vt ( k + 1 ) vtn ( k ) = vtn ( k + 1 ) endif if ( vt ( k ) > 1.e-3_wp ) then ktop_sedi = max ( ktop_sedi , k ) dz_by_vt = dz1d ( k ) / vt ( k ) substeps_sedi = max ( substeps_sedi , int ( global_dt / dz_by_vt + 1._wp )) endif enddo if ( ktop_sedi == nz ) ktop_sedi = nz - 1 end subroutine ice_fallspeed subroutine cloud_fallspeed ( rhof , w1d , l_qc , rc , nc , ilamc , dz1d , vt , vtn , & ktop_sedi ) !! calculates mass and number weighted fall speeds for cloud !! and the top k-level of sedimentation use module_mp_tempo_params , only : av_c , ccg , ocg1 , ocg2 , bv_c , r2 real ( wp ), dimension (:), intent ( in ) :: rhof , w1d , dz1d , rc , nc real ( dp ), dimension (:), intent ( in ) :: ilamc logical , dimension (:), intent ( in ) :: l_qc real ( wp ), dimension (:), intent ( inout ) :: vt , vtn integer , intent ( out ) :: ktop_sedi real ( wp ) :: hgt integer :: k , nz , nu_c nz = size ( l_qc ) ktop_sedi = 1 ! clouds/fog settle below 500 m agl hgt = 0._wp hgt_loop : do k = 1 , nz - 1 if ( rc ( k ) > r2 ) ktop_sedi = k hgt = hgt + dz1d ( k ) if ( hgt > 50 0._wp ) exit hgt_loop enddo hgt_loop do k = ktop_sedi , 1 , - 1 if ( rc ( k ) > r1 . and . w1d ( k ) < 0.1_wp ) then nu_c = get_nuc ( nc ( k )) vt ( k ) = rhof ( k ) * av_c * ccg ( 5 , nu_c ) * ocg2 ( nu_c ) * ilamc ( k ) ** bv_c vtn ( k ) = rhof ( k ) * av_c * ccg ( 4 , nu_c ) * ocg1 ( nu_c ) * ilamc ( k ) ** bv_c endif enddo end subroutine cloud_fallspeed subroutine cloud_condensation ( rho , temp , w1d , ssatw , lvap , tcond , diffu , lvt2 , & nwfa , qv , qvs , l_qc , rc , nc , tend ) !! cloud condensation and evaporation use module_mp_tempo_params , only : eps , r1 , t0 , orv , pi , rho_w , nbc , & tnc_wev , nt_c_min type ( ty_tend ), intent ( inout ) :: tend real ( wp ), dimension (:), intent ( in ) :: rho , temp , w1d , ssatw , lvap , tcond , diffu , lvt2 , & nwfa , qv , qvs , rc , nc logical , dimension (:), intent ( in ) :: l_qc real ( wp ) :: clap , fcd , dfcd , xrc , xnc , orho , tempc , otemp , & rvs , rvs_p , rvs_pp , gamsc , alphsc , xsat , t1_evap real ( dp ) :: dc_star integer :: k , nz , n , idx_d , idx_n , idx_c nz = size ( qv ) do k = 1 , nz if ( abs ( ssatw ( k )) < eps ) return ! RH = 100% orho = 1._wp / rho ( k ) clap = ( qv ( k ) - qvs ( k )) / ( 1._wp + lvt2 ( k ) * qvs ( k )) do n = 1 , 3 fcd = qvs ( k ) * exp ( lvt2 ( k ) * clap ) - qv ( k ) + clap dfcd = qvs ( k ) * lvt2 ( k ) * exp ( lvt2 ( k ) * clap ) + 1._wp clap = clap - fcd / dfcd enddo xrc = rc ( k ) + clap * rho ( k ) xnc = 0._wp if ( xrc > r1 ) then ! mass tendency tend % prw_vcd ( k ) = clap * global_inverse_dt if ( clap > eps ) then ! condensation xnc = max ( nt_c_min , activate_cloud_number ( temp ( k ), w1d ( k ), nwfa ( k ))) tend % pnc_wcd ( k ) = 0.5_wp * ( xnc - nc ( k ) + abs ( xnc - nc ( k ))) * global_inverse_dt * orho elseif ( l_qc ( k ) . and . ssatw ( k ) < - 1.e-6_wp . and . clap < - eps ) then ! evaporation tempc = temp ( k ) - t0 otemp = 1._wp / temp ( k ) rvs = rho ( k ) * qvs ( k ) rvs_p = rvs * otemp * ( lvap ( k ) * otemp * orv - 1._wp ) rvs_pp = rvs * ( otemp * ( lvap ( k ) * otemp * oRv - 1._wp ) * & otemp * ( lvap ( k ) * otemp * oRv - 1._wp ) + & ( - 2._wp * lvap ( k ) * otemp * otemp * otemp * oRv ) + otemp * otemp ) gamsc = lvap ( k ) * diffu ( k ) / tcond ( k ) * rvs_p alphsc = 0.5_wp * ( gamsc / ( 1._wp + gamsc )) * ( gamsc / ( 1._wp + gamsc )) * & rvs_pp / rvs_p * rvs / rvs_p alphsc = max ( 1.e-9_wp , alphsc ) xsat = ssatw ( k ) if ( abs ( xsat ) < 1.e-9_wp ) xsat = 0._wp t1_evap = 2._wp * pi * ( 1.0_wp - alphsc * xsat + 2._wp * alphsc * alphsc * xsat * xsat - & 5._wp * alphsc * alphsc * alphsc * xsat * xsat * xsat ) / ( 1._wp + gamsc ) dc_star = sqrt ( - 2._dp * global_dt * t1_evap / ( 2._dp * pi ) * & 4._dp * diffu ( k ) * ssatw ( k ) * rvs / rho_w ) idx_d = max ( 1 , min ( int ( 1.e6_wp * dc_star ), nbc )) call get_cloud_table_index ( rc ( k ), nc ( k ), idx_c , idx_n ) tend % prw_vcd ( k ) = max ( real ( - rc ( k ) * 0.99_wp * orho * global_inverse_dt , kind = dp ), & tend % prw_vcd ( k )) tend % pnc_wcd ( k ) = max ( real ( - nc ( k ) * 0.99_wp * orho * global_inverse_dt , kind = dp ), & - tnc_wev ( idx_d , idx_c , idx_n ) * orho * global_inverse_dt ) endif else tend % prw_vcd ( k ) = - rc ( k ) * orho * global_inverse_dt tend % pnc_wcd ( k ) = - nc ( k ) * orho * global_inverse_dt endif enddo end subroutine cloud_condensation subroutine rain_evaporation ( rho , temp , ssatw , lvap , tcond , diffu , & vsc2 , rhof2 , qv , qvs , l_qr , rr , nr , ilamr , tend ) !! rain evaporation that includes reduction in the evaporation rate !! in the presence of melting graupel use module_mp_tempo_params , only : eps , r1 , t0 , orv , pi , rho_w , & org2 , cre , t1_qr_ev , t2_qr_ev , fv_r type ( ty_tend ), intent ( inout ) :: tend real ( wp ), dimension (:), intent ( in ) :: rho , temp , ssatw , lvap , tcond , diffu , vsc2 , rhof2 , & qv , qvs , rr , nr logical , dimension (:), intent ( in ) :: l_qr real ( dp ), dimension (:), intent ( in ) :: ilamr real ( wp ) :: orho , tempc , otemp , & rvs , rvs_p , rvs_pp , gamsc , alphsc , xsat , t1_evap , rate_max , eva_factor real ( dp ) :: lamr , n0_r integer :: k , nz nz = size ( qv ) do k = 1 , nz if ( l_qr ( k )) then if (( ssatw ( k ) < - eps ) . and . tend % prw_vcd ( k ) <= 0._dp ) then orho = 1._wp / rho ( k ) tempc = temp ( k ) - t0 otemp = 1._wp / temp ( k ) rvs = rho ( k ) * qvs ( k ) rvs_p = rvs * otemp * ( lvap ( k ) * otemp * orv - 1._wp ) rvs_pp = rvs * ( otemp * ( lvap ( k ) * otemp * oRv - 1._wp ) * & otemp * ( lvap ( k ) * otemp * oRv - 1._wp ) + & ( - 2._wp * lvap ( k ) * otemp * otemp * otemp * oRv ) + otemp * otemp ) gamsc = lvap ( k ) * diffu ( k ) / tcond ( k ) * rvs_p alphsc = 0.5_wp * ( gamsc / ( 1._wp + gamsc )) * ( gamsc / ( 1._wp + gamsc )) * & rvs_pp / rvs_p * rvs / rvs_p alphsc = max ( 1.e-9_wp , alphsc ) xsat = min ( - 1.e-9_wp , ssatw ( k )) t1_evap = 2._wp * pi * ( 1.0_wp - alphsc * xsat + 2._wp * alphsc * alphsc * xsat * xsat - & 5._wp * alphsc * alphsc * alphsc * xsat * xsat * xsat ) / ( 1._wp + gamsc ) !> @note !> rain evaporation rapidly eliminates near zero values when low humidity (<95%) !> @endnotes if ( qv ( k ) / qvs ( k ) < 0.95_wp . and . rr ( k ) * orho <= 1.e-8_wp ) then tend % prv_rev ( k ) = rr ( k ) * orho * global_inverse_dt else lamr = 1._dp / ilamr ( k ) n0_r = nr ( k ) * org2 * lamr ** cre ( 2 ) tend % prv_rev ( k ) = t1_evap * diffu ( k ) * ( - ssatw ( k )) * n0_r * rvs * & ( t1_qr_ev * ilamr ( k ) ** cre ( 10 ) + t2_qr_ev * vsc2 ( k ) * rhof2 ( k ) * & (( lamr + 0.5 * fv_r ) ** ( - cre ( 11 )))) rate_max = min (( rr ( k ) * orho * global_inverse_dt ), & ( qvs ( k ) - qv ( k )) * global_inverse_dt ) tend % prv_rev ( k ) = min ( real ( rate_max , kind = dp ), tend % prv_rev ( k ) * orho ) if ( tend % prr_gml ( k ) > 0._dp ) then eva_factor = min ( 1._wp , 0.01_wp + ( 0.99_wp - 0.01_wp ) * ( tempc / 2 0._wp )) tend % prv_rev ( k ) = tend % prv_rev ( k ) * eva_factor endif endif tend % pnr_rev ( k ) = min ( real ( nr ( k ) * 0.99 * orho * global_inverse_dt , kind = dp ), & tend % prv_rev ( k ) * nr ( k ) / rr ( k )) endif endif enddo end subroutine rain_evaporation subroutine freeze_cloud_melt_ice ( temp , rho , ocp , lvap , qi1d , ni1d , qiten , niten , & qc1d , nc1d , ncsave , qcten , ncten , tten ) ! freezes all cloud water and melts all cloud ice instantly given the temperature use module_mp_tempo_params , only : t0 , lfus , lsub , hgfrz , nt_c_l real ( wp ), dimension (:), intent ( in ) :: temp , rho , ocp , lvap , qi1d , ni1d , qc1d real ( wp ), dimension (:), intent ( in ), optional :: ncsave real ( wp ), dimension (:), intent ( inout ) :: qiten , niten , qcten , ncten , tten real ( wp ), dimension (:), intent ( in ), optional :: nc1d real ( wp ) :: xri , xrc , lfus2 , xnc integer :: k , nz nz = size ( temp ) do k = 1 , nz ! instantly melt all cloud ice xri = max ( 0._wp , qi1d ( k ) + qiten ( k ) * global_dt ) if (( temp ( k ) > t0 ) . and . ( xri > 0._wp )) then qcten ( k ) = qcten ( k ) + xri * global_inverse_dt ncten ( k ) = ncten ( k ) + ni1d ( k ) * global_inverse_dt qiten ( k ) = qiten ( k ) - xri * global_inverse_dt niten ( k ) = - ni1d ( k ) * global_inverse_dt tten ( k ) = tten ( k ) - lfus * ocp ( k ) * xri * global_inverse_dt endif ! instantly freeze all cloud water xrc = max ( 0._wp , qc1d ( k ) + qcten ( k ) * global_dt ) if (( temp ( k ) < hgfrz ) . and . ( xrc > 0._wp )) then lfus2 = lsub - lvap ( k ) if ( present ( nc1d )) then xnc = nc1d ( k ) + ncten ( k ) * global_dt elseif ( present ( ncsave )) then xnc = ncsave ( k ) / rho ( k ) + ncten ( k ) * global_dt else xnc = nt_c_l / rho ( k ) + ncten ( k ) * global_dt endif qiten ( k ) = qiten ( k ) + xrc * global_inverse_dt niten ( k ) = niten ( k ) + xnc * global_inverse_dt qcten ( k ) = qcten ( k ) - xrc * global_inverse_dt ncten ( k ) = ncten ( k ) - xnc * global_inverse_dt tten ( k ) = tten ( k ) + lfus2 * ocp ( k ) * xrc * global_inverse_dt endif enddo end subroutine freeze_cloud_melt_ice function koop_nucleation ( temp , satw , naero ) result ( nuc ) !! aqueous solution freezing of water from !! [Koop et al. (2000)](https://doi.org/10.1038/35020537) !! newer research suggests that the freezing rate should be lower !! than original paper, so J_rate is reduced by two orders of magnitude use module_mp_tempo_params , only : r_uni , ar_volume real ( wp ), intent ( in ) :: temp , satw , naero real ( wp ) :: xni , mu_diff , a_w_i , delta_aw , log_j_rate , j_rate , prob_h real ( wp ) :: nuc xni = 0.0_wp mu_diff = 21036 8._wp + ( 13 1.438_wp * temp ) - & ( 3.32373e6_wp / temp ) - ( 4172 9.1_wp * log ( temp )) a_w_i = exp ( mu_diff / ( r_uni * temp )) delta_aw = satw - a_w_i log_j_rate = - 90 6.7_wp + ( 850 2._wp * delta_aw ) - & ( 2692 4._wp * delta_aw * delta_aw ) + ( 2918 0._wp * delta_aw * delta_aw * delta_aw ) log_j_rate = min ( 2 0._wp , log_j_rate ) j_rate = 1 0._wp ** log_j_rate ! cm-3 s-1 prob_h = min ( 1._wp - exp ( - j_rate * ar_volume * global_dt ), 1._wp ) if ( prob_h > 0._wp ) then xni = min ( prob_h * naero , 100 0.e3_wp ) endif nuc = max ( 0._wp , xni ) end function koop_nucleation function activate_cloud_number ( temp , w1d , nwfa , land ) result ( activ ) !! calculations numer of cloud droplets activated use module_mp_tempo_params , only : ta_na , ntb_arc , ta_ww , ntb_arw , & ta_tk , ntb_art , tnccn_act real ( wp ), intent ( in ) :: temp , w1d , nwfa integer , intent ( in ), optional :: land real ( wp ) :: n_local , w_local real ( wp ) :: a , b , c , d , t , u , x1 , x2 , y1 , y2 , nx , wy , fraction real ( wp ) :: lower_lim_nuc_frac integer :: i , j , k , l , m , n real ( wp ) :: activ ! index for number of aerosols n_local = nwfa * 1.e-6_wp if ( n_local >= ta_na ( ntb_arc )) then n_local = ta_na ( ntb_arc ) - 1.0_wp elseif ( n_local <= ta_na ( 1 )) then n_local = ta_na ( 1 ) + 1.0_wp endif nindex : do n = 2 , ntb_arc if ( n_local >= ta_na ( n - 1 ) . and . n_local < ta_na ( n )) exit nindex enddo nindex i = n x1 = log ( ta_na ( i - 1 )) x2 = log ( ta_na ( i )) ! index for vertical velocity w_local = w1d if ( w_local >= ta_ww ( ntb_arw )) then w_local = ta_ww ( ntb_arw ) - 1.0_wp elseif ( w_local <= ta_ww ( 1 )) then w_local = ta_ww ( 1 ) + 0.001_wp endif windex : do n = 2 , ntb_arw if ( w_local >= ta_ww ( n - 1 ) . and . w_local < ta_ww ( n )) exit windex enddo windex j = n y1 = log ( ta_ww ( j - 1 )) y2 = log ( ta_ww ( j )) k = max ( 1 , min ( nint (( temp - ta_tk ( 1 )) * 0.1_wp ) + 1 , ntb_art )) ! the next two values are indexes of mean aerosol radius and ! hygroscopicity and are currently constant !> @todo !> separation tiny size sulfates from larger sea salts !> @endtodo l = 3 m = 2 !> @note !> there is a lower limit set for activation over water to improve cloud coverage !> @endnote lower_lim_nuc_frac = 0. if ( present ( land )) then if ( land == 1 ) then ! land lower_lim_nuc_frac = 0. elseif ( land == 0 ) then ! not land (water/ice) lower_lim_nuc_frac = 0.15 else lower_lim_nuc_frac = 0.15 ! catch-all for anything else endif endif a = tnccn_act ( i - 1 , j - 1 , k , l , m ) b = tnccn_act ( i , j - 1 , k , l , m ) c = tnccn_act ( i , j , k , l , m ) d = tnccn_act ( i - 1 , j , k , l , m ) nx = log ( n_local ) wy = log ( w_local ) t = ( nx - x1 ) / ( x2 - x1 ) u = ( wy - y1 ) / ( y2 - y1 ) fraction = ( 1.0_wp - t ) * ( 1.0_wp - u ) * a + t * ( 1.0_wp - u ) * b + t * u * c + ( 1.0_wp - t ) * u * d fraction = max ( fraction , lower_lim_nuc_frac ) activ = nwfa * fraction end function activate_cloud_number subroutine warm_rain ( rhof , l_qc , rc , nc , ilamc , mvd_c , l_qr , rr , nr , mvd_r , tend ) !! computes warm-rain process rates -- condensation/evaporation happen later use module_mp_tempo_params , only : d0r , d0c , r1 , nbr , t_efrw , & t1_qr_qc , mu_r , am_r , ccg , obmr , ocg2 , dr , org2 , cre , fv_r , & autocon_nr_factor real ( wp ), dimension (:), intent ( in ) :: rhof , mvd_r , mvd_c , rr , nr , rc , nc real ( dp ), dimension (:), intent ( in ) :: ilamc logical , dimension (:), intent ( in ) :: l_qc , l_qr type ( ty_tend ), intent ( inout ) :: tend real ( dp ) :: lamr , lamc , n0_r real ( wp ) :: ef_rr , dc_g , dc_b , xdc , zeta1 , zeta , taud , tau , ef_rw integer :: k , nz , nu_c , idx nz = size ( l_qc ) !> @note !> rain self-collection is from !> [Seifert and Beheng (2001)](https://doi.org/10.1016/S0169-8095(01)00126-0) !> and drop break-up follows !> [Verlinde and Cotton (1993)](https://doi.org/10.1175/1520-0493(1993)121<2776:FMOONC>2.0.CO;2) do k = 1 , nz if ( l_qr ( k )) then if ( mvd_r ( k ) > d0r ) then ef_rr = max ( - 0.1_wp , 1.0_wp - exp ( 230 0.0_wp * ( mvd_r ( k ) - 195 0.0e-6_wp ))) tend % pnr_rcr ( k ) = ef_rr * 2.0_wp * nr ( k ) * rr ( k ) endif endif !> !> autoconversion follows !> [Berry and Reinhardt (1974)](https://doi.org/10.1175/1520-0469(1974)031<1814:AAOCDG>2.0.CO;2) !> with characteristic diameters correctly computed from gamma distribution of cloud droplets if ( l_qc ( k )) then if ( rc ( k ) > 0.01e-3_wp ) then nu_c = get_nuc ( nc ( k )) lamc = 1._dp / ilamc ( k ) xdc = max ( d0c * 1.e6_wp , (( rc ( k ) / ( am_r * nc ( k ))) ** obmr ) * 1.e6_wp ) dc_g = (( ccg ( 3 , nu_c ) * ocg2 ( nu_c )) ** obmr / lamc ) * 1.e6_wp dc_b = ( xdc * xdc * xdc * dc_g * dc_g * dc_g - xdc * xdc * xdc * xdc * xdc * xdc ) & ** ( 1._wp / 6._wp ) zeta1 = 0.5_wp * (( 6.25e-6_wp * xdc * dc_b * dc_b * dc_b - 0.4_wp ) & + abs ( 6.25e-6_wp * xdc * dc_b * dc_b * dc_b - 0.4_wp )) zeta = 0.027_wp * rc ( k ) * zeta1 taud = 0.5_wp * (( 0.5_wp * dc_b - 7.5_wp ) + abs ( 0.5_wp * dc_b - 7.5_wp )) + r1 tau = 3.72_wp / ( rc ( k ) * taud ) tend % prr_wau ( k ) = zeta / tau tend % prr_wau ( k ) = min ( real ( rc ( k ) * global_inverse_dt , kind = dp ), & tend % prr_wau ( k )) tend % pnr_wau ( k ) = tend % prr_wau ( k ) / ( am_r * nu_c * autocon_nr_factor * d0r * d0r * d0r ) tend % pnc_wau ( k ) = min ( real ( nc ( k ) * global_inverse_dt , kind = dp ), & tend % prr_wau ( k ) / ( am_r * mvd_c ( k ) * mvd_c ( k ) * mvd_c ( k ))) endif endif !> !> rain collecting cloud water - assumes dc << dr and vtc \\approx 0 !> @endnote if ( l_qr ( k ) . and . l_qc ( k )) then if ( mvd_r ( k ) > d0r . and . mvd_c ( k ) > d0c ) then lamr = ( 3.0_dp + mu_r + 0.672_dp ) / mvd_r ( k ) idx = 1 + int ( nbr * log ( real ( mvd_r ( k ) / dr ( 1 ), kind = dp )) / & log ( real ( dr ( nbr ) / dr ( 1 ), kind = dp ))) idx = min ( idx , nbr ) ef_rw = t_efrw ( idx , int ( mvd_c ( k ) * 1.e6_wp )) n0_r = nr ( k ) * org2 * lamr ** cre ( 2 ) tend % prr_rcw ( k ) = rhof ( k ) * t1_qr_qc * ef_rw * rc ( k ) * n0_r * & (( lamr + fv_r ) ** ( - cre ( 9 ))) tend % prr_rcw ( k ) = min ( real ( rc ( k ) * global_inverse_dt , kind = dp ), tend % prr_rcw ( k )) tend % pnc_rcw ( k ) = rhof ( k ) * t1_qr_qc * ef_rw * nc ( k ) * n0_r * & (( lamr + fv_r ) ** ( - cre ( 9 ))) tend % pnc_rcw ( k ) = min ( real ( nc ( k ) * global_inverse_dt , kind = dp ), tend % pnc_rcw ( k )) endif endif enddo end subroutine warm_rain subroutine riming ( temp , rhof , visco , l_qc , rc , nc , ilamc , mvd_c , & l_qs , rs , smo0 , smob , smoc , smoe , vtboost , l_qg , rg , ng , ilamg , idx , tend ) !! snow and graupel riming use module_mp_tempo_params , only : d0c , d0s , nbs , ds , t_efsw , t1_qs_qc , & r_g , bm_g , mu_g , av_g , cgg , ogg3 , bv_g , rho_w , t0 , d0g , pi , cge , ogg2 , & rime_threshold , rime_conversion , av_s , bv_s , rho_s , xm0i , eps , fv_s , & meters3_to_liters type ( ty_tend ), intent ( inout ) :: tend real ( wp ), dimension (:), intent ( in ) :: rhof , visco , temp , rc , nc , rs , rg , ng real ( wp ), dimension (:), intent ( in ) :: mvd_c real ( dp ), dimension (:), intent ( in ) :: smo0 , smob , smoc , smoe , ilamg , ilamc logical , dimension (:), intent ( in ) :: l_qc , l_qs , l_qg integer , dimension (:), intent ( in ) :: idx real ( wp ), dimension (:), intent ( out ) :: vtboost real ( dp ) :: xds , xdg , n0_g , lamc real ( wp ) :: ef_sw , vtg , stoke_g , const_ri , tempc , rime_dens , ef_gw real ( wp ) :: t1_qg_qc , r_frac , g_frac , vts , tf , snow_dens_frac integer :: k , nz , idxs , nu_c nz = size ( l_qc ) do k = 1 , nz tempc = temp ( k ) - t0 vtboost ( k ) = 1._wp if ( l_qc ( k ) . and . l_qs ( k )) then nu_c = get_nuc ( nc ( k )) lamc = 1._dp / ilamc ( k ) xds = smoc ( k ) / smob ( k ) if (( mvd_c ( k ) > d0c ) . and . ( xds > d0s )) then !> @note !> snow collecting cloud water - assume dc << ds and vtc \\approx 0 idxs = 1 + int ( nbs * log ( real ( xds / ds ( 1 ), kind = dp )) / log ( real ( ds ( nbs ) / ds ( 1 ), kind = dp ))) idxs = min ( idxs , nbs ) ef_sw = t_efsw ( idxs , int ( mvd_c ( k ) * 1.e6_wp )) tend % prs_scw ( k ) = rhof ( k ) * t1_qs_qc * ef_sw * rc ( k ) * smoe ( k ) tend % prs_scw ( k ) = min ( real ( rc ( k ) * global_inverse_dt , kind = dp ), tend % prs_scw ( k )) tend % pnc_scw ( k ) = rhof ( k ) * t1_qs_qc * ef_sw * nc ( k ) * smoe ( k ) tend % pnc_scw ( k ) = min ( real ( nc ( k ) * global_inverse_dt , kind = dp ), tend % pnc_scw ( k )) !> !> at temperatures below melting, if the riming rate is greater than the depositional !> growth rate for snow by a factor rime_threshold, convert a portion of rimed snow !> to graupel if ( temp ( k ) < t0 ) then if ( tend % prs_scw ( k ) > rime_threshold * tend % prs_sde ( k ) . and . & tend % prs_sde ( k ) > eps ) then r_frac = min ( 3 0.0_dp , tend % prs_scw ( k ) / tend % prs_sde ( k )) g_frac = min ( rime_conversion , 0.15_wp + ( r_frac - 2._wp ) * . 028_wp ) vtboost ( k ) = min ( 1.5_wp , 1.1_wp + ( r_frac - 2. ) * . 016_wp ) tend % prg_scw ( k ) = g_frac * tend % prs_scw ( k ) tend % png_scw ( k ) = tend % prg_scw ( k ) * smo0 ( k ) / rs ( k ) vts = av_s * xds ** bv_s * exp ( - fv_s * xds ) const_ri = - 1._wp * ( mvd_c ( k ) * 0.5e6_wp ) * vts / min ( - 0.1_wp , tempc ) const_ri = max ( 0.1_wp , min ( const_ri , 1 0._wp )) rime_dens = ( 0.051_wp + 0.114_wp * const_ri - 0.0055_wp * const_ri * const_ri ) * 100 0._wp if ( rime_dens < 15 0._wp ) then g_frac = 0._wp tend % prg_scw ( k ) = 0._dp tend % png_scw ( k ) = 0._dp endif snow_dens_frac = min ( 1._wp , max ( 0._wp , rs ( k ) * global_inverse_dt / & ( rs ( k ) * global_inverse_dt + tend % prg_scw ( k )))) tend % pbg_scw ( k ) = meters3_to_liters * tend % prg_scw ( k ) / & ( rho_s * snow_dens_frac + rime_dens * ( 1._wp - snow_dens_frac )) ! tend%pbg_scw(k) = meters3_to_liters*tend%prg_scw(k) / & !  (0.5_wp*(rho_s+rime_dens)) tend % prs_scw ( k ) = ( 1._wp - g_frac ) * tend % prs_scw ( k ) endif endif endif endif if ( l_qc ( k ) . and . l_qg ( k )) then !> !> graupel collecting cloud water - assume dc << dg and vtc \\approx 0 if ( rg ( k ) >= r_g ( 1 ) . and . mvd_c ( k ) > d0c ) then xdg = ( bm_g + mu_g + 1._wp ) * ilamg ( k ) vtg = rhof ( k ) * av_g ( idx ( k )) * cgg ( 6 , idx ( k )) * ogg3 * ilamg ( k ) ** bv_g ( idx ( k )) stoke_g = mvd_c ( k ) * mvd_c ( k ) * vtg * rho_w / ( 9._wp * visco ( k ) * xdg ) !> !> rime density formula is from !> [Cober and List (1993)](https://doi.org/10.1175/1520-0469(1993)050<1591:MOTHAM>2.0.CO;2) const_ri = - 1._wp * ( mvd_c ( k ) * 0.5e6_wp ) * vtg / min ( - 0.1_wp , tempc ) const_ri = max ( 0.1_wp , min ( const_ri , 1 0._wp )) rime_dens = ( 0.051_wp + 0.114_wp * const_ri - 0.0055_wp * const_ri * const_ri ) * 100 0._wp if ( xdg > d0g ) then if ( stoke_g >= 0.4_wp . and . stoke_g <= 1 0._wp ) then ef_gw = 0.55_wp * log10 ( 2.51_wp * stoke_g ) elseif ( stoke_g < 0.4_wp ) then ef_gw = 0.0_wp elseif ( stoke_g > 1 0._wp ) then ef_gw = 0.77_wp endif !> !> hail size increases below the melting level so the collection efficiency !> is reduced (proxy for shedding of collected cloud water) if ( temp ( k ) > t0 ) ef_gw = ef_gw * 0.1_wp t1_qg_qc = pi * . 25_wp * av_g ( idx ( k )) * cgg ( 9 , idx ( k )) n0_g = ng ( k ) * ogg2 * ( 1._wp / ilamg ( k )) ** cge ( 2 , 1 ) tend % prg_gcw ( k ) = rhof ( k ) * t1_qg_qc * ef_gw * rc ( k ) * & n0_g * ilamg ( k ) ** cge ( 9 , idx ( k )) tend % pnc_gcw ( k ) = rhof ( k ) * t1_qg_qc * ef_gw * nc ( k ) * & n0_g * ilamg ( k ) ** cge ( 9 , idx ( k )) tend % pnc_gcw ( k ) = min ( real ( nc ( k ) * global_inverse_dt , kind = dp ), tend % pnc_gcw ( k )) if ( temp ( k ) < t0 ) tend % pbg_gcw ( k ) = meters3_to_liters * tend % prg_gcw ( k ) / rime_dens if ( temp ( k ) < t0 ) then !> !> rime splintering is from !> [Hallet and Mossop (1974)](https://doi.org/10.1038/249026a0) !> @endnote if ( tend % prg_gcw ( k ) > eps . and . tempc > - 8._wp ) then tf = 0._wp if ( tempc >= - 5._wp . and . tempc < - 3._wp ) then tf = 0.5_wp * ( - 3.0_wp - tempc ) elseif ( tempc > - 8._wp . and . tempc < - 5._wp ) then tf = 0.33333333_wp * ( 8._wp + tempc ) endif tend % pni_ihm ( k ) = 3.5e8_wp * tf * tend % prg_gcw ( k ) tend % pri_ihm ( k ) = xm0i * tend % pni_ihm ( k ) tend % prs_ihm ( k ) = tend % prs_scw ( k ) / ( tend % prs_scw ( k ) + tend % prg_gcw ( k )) * & tend % pri_ihm ( k ) tend % prg_ihm ( k ) = tend % prg_gcw ( k ) / ( tend % prs_scw ( k ) + tend % prg_gcw ( k )) * & tend % pri_ihm ( k ) endif endif endif endif endif end do end subroutine riming subroutine get_snow_table_index ( rs , idx_s ) !! get snow table index from snow mass use module_mp_tempo_params , only : ntb_s , nis2 real ( wp ), intent ( in ) :: rs integer :: nis , nn , n integer , intent ( out ) :: idx_s nis = nint ( log10 ( rs )) do_loop_rs : do nn = nis - 1 , nis + 1 n = nn if (( rs / 1 0._wp ** nn ) >= 1._wp . and . ( rs / 1 0._wp ** nn ) < 1 0._wp ) exit do_loop_rs enddo do_loop_rs idx_s = int ( rs / 1 0._wp ** n ) + 10 * ( n - nis2 ) - ( n - nis2 ) idx_s = max ( 1 , min ( idx_s , ntb_s )) end subroutine get_snow_table_index subroutine get_temperature_table_index ( tempk , idx_t ) !! get temperature table index use module_mp_tempo_params , only : t0 , ntb_t real ( wp ), intent ( in ) :: tempk real ( wp ) :: tempc integer , intent ( out ) :: idx_t tempc = tempk - t0 idx_t = int (( tempc - 2.5_wp ) / 5._wp ) - 1 idx_t = max ( 1 , - idx_t ) idx_t = min ( idx_t , ntb_t ) end subroutine get_temperature_table_index subroutine get_rain_table_index ( rr , ilamr , idx_r , idx_r1 ) !! get rain table indices from rain mass and lambda use module_mp_tempo_params , only : nir2 , nir3 , ntb_r , ntb_r1 , & org2 , org1 , bm_r , am_r , crg , cre real ( wp ), intent ( in ) :: rr real ( dp ), intent ( in ) :: ilamr real ( dp ) :: lamr , lam_exp , n0_exp integer :: nir , nn , n integer , intent ( out ) :: idx_r , idx_r1 nir = nint ( log10 ( rr )) do_loop_rr : do nn = nir - 1 , nir + 1 n = nn if (( rr / 1 0._wp ** nn ) >= 1._wp . and . ( rr / 1 0._wp ** nn ) < 1 0._wp ) exit do_loop_rr enddo do_loop_rr idx_r = int ( rr / 1 0._wp ** n ) + 10 * ( n - nir2 ) - ( n - nir2 ) idx_r = max ( 1 , min ( idx_r , ntb_r )) lamr = 1. / ilamr lam_exp = lamr * ( crg ( 3 ) * org2 * org1 ) ** bm_r n0_exp = org1 * rr / am_r * lam_exp ** cre ( 1 ) nir = nint ( log10 ( real ( n0_exp , kind = dp ))) do_loop_nr : do nn = nir - 1 , nir + 1 n = nn if (( n0_exp / 1 0._wp ** nn ) >= 1._wp . and . ( n0_exp / 1 0._wp ** nn ) < 1 0._wp ) exit do_loop_nr enddo do_loop_nr idx_r1 = int ( n0_exp / 1 0._wp ** n ) + 10 * ( n - nir3 ) - ( n - nir3 ) idx_r1 = max ( 1 , min ( idx_r1 , ntb_r1 )) end subroutine get_rain_table_index subroutine get_graupel_table_index ( rg , ilamg , idx , idx_g , idx_g1 ) !! get graupel table indices from graupel mass, lambda, and density index use module_mp_tempo_params , only : nig2 , ntb_g , ntb_g1 , ogg2 , ogg1 , & bm_g , cgg , ogg1 , am_g , cge , nig3 real ( wp ), intent ( in ) :: rg real ( dp ), intent ( in ) :: ilamg integer , intent ( in ) :: idx real ( dp ) :: lamg , lam_exp , n0_exp integer :: nig , nn , n integer , intent ( out ) :: idx_g , idx_g1 nig = nint ( log10 ( rg )) do_loop_rg : do nn = nig - 1 , nig + 1 n = nn if ( ( rg / 1 0._wp ** nn ) >= 1._wp . and . ( rg / 1 0._wp ** nn ). lt . 1 0._wp ) exit do_loop_rg enddo do_loop_rg idx_g = int ( rg / 1 0._wp ** n ) + 10 * ( n - nig2 ) - ( n - nig2 ) idx_g = max ( 1 , min ( idx_g , ntb_g )) lamg = 1. / ilamg lam_exp = lamg * ( cgg ( 3 , 1 ) * ogg2 * ogg1 ) ** bm_g n0_exp = ogg1 * rg / am_g ( idx ) * lam_exp ** cge ( 1 , 1 ) nig = nint ( log10 ( real ( n0_exp , kind = dp ))) do_loop_ng : do nn = nig - 1 , nig + 1 n = nn if ( ( n0_exp / 1 0._wp ** nn ) >= 1._wp . and . ( n0_exp / 1 0._wp ** nn ) < 1 0._wp ) exit do_loop_ng enddo do_loop_ng idx_g1 = int ( n0_exp / 1 0._wp ** n ) + 10 * ( n - nig3 ) - ( n - nig3 ) idx_g1 = max ( 1 , min ( idx_g1 , ntb_g1 )) end subroutine get_graupel_table_index subroutine get_cloud_table_index ( rc , nc , idx_c , idx_n ) !! get cloud table index from mass and number use module_mp_tempo_params , only : nbc , ntb_c , r_c , nic2 , t_nc , nic1 real ( wp ), intent ( in ) :: rc , nc integer , intent ( out ) :: idx_c , idx_n integer :: nic , nn , n nic = nint ( log10 ( rc )) do_loop_rc : do nn = nic - 1 , nic + 1 n = nn if ( ( rc / 1 0._wp ** nn ) >= 1._wp . and . ( rc / 1 0._wp ** nn ) < 1 0._wp ) exit do_loop_rc enddo do_loop_rc idx_c = int ( rc / 1 0._wp ** n ) + 10 * ( n - nic2 ) - ( n - nic2 ) idx_c = max ( 1 , min ( idx_c , ntb_c )) idx_n = nint ( 1._wp + real ( nbc , kind = wp ) * log ( real ( nc / t_nc ( 1 ), kind = dp )) / nic1 ) idx_n = max ( 1 , min ( idx_n , nbc )) end subroutine get_cloud_table_index subroutine get_ice_table_index ( ri , ni , idx_i , idx_i1 ) !! get ice table index from mass and number use module_mp_tempo_params , only : ntb_i , ntb_i1 , nii2 , nii3 real ( wp ), intent ( in ) :: ri , ni integer , intent ( out ) :: idx_i , idx_i1 integer :: nii , nn , n nii = nint ( log10 ( ri )) do_loop_ri : do nn = nii - 1 , nii + 1 n = nn if ( ( ri / 1 0._wp ** nn ) >= 1._wp . and . ( ri / 1 0._wp ** nn ) < 1 0._wp ) exit do_loop_ri enddo do_loop_ri idx_i = int ( ri / 1 0._wp ** n ) + 10 * ( n - nii2 ) - ( n - nii2 ) idx_i = max ( 1 , min ( idx_i , ntb_i )) nii = nint ( log10 ( ni )) do_loop_ni : do nn = nii - 1 , nii + 1 n = nn if ( ( ni / 1 0._wp ** nn ) >= 1._wp . and . ( ni / 1 0._wp ** nn ) < 1 0._wp ) exit do_loop_ni enddo do_loop_ni idx_i1 = int ( ni / 1 0._wp ** n ) + 10 * ( n - nii3 ) - ( n - nii3 ) idx_i1 = max ( 1 , min ( idx_i1 , ntb_i1 )) end subroutine get_ice_table_index subroutine rain_snow_rain_graupel ( temp , l_qr , rr , nr , ilamr , l_qs , rs , & l_qg , rg , ng , ilamg , idx , tend ) !! calculates rain-snow and rain-graupel collection use module_mp_tempo_params , only : t0 , r_r , r_s , r_g , rho_i , rho_g , meters3_to_liters , & tmr_racs2 , tcr_sacr2 , tmr_racs1 , tcr_sacr1 , tms_sacr1 , tcs_racs1 , & tnr_sacr1 , tnr_sacr2 , tnr_racs1 , tnr_racs2 , & tcr_gacr , tmr_racg , tcg_racg , tnr_gacr , tnr_racg type ( ty_tend ), intent ( inout ) :: tend real ( wp ), dimension (:), intent ( in ) :: temp , rr , rs , rg , nr , ng real ( dp ), dimension (:), intent ( in ) :: ilamr , ilamg logical , dimension (:), intent ( in ) :: l_qr , l_qs , l_qg integer , dimension (:), intent ( in ) :: idx integer :: k , nz , idx_r , idx_r1 , idx_s , idx_t , & idx_g , idx_g1 nz = size ( l_qg ) do k = 1 , nz if ( l_qr ( k ) . and . l_qs ( k )) then if ( rr ( k ) >= r_r ( 1 ) . and . rs ( k ) >= r_s ( 1 )) then call get_temperature_table_index ( temp ( k ), idx_t ) call get_rain_table_index ( rr ( k ), ilamr ( k ), idx_r , idx_r1 ) call get_snow_table_index ( rs ( k ), idx_s ) if ( temp ( k ) < t0 ) then tend % prr_rcs ( k ) = - ( tmr_racs2 ( idx_s , idx_t , idx_r1 , idx_r ) & + tcr_sacr2 ( idx_s , idx_t , idx_r1 , idx_r ) & + tmr_racs1 ( idx_s , idx_t , idx_r1 , idx_r ) & + tcr_sacr1 ( idx_s , idx_t , idx_r1 , idx_r )) tend % prs_rcs ( k ) = tmr_racs2 ( idx_s , idx_t , idx_r1 , idx_r ) & + tcr_sacr2 ( idx_s , idx_t , idx_r1 , idx_r ) & - tcs_racs1 ( idx_s , idx_t , idx_r1 , idx_r ) & - tms_sacr1 ( idx_s , idx_t , idx_r1 , idx_r ) tend % prg_rcs ( k ) = tmr_racs1 ( idx_s , idx_t , idx_r1 , idx_r ) & + tcr_sacr1 ( idx_s , idx_t , idx_r1 , idx_r ) & + tcs_racs1 ( idx_s , idx_t , idx_r1 , idx_r ) & + tms_sacr1 ( idx_s , idx_t , idx_r1 , idx_r ) tend % prr_rcs ( k ) = max ( real ( - rr ( k ) * global_inverse_dt , kind = dp ), tend % prr_rcs ( k )) tend % prs_rcs ( k ) = max ( real ( - rs ( k ) * global_inverse_dt , kind = dp ), tend % prs_rcs ( k )) tend % prg_rcs ( k ) = min ( real (( rr ( k ) + rs ( k )) * global_inverse_dt , kind = dp ), & tend % prg_rcs ( k )) tend % pnr_rcs ( k ) = tnr_racs1 ( idx_s , idx_t , idx_r1 , idx_r ) & + tnr_racs2 ( idx_s , idx_t , idx_r1 , idx_r ) & + tnr_sacr1 ( idx_s , idx_t , idx_r1 , idx_r ) & + tnr_sacr2 ( idx_s , idx_t , idx_r1 , idx_r ) tend % pnr_rcs ( k ) = min ( real ( nr ( k ) * global_inverse_dt , kind = dp ), tend % pnr_rcs ( k )) tend % png_rcs ( k ) = tend % pnr_rcs ( k ) tend % pbg_rcs ( k ) = meters3_to_liters * tend % prg_rcs ( k ) / rho_i else tend % prs_rcs ( k ) = - tcs_racs1 ( idx_s , idx_t , idx_r1 , idx_r ) & - tms_sacr1 ( idx_s , idx_t , idx_r1 , idx_r ) & + tmr_racs2 ( idx_s , idx_t , idx_r1 , idx_r ) & + tcr_sacr2 ( idx_s , idx_t , idx_r1 , idx_r ) tend % prs_rcs ( k ) = max ( real ( - rs ( k ) * global_inverse_dt , kind = dp ), tend % prs_rcs ( k )) tend % prr_rcs ( k ) = - tend % prs_rcs ( k ) endif endif endif if ( l_qr ( k ) . and . l_qg ( k )) then if ( rr ( k ) >= r_r ( 1 ) . and . rg ( k ) >= r_g ( 1 )) then call get_temperature_table_index ( temp ( k ), idx_t ) call get_rain_table_index ( rr ( k ), ilamr ( k ), idx_r , idx_r1 ) call get_graupel_table_index ( rg ( k ), ilamg ( k ), idx ( k ), idx_g , idx_g1 ) if ( temp ( k ) < t0 ) then tend % prg_rcg ( k ) = tmr_racg ( idx_g1 , idx_g , idx ( k ), idx_r1 , idx_r ) & + tcr_gacr ( idx_g1 , idx_g , idx ( k ), idx_r1 , idx_r ) tend % prg_rcg ( k ) = min ( real ( rr ( k ) * global_inverse_dt , kind = dp ), tend % prg_rcg ( k )) tend % prr_rcg ( k ) = - tend % prg_rcg ( k ) tend % pnr_rcg ( k ) = tnr_racg ( idx_g1 , idx_g , idx ( k ), idx_r1 , idx_r ) & + tnr_gacr ( idx_g1 , idx_g , idx ( k ), idx_r1 , idx_r ) tend % pnr_rcg ( k ) = min ( real ( nr ( k ) * global_inverse_dt , kind = dp ), tend % pnr_rcg ( k )) tend % pbg_rcg ( k ) = meters3_to_liters * tend % prg_rcg ( k ) / rho_i else tend % prr_rcg ( k ) = tcg_racg ( idx_g1 , idx_g , idx ( k ), idx_r1 , idx_r ) tend % prr_rcg ( k ) = min ( real ( rg ( k ) * global_inverse_dt , kind = dp ), tend % prr_rcg ( k )) tend % prg_rcg ( k ) = - tend % prr_rcg ( k ) tend % png_rcg ( k ) = tnr_racg ( idx_g1 , idx_g , idx ( k ), idx_r1 , idx_r ) tend % png_rcg ( k ) = min ( real ( ng ( k ) * global_inverse_dt , kind = dp ), tend % png_rcg ( k )) tend % pbg_rcg ( k ) = meters3_to_liters * tend % prg_rcg ( k ) / rho_g ( idx ( k )) !> @note !> adds explicit rain drop break-up due to collisions with graupel !> at temperatures above melting !> @endnote tend % pnr_rcg ( k ) = - 1.5_wp * tnr_gacr ( idx_g1 , idx_g , idx ( k ), idx_r1 , idx_r ) endif endif endif enddo end subroutine rain_snow_rain_graupel subroutine ice_nucleation ( temp , rho , w1d , qv , qvsi , ssati , ssatw , & nifa , nwfa , ni , smo0 , rc , nc , rr , nr , ilamr , tend ) !! ice nulceation use module_mp_tempo_params , only : r_r , r_c , hgfrz , rho_i , xm0i , & tpg_qrfz , tpi_qrfz , tni_qrfz , tnr_qrfz , tpi_qcfz , tni_qcfz , & demott_nuc_ssati , eps , icenuc_max , tno , ato , max_ni , meters3_to_liters type ( ty_tend ), intent ( inout ) :: tend real ( wp ), dimension (:), intent ( in ) :: qv , temp , rho , qvsi , rr , nr , rc , nc , w1d , & ssati , ssatw , ni real ( dp ), dimension (:), intent ( in ) :: ilamr , smo0 real ( wp ), dimension (:), intent ( in ), optional :: nifa , nwfa real ( wp ) :: rate_max , tempc , xni , xnc integer :: k , nz , idx_in , idx_r , idx_r1 , idx_tc , idx_c , idx_n nz = size ( qv ) do k = 1 , nz if ( temp ( k ) < t0 ) then tempc = temp ( k ) - t0 idx_tc = max ( 1 , min ( nint ( - tempc ), 45 )) rate_max = ( qv ( k ) - qvsi ( k )) * rho ( k ) * global_inverse_dt * 0.999_wp if ( present ( nifa )) then xni = demott_nucleation ( tempc , rho ( k ), nifa ( k )) else xni = 1._wp * 100 0._wp ! 1 / Liter endif call get_in_table_index ( xni , idx_in ) !> @note !> freezing of water drops into either cloud ice or graupel is from !> [Bigg (1953)](https://doi.org/10.1002/qj.49707934207) if ( rr ( k ) > r_r ( 1 )) then call get_rain_table_index ( rr ( k ), ilamr ( k ), idx_r , idx_r1 ) tend % prg_rfz ( k ) = tpg_qrfz ( idx_r , idx_r1 , idx_tc , idx_in ) * global_inverse_dt tend % pri_rfz ( k ) = tpi_qrfz ( idx_r , idx_r1 , idx_tc , idx_in ) * global_inverse_dt tend % pni_rfz ( k ) = tni_qrfz ( idx_r , idx_r1 , idx_tc , idx_in ) * global_inverse_dt tend % pnr_rfz ( k ) = tnr_qrfz ( idx_r , idx_r1 , idx_tc , idx_in ) * global_inverse_dt tend % prg_rfz ( k ) = min ( real ( rr ( k ) * global_inverse_dt , kind = dp ), tend % prg_rfz ( k )) tend % pnr_rfz ( k ) = min ( real ( nr ( k ) * global_inverse_dt , kind = dp ), tend % pnr_rfz ( k )) ! reduce number of graupel particles created at higher vertical velocities tend % png_rfz ( k ) = tend % pnr_rfz ( k ) * & max ( min (( 1 0._wp ** ( - 0.1_wp * w1d ( k )) + 0.1_wp ), 1._wp ), 0.1_wp ) ! tend%png_rfz(k) = tend%pnr_rfz(k) elseif ( rr ( k ) > r1 . and . temp ( k ) < hgfrz ) then tend % pri_rfz ( k ) = rr ( k ) * global_inverse_dt tend % pni_rfz ( k ) = nr ( k ) * global_inverse_dt endif tend % pbg_rfz ( k ) = meters3_to_liters * tend % prg_rfz ( k ) / rho_i if ( rc ( k ) > r_c ( 1 )) then call get_cloud_table_index ( rc ( k ), nc ( k ), idx_c , idx_n ) tend % pri_wfz ( k ) = tpi_qcfz ( idx_c , idx_n , idx_tc , idx_in ) * global_inverse_dt tend % pri_wfz ( k ) = min ( real ( rc ( k ) * global_inverse_dt , kind = dp ), tend % pri_wfz ( k )) tend % pni_wfz ( k ) = tni_qcfz ( idx_c , idx_n , idx_tc , idx_in ) * global_inverse_dt tend % pni_wfz ( k ) = min ( real ( nc ( k ) * global_inverse_dt , kind = dp ), & tend % pri_wfz ( k ) / ( 2.0_dp * xm0i ), tend % pni_wfz ( k )) elseif ( rc ( k ) > r1 . and . temp ( k ) < hgfrz ) then tend % pri_wfz ( k ) = rc ( k ) * global_inverse_dt tend % pni_wfz ( k ) = nc ( k ) * global_inverse_dt endif !> !> deposition nucleation from dust is from !> [DeMott et al. (2010)](https://doi.org/10.1073/pnas.0910818107) if (( ssati ( k ) >= demott_nuc_ssati ) . or . ( ssatw ( k ) > eps & . and . tempc < - 2 0._wp )) then if ( present ( nifa )) then xnc = demott_nucleation ( tempc , rho ( k ), nifa ( k )) else xnc = min ( icenuc_max , tno * exp ( ato * ( t0 - temp ( k )))) endif xni = ni ( k ) + ( tend % pni_rfz ( k ) + tend % pni_wfz ( k )) * global_dt tend % pni_inu ( k ) = 0.5_wp * ( xnc - xni + abs ( xnc - xni )) * global_inverse_dt tend % pri_inu ( k ) = min ( real ( rate_max , kind = dp ), xm0i * tend % pni_inu ( k )) tend % pni_inu ( k ) = tend % pri_inu ( k ) / xm0i endif !> !> freezing of aqueous aerosols is based on [Koop et al. (2000)](https://doi.org/10.1038/35020537) xni = smo0 ( k ) + ni ( k ) + ( tend % pni_rfz ( k ) + tend % pni_wfz ( k ) + tend % pni_inu ( k )) * global_dt if ( present ( nwfa )) then if (( xni <= max_ni ) . and .( temp ( k ) < 23 8._wp ) . and . ( ssati ( k ) >= 0.4_wp )) then xnc = koop_nucleation ( temp ( k ), ssatw ( k ), nwfa ( k )) tend % pni_iha ( k ) = xnc * global_inverse_dt tend % pri_iha ( k ) = min ( real ( rate_max , kind = dp ), xm0i * 0.1_wp * tend % pni_iha ( k )) tend % pni_iha ( k ) = tend % pri_iha ( k ) / ( xm0i * 0.1_wp ) endif endif endif enddo end subroutine ice_nucleation function demott_nucleation ( tempc , rho , nifa ) result ( nuc ) !! DeMott nucleation use module_mp_tempo_params , only : rho_not0 real ( wp ), intent ( in ) :: tempc , rho , nifa real ( wp ) :: xni , nifa_cc real ( wp ) :: nuc xni = 0._wp nifa_cc = max ( 0.5_wp , nifa * rho_not0 * 1.e-6_wp / rho ) xni = ( 5.94e-5_wp * ( - tempc ) ** 3.33_wp ) * ( nifa_cc ** (( - 0.0264_wp * ( tempc )) + 0.0033_wp )) xni = xni * rho / rho_not0 * 100 0._wp nuc = max ( 0._wp , xni ) end function demott_nucleation subroutine get_in_table_index ( xni , idx_in ) !! get ice nuclei table index use module_mp_tempo_params , only : ntb_in , nt_in , niin2 real ( wp ), intent ( in ) :: xni integer , intent ( out ) :: idx_in integer :: niin , nn , n if ( xni > nt_in ( 1 )) then niin = nint ( log10 ( xni )) do_loop_xni : do nn = niin - 1 , niin + 1 n = nn if ( ( xni / 1 0._wp ** nn ) >= 1._wp . and . ( xni / 1 0._wp ** nn ) < 1 0._wp ) exit do_loop_xni enddo do_loop_xni idx_in = int ( xni / 1 0._wp ** n ) + 10 * ( n - niin2 ) - ( n - niin2 ) idx_in = max ( 1 , min ( idx_in , ntb_in )) else idx_in = 1 endif end subroutine get_in_table_index subroutine get_t1_subl ( rho , temp , qvsi , tcond , diffu , ssati , t1_subl ) !! calculations thermodynamic term used in depositional growth and melting use module_mp_tempo_params , only : t0 , bm_i , mu_i , lsub , orv , & pi , c_sqrd , c_cube , d0s , ntb_i , r_s , ef_si , r_r , fv_r , ef_ri , & rho_i , eps , rho_w , rho_g real ( wp ), dimension (:), intent ( in ) :: rho , temp , qvsi , tcond , diffu , ssati real ( wp ) :: otemp , rvs , rvs_p , rvs_pp , gamsc , alphsc , xsat real ( wp ), dimension (:), intent ( out ) :: t1_subl integer :: k , nz nz = size ( rho ) do k = 1 , nz otemp = 1._wp / temp ( k ) rvs = rho ( k ) * qvsi ( k ) rvs_p = rvs * otemp * ( lsub * otemp * orv - 1._wp ) rvs_pp = rvs * ( otemp * ( lsub * otemp * orv - 1._wp ) * otemp * ( lsub * otemp * orv - 1._wp ) + & ( - 2. * lsub * otemp * otemp * otemp * orv ) + otemp * otemp ) gamsc = lsub * diffu ( k ) / tcond ( k ) * rvs_p alphsc = 0.5_wp * ( gamsc / ( 1._wp + gamsc )) * ( gamsc / ( 1._wp + gamsc )) * & rvs_pp / rvs_p * rvs / rvs_p alphsc = max ( 1.e-9_wp , alphsc ) xsat = ssati ( k ) if ( abs ( xsat ) < 1.e-9_wp ) xsat = 0._wp t1_subl ( k ) = 4._wp * pi * ( 1._wp - alphsc * xsat + 2._wp * alphsc * alphsc * xsat * xsat - & 5._wp * alphsc * alphsc * alphsc * xsat * xsat * xsat ) / ( 1._wp + gamsc ) end do end subroutine get_t1_subl subroutine ice_processes ( rhof , rhof2 , rho , w1d , temp , qv , qvsi , tcond , diffu , & vsc2 , ssati , l_qi , ri , ni , ilami , l_qs , rs , smoe , smof , smo1 , rr , nr , ilamr , & mvd_r , l_qg , rg , ng , ilamg , idx , tend ) !! ice processes including cloud ice depositional growth, conversion of cloud ice !! to snow, snow collecting cloud ice, rain collecting cloud ice, snow depositional growth, !! and graupel sublimation use module_mp_tempo_params , only : t0 , d0i , bm_i , mu_i , am_i , & c_sqrd , c_cube , oig1 , cig , d0s , ntb_i , tpi_ide , tps_iaus , tni_iaus , & obmi , r_s , ef_si , t1_qs_qi , r_r , org2 , cre , t1_qr_qi , t2_qr_qi , & fv_r , ef_ri , rho_i , t1_qs_sd , t2_qs_sd , eps , t1_qg_sd , & sc3 , ogg2 , cge , cgg , av_g , rho_w , rho_g type ( ty_tend ), intent ( inout ) :: tend logical , dimension (:), intent ( in ) :: l_qi , l_qs , l_qg real ( wp ), dimension (:), intent ( in ) :: rhof , rhof2 , rho , w1d , ri , ni , rs , rr , nr , & temp , qv , qvsi , tcond , diffu , ssati , vsc2 , mvd_r , rg , ng real ( dp ), dimension (:), intent ( in ) :: ilami , smoe , smof , smo1 , ilamr , ilamg integer , dimension (:), intent ( in ) :: idx real ( wp ) :: xdi , xmi , oxmi , c_snow , rate_max , otemp , rvs , t2_qg_sd real ( dp ) :: lami , lamr , n0_r , n0_g integer :: k , nz , idx_i , idx_i1 real ( wp ), dimension (:), allocatable :: t1_subl nz = size ( l_qi ) allocate ( t1_subl ( nz ), source = 0._wp ) call get_t1_subl ( rho , temp , qvsi , tcond , diffu , ssati , t1_subl ) do k = 1 , nz otemp = 1._wp / temp ( k ) rvs = rho ( k ) * qvsi ( k ) rate_max = ( qv ( k ) - qvsi ( k )) * rho ( k ) * global_inverse_dt * 0.999_wp if ( temp ( k ) < t0 ) then if ( l_qi ( k )) then call get_ice_table_index ( ri ( k ), ni ( k ), idx_i , idx_i1 ) lami = 1._dp / ilami ( k ) xdi = max ( real ( d0i , kind = dp ), ( bm_i + mu_i + 1. ) * ilami ( k )) xmi = am_i * xdi ** bm_i oxmi = 1._wp / xmi tend % pri_ide ( k ) = c_cube * t1_subl ( k ) * diffu ( k ) * ssati ( k ) * rvs & * oig1 * cig ( 5 ) * ni ( k ) * ilami ( k ) if ( tend % pri_ide ( k ) < 0._dp ) then tend % pri_ide ( k ) = max ( real ( - ri ( k ) * global_inverse_dt , kind = dp ), & tend % pri_ide ( k ), real ( rate_max , kind = dp )) tend % pni_ide ( k ) = tend % pri_ide ( k ) * oxmi tend % pni_ide ( k ) = max ( real ( - ni ( k ) * global_inverse_dt , kind = dp ), tend % pni_ide ( k )) else tend % pri_ide ( k ) = min ( tend % pri_ide ( k ), real ( rate_max , kind = dp )) tend % prs_ide ( k ) = ( 1.0_dp - tpi_ide ( idx_i , idx_i1 )) * tend % pri_ide ( k ) tend % pri_ide ( k ) = tpi_ide ( idx_i , idx_i1 ) * tend % pri_ide ( k ) endif ! conversion of cloud ice to snow if (( idx_i == ntb_i ) . or . ( xdi > 5.0_wp * d0s )) then tend % prs_iau ( k ) = ri ( k ) * . 99_wp * global_inverse_dt tend % pni_iau ( k ) = ni ( k ) * . 95_wp * global_inverse_dt elseif ( xdi < 0.1_wp * d0s ) then tend % prs_iau ( k ) = 0._dp tend % pni_iau ( k ) = 0._dp else tend % prs_iau ( k ) = tps_iaus ( idx_i , idx_i1 ) * global_inverse_dt tend % prs_iau ( k ) = min ( real ( ri ( k ) * . 99_wp * global_inverse_dt , kind = dp ), tend % prs_iau ( k )) tend % pni_iau ( k ) = tni_iaus ( idx_i , idx_i1 ) * global_inverse_dt tend % pni_iau ( k ) = min ( real ( ni ( k ) * . 95_wp * global_inverse_dt , kind = dp ), tend % pni_iau ( k )) endif ! snow collecting cloud ice assumes di << ds and vti ~ 0 lami = ( am_i * cig ( 2 ) * oig1 * ni ( k ) / ri ( k )) ** obmi xdi = max ( real ( D0i , kind = dp ), ( bm_i + mu_i + 1. ) * ilami ( k )) xmi = am_i * xDi ** bm_i oxmi = 1. / xmi if ( rs ( k ) >= r_s ( 1 )) then tend % prs_sci ( k ) = t1_qs_qi * rhof ( k ) * ef_si * ri ( k ) * smoe ( k ) tend % pni_sci ( k ) = tend % prs_sci ( k ) * oxmi endif ! rain collecting cloud ice assumes di << dr and vti= ~ 0 if ( rr ( k ) >= r_r ( 1 ) . and . mvd_r ( k ) > 4._wp * xdi ) then lamr = 1._wp / ilamr ( k ) n0_r = nr ( k ) * org2 * lamr ** cre ( 2 ) tend % pri_rci ( k ) = rhof ( k ) * t1_qr_qi * ef_ri * ri ( k ) * n0_r * & (( lamr + fv_r ) ** ( - cre ( 9 ))) tend % pnr_rci ( k ) = rhof ( k ) * t1_qr_qi * ef_ri * ni ( k ) * n0_r * & (( lamr + fv_r ) ** ( - cre ( 9 ))) tend % pnr_rci ( k ) = min ( real ( nr ( k ) * global_inverse_dt , kind = dp ), tend % pnr_rci ( k )) tend % png_rci ( k ) = tend % pnr_rci ( k ) * & max ( min (( 1 0._wp ** ( - 0.1 * w1d ( k )) + 0.1_wp ), 1._wp ), 0.1_wp ) tend % pni_rci ( k ) = tend % pri_rci ( k ) * oxmi tend % prr_rci ( k ) = rhof ( k ) * t2_qr_qi * ef_ri * ni ( k ) * n0_r * & (( lamr + fv_r ) ** ( - cre ( 8 ))) tend % prr_rci ( k ) = min ( real ( rr ( k ) * global_inverse_dt , kind = dp ), tend % prr_rci ( k )) tend % prg_rci ( k ) = tend % pri_rci ( k ) + tend % prr_rci ( k ) tend % pbg_rci ( k ) = tend % prg_rci ( k ) / rho_i endif endif if ( l_qs ( k )) then c_snow = c_sqrd + ( temp ( k ) - t0 + 1.5_wp ) * ( c_cube - c_sqrd ) / ( - 3 0._wp + 1.5_wp ) c_snow = max ( c_sqrd , min ( c_snow , c_cube )) tend % prs_sde ( k ) = c_snow * t1_subl ( k ) * diffu ( k ) * ssati ( k ) * rvs * ( t1_qs_sd * smo1 ( k ) + & t2_qs_sd * rhof2 ( k ) * vsc2 ( k ) * smof ( k )) if ( tend % prs_sde ( k ) < 0._dp ) then tend % prs_sde ( k ) = max ( real ( - rs ( k ) * global_inverse_dt , kind = dp ), & tend % prs_sde ( k ), real ( rate_max , kind = dp )) else tend % prs_sde ( k ) = min ( tend % prs_sde ( k ), real ( rate_max , kind = dp )) endif endif if ( l_qg ( k )) then if ( ssati ( k ) < - eps ) then n0_g = ng ( k ) * ogg2 * ( 1._wp / ilamg ( k )) ** cge ( 2 , 1 ) t2_qg_sd = 0.28_wp * sc3 * sqrt ( av_g ( idx ( k ))) * cgg ( 11 , idx ( k )) tend % prg_gde ( k ) = c_cube * t1_subl ( k ) * diffu ( k ) * ssati ( k ) * rvs & * n0_g * ( t1_qg_sd * ilamg ( k ) ** cge ( 10 , 1 ) & + t2_qg_sd * vsc2 ( k ) * rhof2 ( k ) * ilamg ( k ) ** cge ( 11 , idx ( k ))) if ( tend % prg_gde ( k ) < 0._wp ) then tend % prg_gde ( k ) = max ( real ( - rg ( k ) * global_inverse_dt , kind = dp ), & tend % prg_gde ( k ), real ( rate_max , kind = dp )) tend % png_gde ( k ) = tend % prg_gde ( k ) * ng ( k ) / rg ( k ) else tend % prg_gde ( k ) = min ( tend % prg_gde ( k ), real ( rate_max , kind = dp )) endif endif endif endif enddo end subroutine ice_processes subroutine melting ( rhof2 , rho , temp , qvsi , tcond , diffu , vsc2 , ssati , & delqvs , l_qs , rs , smof , smo0 , smo1 , l_qg , rg , ng , ilamg , idx , tend ) !! melting of snow and graupel use module_mp_tempo_params , only : t0 , bm_i , mu_i , pi , c_sqrd , c_cube , d0s , & ntb_i , r_s , ef_si , r_r , fv_r , ef_ri , rho_i , t1_qs_sd , t2_qs_sd , eps , & t1_qg_sd , sc3 , ogg2 , cge , cgg , av_g , t1_qs_me , t2_qs_me , lvap0 , olfus , & t1_qg_me , rho_w , rho_g , meters3_to_liters , timestep_conversion_rime_to_rain type ( ty_tend ), intent ( inout ) :: tend logical , dimension (:), intent ( in ) :: l_qs , l_qg real ( wp ), dimension (:), intent ( in ) :: rhof2 , rho , rs , & temp , qvsi , tcond , diffu , ssati , delqvs , vsc2 , rg , ng real ( dp ), dimension (:), intent ( in ) :: smof , smo0 , smo1 , ilamg integer , dimension (:), intent ( in ) :: idx real ( wp ) :: tempc , otemp , rvs , melt_f , t2_qg_me , t2_qg_sd real ( dp ) :: n0_g , n0_melt , lamg integer :: k , nz real ( wp ), dimension (:), allocatable :: t1_subl nz = size ( l_qs ) allocate ( t1_subl ( nz ), source = 0._wp ) call get_t1_subl ( rho , temp , qvsi , tcond , diffu , ssati , t1_subl ) do k = 1 , nz otemp = 1._wp / temp ( k ) tempc = temp ( k ) - t0 rvs = rho ( k ) * qvsi ( k ) if ( temp ( k ) > t0 ) then if ( l_qs ( k )) then tend % prr_sml ( k ) = ( tempc * tcond ( k ) - lvap0 * diffu ( k ) * delqvs ( k )) * & ( t1_qs_me * smo1 ( k ) + t2_qs_me * rhof2 ( k ) * vsc2 ( k ) * smof ( k )) if ( tend % prr_sml ( k ) > 0._dp ) then tend % prr_sml ( k ) = tend % prr_sml ( k ) + 421 8._wp * olfus * tempc * & ( tend % prr_rcs ( k ) + tend % prs_scw ( k )) tend % prr_sml ( k ) = min ( real ( rs ( k ) * global_inverse_dt , kind = dp ), & max ( 0._dp , tend % prr_sml ( k ))) tend % pnr_sml ( k ) = smo0 ( k ) / rs ( k ) * tend % prr_sml ( k ) * 1 0.0_wp ** ( - 0.25_wp * tempc ) tend % pnr_sml ( k ) = min ( real ( smo0 ( k ) * global_inverse_dt , kind = dp ), tend % pnr_sml ( k )) else tend % prr_sml ( k ) = 0._dp tend % pnr_sml ( k ) = 0._dp if ( ssati ( k ) < 0._wp ) then tend % prs_sde ( k ) = c_cube * t1_subl ( k ) * diffu ( k ) * ssati ( k ) * rvs * & ( t1_qs_sd * smo1 ( k ) + t2_qs_sd * rhof2 ( k ) * vsc2 ( k ) * smof ( k )) tend % prs_sde ( k ) = max ( real ( - rs ( k ) * global_inverse_dt , kind = dp ), tend % prs_sde ( k )) endif endif endif if ( l_qg ( k )) then n0_g = ng ( k ) * ogg2 * ( 1._wp / ilamg ( k )) ** cge ( 2 , 1 ) n0_melt = ng ( k ) * ogg2 * ( 1._dp / ilamg ( k )) ** cge ( 2 , 1 ) if (( rg ( k ) * ng ( k )) < 1.e-4_wp ) then lamg = 1. / ilamg ( k ) n0_melt = ( 1.e-4_wp / rg ( k )) * ogg2 * lamg ** cge ( 2 , 1 ) endif t2_qg_me = pi * 4._wp * c_cube * olfus * & 0.2_wp * sc3 * sqrt ( av_g ( idx ( k ))) * cgg ( 11 , idx ( k )) tend % prr_gml ( k ) = ( tempc * tcond ( k ) - lvap0 * diffu ( k ) * delqvs ( k )) * & n0_melt * ( t1_qg_me * ilamg ( k ) ** cge ( 10 , 1 ) + & t2_qg_me * rhof2 ( k ) * vsc2 ( k ) * ilamg ( k ) ** cge ( 11 , idx ( k ))) tend % prr_gml ( k ) = min ( real ( rg ( k ) * global_inverse_dt , kind = dp ), max ( 0._dp , tend % prr_gml ( k ))) if ( tend % prr_gml ( k ) > 0._dp ) then melt_f = max ( 0.05_wp , min ( tend % prr_gml ( k ) * global_dt / rg ( k ), 1._wp )) ! 1000 is density water, 50 is lower limit (max ice density is 800) tend % pbg_gml ( k ) = meters3_to_liters * tend % prr_gml ( k ) / & max ( min ( melt_f * rho_g ( idx ( k )), rho_w ), 5 0._wp ) tend % pnr_gml ( k ) = tend % prr_gml ( k ) * ng ( k ) / rg ( k ) * 1 0.0_wp ** ( - 0.33_wp * ( temp ( k ) - t0 )) else tend % prr_gml ( k ) = 0._dp tend % pnr_gml ( k ) = 0._dp tend % pbg_gml ( k ) = 0._dp if ( ssati ( k ) < 0._wp ) then t2_qg_sd = 0.28_wp * Sc3 * sqrt ( av_g ( idx ( k ))) * cgg ( 11 , idx ( k )) tend % prg_gde ( k ) = C_cube * t1_subl ( k ) * diffu ( k ) * ssati ( k ) * rvs * n0_g * & ( t1_qg_sd * ilamg ( k ) ** cge ( 10 , 1 ) + & t2_qg_sd * vsc2 ( k ) * rhof2 ( k ) * ilamg ( k ) ** cge ( 11 , idx ( k ))) tend % prg_gde ( k ) = max ( real ( - rg ( k ) * global_inverse_dt , kind = dp ), tend % prg_gde ( k )) tend % png_gde ( k ) = tend % prg_gde ( k ) * ng ( k ) / rg ( k ) endif endif endif !> @note !> if snow and graupel collected cloud water at temperatures above melting !> and if the timestep is too long, the melting process should have converted !> everything to rain !> !> credit to Bjorn-Egil Nygaard for this find if ( global_dt > timestep_conversion_rime_to_rain ) then tend % prr_rcw ( k ) = tend % prr_rcw ( k ) + tend % prs_scw ( k ) + tend % prg_gcw ( k ) tend % prs_scw ( k ) = 0._dp tend % prg_gcw ( k ) = 0._dp endif endif enddo end subroutine melting subroutine aerosol_scavenging ( temp , rho , rhof , visco , nwfa , nifa , & l_qr , nr , ilamr , mvd_r , l_qs , rs , smob , smoc , smoe , & l_qg , rg , ng , ilamg , idx , tend ) !! scavenging of aerosols by rain, snow, and graupel use module_mp_tempo_params , only : d0r , t1_qr_qc , fv_r , cre , & org2 , r_s , t1_qs_qc , r_g , bm_g , mu_g , av_g , cge , cgg , pi , ogg2 real ( wp ), dimension (:), intent ( in ) :: temp , rho , rhof , visco , nr , mvd_r , & nwfa , nifa , rs , rg , ng real ( dp ), dimension (:), intent ( in ) :: smob , smoc , smoe , ilamg , ilamr integer , dimension (:), intent ( in ) :: idx logical , dimension (:), intent ( in ) :: l_qr , l_qs , l_qg type ( ty_tend ), intent ( inout ) :: tend real ( wp ) :: ef_ra , ef_sa , ef_ga , t1_qg_qc real ( dp ) :: n0_r , xds , xdg , n0_g , lamr real ( wp ), parameter :: wf_aerosol_size = 0.04e-6_wp real ( wp ), parameter :: if_aerosol_size = 0.8e-6_wp integer :: k , nz nz = size ( l_qr ) do k = 1 , nz if ( l_qr ( k ) . and . mvd_r ( k ). gt . d0r ) then ef_ra = aerosol_collection_efficiency ( real ( mvd_r ( k ), kind = dp ), & wf_aerosol_size , visco ( k ), rho ( k ), temp ( k ), 'r' ) lamr = 1._dp / ilamr ( k ) n0_r = nr ( k ) * org2 * lamr ** cre ( 2 ) tend % pna_rca ( k ) = rhof ( k ) * t1_qr_qc * ef_ra * nwfa ( k ) * n0_r * & (( lamr + fv_r ) ** ( - cre ( 9 ))) tend % pna_rca ( k ) = min ( real ( nwfa ( k ) * global_inverse_dt , kind = dp ), & tend % pna_rca ( k )) ef_ra = aerosol_collection_efficiency ( real ( mvd_r ( k ), kind = dp ), & if_aerosol_size , visco ( k ), rho ( k ), temp ( k ), 'r' ) tend % pnd_rcd ( k ) = rhof ( k ) * t1_qr_qc * ef_ra * nifa ( k ) * n0_r * & (( lamr + fv_r ) ** ( - cre ( 9 ))) tend % pnd_rcd ( k ) = min ( real ( nifa ( k ) * global_inverse_dt , kind = dp ), & tend % pnd_rcd ( k )) endif if ( l_qs ( k ) . and . rs ( k ) > r_s ( 1 )) then xds = smoc ( k ) / smob ( k ) ef_sa = aerosol_collection_efficiency ( xds , wf_aerosol_size , & visco ( k ), rho ( k ), temp ( k ), 's' ) tend % pna_sca ( k ) = rhof ( k ) * t1_qs_qc * ef_sa * nwfa ( k ) * smoe ( k ) tend % pna_sca ( k ) = min ( real ( nwfa ( k ) * global_inverse_dt , kind = dp ), & tend % pna_sca ( k )) ef_sa = aerosol_collection_efficiency ( xds , if_aerosol_size , & visco ( k ), rho ( k ), temp ( k ), 's' ) tend % pnd_scd ( k ) = rhof ( k ) * t1_qs_qc * Ef_sa * nifa ( k ) * smoe ( k ) tend % pnd_scd ( k ) = min ( real ( nifa ( k ) * global_inverse_dt , kind = dp ), & tend % pnd_scd ( k )) endif if ( l_qg ( k ) . and . rg ( k ) > r_g ( 1 )) then xdg = ( bm_g + mu_g + 1._dp ) * ilamg ( k ) ef_ga = aerosol_collection_efficiency ( xdg , wf_aerosol_size , & visco ( k ), rho ( k ), temp ( k ), 'g' ) t1_qg_qc = pi * . 25_wp * av_g ( idx ( k )) * cgg ( 9 , idx ( k )) n0_g = ng ( k ) * ogg2 * ( 1._wp / ilamg ( k )) ** cge ( 2 , 1 ) tend % pna_gca ( k ) = rhof ( k ) * t1_qg_qc * ef_ga * nwfa ( k ) * n0_g * & ilamg ( k ) ** cge ( 9 , idx ( k )) tend % pna_gca ( k ) = min ( real ( nwfa ( k ) * global_inverse_dt , kind = dp ), & tend % pna_gca ( k )) ef_ga = aerosol_collection_efficiency ( xdg , if_aerosol_size , & visco ( k ), rho ( k ), temp ( k ), 'g' ) tend % pnd_gcd ( k ) = rhof ( k ) * t1_qg_qc * ef_ga * nifa ( k ) * n0_g * & ilamg ( k ) ** cge ( 9 , idx ( k )) tend % pnd_gcd ( k ) = min ( real ( nifa ( k ) * global_inverse_dt , kind = dp ), & tend % pnd_gcd ( k )) endif enddo end subroutine aerosol_scavenging end module module_mp_tempo_main","tags":"","url":"sourcefile/module_mp_tempo_main.f90.html"},{"title":"module_mp_tempo_diags.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~module_mp_tempo_diags.f90~~EfferentGraph sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~module_mp_tempo_diags.f90~~AfferentGraph sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_diags.f90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_diags !! diagnostic output use module_mp_tempo_params , only : wp , sp , dp , create_bins , r1 , pi use module_mp_tempo_utils , only : get_nuc , snow_moments implicit none private public :: reflectivity_10cm , effective_radius , max_hail_diam , freezing_rain contains subroutine effective_radius ( temp , l_qc , nc , ilamc , l_qi , ilami , l_qs , rs , & re_qc , re_qi , re_qs ) !! effective radius values for cloud water, cloud ice and snow !! !! r_{e} = 0.5\\frac{\\int_0&#94;\\infty D&#94;{3}n(D)dD}{\\int_0&#94;\\infty D&#94;2n(D)dD} use module_mp_tempo_params , only : mu_i , t0 real ( wp ), dimension (:), intent ( in ) :: temp , nc , rs real ( dp ), dimension (:), intent ( in ) :: ilamc , ilami logical , dimension (:), intent ( in ) :: l_qc , l_qi , l_qs real ( wp ), dimension (:), intent ( out ) :: re_qc , re_qi , re_qs real ( wp ), dimension ( 15 ), parameter :: g_ratio = & [ 2 4._wp , 6 0._wp , 12 0._wp , 21 0._wp , 33 6._wp , 50 4._wp , 72 0._wp , 99 0._wp , & 132 0._wp , 171 6._wp , 218 4._wp , 273 0._wp , 336 0._wp , 408 0._wp , 489 6._wp ] real ( dp ) :: smob , smoc real ( wp ) :: tc0 integer :: k , nz , nu_c nz = size ( l_qc ) do k = 1 , nz re_qc ( k ) = 0._wp re_qi ( k ) = 0._wp re_qs ( k ) = 0._wp !> @note !> limiting values of 2.51-50 \\mu m for cloud water, 2.51-125 \\mu m for !> cloud ice, and 5.01-999 \\mu m for snow are consistent with RRTMG radiation !> @endnote if ( l_qc ( k )) then nu_c = get_nuc ( nc ( k )) re_qc ( k ) = max ( 2.51e-6_wp , & min ( real ( 0.5_dp * ( 3._dp + real ( nu_c , kind = dp )) * ilamc ( k ), kind = wp ), 5 0.e-6_wp )) endif if ( l_qi ( k )) then re_qi ( k ) = max ( 2.51e-6_wp , & min ( real ( 0.5_dp * ( 3._dp + real ( mu_i , kind = dp )) * ilami ( k ), kind = wp ), 12 5.e-6_wp )) endif if ( l_qs ( k )) then tc0 = min ( - 0.1 , temp ( k ) - t0 ) call snow_moments ( rs = rs ( k ), tc = tc0 , smob = smob , smoc = smoc ) re_qs ( k ) = max ( 5.01e-6_wp , min ( 0.5_wp * ( smoc / smob ), 99 9.e-6_wp )) endif enddo end subroutine effective_radius subroutine reflectivity_10cm ( refl10cm_from_melting_flag , & temp , l_qr , rr , nr , ilamr , l_qs , rs , smoc , smob , smoz , & l_qg , rg , ng , idx , ilamg , dbz ) !! 10-cm radar reflectivity !! !! contributions from melting snow and graupel are optionally included !! !! Z_{e} = \\int_0&#94;\\infty D&#94;{6}n(D)dD and dbz = 10*log10(Z_{e}*1\\times 10&#94;{18}) use module_mp_tempo_params , only : pi , org2 , cre , crg , am_s , am_g , cge , cgg , ogg2 logical , intent ( in ) :: refl10cm_from_melting_flag logical , dimension (:), intent ( in ) :: l_qr , l_qs , l_qg real ( wp ), dimension (:), intent ( in ) :: temp , rg , ng , rr , nr , rs real ( dp ), dimension (:), intent ( in ) :: ilamr , smoc , smob , smoz , ilamg integer , dimension (:), intent ( in ) :: idx real ( wp ), dimension (:), intent ( out ) :: dbz real ( wp ), allocatable , dimension (:) :: ze_rain , ze_snow , ze_graupel real ( dp ) :: n0_r , lamr , n0_g integer :: k , nz , k_melt nz = size ( temp ) allocate ( ze_rain ( nz ), source = 1.e-22_wp ) allocate ( ze_snow ( nz ), source = 1.e-22_wp ) allocate ( ze_graupel ( nz ), source = 1.e-22_wp ) if ( refl10cm_from_melting_flag ) then k_melt = find_melting_level ( temp , l_qr , l_qs , l_qg ) endif do k = nz , 1 , - 1 dbz ( k ) = - 3 5._wp if ( l_qr ( k )) then lamr = 1._dp / ilamr ( k ) n0_r = nr ( k ) * org2 * lamr ** cre ( 2 ) ze_rain ( k ) = n0_r * crg ( 4 ) * ilamr ( k ) ** cre ( 4 ) endif if ( l_qs ( k )) then ze_snow ( k ) = ( 0.176_wp / 0.93_wp ) * ( 6._wp / pi ) * ( 6._wp / pi ) * & ( am_s / 90 0._wp ) * ( am_s / 90 0._wp ) * smoz ( k ) ! include melting if ( refl10cm_from_melting_flag ) then if ( k_melt > 2 . and . k < k_melt - 1 ) then ze_snow ( k ) = reflectivity_from_melting_snow ( rs ( k ), & smob ( k ), smoc ( k ), rr ( k )) endif endif endif if ( l_qg ( k )) then n0_g = ng ( k ) * ogg2 * ( 1._dp / ilamg ( k )) ** cge ( 2 , 1 ) ze_graupel ( k ) = ( 0.176_wp / 0.93_wp ) * ( 6._wp / pi ) * ( 6._wp / pi ) * & ( am_g ( idx ( k )) / 90 0._wp ) * ( am_g ( idx ( k )) / 90 0._wp ) * n0_g * cgg ( 4 , 1 ) * ilamg ( k ) ** cge ( 4 , 1 ) ! include melting if ( refl10cm_from_melting_flag ) then if ( k_melt > 2 . and . k < k_melt - 1 ) then ze_graupel ( k ) = reflectivity_from_melting_graupel ( rg ( k ), ng ( k ), & ilamg ( k ), idx ( k ), rr ( k )) endif endif endif dbz ( k ) = max ( - 3 5._wp , 1 0._wp * log10 (( ze_rain ( k ) + ze_snow ( k ) + ze_graupel ( k )) * 1.e18_dp )) enddo end subroutine reflectivity_10cm function find_melting_level ( temp , l_qr , l_qs , l_qg ) result ( k_melt ) !! finds the melting level use module_mp_tempo_params , only : t0 real ( wp ), dimension (:), intent ( in ) :: temp logical , dimension (:), intent ( in ) :: l_qr , l_qs , l_qg integer :: k , nz integer :: k_melt nz = size ( l_qr ) k_melt = 1 kloop : do k = nz - 1 , 1 , - 1 if (( temp ( k ) > t0 ) . and . l_qr ( k ) . and . ( l_qs ( k + 1 ) . or . l_qg ( k + 1 ))) then k_melt = max ( k + 1 , k_melt ) exit kloop endif enddo kloop end function find_melting_level function complex_water_ray ( lambda , t ) result ( refractive_index ) use module_mp_tempo_params , only : pi !! complex refractive index of water !! from [Ray (1972)](https://doi.org/10.1364/AO.11.001836) !! calculated as function of temperature t [Celsius] (valid from -10 to 30) !! and radar wavelength lambda [m] (valid from 0.001 to 1) !! !! original credit: Ulrich Blahak and G. Thompson real ( dp ), intent ( in ) :: lambda , t real ( dp ) :: epsinf , epss , epsr , epsi , alpha , lambdas , nenner complex ( dp ), parameter :: i = ( 0._dp , 1._dp ) complex ( dp ) :: refractive_index epsinf = 5.27137_dp + 0.02164740d0 * t - 0.00131198_dp * t * t epss = 7 8.54_dp * ( 1.0_dp - 4.579e-3_dp * ( t - 2 5.0_dp ) + & 1.190e-5_dp * ( t - 2 5.0_dp ) * ( t - 2 5.0_dp ) - 2.800e-8_dp * & ( t - 2 5.0_dp ) * ( t - 2 5.0_dp ) * ( t - 2 5.0_dp )) alpha = - 1 6.8129_dp / ( t + 27 3.16_dp ) + 0.0609265_dp lambdas = 0.00033836_dp * exp ( 251 3.98_dp / ( t + 27 3.16_dp )) * 1e-2_dp nenner = 1._dp + 2._dp * ( lambdas / lambda ) ** ( 1_dp - alpha ) * sin ( alpha * pi * 0.5_dp ) + & ( lambdas / lambda ) ** ( 2._dp - 2._dp * alpha ) epsr = epsinf + (( epss - epsinf ) * (( lambdas / lambda ) ** ( 1_dp - alpha ) * & sin ( alpha * pi * 0.5_dp ) + 1._dp )) / nenner epsi = (( epss - epsinf ) * (( lambdas / lambda ) ** ( 1_dp - alpha ) * & cos ( alpha * pi * 0.5_dp ) + 0._dp )) / nenner + lambda * 1.25664_dp / 1.88496_dp refractive_index = sqrt ( cmplx ( epsr , - epsi , kind = dp )) end function complex_water_ray function complex_ice_maetzler ( lambda , t ) result ( refractive_index ) !! complex refractive index of ice from !! [Maetzler (1998)](https://doi.org/10.1007/978-94-011-5252-5_10) !! calculated as function of temperature t [Celsius] (valid from -250 to 0) !! and radar wavelength lambda [m] (valid from 0.0001 to 30) !! !! original credit: Ulrich Blahak and G. Thompson real ( dp ), intent ( in ) :: lambda , t real ( dp ) :: f , c , tk , b1 , b2 , b , deltabeta , betam , beta , theta , alfa complex ( dp ) :: refractive_index c = 2.99e8_dp tk = t + 27 3.16_dp f = c / lambda * 1e-9_dp b1 = 0.0207_dp b2 = 1.16e-11_dp b = 33 5._dp deltabeta = exp ( - 1 0.02_dp + 0.0364_dp * ( tk - 27 3.16_dp )) betam = ( b1 / tk ) * ( exp ( b / tk ) / (( exp ( b / tk ) - 1._dp ) ** 2_dp ) ) + b2 * f * f beta = betam + deltabeta theta = 30 0._dp / tk - 1._dp alfa = ( 0.00504_dp + 0.0062_dp * theta ) * exp ( - 2 2.1_dp * theta ) refractive_index = 3.1884_dp + 9.1e-4_dp * ( tk - 27 3.16_dp ) refractive_index = refractive_index + cmplx ( 0.0_dp , ( alfa / f + beta * f ), kind = dp ) refractive_index = sqrt ( conjg ( refractive_index )) end function complex_ice_maetzler function reflectivity_from_melting_graupel ( rg , ng , ilamg , idx , rr ) result ( ze_graupel ) !! calculates radar reflectivity from melting graupel using binned approach !! !! original credit: Ulrich Blahak and G. Thompson use module_mp_tempo_params , only : am_g , bm_g , obmg , ocmg , mu_g , ogg2 , cge , & gbins_radar , dgbins_radar , radar_bins real ( wp ), intent ( in ) :: rg , ng , rr real ( dp ), intent ( in ) :: ilamg integer , intent ( in ) :: idx real ( dp ), parameter :: melt_outside = 0.9_dp real ( dp ), parameter :: lambda_radar = 0.10_dp ! in meters complex ( dp ) :: m_w_0 , m_i_0 real ( dp ), dimension ( radar_bins + 1 ) :: simpson real ( dp ), dimension ( 3 ), parameter :: basis = [ 1._dp / 3._dp , 4._dp / 3._dp , 1._dp / 3._dp ] real ( dp ) :: sr , fmelt , eta , lamg , backscatter , f_d , n0_g , mass , k_w integer :: n real ( wp ) :: ze_graupel do n = 1 , radar_bins + 1 simpson ( n ) = 0._dp enddo do n = 1 , radar_bins - 1 , 2 simpson ( n ) = simpson ( n ) + basis ( 1 ) simpson ( n + 1 ) = simpson ( n + 1 ) + basis ( 2 ) simpson ( n + 2 ) = simpson ( n + 2 ) + basis ( 3 ) enddo m_w_0 = complex_water_ray ( lambda_radar , 0._dp ) m_i_0 = complex_ice_maetzler ( lambda_radar , 0._dp ) k_w = ( abs (( m_w_0 * m_w_0 - 1._dp ) / ( m_w_0 * m_w_0 + 2._dp ))) ** 2 sr = max ( 0.01_dp , min ( 1.0_dp - rg / ( rg + rr ), 0.99_dp )) fmelt = real ( sr * sr , kind = dp ) eta = 0._dp lamg = 1._dp / ilamg n0_g = ng * ogg2 * lamg ** cge ( 2 , 1 ) do n = 1 , radar_bins mass = am_g ( idx ) * gbins_radar ( n ) ** bm_g call rayleigh_soak_wetgraupel ( x_g = mass , a_geo = real ( ocmg ( idx ), kind = dp ), b_geo = real ( obmg , kind = dp ), & fmelt = fmelt , lambda_radar = lambda_radar , meltratio_outside = melt_outside , & m_w = m_w_0 , m_i = m_i_0 , backscatter = backscatter ) f_d = n0_g * gbins_radar ( n ) ** mu_g * exp ( - lamg * gbins_radar ( n )) eta = eta + f_d * backscatter * simpson ( n ) * dgbins_radar ( n ) enddo ze_graupel = lambda_radar * lambda_radar * lambda_radar * lambda_radar / & ( pi * pi * pi * pi * pi * k_w ) * eta end function reflectivity_from_melting_graupel function reflectivity_from_melting_snow ( rs , smob , smoc , rr ) result ( ze_snow ) !! calculates radar reflectivity from melting snow using binned approach !! !! original credit: Ulrich Blahak and G. Thompson use module_mp_tempo_params , only : am_s , bm_s , lam0 , lam1 , obms , ocms , kap0 , kap1 , mu_s , & sbins_radar , dsbins_radar , radar_bins real ( wp ), intent ( in ) :: rs , rr real ( dp ), intent ( in ) :: smob , smoc real ( dp ), parameter :: melt_outside = 0.9_dp real ( dp ), parameter :: lambda_radar = 0.10_dp ! in meters complex ( dp ) :: m_w_0 , m_i_0 real ( dp ), dimension ( radar_bins + 1 ) :: simpson real ( dp ), dimension ( 3 ), parameter :: basis = [ 1._dp / 3._dp , 4._dp / 3._dp , 1._dp / 3._dp ] real ( dp ) :: sr , fmelt , eta , backscatter , f_d , mass , k_w , om3 , m0 , mrat , slam1 , slam2 integer :: n real ( wp ) :: ze_snow do n = 1 , radar_bins + 1 simpson ( n ) = 0._dp enddo do n = 1 , radar_bins - 1 , 2 simpson ( n ) = simpson ( n ) + basis ( 1 ) simpson ( n + 1 ) = simpson ( n + 1 ) + basis ( 2 ) simpson ( n + 2 ) = simpson ( n + 2 ) + basis ( 3 ) enddo m_w_0 = complex_water_ray ( lambda_radar , 0._dp ) m_i_0 = complex_ice_maetzler ( lambda_radar , 0._dp ) k_w = ( abs (( m_w_0 * m_w_0 - 1._dp ) / ( m_w_0 * m_w_0 + 2._dp ))) ** 2 sr = max ( 0.01_dp , min ( 1.0_dp - rs / ( rs + rr ), 0.99_dp )) fmelt = real ( sr * sr , kind = dp ) eta = 0._dp om3 = 1._dp / smoc m0 = ( smob * om3 ) mrat = smob * m0 * m0 * m0 slam1 = m0 * lam0 slam2 = m0 * lam1 do n = 1 , radar_bins mass = am_s * sbins_radar ( n ) ** bm_s call rayleigh_soak_wetgraupel ( x_g = mass , a_geo = real ( ocms , kind = dp ), b_geo = real ( obms , kind = dp ), & fmelt = fmelt , lambda_radar = lambda_radar , meltratio_outside = melt_outside , & m_w = m_w_0 , m_i = m_i_0 , backscatter = backscatter ) f_d = mrat * ( kap0 * exp ( - slam1 * sbins_radar ( n )) + kap1 * ( m0 * sbins_radar ( n )) ** mu_s * exp ( - slam2 * sbins_radar ( n ))) eta = eta + f_d * backscatter * simpson ( n ) * dsbins_radar ( n ) enddo ze_snow = lambda_radar * lambda_radar * lambda_radar * lambda_radar / & ( pi * pi * pi * pi * pi * k_w ) * eta end function reflectivity_from_melting_snow subroutine rayleigh_soak_wetgraupel ( x_g , a_geo , b_geo , fmelt , lambda_radar , & meltratio_outside , m_w , m_i , backscatter ) !! calculates backscatter cross section of wet snow or graupel !! using Maxwell-Garnett mixing formula and Rayleigh approximation !! !! original credit: Ulrich Blahak and G. Thompson real ( dp ), intent ( in ) :: x_g , a_geo , b_geo , fmelt , lambda_radar , meltratio_outside complex ( dp ), intent ( in ) :: m_w , m_i real ( dp ), intent ( out ) :: backscatter real ( dp ) :: fm , mra , x_w , d_g , vg , rhog , meltratio_outside_grenz , & volg , fmgrenz , d_large , volwater , volice , volair , volmix1 , volmix2 , & vol1 , vol2 , vol3 complex ( dp ) :: m_core , m_air , m_tmp , m1t , m2t , m3t , beta2 , beta3 m_air = ( 1._dp , 0._dp ) fm = max ( min ( fmelt , 1._dp ), 0._dp ) ! limit melt fraction between 0 and 1 mra = max ( min ( meltratio_outside , 1._dp ), 0._dp ) ! ratio of (melt on outside) / (melt on indside) mra = mra + ( 1._dp - mra ) * fm ! force mra to 1 when fm = 1 x_w = x_g * fm d_g = a_geo * x_g ** b_geo if ( d_g >= r1 ) then vg = pi / 6._dp * d_g ** 3 rhog = max ( min ( x_g / vg , 90 0._dp ), 1 0._dp ) vg = x_g / rhog meltratio_outside_grenz = 1._dp - rhog / 100 0._dp if ( mra <= meltratio_outside_grenz ) then volg = vg * ( 1._dp - mra * fm ) else ! at some value of fm all air gets filled with meltwater fmgrenz = ( 90 0._dp - rhog ) / ( mra * 90 0._dp - rhog + 90 0._dp * rhog / 100 0._dp ) if ( fm <= fmgrenz ) then ! not all air is filled with meltwater volg = ( 1.0_dp - mra * fm ) * vg else ! all air is filled with meltwater volg = ( x_g - x_w ) / 90 0._dp + x_w / 100 0._dp endif endif ! ice-air-water mixture volumes d_large = ( 6._dp / pi * volg ) ** ( 1._dp / 3._dp ) volice = ( x_g - x_w ) / ( volg * 90 0._dp ) volwater = x_w / ( 100 0._dp * volg ) volair = 1.0_dp - volice - volwater volmix1 = volice / max ( volice + volwater , 1e-10_dp ) volmix2 = 1._dp - volmix1 ! Maxwell-Garnett mixing for ice-water mixture m1t = m_w ** 2 m2t = m_air ** 2 m3t = m_i ** 2 vol1 = volmix2 vol2 = 0._dp vol3 = volmix1 beta2 = 2._dp * m1t / ( m2t - m1t ) * ( m2t / ( m2t - m1t ) * log ( m2t / m1t ) - 1._dp ) beta3 = 2._dp * m1t / ( m3t - m1t ) * ( m3t / ( m3t - m1t ) * log ( m3t / m1t ) - 1._dp ) m_tmp = sqrt ((( 1._dp - vol2 - vol3 ) * m1t + vol2 * beta2 * m2t + vol3 * beta3 * m3t ) / & ( 1._dp - vol2 - vol3 + vol2 * beta2 + vol3 * beta3 )) ! Maxwell-Garnett mixing (including air) m1t = m_tmp ** 2 m2t = m_air ** 2 m3t = ( 2._dp * m_air ) ** 2 vol1 = ( 1._dp - volair ) vol2 = volair vol3 = 0._dp beta2 = 2._dp * m1t / ( m2t - m1t ) * ( m2t / ( m2t - m1t ) * log ( m2t / m1t ) - 1._dp ) beta3 = 2._dp * m1t / ( m3t - m1t ) * ( m3t / ( m3t - m1t ) * log ( m3t / m1t ) - 1._dp ) ! complex index of refraction for ice-air-water mixture m_core = sqrt ((( 1._dp - vol2 - vol3 ) * m1t + vol2 * beta2 * m2t + vol3 * beta3 * m3t ) / & ( 1._dp - vol2 - vol3 + vol2 * beta2 + vol3 * beta3 )) ! Rayleigh backscattering coefficient of melting particle backscatter = ( abs (( m_core ** 2 - 1._dp ) / ( m_core ** 2 + 2._dp ))) ** 2 * pi * pi * pi * pi * pi * d_large ** 6 / & ( lambda_radar * lambda_radar * lambda_radar * lambda_radar ) else backscatter = 0._dp endif end subroutine rayleigh_soak_wetgraupel subroutine max_hail_diam ( rho , rg , ng , ilamg , idx , max_hail_diameter ) !! estimates maximmum hail diameter [mm] using a binned approach !! !! see [Jensen et al. (2023)](https://doi.org/10.1175/MWR-D-21-0319.1) use module_mp_tempo_params , only : hbins , dhbins , rho_g , ogg2 , cge , nhbins , mu_g real ( wp ), dimension (:), intent ( in ) :: rho , rg , ng real ( dp ), dimension (:), intent ( in ) :: ilamg integer , dimension (:), intent ( in ) :: idx real ( wp ), dimension (:), intent ( out ) :: max_hail_diameter real ( dp ) :: lamg , n0_g , sum_nh , sum_t , f_d , hail_max integer :: k , nz , n real ( dp ), parameter :: threshold_conc = 0.0005 nz = size ( rho ) do k = 1 , nz max_hail_diameter ( k ) = 0._wp if ( rg ( k ) / rho ( k ) >= 1.e-6_wp ) then if ( rho_g ( idx ( k )) < 35 0._wp ) cycle ! density too low to be hail/ice pellets lamg = 1._dp / ilamg ( k ) n0_g = ng ( k ) * ogg2 * lamg ** cge ( 2 , 1 ) sum_nh = 0._dp sum_t = 0._dp do n = nhbins , 1 , - 1 f_d = n0_g * hbins ( n ) ** mu_g * exp ( - lamg * hbins ( n )) * dhbins ( n ) sum_nh = sum_nh + f_d if ( sum_nh > threshold_conc ) exit sum_t = sum_nh enddo if ( n >= nhbins ) then hail_max = hbins ( nhbins ) elseif ( hbins ( n + 1 ) > 1.e-3_wp ) then hail_max = hbins ( n ) - ( sum_nh - threshold_conc ) / ( sum_nh - sum_t ) * ( hbins ( n ) - hbins ( n + 1 )) else hail_max = 1.e-4_wp endif max_hail_diameter ( k ) = 100 0._wp * hail_max ! convert to mm endif enddo end subroutine max_hail_diam subroutine freezing_rain ( temp , rain_precip , cloud_precip , frz_rain ) !! estimates freezing rain/drizzle accumulation use module_mp_tempo_params , only : t0 real ( wp ), intent ( in ) :: temp , rain_precip real ( wp ), intent ( in ), optional :: cloud_precip real ( wp ), intent ( out ) :: frz_rain frz_rain = 0._wp if (( temp - t0 ) < - 0.5_wp ) then frz_rain = rain_precip if ( present ( cloud_precip )) then frz_rain = frz_rain + cloud_precip endif endif end subroutine freezing_rain end module module_mp_tempo_diags","tags":"","url":"sourcefile/module_mp_tempo_diags.f90.html"},{"title":"module_mp_tempo_utils.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~module_mp_tempo_utils.f90~~EfferentGraph sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~module_mp_tempo_utils.f90~~AfferentGraph sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_diags.f90 sourcefile~module_mp_tempo_tables.f90 module_mp_tempo_tables.F90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~build_tables.f90 build_tables.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_tables.f90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_utils !! utilities for tempo microphysics use module_mp_tempo_params , only : wp , sp , dp implicit none private public :: snow_moments , calc_gamma_p , get_nuc , get_constant_cloud_number , & calc_rslf , calc_rsif , compute_efrw , compute_efsw , compute_drop_evap , qi_aut_qs contains subroutine get_constant_cloud_number ( land , nc ) !! returns land-specific value of cloud droplet number concentration !! when aerosol-aware = false if land = 1, else returns ocean-specific value use module_mp_tempo_params , only : nt_c_l , nt_c_o integer , intent ( in ), optional :: land real ( wp ), dimension (:), intent ( out ) :: nc nc = nt_c_l if ( present ( land )) then if ( land /= 1 ) nc = nt_c_o endif end subroutine get_constant_cloud_number function calc_gamma_p ( a , x ) result ( gamma_p ) !! normalized lower gamma function calculated either with a !! series expansion or continued fraction method !! !! input: a = gamma function argument, x = upper limit of integration !! !! output: gamma_p = \\gamma(a, x) / \\Gamma(a) real ( wp ), intent ( in ) :: a , x real ( wp ) :: gamma_p if (( x < 0.0_wp ) . or . ( a <= 0.0_wp )) stop \"Invalid arguments for function gamma_p\" if ( x < ( a + 1.0_wp )) then gamma_p = calc_gamma_series ( a , x ) else ! gammma_cf computes the upper series gamma_p = 1.0_wp - calc_gamma_cf ( a , x ) endif end function calc_gamma_p function calc_gamma_series ( a , x ) result ( gamma_series ) !! solves the normalized lower gamma function !! !! \\gamma(a,x) / \\Gamma(a) = x&#94;{a} * \\gamma*(a,x) !! !! see [Equation 8.7.1](https://dlmf.nist.gov/8.7) !! \\gamma(a,x) = exp(-x) * \\sum_{k=0}&#94;{\\infty} \\frac{x&#94;{k}}{\\Gamma(a+k+1)} !! !! input: a = gamma function argument, x = upper limit of integration !! !! output: normalized lower gamma function \\gamma(a, x) / \\Gamma(a) real ( wp ), intent ( in ) :: a , x integer :: k integer , parameter :: it_max = 100 real ( wp ), parameter :: smallvalue = 1.e-7_wp real ( wp ) :: ap1 , sum_term , sum real ( wp ) :: gamma_series if ( x <= 0.0_wp ) stop \"Invalid arguments for function gamma_series\" ! k = 0 summation term is 1 / Gamma(a+1) ap1 = a sum_term = 1.0_wp / gamma ( ap1 + 1.0_wp ) sum = sum_term do k = 1 , it_max ap1 = ap1 + 1.0_wp sum_term = sum_term * x / ap1 sum = sum + sum_term if ( abs ( sum_term ) < ( abs ( sum ) * smallvalue )) exit enddo if ( k == it_max ) stop \"gamma_series solution did not converge\" gamma_series = sum * x ** a * exp ( - x ) end function calc_gamma_series function calc_gamma_cf ( a , x ) result ( gamma_cf ) !! solves the normalized upper gamma function \\gamma(a,x) / \\Gamma(a) !! using a continued fractions method !! [(modified Lentz Algorithm)](http://functions.wolfram.com/06.06.10.0003.01) !! !!input: a = gamma function argument, x = lower limit of integration !! !!output: normalized upper gamma function: \\gamma(a, x) / \\Gamma(a) real ( wp ), intent ( in ) :: a , x integer :: k integer , parameter :: it_max = 100 real ( wp ), parameter :: smallvalue = 1.e-7_wp real ( wp ), parameter :: offset = 1.e-30_wp real ( wp ) :: b , d , h0 , c , delta , h , aj real ( wp ) :: gamma_cf b = 1.0_wp - a + x d = 1.0_wp / b h0 = offset c = b + ( 1.0_wp / offset ) delta = c * d h = h0 * delta do k = 1 , it_max aj = k * ( a - k ) b = b + 2.0_wp d = b + aj * d if ( abs ( d ) < offset ) d = offset c = b + aj / c if ( abs ( c ) < offset ) c = offset d = 1.0_wp / d delta = c * d h = h * delta if ( abs ( delta - 1.0_wp ) < smallvalue ) exit enddo if ( k == it_max ) stop \"gamma_cf solution did not converge\" gamma_cf = exp ( - x + a * log ( x )) * h / gamma ( a ) end function calc_gamma_cf subroutine snow_moments ( rs , tc , smob , smoc , ns , smo0 , smo1 , smo2 , smoe , smof , smog , smoz ) !! computes snow moments from !! [Field et al. (2005)](https://doi.org/10.1256/qj.04.134) ! smo0 = 0th moment ! smo1 = 1st moment ! smo2 = 2nd moment ! ns   = total number concentration (not smo0) ! smob = rs*oams (2nd moment when bm_s=2) ! smoc = (bm_s+1)th moment ! smoe = (bv_s+2)th moment ! smof = (1+(bv_s+1)/2)th moment ! smog = (bm_s+bv_s+2)th moment ! somz = (bm**2)th moment for reflectivity use module_mp_tempo_params , only : bm_s , sa , sb , & oams , cse , csg , lam0 , lam1 , kap0 , kap1 , mu_s real ( wp ), intent ( in ) :: rs , tc real ( dp ) :: loga_ , a_ , b_ , smo2_ , m0 , mrat , slam1 , slam2 real ( dp ), intent ( out ) :: smob , smoc real ( dp ), intent ( out ), optional :: ns , smo0 , smo1 , smo2 , smoe , smof , smog , smoz ! Second moment and smob smob = real ( rs * oams , kind = dp ) if ( bm_s > 2.0_wp - 1.e-3_wp . and . bm_s < 2.0_wp + 1.e-3_wp ) then loga_ = sa ( 1 ) + sa ( 2 ) * tc + sa ( 3 ) * bm_s & + sa ( 4 ) * tc * bm_s + sa ( 5 ) * tc * tc & + sa ( 6 ) * bm_s * bm_s + sa ( 7 ) * tc * tc * bm_s & + sa ( 8 ) * tc * bm_s * bm_s + sa ( 9 ) * tc * tc * tc & + sa ( 10 ) * bm_s * bm_s * bm_s a_ = 1 0.0_wp ** loga_ b_ = sb ( 1 ) + sb ( 2 ) * tc + sb ( 3 ) * bm_s & + sb ( 4 ) * tc * bm_s + sb ( 5 ) * tc * tc & + sb ( 6 ) * bm_s * bm_s + sb ( 7 ) * tc * tc * bm_s & + sb ( 8 ) * tc * bm_s * bm_s + sb ( 9 ) * tc * tc * tc & + sb ( 10 ) * bm_s * bm_s * bm_s smo2_ = ( smob / a_ ) ** ( 1._wp / b_ ) else smo2_ = smob endif if ( present ( smo2 )) smo2 = smo2_ ! bm+1 moment. Useful for diameter calcs. loga_ = sa ( 1 ) + sa ( 2 ) * tc + sa ( 3 ) * cse ( 1 ) & + sa ( 4 ) * tc * cse ( 1 ) + sa ( 5 ) * tc * tc & + sa ( 6 ) * cse ( 1 ) * cse ( 1 ) + sa ( 7 ) * tc * tc * cse ( 1 ) & + sa ( 8 ) * tc * cse ( 1 ) * cse ( 1 ) + sa ( 9 ) * tc * tc * tc & + sa ( 10 ) * cse ( 1 ) * cse ( 1 ) * cse ( 1 ) a_ = 1 0.0_dp ** loga_ b_ = sb ( 1 ) + sb ( 2 ) * tc + sb ( 3 ) * cse ( 1 ) + sb ( 4 ) * tc * cse ( 1 ) & + sb ( 5 ) * tc * tc + sb ( 6 ) * cse ( 1 ) * cse ( 1 ) & + sb ( 7 ) * tc * tc * cse ( 1 ) + sb ( 8 ) * tc * cse ( 1 ) * cse ( 1 ) & + sb ( 9 ) * tc * tc * tc + sb ( 10 ) * cse ( 1 ) * cse ( 1 ) * cse ( 1 ) smoc = a_ * smo2_ ** b_ ! 0th moment. Represents snow number concentration. loga_ = sa ( 1 ) + sa ( 2 ) * tc + sa ( 5 ) * tc * tc + sa ( 9 ) * tc * tc * tc a_ = 1 0.0 ** loga_ b_ = sb ( 1 ) + sb ( 2 ) * tc + sb ( 5 ) * tc * tc + sb ( 9 ) * tc * tc * tc if ( present ( smo0 )) smo0 = a_ * smo2_ ** b_ ! 1st moment. Useful for depositional growth and melting. loga_ = sa ( 1 ) + sa ( 2 ) * tc + sa ( 3 ) & + sa ( 4 ) * tc + sa ( 5 ) * tc * tc & + sa ( 6 ) + sa ( 7 ) * tc * tc & + sa ( 8 ) * tc + sa ( 9 ) * tc * tc * tc & + sa ( 10 ) a_ = 1 0.0 ** loga_ b_ = sb ( 1 ) + sb ( 2 ) * tc + sb ( 3 ) + sb ( 4 ) * tc & + sb ( 5 ) * tc * tc + sb ( 6 ) & + sb ( 7 ) * tc * tc + sb ( 8 ) * tc & + sb ( 9 ) * tc * tc * tc + sb ( 10 ) if ( present ( smo1 )) smo1 = a_ * smo2_ ** b_ ! snow number concentration (explicit integral, not smo0) m0 = smob / smoc mrat = smob * m0 * m0 * m0 slam1 = m0 * lam0 slam2 = m0 * lam1 if ( present ( ns )) then ns = mrat * kap0 / slam1 + mrat * kap1 * m0 ** mu_s * csg ( 15 ) / slam2 ** cse ( 15 ) endif ! bv_s+2 (th) moment. Useful for riming. loga_ = sa ( 1 ) + sa ( 2 ) * tc + sa ( 3 ) * cse ( 13 ) & + sa ( 4 ) * tc * cse ( 13 ) + sa ( 5 ) * tc * tc & + sa ( 6 ) * cse ( 13 ) * cse ( 13 ) + sa ( 7 ) * tc * tc * cse ( 13 ) & + sa ( 8 ) * tc * cse ( 13 ) * cse ( 13 ) + sa ( 9 ) * tc * tc * tc & + sa ( 10 ) * cse ( 13 ) * cse ( 13 ) * cse ( 13 ) a_ = 1 0.0 ** loga_ b_ = sb ( 1 ) + sb ( 2 ) * tc + sb ( 3 ) * cse ( 13 ) + sb ( 4 ) * tc * cse ( 13 ) & + sb ( 5 ) * tc * tc + sb ( 6 ) * cse ( 13 ) * cse ( 13 ) & + sb ( 7 ) * tc * tc * cse ( 13 ) + sb ( 8 ) * tc * cse ( 13 ) * cse ( 13 ) & + sb ( 9 ) * tc * tc * tc + sb ( 10 ) * cse ( 13 ) * cse ( 13 ) * cse ( 13 ) if ( present ( smoe )) smoe = a_ * smo2_ ** b_ ! 1+(bv_s+1)/2 (th) moment.  Useful for depositional growth. loga_ = sa ( 1 ) + sa ( 2 ) * tc + sa ( 3 ) * cse ( 16 ) & + sa ( 4 ) * tc * cse ( 16 ) + sa ( 5 ) * tc * tc & + sa ( 6 ) * cse ( 16 ) * cse ( 16 ) + sa ( 7 ) * tc * tc * cse ( 16 ) & + sa ( 8 ) * tc * cse ( 16 ) * cse ( 16 ) + sa ( 9 ) * tc * tc * tc & + sa ( 10 ) * cse ( 16 ) * cse ( 16 ) * cse ( 16 ) a_ = 1 0.0 ** loga_ b_ = sb ( 1 ) + sb ( 2 ) * tc + sb ( 3 ) * cse ( 16 ) + sb ( 4 ) * tc * cse ( 16 ) & + sb ( 5 ) * tc * tc + sb ( 6 ) * cse ( 16 ) * cse ( 16 ) & + sb ( 7 ) * tc * tc * cse ( 16 ) + sb ( 8 ) * tc * cse ( 16 ) * cse ( 16 ) & + sb ( 9 ) * tc * tc * tc + sb ( 10 ) * cse ( 16 ) * cse ( 16 ) * cse ( 16 ) if ( present ( smof )) smof = a_ * smo2_ ** b_ ! bm_s + bv_s+2 (th) moment.  Useful for riming into graupel. loga_ = sa ( 1 ) + sa ( 2 ) * tc + sa ( 3 ) * cse ( 17 ) & + sa ( 4 ) * tc * cse ( 17 ) + sa ( 5 ) * tc * tc & + sa ( 6 ) * cse ( 17 ) * cse ( 17 ) + sa ( 7 ) * tc * tc * cse ( 17 ) & + sa ( 8 ) * tc * cse ( 17 ) * cse ( 17 ) + sa ( 9 ) * tc * tc * tc & + sa ( 10 ) * cse ( 17 ) * cse ( 17 ) * cse ( 17 ) a_ = 1 0.0 ** loga_ b_ = sb ( 1 ) + sb ( 2 ) * tc + sb ( 3 ) * cse ( 17 ) + sb ( 4 ) * tc * cse ( 17 ) & + sb ( 5 ) * tc * tc + sb ( 6 ) * cse ( 17 ) * cse ( 17 ) & + sb ( 7 ) * tc * tc * cse ( 17 ) + sb ( 8 ) * tc * cse ( 17 ) * cse ( 17 ) & + sb ( 9 ) * tc * tc * tc + sb ( 10 ) * cse ( 17 ) * cse ( 17 ) * cse ( 17 ) if ( present ( smog )) smog = a_ * smo2_ ** b_ !..Calculate bm_s*2 (th) moment.  Useful for reflectivity. loga_ = sa ( 1 ) + sa ( 2 ) * tc + sa ( 3 ) * cse ( 3 ) & + sa ( 4 ) * tc * cse ( 3 ) + sa ( 5 ) * tc * tc & + sa ( 6 ) * cse ( 3 ) * cse ( 3 ) + sa ( 7 ) * tc * tc * cse ( 3 ) & + sa ( 8 ) * tc * cse ( 3 ) * cse ( 3 ) + sa ( 9 ) * tc * tc * tc & + sa ( 10 ) * cse ( 3 ) * cse ( 3 ) * cse ( 3 ) a_ = 1 0.0 ** loga_ b_ = sb ( 1 ) + sb ( 2 ) * tc + sb ( 3 ) * cse ( 3 ) + sb ( 4 ) * tc * cse ( 3 ) & + sb ( 5 ) * tc * tc + sb ( 6 ) * cse ( 3 ) * cse ( 3 ) & + sb ( 7 ) * tc * tc * cse ( 3 ) + sb ( 8 ) * tc * cse ( 3 ) * cse ( 3 ) & + sb ( 9 ) * tc * tc * tc + sb ( 10 ) * cse ( 3 ) * cse ( 3 ) * cse ( 3 ) if ( present ( smoz )) smoz = a_ * smo2 ** b_ end subroutine snow_moments function calc_rslf ( p , t ) result ( rslf ) !! calculates liquid saturation vapor mixing ratio real ( wp ), intent ( in ) :: p , t real ( wp ) :: esl , x real ( wp ), parameter :: c0 = . 61158369 9E03_wp real ( wp ), parameter :: c1 = . 44460689 6E02_wp real ( wp ), parameter :: c2 = . 14317715 7e01_wp real ( wp ), parameter :: c3 = . 26422432 1e-1_wp real ( wp ), parameter :: c4 = . 29929108 1e-3_wp real ( wp ), parameter :: c5 = . 20315418 2e-5_wp real ( wp ), parameter :: c6 = . 70262069 8e-8_wp real ( wp ), parameter :: c7 = . 37953431 0e-11_wp real ( wp ), parameter :: c8 = - . 32158239 3e-13_wp real ( wp ) :: rslf x = max ( - 8 0._wp , t - 27 3.16_wp ) esl = c0 + x * ( c1 + x * ( c2 + x * ( c3 + x * ( c4 + x * ( c5 + x * ( c6 + x * ( c7 + x * c8 ))))))) esl = min ( esl , p * 0.15 ) !! @note !! even with p = 1050 mb and t = 55 C, the saturation vapor !! pressure only contributes to 15% of the total pressure, !! thus the limit on the saturation vapor pressure is set to 15% !! @endnote rslf = . 622 * esl / ( p - esl ) end function calc_rslf function calc_rsif ( p , t ) result ( rsif ) !! calculates liquid saturation vapor mixing ratio real ( wp ), intent ( in ) :: p , t real ( wp ) :: esi , x real ( wp ), parameter :: c0 = . 60986899 3e03_wp real ( wp ), parameter :: c1 = . 49932023 3e02_wp real ( wp ), parameter :: c2 = . 18467263 1e01_wp real ( wp ), parameter :: c3 = . 40273718 4e-1_wp real ( wp ), parameter :: c4 = . 56539298 7e-3_wp real ( wp ), parameter :: c5 = . 52169393 3e-5_wp real ( wp ), parameter :: c6 = . 30783958 3e-7_wp real ( wp ), parameter :: c7 = . 10578516 0e-9_wp real ( wp ), parameter :: c8 = . 16144444 4e-12_wp real ( wp ) :: rsif x = max ( - 8 0._wp , t - 27 3.16_wp ) esi = c0 + x * ( c1 + x * ( c2 + x * ( c3 + x * ( c4 + x * ( c5 + x * ( c6 + x * ( c7 + x * c8 ))))))) esi = min ( esi , p * 0.15 ) rsif = . 622 * esi / max ( 1.e-4_wp ,( p - esi )) end function calc_rsif function get_nuc ( nc ) result ( nu_c ) !! returns nu_c for cloud water (values from 2-15) use module_mp_tempo_params , only : nu_c_scale real ( wp ), intent ( in ) :: nc integer :: nu_c if (( nu_c_scale / nc ) >= 1 2.5_wp ) then nu_c = 15 else nu_c = min ( 15 , nint ( nu_c_scale / nc ) + 2 ) endif end function get_nuc subroutine compute_efrw () !! collision efficiency for rain collecting cloud water from Beard and Grover (1974) !! if a/A < 0.25 !! https://doi.org/10.1175/1520-0469(1974)031<0543:NCEFSR>2.0.CO;2 !! otherwise uses polynomials to get close match of Pruppacher and Klett Fig. 14-9 use module_mp_tempo_params , only : nbc , nbr , dc , dr , t_efrw , rho_w , pi real ( dp ) :: vtr , stokes , reynolds , ef_rw real ( dp ) :: p , yc0 , f , g , h , z , k0 , x integer :: i , j do j = 1 , nbc do i = 1 , nbr ef_rw = 0.0_dp p = dc ( j ) / dr ( i ) if ( dr ( i ) < 5 0.e-6_dp . or . dc ( j ) < 3.e-6_dp ) then t_efrw ( i , j ) = 0.0_dp elseif ( p > 0.25_dp ) then x = dc ( j ) * 1.e6_dp if ( dr ( i ) < 7 5.e-6_dp ) then ef_rw = 0.026794_dp * x - 0.20604_dp elseif ( dr ( i ) < 12 5.e-6_dp ) then ef_rw = - 0.00066842_dp * x * x + 0.061542_dp * x - 0.37089_dp elseif ( dr ( i ) < 17 5.e-6_dp ) then ef_rw = 4.091e-06_dp * x * x * x * x - 0.00030908_dp * x * x * x + & 0.0066237_dp * x * x - 0.0013687_dp * x - 0.073022_dp elseif ( dr ( i ) < 25 0.e-6_dp ) then ef_rw = 9.6719e-5_dp * x * x * x - 0.0068901_dp * x * x + 0.17305_dp * x - 0.65988_dp elseif ( dr ( i ) < 35 0.e-6_dp ) then ef_rw = 9.0488e-5_dp * x * x * x - 0.006585_dp * x * x + 0.16606_dp * x - 0.56125_dp else ef_rw = 0.00010721_dp * x * x * x - 0.0072962_dp * x * x + 0.1704_dp * x - 0.46929_dp endif else vtr = - 0.1021_dp + 4.932e3_dp * dr ( i ) - 0.9551e6_dp * dr ( i ) * dr ( i ) + 0.07934e9_dp * dr ( i ) * dr ( i ) * dr ( i ) & - 0.002362e12_dp * dr ( i ) * dr ( i ) * dr ( i ) * dr ( i ) stokes = dc ( j ) * dc ( j ) * vtr * rho_w / ( 9._dp * 1.718e-5_dp * dr ( i )) reynolds = 9._dp * stokes / ( p * p * rho_w ) f = log ( reynolds ) g = - 0.1007_dp - 0.358_dp * f + 0.0261_dp * f * f k0 = exp ( g ) z = log ( stokes / ( k0 + 1.e-15_dp )) H = 0.1465_dp + 1.302_dp * z - 0.607_dp * z * z + 0.293_dp * z * z * z yc0 = 2.0_dp / pi * atan ( h ) ef_rw = ( yc0 + p ) * ( yc0 + p ) / (( 1. + p ) * ( 1. + p )) endif t_efrw ( i , j ) = max ( 0.0_dp , min ( ef_rw , 0.95_dp )) enddo enddo end subroutine compute_efrw subroutine compute_efsw () !! collision efficiency for snow collecting cloud water from Wang and Ji (2000) !! https://doi.org/10.1175/1520-0469(2000)057<1001:CEOICA>2.0.CO;2 !! equating melted snow diameter to effective collision cross-section use module_mp_tempo_params , only : wp , sp , dp , & nbc , dc , av_s , bv_s , ds , nbs , am_s , bm_s , am_r , obmr , fv_s , & t_efsw , d0s , rho_w , pi real ( dp ) :: ds_m , vts , vtc , stokes , reynolds , ef_sw real ( dp ) :: p , yc0 , f , g , h , z , k0 integer :: i , j do j = 1 , nbc vtc = 1.19e4_dp * ( 1.0e4_dp * dc ( j ) * dc ( j ) * 0.25_dp ) do i = 1 , nbs vts = av_s * ds ( i ) ** bv_s * exp ( real ( - fv_s * ds ( i ), kind = dp )) - vtc ds_m = ( am_s * ds ( i ) ** bm_s / am_r ) ** obmr p = dc ( j ) / ds_m if ( p > 0.25_dp . or . ds ( i ) < d0s . or . dc ( j ) < 6.e-6_dp . or . vts < 1.e-3_dp ) then t_efsw ( i , j ) = 0.0_dp else stokes = dc ( j ) * dc ( j ) * vts * rho_w / ( 9. * 1.718e-5_dp * ds_m ) reynolds = 9._dp * stokes / ( p * p * rho_w ) f = log ( reynolds ) g = - 0.1007_dp - 0.358_dp * f + 0.0261_dp * f * f k0 = exp ( g ) z = log ( stokes / ( k0 + 1.e-15_dp )) h = 0.1465_dp + 1.302_dp * z - 0.607_dp * z * z + 0.293_dp * z * z * z yc0 = 2.0_dp / pi * atan ( h ) ef_sw = ( yc0 + p ) * ( yc0 + p ) / (( 1. + p ) * ( 1. + p )) t_efsw ( i , j ) = max ( 0.0_dp , min ( ef_sw , 0.95_dp )) endif enddo enddo end subroutine compute_efsw subroutine qi_aut_qs () !! calculates cloud ice conversion to snow !! and depositional growth by binning cloud ice distributions and !! determining both the size bins > d0s (that are converted to snow) and the !! depositional growth up to d0s (for cloud ice) and > d0s for snow !! following Harrington et al. (1995) !! https://doi.org/10.1175/1520-0469(1995)052<4344:POICCP>2.0.CO;2 use module_mp_tempo_params , only : wp , sp , dp , & nbi , ntb_i , ntb_i1 , & am_i , cie , cig , oig1 , nt_i , r_i , obmi , bm_i , mu_i , d0s , d0i , & tpi_ide , tps_iaus , tni_iaus , di , dti integer :: i , j , n2 real ( dp ), dimension ( nbi ) :: n_i real ( dp ) :: n0_i , lami , di_mean , t1 , t2 real ( wp ) :: xlimit_intg do j = 1 , ntb_i1 do i = 1 , ntb_i lami = ( am_i * cig ( 2 ) * oig1 * nt_i ( j ) / r_i ( i )) ** obmi di_mean = ( bm_i + mu_i + 1. ) / lami n0_i = nt_i ( j ) * oig1 * lami ** cie ( 1 ) t1 = 0. t2 = 0. if ( real ( di_mean , kind = wp ) > 5. * d0s ) then t1 = r_i ( i ) t2 = nt_i ( j ) tpi_ide ( i , j ) = 0. elseif ( real ( di_mean , kind = wp ) < d0i ) then t1 = 0. t2 = 0. tpi_ide ( i , j ) = 1. else xlimit_intg = lami * d0s tpi_ide ( i , j ) = real ( calc_gamma_p ( mu_i + 2.0 , xlimit_intg ), kind = dp ) do n2 = 1 , nbi n_i ( n2 ) = n0_i * di ( n2 ) ** mu_i * exp ( - lami * di ( n2 )) * dti ( n2 ) if ( di ( n2 ) >= d0s ) then t1 = t1 + n_i ( n2 ) * am_i * di ( n2 ) ** bm_i t2 = t2 + n_i ( n2 ) endif enddo endif tps_iaus ( i , j ) = t1 tni_iaus ( i , j ) = t2 enddo enddo end subroutine qi_aut_qs subroutine compute_drop_evap () !! calculates droplet evaporation data use module_mp_tempo_params , only : wp , sp , dp , & nbc , am_r , dc , bm_r , nu_c_scale , nu_c_max , nu_c_min , & t_nc , ntb_c , cce , ccg , ocg1 , r_c , obmr , dtc , & tpc_wev , tnc_wev integer :: i , j , k , n real ( dp ), dimension ( nbc ) :: n_c , massc real ( dp ) :: summ , summ2 , lamc , n0_c integer :: nu_c do n = 1 , nbc massc ( n ) = am_r * dc ( n ) ** bm_r enddo do k = 1 , nbc nu_c = get_nuc ( real ( t_nc ( k ), kind = wp )) do j = 1 , ntb_c lamc = ( t_nc ( k ) * am_r * ccg ( 2 , nu_c ) * ocg1 ( nu_c ) / r_c ( j )) ** obmr n0_c = t_nc ( k ) * ocg1 ( nu_c ) * lamc ** cce ( 1 , nu_c ) do i = 1 , nbc n_c ( i ) = n0_c * dc ( i ) ** nu_c * exp ( - lamc * dc ( i )) * dtc ( i ) summ = 0._dp summ2 = 0._dp do n = 1 , i summ = summ + massc ( n ) * n_c ( n ) summ2 = summ2 + n_c ( n ) enddo tpc_wev ( i , j , k ) = summ tnc_wev ( i , j , k ) = summ2 enddo enddo enddo end subroutine compute_drop_evap end module module_mp_tempo_utils","tags":"","url":"sourcefile/module_mp_tempo_utils.f90.html"},{"title":"machine.F90 – TEMPO Microphysics","text":"Files dependent on this one sourcefile~~machine.f90~~AfferentGraph sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 sourcefile~build_tables.f90 build_tables.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_tables.f90 module_mp_tempo_tables.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_tables.f90 sourcefile~module_mp_tempo_aerosols.f90 module_mp_tempo_aerosols.F90 sourcefile~module_mp_tempo_aerosols.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~module_mp_tempo_ml.f90 module_mp_tempo_ml.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_aerosols.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_diags.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_ml.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module machine !! sets the precision if not set by a host model implicit none private public :: kind_phys , kind_sngl_prec , kind_dbl_prec , kind_io8 integer , parameter :: kind_sngl_prec = 4 , & kind_dbl_prec = 8 ! physics single precision flag #ifndef SINGLE_PREC integer , parameter :: kind_phys = kind_dbl_prec #else integer , parameter :: kind_phys = kind_sngl_prec #endif integer , parameter :: kind_io8 = kind_phys end module machine","tags":"","url":"sourcefile/machine.f90.html"},{"title":"module_mp_tempo_params.F90 – TEMPO Microphysics","text":"This file depends on sourcefile~~module_mp_tempo_params.f90~~EfferentGraph sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~machine.f90 machine.F90 sourcefile~module_mp_tempo_params.f90->sourcefile~machine.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Files dependent on this one sourcefile~~module_mp_tempo_params.f90~~AfferentGraph sourcefile~module_mp_tempo_params.f90 module_mp_tempo_params.F90 sourcefile~build_tables.f90 build_tables.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_tables.f90 module_mp_tempo_tables.F90 sourcefile~build_tables.f90->sourcefile~module_mp_tempo_tables.f90 sourcefile~module_mp_tempo_aerosols.f90 module_mp_tempo_aerosols.F90 sourcefile~module_mp_tempo_aerosols.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_diags.f90 module_mp_tempo_diags.F90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_utils.f90 module_mp_tempo_utils.F90 sourcefile~module_mp_tempo_diags.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_driver.f90 module_mp_tempo_driver.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90 module_mp_tempo_main.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_main.f90 sourcefile~module_mp_tempo_ml.f90 module_mp_tempo_ml.F90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_driver.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_aerosols.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_diags.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_ml.f90 sourcefile~module_mp_tempo_main.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_ml.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~module_mp_tempo_tables.f90->sourcefile~module_mp_tempo_utils.f90 sourcefile~module_mp_tempo_utils.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~tests.f90 tests.F90 sourcefile~tests.f90->sourcefile~module_mp_tempo_params.f90 sourcefile~tests.f90->sourcefile~module_mp_tempo_driver.f90 sourcefile~run_tempo_tests.f90 run_tempo_tests.F90 sourcefile~run_tempo_tests.f90->sourcefile~tests.f90 Help Graph Key Nodes of different colours represent the following: Graph Key Source File Source File This Page's Entity This Page's Entity Solid arrows point from a file to a file which it depends on. A file\nis dependent upon another if the latter must be compiled before the former\ncan be. Source Code module module_mp_tempo_params !! parameters and variables used in tempo microphysics ! define machine precision #if defined(tempo_mpas) use mpas_kind_types , only : wp => RKIND , sp => R4KIND , dp => R8KIND #elif defined(tempo_ccpp) use machine , only : wp => kind_phys , sp => kind_sngl_prec , dp => kind_dbl_prec #elif defined(wrfmodel) use ccpp_kind_types , only : wp => kind_phys , sp => kind_phys #else use machine , only : wp => kind_phys , sp => kind_sngl_prec , dp => kind_dbl_prec #endif use iso_fortran_env , only : real32 , real64 ! for machine-independent lookup table precisions implicit none public #if defined(wrfmodel) integer , parameter :: dp = selected_real_kind ( 15 , 307 ) #endif character ( len = 11 ) :: tempo_version !! tempo version string (max is xxx.xxx.xxx) ! parameters that can be changed ------------------------------------------------------------------------ integer , parameter :: idx_bg1 = 6 !! index from rho_g when hail_aware = false: density = 500 kg\\, m&#94;{-3} !> @note !> av_r is the rain fallspeed power-law coefficient !> !> fallspeed power law relations are !> !>  v =(a_{v}D&#94;{b_{v}})\\exp\\left(-f_{v}D\\right), \\textrm{where}\\,fv = 0\\, \\textrm{for graupel/ice}  !> !> and coefficients are from from [Ferrier (1994)](https://doi.org/10.1175/1520-0469(1994)051<0249:ADMMPF>2.0.CO;2) for rain and !> [Thompson et al. (2008)](https://doi.org/10.1175/2008MWR2387.1) for ice, snow, and graupel !> @endnote real ( wp ), parameter :: av_r = 485 4._wp real ( wp ), parameter :: bv_r = 1.0_wp !! rain fallspeed power-law coefficient real ( wp ), parameter :: av_s = 4 0._wp !! snow fallspeed power-law coefficient real ( wp ), parameter :: bv_s = 0.55_wp !! snow fallspeed power-law coefficient real ( wp ), parameter :: fv_s = 10 0._wp !! snow fallspeed power-law coefficient real ( wp ), parameter :: bv_c = 2.0_wp !! cloud fallspeed power-law coefficient real ( wp ), parameter :: bv_i = 1.0_wp !! ice fallspeed power-law coefficient real ( wp ), parameter :: av_g_old = 44 2._wp !! graupel fallspeed power-law coefficient (hail_aware = false) real ( wp ), parameter :: bv_g_old = 0.89_wp !! graupel fallspeed power-law coefficient (hail_aware = false) real ( wp ), parameter :: av_g_new = 16 1.794724_wp !! graupel fallspeed power-law coefficient HARDCODED for idx_bg1 = 6 (hail_aware = true) real ( wp ), parameter :: bv_g_new = 0.640961647_wp !! graupel fallspeed power-law coefficient HARDCODED for idx_bg1 = 6 (hail_aware = true) real ( wp ), parameter :: fv_r = 19 5.0_wp !! rain fallspeed power-law coefficient real ( wp ), parameter :: av_c = 0.316946e8_wp !! cloud fallspeed power-law coefficient real ( wp ), parameter :: a_coeff = 0.47244157_wp !! graupel fallspeed power-law coefficient real ( wp ), parameter :: b_coeff = 0.54698726_wp !! grapuel fallspeed power-law coefficient real ( wp ), parameter :: av_i = 149 3.9 !! ice fallspeed power-law coefficient !> @note !> am_s is the snow mass power-law coefficient !> !> mass power law relations are !>  m = a_{m}D&#94;{b_{m}}  !> and coefficients for snow are from !> [Field et al. (2005)](https://doi.org/10.1256/qj.04.134) !> and others assume a spherical form !> @endnote real ( wp ), parameter :: am_s = 0.069_wp real ( wp ), parameter :: bm_s = 2.0_wp !! snow mass power-law coefficient real ( wp ), parameter :: bm_g = 3.0_wp !! graupel mass power-law coefficient real ( wp ), parameter :: bm_i = 3.0_wp !! ice mass power-law coefficient real ( wp ), parameter :: bm_r = 3.0_wp !! rain mass power-law coefficient real ( wp ), parameter :: rho_i = 89 0._wp !! density of cloud ice [kg\\, m&#94;{-3}] real ( wp ), parameter :: xm0i = 1.e-12_wp !! ice initiates with this mass [kg] real ( wp ), parameter :: d0c = 1.e-6_wp !! minimum diameter of cloud droplets [m] real ( wp ), parameter :: d0r = 5 0.e-6_wp !! minimum diameter of raindrops [m] real ( wp ), parameter :: d0s = 30 0.e-6_wp !! minimum diameter of snow [m] real ( wp ), parameter :: d0g = 35 0.e-6_wp !! minimum diameter of graupel [m] real ( wp ), parameter :: d0r_max = 2.5e-3_wp !! maximum diameter of raindrops [m] real ( wp ), parameter :: c_cube = 0.5_wp !! capacitance of a sphere \\left(D&#94;{3}\\right) real ( wp ), parameter :: c_sqrd = 0.15_wp !! capacitance of plates/aggregates \\left(D&#94;{2}\\right) !> @note !> mu_r is the shape parameter for rain !> generalized gamma distributions for rain, graupel and cloud ice have the form !> !>  n\\left(D\\right) = n_{0} D&#94;{\\mu}\\exp(-\\lambda D)  !>  \\textrm{where}\\\\ \\mu = 0 \\\\ \\textrm{is exponential}  !> @endnote real ( wp ), parameter :: mu_r = 0.0_wp real ( wp ), parameter :: mu_s = 0.6357_wp !! shape parameter for snow real ( wp ), parameter :: mu_g = 0.0_wp !! shape parameter for graupel real ( wp ), parameter :: mu_i = 0.0_wp !! shape parameter for cloud ice real ( wp ), parameter :: nu_c_scale = 100 0.e6_wp !! scaling parameter for nu_c integer , parameter :: nu_c_max = 15 !! maximum value for nu_c integer , parameter :: nu_c_min = 2 !! minimum value for nu_c real ( wp ), parameter :: naccn0 = 30 0.0e6_wp !! used for water-friendly aerosol initialization real ( wp ), parameter :: naccn1 = 5 0.0e6_wp !! used for water-friendly aerosol initialization real ( wp ), parameter :: nain0 = 1.5e6_wp !! used for ice-friendly aerosol initialization real ( wp ), parameter :: nain1 = 0.5e6_wp !! used for ice-friendly aerosol initialization real ( wp ), parameter :: nwfa_default = 1 1.1e6_wp !! default value for water-friendly aerosols real ( wp ), parameter :: nifa_default = nain1 * 0.01_wp !! default value for ice-friendly aerosols real ( wp ), parameter :: aero_max = 999 9.e6_wp !! maximum aerosol value real ( wp ), parameter :: hgfrz = 23 5.16_wp !! temperature to freeze all liquid [K] real ( wp ), parameter :: nt_c_o = 5 0.e6_wp !! cloud number concentration over ocean (non-aerosol aware) [m&#94;{-3}] real ( wp ), parameter :: nt_c_l = 10 0.e6_wp !! cloud number concentration over land (non-aerosol aware) [m&#94;{-3}] real ( wp ), parameter :: nt_c_max = 199 9.e6_wp !! maximum cloud number concentration [m&#94;{-3}] real ( wp ), parameter :: nt_c_min = 2._wp !! minimum cloud number concentration [m&#94;{-3}] real ( wp ), parameter :: tno = 5.0_wp !! constant in the [Cooper](https://doi.org/10.1007/978-1-935704-17-1_4) curve for ice nucleation real ( wp ), parameter :: ato = 0.304_wp !! constant in the [Cooper](https://doi.org/10.1007/978-1-935704-17-1_4) curve for ice nucleation real ( wp ) :: rho_s = 10 0.0_wp !! density of snow [kg\\, m&#94;{-3}] real ( wp ), parameter :: demott_nuc_ssati = 0.25_wp !! ice supersaturation threshold for [DeMott](https://doi.org/10.1073/pnas.0910818107) nucleation real ( dp ), parameter :: max_ni = 499 9.e3_wp !! maximum ice number concentration [m&#94;{-3}] real ( wp ), parameter :: icenuc_max = 100 0.e3_wp !! maximum ice nucleation number [m&#94;{-3}] real ( wp ), parameter :: rime_threshold = 2.0_wp !! snow to graupel rime threshold parameter real ( wp ), parameter :: rime_conversion = 0.95_wp !! snow to graupel rime conversion parameter real ( wp ), parameter :: ef_si = 0.05_wp !! snow-ice collection efficiency real ( wp ), parameter :: ef_rs = 0.95_wp !! rain-snow collection efficiency real ( wp ), parameter :: ef_rg = 0.75_wp !! rain-graupel collection efficiency real ( wp ), parameter :: ef_ri = 0.95_wp !! rain-ice collection efficiency real ( wp ), parameter :: autocon_nr_factor = 1 0._wp !! factor controlling rain number tendency from autconversion (larger produces few drops) real ( wp ), parameter :: timestep_conversion_rime_to_rain = 12 0._wp !! timestep above which rime above freezing becomes rain (this timestep should be at least 120s) ! parameters that should NOT be changed ----------------------------------------------------------------- integer , parameter :: table_sp = real32 !! precision for lookup tables (machine independent) integer , parameter :: table_dp = real64 !! precision for lookup tables (machine independent) integer , parameter :: nrhg = 9 !! graupel density array size when hail_aware = true integer , parameter :: nrhg1 = 1 !! graupel density array size when hail_aware = false real ( wp ), parameter :: min_qv = 1.e-10_wp !! minimum value of water vapor mixing ratio [kg\\, kg&#94;{-1}] real ( wp ), parameter :: r1 = 1.e-12_wp !! minimum hydrometeor mass [kg\\, m&#94;{-3}] real ( wp ), parameter :: r2 = 1.e-6_wp !! minimum hydrometeor number [kg\\, m&#94;{-3}] real ( wp ), parameter :: low_limit_mass_for_precip = 1.e-9_wp !! minimum hydrometor mass needed in the lowest-model level for precipitation real ( wp ), parameter :: eps = 1.e-15_wp !! small non-zero number real ( wp ), parameter :: meters3_to_liters = 100 0._wp !! number of liters in 1 m&#94;{3} real ( dp ), parameter :: gonv_min = 1.e2_dp !! minimum graupel y-intercept [m&#94;{-4}] real ( dp ), parameter :: gonv_max = 1.e6_dp !! maximum graupel y-intercept [m&#94;{-4}] real ( wp ), parameter :: t0 = 27 3.15_wp !! melting point of ice [K] real ( wp ), parameter :: rho_w = 100 0._wp !! density of liquid water [kg\\, m&#94;{-3}] real ( wp ), dimension ( nrhg ), parameter :: rho_g = [ 5 0._wp , 10 0._wp , 20 0._wp , 30 0._wp , 40 0._wp , & 50 0._wp , 60 0._wp , 70 0._wp , 80 0._wp ] !! !! densities of graupel when hail_aware = true [kg\\, m&#94;{-3}] real ( wp ), parameter :: sc = 0.632_wp !! [schmidt number](https://glossary.ametsoc.org/wiki/Schmidt_number) ! these can be overwritten by a host model and don't have a parameter attribute real ( wp ) :: pi = 3.1415926536_wp !! pi is approximately 355/113 real ( wp ) :: lsub = 2.834e6_wp !! enthalpy of sublimation [J\\, kg&#94;{-1}] real ( wp ) :: lvap0 = 2.5e6_wp !! enthalpy of vaporization [J\\, kg&#94;{-1}] real ( wp ) :: rv = 46 1.5_wp !! gas constant for water vapor [J\\, K&#94;{-1}\\, kg&#94;{-1}] real ( wp ) :: rdry = 28 7.04_wp !! gas constant for dry air [J\\, K&#94;{-1}\\, kg&#94;{-1}] real ( wp ) :: roverrv = 0.622_wp !! dry gas constant divided by water vapor gas constant real ( wp ) :: r = 28 7.04_wp !! gas constant for dry air [J\\, K&#94;{-1}\\, kg&#94;{-1}] real ( wp ) :: rho_not !! density constant [kg\\, m&#94;{-3}] real ( wp ) :: rho_not0 !! density constant [kg\\, m&#94;{-3}] real ( wp ) :: cp = 100 4.0_wp !! heat capacity of air at constant pressure [J\\, K&#94;{-1}\\, kg&#94;{-1}] real ( wp ) :: r_uni = 8.314 !! gas constant [J\\, K&#94;{-1}\\, mol&#94;{-1}] real ( wp ), parameter :: kap0 = 49 0.6_wp !! snow parameter from [Field et al. (2005)](https://doi.org/10.1256/qj.04.134) real ( wp ), parameter :: kap1 = 1 7.46_wp !! snow parameter from [Field et al. (2005)](https://doi.org/10.1256/qj.04.134) real ( wp ), parameter :: lam0 = 2 0.78_wp !! snow parameter from [Field et al. (2005)](https://doi.org/10.1256/qj.04.134) real ( wp ), parameter :: lam1 = 3.29_wp !! snow parameter from [Field et al. (2005)](https://doi.org/10.1256/qj.04.134) ! lookup table dimensions integer , parameter :: nbins = 100 !! lookup table dimension (number of bins) integer , parameter :: nbc = nbins !! lookup table dimension for cloud water integer , parameter :: nbr = nbins !! lookup table dimension for rain integer , parameter :: nbs = nbins !! lookup table dimension for snow integer , parameter :: nbi = nbins !! lookup table dimension integer , parameter :: nbg = nbins !! lookup table dimension integer , parameter :: ntb_i = 64 !! lookup table dimension for cloud ice integer , parameter :: ntb_i1 = 55 !! lookup table dimension for cloud ice integer , parameter :: ntb_c = 37 !! lookup table dimension for cloud water integer , parameter :: ntb_t = 9 !! lookup table dimension for temperature integer , parameter :: ntb_g1 = 37 !! lookup table dimension for graupel integer , parameter :: ntb_s = 37 !! lookup table dimension for snow integer , parameter :: ntb_g = 37 !! lookup table dimension for graupel integer , parameter :: ntb_r = 37 !! lookup table dimension for rain integer , parameter :: ntb_r1 = 37 !! lookup table dimension for rain integer , parameter :: ntb_t1 = 45 !! lookup table dimension for temperature integer , parameter :: ntb_in = 55 !! lookup table dimension for IN integer , parameter :: ntb_arc = 7 !! lookup table dimension for CCN activation integer , parameter :: ntb_arw = 9 !! lookup table dimension for CCN activation integer , parameter :: ntb_art = 7 !! lookup table dimension for CCN activation integer , parameter :: ntb_arr = 5 !! lookup table dimension for CCN activation integer , parameter :: ntb_ark = 4 !! lookup table dimension for CCN activation ! lookup table data real ( wp ), dimension ( ntb_c ), parameter :: & r_c = [ 1.e-6_wp , 2.e-6_wp , 3.e-6_wp , 4.e-6_wp , 5.e-6_wp , 6.e-6_wp , 7.e-6_wp , 8.e-6_wp , 9.e-6_wp , & 1.e-5_wp , 2.e-5_wp , 3.e-5_wp , 4.e-5_wp , 5.e-5_wp , 6.e-5_wp , 7.e-5_wp , 8.e-5_wp , 9.e-5_wp , & 1.e-4_wp , 2.e-4_wp , 3.e-4_wp , 4.e-4_wp , 5.e-4_wp , 6.e-4_wp , 7.e-4_wp , 8.e-4_wp , 9.e-4_wp , & 1.e-3_wp , 2.e-3_wp , 3.e-3_wp , 4.e-3_wp , 5.e-3_wp , 6.e-3_wp , 7.e-3_wp , 8.e-3_wp , 9.e-3_wp , & 1.e-2_wp ] !! mass bins for cloud water [kg\\, m&#94;{-3}] real ( wp ), dimension ( ntb_i ), parameter :: & r_i = [ 1.e-10_wp , 2.e-10_wp , 3.e-10_wp , 4.e-10_wp , & 5.e-10_wp , 6.e-10_wp , 7.e-10_wp , 8.e-10_wp , 9.e-10_wp , & 1.e-9_wp , 2.e-9_wp , 3.e-9_wp , 4.e-9_wp , 5.e-9_wp , 6.e-9_wp , 7.e-9_wp , 8.e-9_wp , 9.e-9_wp , & 1.e-8_wp , 2.e-8_wp , 3.e-8_wp , 4.e-8_wp , 5.e-8_wp , 6.e-8_wp , 7.e-8_wp , 8.e-8_wp , 9.e-8_wp , & 1.e-7_wp , 2.e-7_wp , 3.e-7_wp , 4.e-7_wp , 5.e-7_wp , 6.e-7_wp , 7.e-7_wp , 8.e-7_wp , 9.e-7_wp , & 1.e-6_wp , 2.e-6_wp , 3.e-6_wp , 4.e-6_wp , 5.e-6_wp , 6.e-6_wp , 7.e-6_wp , 8.e-6_wp , 9.e-6_wp , & 1.e-5_wp , 2.e-5_wp , 3.e-5_wp , 4.e-5_wp , 5.e-5_wp , 6.e-5_wp , 7.e-5_wp , 8.e-5_wp , 9.e-5_wp , & 1.e-4_wp , 2.e-4_wp , 3.e-4_wp , 4.e-4_wp , 5.e-4_wp , 6.e-4_wp , 7.e-4_wp , 8.e-4_wp , 9.e-4_wp , & 1.e-3_wp ] !! mass bins for ice water [kg\\, m&#94;{-3}] real ( wp ), dimension ( ntb_r ), parameter :: & r_r = [ 1.e-6_wp , 2.e-6_wp , 3.e-6_wp , 4.e-6_wp , 5.e-6_wp , 6.e-6_wp , 7.e-6_wp , 8.e-6_wp , 9.e-6_wp , & 1.e-5_wp , 2.e-5_wp , 3.e-5_wp , 4.e-5_wp , 5.e-5_wp , 6.e-5_wp , 7.e-5_wp , 8.e-5_wp , 9.e-5_wp , & 1.e-4_wp , 2.e-4_wp , 3.e-4_wp , 4.e-4_wp , 5.e-4_wp , 6.e-4_wp , 7.e-4_wp , 8.e-4_wp , 9.e-4_wp , & 1.e-3_wp , 2.e-3_wp , 3.e-3_wp , 4.e-3_wp , 5.e-3_wp , 6.e-3_wp , 7.e-3_wp , 8.e-3_wp , 9.e-3_wp , & 1.e-2_wp ] !! mass bins for rain [kg\\, m&#94;{-3}] real ( wp ), dimension ( ntb_s ), parameter :: & r_s = [ 1.e-6_wp , 2.e-6_wp , 3.e-6_wp , 4.e-6_wp , 5.e-6_wp , 6.e-6_wp , 7.e-6_wp , 8.e-6_wp , 9.e-6_wp , & 1.e-5_wp , 2.e-5_wp , 3.e-5_wp , 4.e-5_wp , 5.e-5_wp , 6.e-5_wp , 7.e-5_wp , 8.e-5_wp , 9.e-5_wp , & 1.e-4_wp , 2.e-4_wp , 3.e-4_wp , 4.e-4_wp , 5.e-4_wp , 6.e-4_wp , 7.e-4_wp , 8.e-4_wp , 9.e-4_wp , & 1.e-3_wp , 2.e-3_wp , 3.e-3_wp , 4.e-3_wp , 5.e-3_wp , 6.e-3_wp , 7.e-3_wp , 8.e-3_wp , 9.e-3_wp , & 1.e-2_wp ] !! mass bins for snow [kg\\, m&#94;{-3}] real ( wp ), dimension ( ntb_g ), parameter :: & r_g = [ 1.e-6_wp , 2.e-6_wp , 3.e-6_wp , 4.e-6_wp , 5.e-6_wp , 6.e-6_wp , 7.e-6_wp , 8.e-6_wp , 9.e-6_wp , & 1.e-5_wp , 2.e-5_wp , 3.e-5_wp , 4.e-5_wp , 5.e-5_wp , 6.e-5_wp , 7.e-5_wp , 8.e-5_wp , 9.e-5_wp , & 1.e-4_wp , 2.e-4_wp , 3.e-4_wp , 4.e-4_wp , 5.e-4_wp , 6.e-4_wp , 7.e-4_wp , 8.e-4_wp , 9.e-4_wp , & 1.e-3_wp , 2.e-3_wp , 3.e-3_wp , 4.e-3_wp , 5.e-3_wp , 6.e-3_wp , 7.e-3_wp , 8.e-3_wp , 9.e-3_wp , & 1.e-2_wp ] !! mass bins for graupel [kg\\, m&#94;{-3}] real ( wp ), dimension ( ntb_r1 ), parameter :: & n0r_exp = [ 1.e6_wp , 2.e6_wp , 3.e6_wp , 4.e6_wp , 5.e6_wp , 6.e6_wp , 7.e6_wp , 8.e6_wp , 9.e6_wp , & 1.e7_wp , 2.e7_wp , 3.e7_wp , 4.e7_wp , 5.e7_wp , 6.e7_wp , 7.e7_wp , 8.e7_wp , 9.e7_wp , & 1.e8_wp , 2.e8_wp , 3.e8_wp , 4.e8_wp , 5.e8_wp , 6.e8_wp , 7.e8_wp , 8.e8_wp , 9.e8_wp , & 1.e9_wp , 2.e9_wp , 3.e9_wp , 4.e9_wp , 5.e9_wp , 6.e9_wp , 7.e9_wp , 8.e9_wp , 9.e9_wp , & 1.e10_wp ] !! y-intercept bins for rain [m&#94;{-4}] real ( wp ), dimension ( ntb_g1 ), parameter :: & n0g_exp = [ 1.e2_wp , 2.e2_wp , 3.e2_wp , 4.e2_wp , 5.e2_wp , 6.e2_wp , 7.e2_wp , 8.e2_wp , 9.e2_wp , & 1.e3_wp , 2.e3_wp , 3.e3_wp , 4.e3_wp , 5.e3_wp , 6.e3_wp , 7.e3_wp , 8.e3_wp , 9.e3_wp , & 1.e4_wp , 2.e4_wp , 3.e4_wp , 4.e4_wp , 5.e4_wp , 6.e4_wp , 7.e4_wp , 8.e4_wp , 9.e4_wp , & 1.e5_wp , 2.e5_wp , 3.e5_wp , 4.e5_wp , 5.e5_wp , 6.e5_wp , 7.e5_wp , 8.e5_wp , 9.e5_wp , & 1.e6_wp ] !! y-intercept bins for graupel [m&#94;{-4}] real ( wp ), dimension ( ntb_i1 ), parameter :: & nt_i = [ 1.0_wp , 2.0_wp , 3.0_wp , 4.0_wp , 5.0_wp , 6.0_wp , 7.0_wp , 8.0_wp , 9.0_wp , & 1.e1_wp , 2.e1_wp , 3.e1_wp , 4.e1_wp , 5.e1_wp , 6.e1_wp , 7.e1_wp , 8.e1_wp , 9.e1_wp , & 1.e2_wp , 2.e2_wp , 3.e2_wp , 4.e2_wp , 5.e2_wp , 6.e2_wp , 7.e2_wp , 8.e2_wp , 9.e2_wp , & 1.e3_wp , 2.e3_wp , 3.e3_wp , 4.e3_wp , 5.e3_wp , 6.e3_wp , 7.e3_wp , 8.e3_wp , 9.e3_wp , & 1.e4_wp , 2.e4_wp , 3.e4_wp , 4.e4_wp , 5.e4_wp , 6.e4_wp , 7.e4_wp , 8.e4_wp , 9.e4_wp , & 1.e5_wp , 2.e5_wp , 3.e5_wp , 4.e5_wp , 5.e5_wp , 6.e5_wp , 7.e5_wp , 8.e5_wp , 9.e5_wp , & 1.e6_wp ] !! number bins for ice [m&#94;{-3}] real ( wp ), dimension ( ntb_in ), parameter :: & nt_in = [ 1.0_wp , 2.0_wp , 3.0_wp , 4.0_wp , 5.0_wp , 6.0_wp , 7.0_wp , 8.0_wp , 9.0_wp , & 1.e1_wp , 2.e1_wp , 3.e1_wp , 4.e1_wp , 5.e1_wp , 6.e1_wp , 7.e1_wp , 8.e1_wp , 9.e1_wp , & 1.e2_wp , 2.e2_wp , 3.e2_wp , 4.e2_wp , 5.e2_wp , 6.e2_wp , 7.e2_wp , 8.e2_wp , 9.e2_wp , & 1.e3_wp , 2.e3_wp , 3.e3_wp , 4.e3_wp , 5.e3_wp , 6.e3_wp , 7.e3_wp , 8.e3_wp , 9.e3_wp , & 1.e4_wp , 2.e4_wp , 3.e4_wp , 4.e4_wp , 5.e4_wp , 6.e4_wp , 7.e4_wp , 8.e4_wp , 9.e4_wp , & 1.e5_wp , 2.e5_wp , 3.e5_wp , 4.e5_wp , 5.e5_wp , 6.e5_wp , 7.e5_wp , 8.e5_wp , 9.e5_wp , & 1.e6_wp ] !! number bins for IN concentration from 0.001-1000\\, L&#94;{-1} [m&#94;{-3}] real ( wp ), dimension ( ntb_arc ), parameter :: & ta_na = [ 1 0._wp , 3 1.6_wp , 10 0._wp , 31 6._wp , & 100 0._wp , 316 0._wp , 1000 0._wp ] !! aerosol lookup table bins for number concentration real ( wp ), dimension ( ntb_arw ), parameter :: & ta_ww = [ 0.01_wp , 0.0316_wp , 0.1_wp , 0.316_wp , & 1._wp , 3.16_wp , 1 0._wp , 3 1.6_wp , 10 0._wp ] !! aerosol lookup table bins for vertical velocity real ( wp ), dimension ( ntb_art ), parameter :: & ta_tk = [ 24 3.15_wp , 25 3.15_wp , 26 3.15_wp , & 27 3.15_wp , 28 3.15_wp , 29 3.15_wp , 30 3.15_wp ] !! aerosol lookup table bins for temperature real ( wp ), dimension ( ntb_arr ), parameter :: & ta_ra = [ 0.01_wp , 0.02_wp , 0.04_wp , 0.08_wp , 0.16_wp ] !! aerosol lookup table bins for radius real ( wp ), dimension ( ntb_ark ), parameter :: & ta_ka = [ 0.2_wp , 0.4_wp , 0.6_wp , 0.8_wp ] !! aerosol lookup table bins for hygroscopicity real ( wp ), dimension ( 10 ), parameter :: & sa = [ 5.065339_wp , - 0.062659_wp , - 3.032362_wp , 0.029469_wp , - 0.000285_wp , & 0.31255_wp , 0.000204_wp , 0.003199_wp , 0._wp , - 0.015952_wp ] !! snow moment data from [Field et al. (2005)](https://doi.org/10.1256/qj.04.134) real ( wp ), dimension ( 10 ), parameter :: & sb = [ 0.476221_wp , - 0.015896_wp , 0.165977_wp , 0.007468_wp , - 0.000141_wp , & 0.060366_wp , 0.000079_wp , 0.000594_wp , 0._wp , - 0.003577_wp ] !! snow moment data from [Field et al. (2005)](https://doi.org/10.1256/qj.04.134) real ( wp ), dimension ( ntb_t ), parameter :: & tc = [ - 0.01_wp , - 5._wp , - 1 0._wp , - 1 5._wp , & - 2 0._wp , - 2 5._wp , - 3 0._wp , - 3 5._wp , - 4 0._wp ] !! temperature lookup table data ! variables --------------------------------------------------------------------------------------------- integer , protected :: dim_nrhg !! number of dimensions for graupel density !> @note !> av_g contains graupel fallspeed power-law coefficients (hail_aware = true) !> !> av_g and bv_g values from A. Heymsfield: Best - Reynolds relationship !> @endnote real ( wp ), protected , dimension ( nrhg ) :: av_g = [ 4 5.9173813_wp , 6 7.0867386_wp , 9 8.0158463_wp , & 12 2.353378_wp , 14 3.204224_wp , 16 1.794724_wp , & 17 8.762115_wp , 19 4.488785_wp , 20 9.225876_wp ] real ( wp ), protected , dimension ( nrhg ) :: bv_g = [ 0.640961647_wp , 0.640961647_wp , 0.640961647_wp , & 0.640961647_wp , 0.640961647_wp , 0.640961647_wp , & 0.640961647_wp , 0.640961647_wp , 0.640961647_wp ] !! graupel fallspeed power-law coefficients (hail_aware = true) real ( wp ), protected :: am_i !! ice mass-diameter power-law coefficient real ( wp ), protected :: am_r !! rain mass-diameter power-law coefficient real ( wp ), protected , dimension ( nrhg ) :: am_g !! graupel mass-diameter power-law coefficient real ( wp ), protected :: lfus !! enthalpy of fusion [J\\, kg&#94;{-1}] real ( wp ), protected :: olfus !! 1 / lfus [kg\\, J&#94;{-1}] real ( wp ), protected :: orv !! 1 / rv [K\\, kg\\, J&#94;{-1}] real ( wp ), protected :: ar_volume !! volume for Koop nucleation real ( wp ), protected :: sc3 !! schmidt number to the 1/3 power real ( wp ), protected :: d0i !! minimum diameter of cloud ice [m] real ( wp ), protected :: xm0s !! minimum mass of snow [kg] real ( wp ), protected :: xm0g !! minimum mass of graupel [kg] real ( wp ), protected :: obmi !! 1 / bm_i real ( wp ), protected :: obmr !! 1 / bm_r real ( wp ), protected :: oams !! 1 / am_s real ( wp ), protected :: obms !! 1 / bm_s real ( wp ), protected :: ocms !! oams &#94; obms real ( wp ), protected , dimension ( nrhg ) :: oamg !! 1 / am_g real ( wp ), protected , dimension ( nrhg ) :: ocmg !! oamg &#94; obmg real ( wp ), protected :: obmg !! 1 / bm_g ! various gamma calculations used throughout the microphysics real ( wp ), protected , dimension ( 5 , 15 ) :: cce , ccg !! for ccg = \\Gamma(x), cce is x for cloud water real ( wp ), protected , dimension ( 15 ) :: ocg1 , ocg2 !! inverse of specific ccg values real ( wp ), protected , dimension ( 7 ) :: cie , cig !! for cig = \\Gamma(x), cie is x for cloud ice real ( wp ), protected :: oig1 , oig2 !! inverse of specific cig values real ( wp ), protected , dimension ( 13 ) :: cre , crg !! for crg = \\Gamma(x), cre is x for rain real ( wp ), protected :: ore1 , org1 , org2 , org3 !! inverse of specific cre and crg values real ( wp ), protected , dimension ( 17 ) :: cse , csg !! for csg = \\Gamma(x), cse is x for snow real ( wp ), protected , dimension ( 12 , nrhg ) :: cge , cgg !! for cgg = \\Gamma(x), cge is x for graupel real ( wp ), protected :: oge1 , ogg1 , ogg2 , ogg3 !! inverse of specific cge and cgg values ! precomputed constants in various rate equations real ( wp ), protected :: t1_qr_qc , t1_qr_qi , t2_qr_qi !! terms for rain collecting cloud water and cloud ice equations real ( wp ), protected :: t1_qs_qc , t1_qs_qi !! terms for snow collecting cloud water and cloud ice equations real ( wp ), protected :: t1_qr_ev , t2_qr_ev !! terms for rain evaporation equation real ( wp ), protected :: t1_qs_sd , t2_qs_sd !! terms for deposition/sublimation of snow equation real ( wp ), protected :: t1_qs_me , t2_qs_me !! terms for melting snow equation real ( wp ), protected :: t1_qg_sd !! term for deposition/sublimation of graupel equation real ( wp ), protected :: t1_qg_me !! term for melting graupel equation integer :: nic2 , nii2 , nii3 , nir2 , nir3 , nis2 , nig2 , nig3 , niin2 !! lookup table indexes !> @history !> nic1 is used for cloud droplet number concentration lookup table !> !> nic1 was changed from integer in previous code versions !> @endhistory real ( dp ) :: nic1 real ( dp ), protected , dimension ( nbc ) :: dc , dtc !! diameter and bin space for cloud water bins [m] real ( dp ), protected , dimension ( nbi ) :: di , dti !! diameter and bin space for ice bins [m] real ( dp ), protected , dimension ( nbr ) :: dr , dtr !! diameter and bin space for rain bins [m] real ( dp ), protected , dimension ( nbs ) :: ds , dts !! diameter and bin space for snow bins [m] real ( dp ), protected , dimension ( nbg ) :: dg , dtg !! diameter and bin space for graupel bins [m] real ( dp ), protected , dimension ( nbc ) :: t_nc !! cloud droplet number concentration bins [cm&#94;{-3}] integer , parameter :: nhbins = 50 !! used for hail size calculation real ( dp ), protected , dimension (:), allocatable :: hbins , dhbins !! diameter and bin space for hail size bins [m] integer , parameter :: radar_bins = 50 !! used for radar caculation real ( dp ), protected , dimension (:), allocatable :: sbins_radar , dsbins_radar !! diameter and bin space for snow used in radar calculation [m] real ( dp ), protected , dimension (:), allocatable :: gbins_radar , dgbins_radar !! diameter and bin space for graupel used in radar calculation [m] ! lookup table data set in module_mp_tempo_init and cannot be protected real ( dp ), allocatable , dimension (:,:) :: t_efrw , t_efsw !! collection efficiency data arrays real ( dp ), allocatable , dimension (:,:,:) :: tpc_wev , tnc_wev !! evaporation data arrays real ( table_sp ), allocatable , dimension (:,:,:,:,:) :: tnccn_act !! cloud condensation nuclei data arrays real ( table_dp ), allocatable , dimension (:,:,:,:,:) :: tcg_racg , tmr_racg , tcr_gacr , & tnr_racg , tnr_gacr !! rain-graupel collection data arrays real ( table_dp ), allocatable , dimension (:,:,:,:) :: tcs_racs1 , tmr_racs1 , tcs_racs2 , & tmr_racs2 , tcr_sacr1 , tms_sacr1 , tcr_sacr2 , tms_sacr2 , & tnr_racs1 , tnr_racs2 , tnr_sacr1 , tnr_sacr2 !! rain-snow collection data arrays real ( table_dp ), allocatable , dimension (:,:,:,:) :: tpi_qcfz , tni_qcfz !! cloud droplet freezing data arrays real ( table_dp ), allocatable , dimension (:,:,:,:) :: tpi_qrfz , tpg_qrfz , tni_qrfz , tnr_qrfz !! rain freezing data arrays real ( dp ), allocatable , dimension (:,:) :: tps_iaus , tni_iaus , tpi_ide !! cloud ice depositional growth and conversion to snow data array ! ------------------------------------------------------------------------------------------------------- ! ------------------------------------------------------------------------------------------------------- contains subroutine get_version ( version ) !! returns the tempo version string from the README.md file !! or returns empty string if not found character ( len =* ), intent ( inout ) :: version character ( len = 100 ) :: first_line , filename integer :: io_unit logical :: fileexists filename = 'README.md' inquire ( file = trim ( filename ), exist = fileexists ) if (. not . fileexists ) then version = '' ! write(*,'(A)') 'Unable to determine TEMPO Microphysics Version' return endif open ( newunit = io_unit , file = filename , status = 'old' , action = 'read' ) read ( io_unit , '(A)' ) first_line close ( io_unit ) ! format is tempo-vX.X.X version = trim ( first_line ( 8 :)) write ( * , '(A)' ) 'TEMPO Microphysics Version: ' // trim ( version ) end subroutine get_version subroutine initialize_graupel_vars ( hail_flag ) !! initialize graupel variables based on hail-aware configuration flag logical , intent ( in ) :: hail_flag if ( hail_flag ) then ! in case these were previously set to av_g_old and bv_g_old reset av_g ( idx_bg1 ) = av_g_new bv_g ( idx_bg1 ) = bv_g_new dim_nrhg = nrhg else av_g ( idx_bg1 ) = av_g_old bv_g ( idx_bg1 ) = bv_g_old dim_nrhg = nrhg1 endif end subroutine initialize_graupel_vars subroutine initialize_parameters () !! initialize tempo parameters and variables integer :: m , n ! pi could be set by a host model, thus these parameters need to be calculated here am_i = pi * rho_i / 6.0_wp am_r = pi * rho_w / 6.0_wp am_g = [ pi * rho_g ( 1 ) / 6.0_wp , & pi * rho_g ( 2 ) / 6.0_wp , & pi * rho_g ( 3 ) / 6.0_wp , & pi * rho_g ( 4 ) / 6.0_wp , & pi * rho_g ( 5 ) / 6.0_wp , & pi * rho_g ( 6 ) / 6.0_wp , & pi * rho_g ( 7 ) / 6.0_wp , & pi * rho_g ( 8 ) / 6.0_wp , & pi * rho_g ( 9 ) / 6.0_wp ] ! av_i = av_s * d0s ** (bv_s - bv_i) ar_volume = 4.0_wp / 3.0_wp * pi * ( 2.5e-6_wp ) ** 3 lfus = lsub - lvap0 olfus = 1.0_wp / lfus orv = 1.0_wp / rv rho_not = 10132 5.0 / ( rdry * 29 8.0 ) rho_not0 = 10132 5.0 / ( rdry * t0 ) ! Schmidt number to one-third used numerous times sc3 = sc ** ( 1.0_wp / 3.0_wp ) ! compute minimum ice diameter from mass and minimum snow/graupel mass from diameter d0i = ( xm0i / am_i ) ** ( 1.0_wp / bm_i ) ! pre-compute various constants used in the microphysics equations xm0s = am_s * d0s ** bm_s xm0g = am_g ( nrhg ) * d0g ** bm_g obmi = 1.0_wp / bm_i obmr = 1.0_wp / bm_r oams = 1.0_wp / am_s obms = 1.0_wp / bm_s ocms = oams ** obms obmg = 1.0_wp / bm_g do m = 1 , nrhg oamg ( m ) = 1.0_wp / am_g ( m ) ocmg ( m ) = oamg ( m ) ** obmg enddo ! gamma functions for cloud water do n = 1 , 15 cce ( 1 , n ) = n + 1._wp cce ( 2 , n ) = bm_r + n + 1._wp cce ( 3 , n ) = bm_r + n + 4._wp cce ( 4 , n ) = n + bv_c + 1._wp cce ( 5 , n ) = bm_r + n + bv_c + 1._wp ccg ( 1 , n ) = gamma ( cce ( 1 , n )) ccg ( 2 , n ) = gamma ( cce ( 2 , n )) ccg ( 3 , n ) = gamma ( cce ( 3 , n )) ccg ( 4 , n ) = gamma ( cce ( 4 , n )) ccg ( 5 , n ) = gamma ( cce ( 5 , n )) ocg1 ( n ) = 1.0_wp / ccg ( 1 , n ) ocg2 ( n ) = 1.0_wp / ccg ( 2 , n ) enddo ! gamma functions for cloud ice cie ( 1 ) = mu_i + 1._wp cie ( 2 ) = bm_i + mu_i + 1._wp cie ( 3 ) = bm_i + mu_i + bv_i + 1._wp cie ( 4 ) = mu_i + bv_i + 1._wp cie ( 5 ) = mu_i + 2._wp cie ( 6 ) = bm_i * 0.5_wp + mu_i + bv_i + 1._wp cie ( 7 ) = bm_i * 0.5_wp + mu_i + 1._wp cig ( 1 ) = gamma ( cie ( 1 )) cig ( 2 ) = gamma ( cie ( 2 )) cig ( 3 ) = gamma ( cie ( 3 )) cig ( 4 ) = gamma ( cie ( 4 )) cig ( 5 ) = gamma ( cie ( 5 )) cig ( 6 ) = gamma ( cie ( 6 )) cig ( 7 ) = gamma ( cie ( 7 )) oig1 = 1.0_wp / cig ( 1 ) oig2 = 1.0_wp / cig ( 2 ) ! gamma functions for rain cre ( 1 ) = bm_r + 1._wp cre ( 2 ) = mu_r + 1._wp cre ( 3 ) = bm_r + mu_r + 1._wp cre ( 4 ) = bm_r * 2._wp + mu_r + 1._wp cre ( 5 ) = mu_r + bv_r + 1._wp cre ( 6 ) = bm_r + mu_r + bv_r + 1._wp cre ( 7 ) = bm_r * 0.5_wp + mu_r + bv_r + 1._wp cre ( 8 ) = bm_r + mu_r + bv_r + 3._wp cre ( 9 ) = mu_r + bv_r + 3._wp cre ( 10 ) = mu_r + 2._wp cre ( 11 ) = 0.5_wp * ( bv_r + 5._wp + 2._wp * mu_r ) cre ( 12 ) = bm_r * 0.5_wp + mu_r + 1._wp cre ( 13 ) = bm_r * 2._wp + mu_r + bv_r + 1._wp do n = 1 , 13 crg ( n ) = gamma ( cre ( n )) enddo ore1 = 1.0_wp / cre ( 1 ) org1 = 1.0_wp / crg ( 1 ) org2 = 1.0_wp / crg ( 2 ) org3 = 1.0_wp / crg ( 3 ) ! gamma functions for snow cse ( 1 ) = bm_s + 1._wp cse ( 2 ) = bm_s + 2._wp cse ( 3 ) = bm_s * 2._wp cse ( 4 ) = bm_s + bv_s + 1._wp cse ( 5 ) = bm_s * 2._wp + bv_s + 1._wp cse ( 6 ) = bm_s * 2._wp + 1._wp cse ( 7 ) = bm_s + mu_s + 1._wp cse ( 8 ) = bm_s + mu_s + 2._wp cse ( 9 ) = bm_s + mu_s + 3._wp cse ( 10 ) = bm_s + mu_s + bv_s + 1._wp cse ( 11 ) = bm_s * 2._wp + mu_s + bv_s + 1._wp cse ( 12 ) = bm_s * 2._wp + mu_s + 1._wp cse ( 13 ) = bv_s + 2._wp cse ( 14 ) = bm_s + bv_s cse ( 15 ) = mu_s + 1._wp cse ( 16 ) = 1.0_wp + ( 1.0_wp + bv_s ) / 2._wp cse ( 17 ) = bm_s + bv_s + 2._wp do n = 1 , 17 csg ( n ) = gamma ( cse ( n )) enddo ! gamma functions for graupel cge ( 1 ,:) = bm_g + 1._wp cge ( 2 ,:) = mu_g + 1._wp cge ( 3 ,:) = bm_g + mu_g + 1._wp cge ( 4 ,:) = bm_g * 2. + mu_g + 1._wp cge ( 10 ,:) = mu_g + 2._wp cge ( 12 ,:) = bm_g * 0.5_wp + mu_g + 1._wp do m = 1 , nrhg cge ( 5 , m ) = bm_g * 2._wp + mu_g + bv_g ( m ) + 1._wp cge ( 6 , m ) = bm_g + mu_g + bv_g ( m ) + 1._wp cge ( 7 , m ) = bm_g * 0.5_wp + mu_g + bv_g ( m ) + 1._wp cge ( 8 , m ) = mu_g + bv_g ( m ) + 1._wp cge ( 9 , m ) = mu_g + bv_g ( m ) + 3._wp cge ( 11 , m ) = 0.5_wp * ( bv_g ( m ) + 5._wp + 2._wp * mu_g ) enddo do m = 1 , nrhg do n = 1 , 12 cgg ( n , m ) = gamma ( cge ( n , m )) enddo enddo oge1 = 1.0_wp / cge ( 1 , 1 ) ogg1 = 1.0_wp / cgg ( 1 , 1 ) ogg2 = 1.0_wp / cgg ( 2 , 1 ) ogg3 = 1.0_wp / cgg ( 3 , 1 ) ! rain collecting cloud water and cloud ice t1_qr_qc = pi * 0.25_wp * av_r * crg ( 9 ) t1_qr_qi = pi * 0.25_wp * av_r * crg ( 9 ) t2_qr_qi = pi * 0.25_wp * am_r * av_r * crg ( 8 ) ! snow collecting cloud water and cloud ice t1_qs_qc = pi * 0.25_wp * av_s t1_qs_qi = pi * 0.25_wp * av_s ! evaporation of rain; ignore depositional growth of rain. t1_qr_ev = 0.78_wp * crg ( 10 ) t2_qr_ev = 0.308_wp * sc3 * sqrt ( av_r ) * crg ( 11 ) ! sublimation/depositional growth of snow t1_qs_sd = 0.86_wp t2_qs_sd = 0.28_wp * sc3 * sqrt ( av_s ) ! melting of snow t1_qs_me = pi * 4._wp * c_sqrd * olfus * 0.86_wp t2_qs_me = pi * 4._wp * c_sqrd * olfus * 0.28_wp * sc3 * sqrt ( av_s ) ! sublimation/depositional growth of graupel t1_qg_sd = 0.86_wp * cgg ( 10 , 1 ) ! melting of graupel t1_qg_me = pi * 4._wp * c_cube * olfus * 0.86_wp * cgg ( 10 , 1 ) end subroutine initialize_parameters subroutine initialize_bins_for_tables () !! initialize log-spaced bins of hydrometer quantities used for lookup tables integer :: n ! constants for helping find lookup table indexes nic2 = nint ( log10 ( r_c ( 1 ))) nii2 = nint ( log10 ( r_i ( 1 ))) nir2 = nint ( log10 ( r_r ( 1 ))) nis2 = nint ( log10 ( r_s ( 1 ))) nig2 = nint ( log10 ( r_g ( 1 ))) nii3 = nint ( log10 ( nt_i ( 1 ))) nir3 = nint ( log10 ( n0r_exp ( 1 ))) nig3 = nint ( log10 ( n0g_exp ( 1 ))) niin2 = nint ( log10 ( nt_in ( 1 ))) ! bins of cloud water (from minimum diameter to 100 microns) dc ( 1 ) = real ( d0c , kind = dp ) dtc ( 1 ) = real ( d0c , kind = dp ) do n = 2 , nbc dc ( n ) = dc ( n - 1 ) + 1.0e-6_dp dtc ( n ) = ( dc ( n ) - dc ( n - 1 )) enddo ! bins of cloud ice (from min diameter up to 2x min snow size) call create_bins ( numbins = nbi , lowbin = real ( d0i , kind = dp ), & highbin = 2.0_dp * d0s , bins = di , deltabins = dti ) ! bins of rain (from min diameter up to 5 mm) call create_bins ( numbins = nbr , lowbin = real ( d0r , kind = dp ), & highbin = 0.005_dp , bins = dr , deltabins = dtr ) ! bins of snow (from min diameter up to 2 cm) call create_bins ( numbins = nbs , lowbin = real ( d0s , kind = dp ), & highbin = 0.02_dp , bins = ds , deltabins = dts ) ! bins of graupel (from min diameter up to 5 cm) call create_bins ( numbins = nbg , lowbin = real ( d0g , kind = dp ), & highbin = 0.05_dp , bins = dg , deltabins = dtg ) ! bins of cloud droplet number concentration (1 to 3000 per cc) call create_bins ( numbins = nbc , lowbin = 1.0_dp , & highbin = 300 0.0_dp , bins = t_nc ) t_nc = t_nc * 1.0e6_dp nic1 = real ( log ( t_nc ( nbc ) / t_nc ( 1 )), kind = dp ) end subroutine initialize_bins_for_tables subroutine initialize_bins_for_hail_size () !! initialize log-spaced bins for hail size calculation real ( dp ), parameter :: lowbin = 50 0.e-6_dp real ( dp ), parameter :: highbin = 0.075_dp if (. not . allocated ( hbins )) allocate ( hbins ( nhbins ), source = 0._dp ) if (. not . allocated ( dhbins )) allocate ( dhbins ( nhbins ), source = 0._dp ) call create_bins ( numbins = nhbins , lowbin = lowbin , highbin = highbin , & bins = hbins , deltabins = dhbins ) end subroutine initialize_bins_for_hail_size subroutine initialize_bins_for_radar () !! initialize log-spaced bins for radar calculation real ( dp ), parameter :: lowbin = 10 0.e-6_dp real ( dp ), parameter :: s_highbin = 0.02_dp real ( dp ), parameter :: g_highbin = 0.05_dp if (. not . allocated ( sbins_radar )) allocate ( sbins_radar ( radar_bins ), source = 0._dp ) if (. not . allocated ( dsbins_radar )) allocate ( dsbins_radar ( radar_bins ), source = 0._dp ) ! bins of snow (from 100 microns up to 2 cm) call create_bins ( numbins = radar_bins , lowbin = lowbin , & highbin = s_highbin , bins = sbins_radar , deltabins = dsbins_radar ) if (. not . allocated ( gbins_radar )) allocate ( gbins_radar ( radar_bins ), source = 0._dp ) if (. not . allocated ( dgbins_radar )) allocate ( dgbins_radar ( radar_bins ), source = 0._dp ) ! bins of graupel (from 100 microns up to 5 cm) call create_bins ( numbins = radar_bins , lowbin = lowbin , & highbin = g_highbin , bins = gbins_radar , deltabins = dgbins_radar ) end subroutine initialize_bins_for_radar subroutine create_bins ( numbins , lowbin , highbin , bins , deltabins ) !! calculates log-spaced bins of hydrometer sizes to simplify calculations later integer , intent ( in ) :: numbins real ( dp ), intent ( in ) :: lowbin , highbin real ( dp ), dimension (:), intent ( out ) :: bins real ( dp ), dimension (:), intent ( out ), optional :: deltabins integer :: n real ( dp ), dimension ( numbins + 1 ) :: xdx xdx ( 1 ) = lowbin xdx ( numbins + 1 ) = highbin do n = 2 , numbins xdx ( n ) = exp ( real ( n - 1 , kind = dp ) / real ( numbins , kind = dp ) * log ( xdx ( numbins + 1 ) / xdx ( 1 )) + log ( xdx ( 1 ))) enddo do n = 1 , numbins bins ( n ) = sqrt ( xdx ( n ) * xdx ( n + 1 )) enddo if ( present ( deltabins )) then do n = 1 , numbins deltabins ( n ) = xdx ( n + 1 ) - xdx ( n ) enddo endif end subroutine create_bins subroutine initialize_arrays_freezewater ( table_size ) !! initialize data arrays for [Bigg (1953)](https://doi.org/10.1002/qj.49707934207) freezing of cloud water and rain !! @warning !! six lookup table arrays are allocated and set here !! @endwarning integer , intent ( out ), optional :: table_size ! cloud water freezing if (. not . allocated ( tpi_qcfz )) allocate ( tpi_qcfz ( ntb_c , nbc , ntb_t1 , ntb_in ), source = 0._table_dp ) if (. not . allocated ( tni_qcfz )) allocate ( tni_qcfz ( ntb_c , nbc , ntb_t1 , ntb_in ), source = 0._table_dp ) ! rain freezing if (. not . allocated ( tpi_qrfz )) allocate ( tpi_qrfz ( ntb_r , ntb_r1 , ntb_t1 , ntb_in ), source = 0._table_dp ) if (. not . allocated ( tpg_qrfz )) allocate ( tpg_qrfz ( ntb_r , ntb_r1 , ntb_t1 , ntb_in ), source = 0._table_dp ) if (. not . allocated ( tni_qrfz )) allocate ( tni_qrfz ( ntb_r , ntb_r1 , ntb_t1 , ntb_in ), source = 0._table_dp ) if (. not . allocated ( tnr_qrfz )) allocate ( tnr_qrfz ( ntb_r , ntb_r1 , ntb_t1 , ntb_in ), source = 0._table_dp ) ! table size is precision * entries * dimensions if ( present ( table_size )) then table_size = ( table_dp * 2 * ( ntb_c * nbc * ntb_t1 * ntb_in )) + & ( table_dp * 4 * ( ntb_r * ntb_r1 * ntb_t1 * ntb_in )) endif end subroutine initialize_arrays_freezewater subroutine initialize_arrays_qr_acr_qs ( table_size ) !! initialize data arrays for rain-snow collection !! @warning !! twelve lookup table arrays are allocated and set here !! @endwarning integer , intent ( out ), optional :: table_size if (. not . allocated ( tcs_racs1 )) allocate ( tcs_racs1 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tmr_racs1 )) allocate ( tmr_racs1 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tcs_racs2 )) allocate ( tcs_racs2 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tmr_racs2 )) allocate ( tmr_racs2 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tcr_sacr1 )) allocate ( tcr_sacr1 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tms_sacr1 )) allocate ( tms_sacr1 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tcr_sacr2 )) allocate ( tcr_sacr2 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tms_sacr2 )) allocate ( tms_sacr2 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tnr_racs1 )) allocate ( tnr_racs1 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tnr_racs2 )) allocate ( tnr_racs2 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tnr_sacr1 )) allocate ( tnr_sacr1 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tnr_sacr2 )) allocate ( tnr_sacr2 ( ntb_s , ntb_t , ntb_r1 , ntb_r ), source = 0._table_dp ) ! table size is precision * entries * dimensions if ( present ( table_size )) then table_size = table_dp * 12 * ( ntb_s * ntb_t * ntb_r1 * ntb_r ) endif end subroutine initialize_arrays_qr_acr_qs subroutine initialize_arrays_qr_acr_qg ( table_size ) !! initialize data arrays for rain-graupel collection !! @warning !! five lookup table arrays are allocated and set here !! @endwarning integer , intent ( out ), optional :: table_size ! rain-graupel if (. not . allocated ( tcg_racg )) allocate ( tcg_racg ( ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tmr_racg )) allocate ( tmr_racg ( ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tcr_gacr )) allocate ( tcr_gacr ( ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tnr_racg )) allocate ( tnr_racg ( ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r ), source = 0._table_dp ) if (. not . allocated ( tnr_gacr )) allocate ( tnr_gacr ( ntb_g1 , ntb_g , nrhg , ntb_r1 , ntb_r ), source = 0._table_dp ) ! table size is precision * entries * dimensions if ( present ( table_size )) then table_size = table_dp * 5 * ( ntb_g1 * ntb_g * nrhg * ntb_r1 * ntb_r ) endif end subroutine initialize_arrays_qr_acr_qg subroutine initialize_arrays_ccn ( table_size ) !! initialize data arrays for ccn lookup table !! @warning !! one lookup table array is allocated and set here !! @endwarning integer , intent ( out ), optional :: table_size if (. not . allocated ( tnccn_act )) & allocate ( tnccn_act ( ntb_arc , ntb_arw , ntb_art , ntb_arr , ntb_ark ), source = 0._table_sp ) ! table size is precision * entries * dimensions if ( present ( table_size )) then table_size = table_sp * 1 * ( ntb_arc * ntb_arw * ntb_art * ntb_arr * ntb_ark ) + ( table_sp + table_sp ) * 1 endif end subroutine initialize_arrays_ccn subroutine initialize_arrays_drop_evap () !! initialize data arrays for drop evaporation data !! @warning !! two lookup table arrays are allocated and set here !! @endwarning if (. not . allocated ( tpc_wev )) allocate ( tpc_wev ( nbc , ntb_c , nbc ), source = 0._dp ) if (. not . allocated ( tnc_wev )) allocate ( tnc_wev ( nbc , ntb_c , nbc ), source = 0._dp ) end subroutine initialize_arrays_drop_evap subroutine initialize_array_efsw () !! initializes the collision efficiency data array for snow collecting cloud water !! @warning !! one lookup table array is allocated and set here !! @endwarning if (. not . allocated ( t_efsw )) allocate ( t_efsw ( nbs , nbc ), source = 0._dp ) end subroutine initialize_array_efsw subroutine initialize_array_efrw () !! initializes the collision efficiency data array for rain collecting cloud water !! @warning !! one lookup table array is allocated and set here !! @endwarning if (. not . allocated ( t_efrw )) allocate ( t_efrw ( nbr , nbc ), source = 0._dp ) end subroutine initialize_array_efrw subroutine initialize_arrays_qi_aut_qs () !! initializes data arrays for cloud ice to snow conversion and growth !! @warning !! three lookup table arrays are allocated and set here !! @endwarning if (. not . allocated ( tps_iaus )) allocate ( tps_iaus ( ntb_i , ntb_i1 ), source = 0._dp ) if (. not . allocated ( tni_iaus )) allocate ( tni_iaus ( ntb_i , ntb_i1 ), source = 0._dp ) if (. not . allocated ( tpi_ide )) allocate ( tpi_ide ( ntb_i , ntb_i1 ), source = 0._dp ) end subroutine initialize_arrays_qi_aut_qs end module module_mp_tempo_params","tags":"","url":"sourcefile/module_mp_tempo_params.f90.html"}]}